(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const w of document.querySelectorAll('link[rel="modulepreload"]'))_(w);new MutationObserver(w=>{for(const T of w)if(T.type==="childList")for(const S of T.addedNodes)S.tagName==="LINK"&&S.rel==="modulepreload"&&_(S)}).observe(document,{childList:!0,subtree:!0});function h(w){const T={};return w.integrity&&(T.integrity=w.integrity),w.referrerPolicy&&(T.referrerPolicy=w.referrerPolicy),w.crossOrigin==="use-credentials"?T.credentials="include":w.crossOrigin==="anonymous"?T.credentials="omit":T.credentials="same-origin",T}function _(w){if(w.ep)return;w.ep=!0;const T=h(w);fetch(w.href,T)}})();var vg=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function xg(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Z0={exports:{}},ef={},H0={exports:{}},xr={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ad=Symbol.for("react.element"),Kb=Symbol.for("react.portal"),Jb=Symbol.for("react.fragment"),Yb=Symbol.for("react.strict_mode"),Qb=Symbol.for("react.profiler"),ew=Symbol.for("react.provider"),tw=Symbol.for("react.context"),rw=Symbol.for("react.forward_ref"),iw=Symbol.for("react.suspense"),nw=Symbol.for("react.memo"),sw=Symbol.for("react.lazy"),Fy=Symbol.iterator;function aw(i){return i===null||typeof i!="object"?null:(i=Fy&&i[Fy]||i["@@iterator"],typeof i=="function"?i:null)}var W0={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},X0=Object.assign,K0={};function hh(i,a,h){this.props=i,this.context=a,this.refs=K0,this.updater=h||W0}hh.prototype.isReactComponent={};hh.prototype.setState=function(i,a){if(typeof i!="object"&&typeof i!="function"&&i!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,i,a,"setState")};hh.prototype.forceUpdate=function(i){this.updater.enqueueForceUpdate(this,i,"forceUpdate")};function J0(){}J0.prototype=hh.prototype;function bg(i,a,h){this.props=i,this.context=a,this.refs=K0,this.updater=h||W0}var wg=bg.prototype=new J0;wg.constructor=bg;X0(wg,hh.prototype);wg.isPureReactComponent=!0;var By=Array.isArray,Y0=Object.prototype.hasOwnProperty,Sg={current:null},Q0={key:!0,ref:!0,__self:!0,__source:!0};function ev(i,a,h){var _,w={},T=null,S=null;if(a!=null)for(_ in a.ref!==void 0&&(S=a.ref),a.key!==void 0&&(T=""+a.key),a)Y0.call(a,_)&&!Q0.hasOwnProperty(_)&&(w[_]=a[_]);var d=arguments.length-2;if(d===1)w.children=h;else if(1<d){for(var q=Array(d),me=0;me<d;me++)q[me]=arguments[me+2];w.children=q}if(i&&i.defaultProps)for(_ in d=i.defaultProps,d)w[_]===void 0&&(w[_]=d[_]);return{$$typeof:Ad,type:i,key:T,ref:S,props:w,_owner:Sg.current}}function ow(i,a){return{$$typeof:Ad,type:i.type,key:a,ref:i.ref,props:i.props,_owner:i._owner}}function Mg(i){return typeof i=="object"&&i!==null&&i.$$typeof===Ad}function lw(i){var a={"=":"=0",":":"=2"};return"$"+i.replace(/[=:]/g,function(h){return a[h]})}var Oy=/\/+/g;function Qf(i,a){return typeof i=="object"&&i!==null&&i.key!=null?lw(""+i.key):a.toString(36)}function yp(i,a,h,_,w){var T=typeof i;(T==="undefined"||T==="boolean")&&(i=null);var S=!1;if(i===null)S=!0;else switch(T){case"string":case"number":S=!0;break;case"object":switch(i.$$typeof){case Ad:case Kb:S=!0}}if(S)return S=i,w=w(S),i=_===""?"."+Qf(S,0):_,By(w)?(h="",i!=null&&(h=i.replace(Oy,"$&/")+"/"),yp(w,a,h,"",function(me){return me})):w!=null&&(Mg(w)&&(w=ow(w,h+(!w.key||S&&S.key===w.key?"":(""+w.key).replace(Oy,"$&/")+"/")+i)),a.push(w)),1;if(S=0,_=_===""?".":_+":",By(i))for(var d=0;d<i.length;d++){T=i[d];var q=_+Qf(T,d);S+=yp(T,a,h,q,w)}else if(q=aw(i),typeof q=="function")for(i=q.call(i),d=0;!(T=i.next()).done;)T=T.value,q=_+Qf(T,d++),S+=yp(T,a,h,q,w);else if(T==="object")throw a=String(i),Error("Objects are not valid as a React child (found: "+(a==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":a)+"). If you meant to render a collection of children, use an array instead.");return S}function tp(i,a,h){if(i==null)return i;var _=[],w=0;return yp(i,_,"","",function(T){return a.call(h,T,w++)}),_}function cw(i){if(i._status===-1){var a=i._result;a=a(),a.then(function(h){(i._status===0||i._status===-1)&&(i._status=1,i._result=h)},function(h){(i._status===0||i._status===-1)&&(i._status=2,i._result=h)}),i._status===-1&&(i._status=0,i._result=a)}if(i._status===1)return i._result.default;throw i._result}var Zn={current:null},vp={transition:null},uw={ReactCurrentDispatcher:Zn,ReactCurrentBatchConfig:vp,ReactCurrentOwner:Sg};function tv(){throw Error("act(...) is not supported in production builds of React.")}xr.Children={map:tp,forEach:function(i,a,h){tp(i,function(){a.apply(this,arguments)},h)},count:function(i){var a=0;return tp(i,function(){a++}),a},toArray:function(i){return tp(i,function(a){return a})||[]},only:function(i){if(!Mg(i))throw Error("React.Children.only expected to receive a single React element child.");return i}};xr.Component=hh;xr.Fragment=Jb;xr.Profiler=Qb;xr.PureComponent=bg;xr.StrictMode=Yb;xr.Suspense=iw;xr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=uw;xr.act=tv;xr.cloneElement=function(i,a,h){if(i==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+i+".");var _=X0({},i.props),w=i.key,T=i.ref,S=i._owner;if(a!=null){if(a.ref!==void 0&&(T=a.ref,S=Sg.current),a.key!==void 0&&(w=""+a.key),i.type&&i.type.defaultProps)var d=i.type.defaultProps;for(q in a)Y0.call(a,q)&&!Q0.hasOwnProperty(q)&&(_[q]=a[q]===void 0&&d!==void 0?d[q]:a[q])}var q=arguments.length-2;if(q===1)_.children=h;else if(1<q){d=Array(q);for(var me=0;me<q;me++)d[me]=arguments[me+2];_.children=d}return{$$typeof:Ad,type:i.type,key:w,ref:T,props:_,_owner:S}};xr.createContext=function(i){return i={$$typeof:tw,_currentValue:i,_currentValue2:i,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},i.Provider={$$typeof:ew,_context:i},i.Consumer=i};xr.createElement=ev;xr.createFactory=function(i){var a=ev.bind(null,i);return a.type=i,a};xr.createRef=function(){return{current:null}};xr.forwardRef=function(i){return{$$typeof:rw,render:i}};xr.isValidElement=Mg;xr.lazy=function(i){return{$$typeof:sw,_payload:{_status:-1,_result:i},_init:cw}};xr.memo=function(i,a){return{$$typeof:nw,type:i,compare:a===void 0?null:a}};xr.startTransition=function(i){var a=vp.transition;vp.transition={};try{i()}finally{vp.transition=a}};xr.unstable_act=tv;xr.useCallback=function(i,a){return Zn.current.useCallback(i,a)};xr.useContext=function(i){return Zn.current.useContext(i)};xr.useDebugValue=function(){};xr.useDeferredValue=function(i){return Zn.current.useDeferredValue(i)};xr.useEffect=function(i,a){return Zn.current.useEffect(i,a)};xr.useId=function(){return Zn.current.useId()};xr.useImperativeHandle=function(i,a,h){return Zn.current.useImperativeHandle(i,a,h)};xr.useInsertionEffect=function(i,a){return Zn.current.useInsertionEffect(i,a)};xr.useLayoutEffect=function(i,a){return Zn.current.useLayoutEffect(i,a)};xr.useMemo=function(i,a){return Zn.current.useMemo(i,a)};xr.useReducer=function(i,a,h){return Zn.current.useReducer(i,a,h)};xr.useRef=function(i){return Zn.current.useRef(i)};xr.useState=function(i){return Zn.current.useState(i)};xr.useSyncExternalStore=function(i,a,h){return Zn.current.useSyncExternalStore(i,a,h)};xr.useTransition=function(){return Zn.current.useTransition()};xr.version="18.3.1";H0.exports=xr;var Jt=H0.exports;/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hw=Jt,dw=Symbol.for("react.element"),pw=Symbol.for("react.fragment"),fw=Object.prototype.hasOwnProperty,mw=hw.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,gw={key:!0,ref:!0,__self:!0,__source:!0};function rv(i,a,h){var _,w={},T=null,S=null;h!==void 0&&(T=""+h),a.key!==void 0&&(T=""+a.key),a.ref!==void 0&&(S=a.ref);for(_ in a)fw.call(a,_)&&!gw.hasOwnProperty(_)&&(w[_]=a[_]);if(i&&i.defaultProps)for(_ in a=i.defaultProps,a)w[_]===void 0&&(w[_]=a[_]);return{$$typeof:dw,type:i,key:T,ref:S,props:w,_owner:mw.current}}ef.Fragment=pw;ef.jsx=rv;ef.jsxs=rv;Z0.exports=ef;var Ee=Z0.exports,iv={exports:{}},ks={},nv={exports:{}},sv={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(i){function a(Ye,Fe){var dt=Ye.length;Ye.push(Fe);e:for(;0<dt;){var St=dt-1>>>1,Ze=Ye[St];if(0<w(Ze,Fe))Ye[St]=Fe,Ye[dt]=Ze,dt=St;else break e}}function h(Ye){return Ye.length===0?null:Ye[0]}function _(Ye){if(Ye.length===0)return null;var Fe=Ye[0],dt=Ye.pop();if(dt!==Fe){Ye[0]=dt;e:for(var St=0,Ze=Ye.length,Ot=Ze>>>1;St<Ot;){var Yt=2*(St+1)-1,Ht=Ye[Yt],nr=Yt+1,Qt=Ye[nr];if(0>w(Ht,dt))nr<Ze&&0>w(Qt,Ht)?(Ye[St]=Qt,Ye[nr]=dt,St=nr):(Ye[St]=Ht,Ye[Yt]=dt,St=Yt);else if(nr<Ze&&0>w(Qt,dt))Ye[St]=Qt,Ye[nr]=dt,St=nr;else break e}}return Fe}function w(Ye,Fe){var dt=Ye.sortIndex-Fe.sortIndex;return dt!==0?dt:Ye.id-Fe.id}if(typeof performance=="object"&&typeof performance.now=="function"){var T=performance;i.unstable_now=function(){return T.now()}}else{var S=Date,d=S.now();i.unstable_now=function(){return S.now()-d}}var q=[],me=[],Pe=1,le=null,H=3,Ge=!1,We=!1,ke=!1,gt=typeof setTimeout=="function"?setTimeout:null,he=typeof clearTimeout=="function"?clearTimeout:null,ne=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function _e(Ye){for(var Fe=h(me);Fe!==null;){if(Fe.callback===null)_(me);else if(Fe.startTime<=Ye)_(me),Fe.sortIndex=Fe.expirationTime,a(q,Fe);else break;Fe=h(me)}}function je(Ye){if(ke=!1,_e(Ye),!We)if(h(q)!==null)We=!0,hr(rt);else{var Fe=h(me);Fe!==null&&ht(je,Fe.startTime-Ye)}}function rt(Ye,Fe){We=!1,ke&&(ke=!1,he(ee),ee=-1),Ge=!0;var dt=H;try{for(_e(Fe),le=h(q);le!==null&&(!(le.expirationTime>Fe)||Ye&&!qe());){var St=le.callback;if(typeof St=="function"){le.callback=null,H=le.priorityLevel;var Ze=St(le.expirationTime<=Fe);Fe=i.unstable_now(),typeof Ze=="function"?le.callback=Ze:le===h(q)&&_(q),_e(Fe)}else _(q);le=h(q)}if(le!==null)var Ot=!0;else{var Yt=h(me);Yt!==null&&ht(je,Yt.startTime-Fe),Ot=!1}return Ot}finally{le=null,H=dt,Ge=!1}}var te=!1,Ae=null,ee=-1,de=5,De=-1;function qe(){return!(i.unstable_now()-De<de)}function yt(){if(Ae!==null){var Ye=i.unstable_now();De=Ye;var Fe=!0;try{Fe=Ae(!0,Ye)}finally{Fe?bt():(te=!1,Ae=null)}}else te=!1}var bt;if(typeof ne=="function")bt=function(){ne(yt)};else if(typeof MessageChannel<"u"){var Et=new MessageChannel,or=Et.port2;Et.port1.onmessage=yt,bt=function(){or.postMessage(null)}}else bt=function(){gt(yt,0)};function hr(Ye){Ae=Ye,te||(te=!0,bt())}function ht(Ye,Fe){ee=gt(function(){Ye(i.unstable_now())},Fe)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(Ye){Ye.callback=null},i.unstable_continueExecution=function(){We||Ge||(We=!0,hr(rt))},i.unstable_forceFrameRate=function(Ye){0>Ye||125<Ye?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):de=0<Ye?Math.floor(1e3/Ye):5},i.unstable_getCurrentPriorityLevel=function(){return H},i.unstable_getFirstCallbackNode=function(){return h(q)},i.unstable_next=function(Ye){switch(H){case 1:case 2:case 3:var Fe=3;break;default:Fe=H}var dt=H;H=Fe;try{return Ye()}finally{H=dt}},i.unstable_pauseExecution=function(){},i.unstable_requestPaint=function(){},i.unstable_runWithPriority=function(Ye,Fe){switch(Ye){case 1:case 2:case 3:case 4:case 5:break;default:Ye=3}var dt=H;H=Ye;try{return Fe()}finally{H=dt}},i.unstable_scheduleCallback=function(Ye,Fe,dt){var St=i.unstable_now();switch(typeof dt=="object"&&dt!==null?(dt=dt.delay,dt=typeof dt=="number"&&0<dt?St+dt:St):dt=St,Ye){case 1:var Ze=-1;break;case 2:Ze=250;break;case 5:Ze=1073741823;break;case 4:Ze=1e4;break;default:Ze=5e3}return Ze=dt+Ze,Ye={id:Pe++,callback:Fe,priorityLevel:Ye,startTime:dt,expirationTime:Ze,sortIndex:-1},dt>St?(Ye.sortIndex=dt,a(me,Ye),h(q)===null&&Ye===h(me)&&(ke?(he(ee),ee=-1):ke=!0,ht(je,dt-St))):(Ye.sortIndex=Ze,a(q,Ye),We||Ge||(We=!0,hr(rt))),Ye},i.unstable_shouldYield=qe,i.unstable_wrapCallback=function(Ye){var Fe=H;return function(){var dt=H;H=Fe;try{return Ye.apply(this,arguments)}finally{H=dt}}}})(sv);nv.exports=sv;var _w=nv.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var yw=Jt,Ms=_w;function it(i){for(var a="https://reactjs.org/docs/error-decoder.html?invariant="+i,h=1;h<arguments.length;h++)a+="&args[]="+encodeURIComponent(arguments[h]);return"Minified React error #"+i+"; visit "+a+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var av=new Set,fd={};function Kc(i,a){nh(i,a),nh(i+"Capture",a)}function nh(i,a){for(fd[i]=a,i=0;i<a.length;i++)av.add(a[i])}var Lo=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),km=Object.prototype.hasOwnProperty,vw=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Ny={},$y={};function xw(i){return km.call($y,i)?!0:km.call(Ny,i)?!1:vw.test(i)?$y[i]=!0:(Ny[i]=!0,!1)}function bw(i,a,h,_){if(h!==null&&h.type===0)return!1;switch(typeof a){case"function":case"symbol":return!0;case"boolean":return _?!1:h!==null?!h.acceptsBooleans:(i=i.toLowerCase().slice(0,5),i!=="data-"&&i!=="aria-");default:return!1}}function ww(i,a,h,_){if(a===null||typeof a>"u"||bw(i,a,h,_))return!0;if(_)return!1;if(h!==null)switch(h.type){case 3:return!a;case 4:return a===!1;case 5:return isNaN(a);case 6:return isNaN(a)||1>a}return!1}function Hn(i,a,h,_,w,T,S){this.acceptsBooleans=a===2||a===3||a===4,this.attributeName=_,this.attributeNamespace=w,this.mustUseProperty=h,this.propertyName=i,this.type=a,this.sanitizeURL=T,this.removeEmptyString=S}var In={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(i){In[i]=new Hn(i,0,!1,i,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(i){var a=i[0];In[a]=new Hn(a,1,!1,i[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(i){In[i]=new Hn(i,2,!1,i.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(i){In[i]=new Hn(i,2,!1,i,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(i){In[i]=new Hn(i,3,!1,i.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(i){In[i]=new Hn(i,3,!0,i,null,!1,!1)});["capture","download"].forEach(function(i){In[i]=new Hn(i,4,!1,i,null,!1,!1)});["cols","rows","size","span"].forEach(function(i){In[i]=new Hn(i,6,!1,i,null,!1,!1)});["rowSpan","start"].forEach(function(i){In[i]=new Hn(i,5,!1,i.toLowerCase(),null,!1,!1)});var kg=/[\-:]([a-z])/g;function Tg(i){return i[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(i){var a=i.replace(kg,Tg);In[a]=new Hn(a,1,!1,i,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(i){var a=i.replace(kg,Tg);In[a]=new Hn(a,1,!1,i,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(i){var a=i.replace(kg,Tg);In[a]=new Hn(a,1,!1,i,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(i){In[i]=new Hn(i,1,!1,i.toLowerCase(),null,!1,!1)});In.xlinkHref=new Hn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(i){In[i]=new Hn(i,1,!1,i.toLowerCase(),null,!0,!0)});function Cg(i,a,h,_){var w=In.hasOwnProperty(a)?In[a]:null;(w!==null?w.type!==0:_||!(2<a.length)||a[0]!=="o"&&a[0]!=="O"||a[1]!=="n"&&a[1]!=="N")&&(ww(a,h,w,_)&&(h=null),_||w===null?xw(a)&&(h===null?i.removeAttribute(a):i.setAttribute(a,""+h)):w.mustUseProperty?i[w.propertyName]=h===null?w.type===3?!1:"":h:(a=w.attributeName,_=w.attributeNamespace,h===null?i.removeAttribute(a):(w=w.type,h=w===3||w===4&&h===!0?"":""+h,_?i.setAttributeNS(_,a,h):i.setAttribute(a,h))))}var Oo=yw.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,rp=Symbol.for("react.element"),$u=Symbol.for("react.portal"),ju=Symbol.for("react.fragment"),Ig=Symbol.for("react.strict_mode"),Tm=Symbol.for("react.profiler"),ov=Symbol.for("react.provider"),lv=Symbol.for("react.context"),Eg=Symbol.for("react.forward_ref"),Cm=Symbol.for("react.suspense"),Im=Symbol.for("react.suspense_list"),Pg=Symbol.for("react.memo"),Dl=Symbol.for("react.lazy"),cv=Symbol.for("react.offscreen"),jy=Symbol.iterator;function Hh(i){return i===null||typeof i!="object"?null:(i=jy&&i[jy]||i["@@iterator"],typeof i=="function"?i:null)}var wi=Object.assign,em;function td(i){if(em===void 0)try{throw Error()}catch(h){var a=h.stack.trim().match(/\n( *(at )?)/);em=a&&a[1]||""}return`
`+em+i}var tm=!1;function rm(i,a){if(!i||tm)return"";tm=!0;var h=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(a)if(a=function(){throw Error()},Object.defineProperty(a.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(a,[])}catch(me){var _=me}Reflect.construct(i,[],a)}else{try{a.call()}catch(me){_=me}i.call(a.prototype)}else{try{throw Error()}catch(me){_=me}i()}}catch(me){if(me&&_&&typeof me.stack=="string"){for(var w=me.stack.split(`
`),T=_.stack.split(`
`),S=w.length-1,d=T.length-1;1<=S&&0<=d&&w[S]!==T[d];)d--;for(;1<=S&&0<=d;S--,d--)if(w[S]!==T[d]){if(S!==1||d!==1)do if(S--,d--,0>d||w[S]!==T[d]){var q=`
`+w[S].replace(" at new "," at ");return i.displayName&&q.includes("<anonymous>")&&(q=q.replace("<anonymous>",i.displayName)),q}while(1<=S&&0<=d);break}}}finally{tm=!1,Error.prepareStackTrace=h}return(i=i?i.displayName||i.name:"")?td(i):""}function Sw(i){switch(i.tag){case 5:return td(i.type);case 16:return td("Lazy");case 13:return td("Suspense");case 19:return td("SuspenseList");case 0:case 2:case 15:return i=rm(i.type,!1),i;case 11:return i=rm(i.type.render,!1),i;case 1:return i=rm(i.type,!0),i;default:return""}}function Em(i){if(i==null)return null;if(typeof i=="function")return i.displayName||i.name||null;if(typeof i=="string")return i;switch(i){case ju:return"Fragment";case $u:return"Portal";case Tm:return"Profiler";case Ig:return"StrictMode";case Cm:return"Suspense";case Im:return"SuspenseList"}if(typeof i=="object")switch(i.$$typeof){case lv:return(i.displayName||"Context")+".Consumer";case ov:return(i._context.displayName||"Context")+".Provider";case Eg:var a=i.render;return i=i.displayName,i||(i=a.displayName||a.name||"",i=i!==""?"ForwardRef("+i+")":"ForwardRef"),i;case Pg:return a=i.displayName||null,a!==null?a:Em(i.type)||"Memo";case Dl:a=i._payload,i=i._init;try{return Em(i(a))}catch{}}return null}function Mw(i){var a=i.type;switch(i.tag){case 24:return"Cache";case 9:return(a.displayName||"Context")+".Consumer";case 10:return(a._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return i=a.render,i=i.displayName||i.name||"",a.displayName||(i!==""?"ForwardRef("+i+")":"ForwardRef");case 7:return"Fragment";case 5:return a;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Em(a);case 8:return a===Ig?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof a=="function")return a.displayName||a.name||null;if(typeof a=="string")return a}return null}function Zl(i){switch(typeof i){case"boolean":case"number":case"string":case"undefined":return i;case"object":return i;default:return""}}function uv(i){var a=i.type;return(i=i.nodeName)&&i.toLowerCase()==="input"&&(a==="checkbox"||a==="radio")}function kw(i){var a=uv(i)?"checked":"value",h=Object.getOwnPropertyDescriptor(i.constructor.prototype,a),_=""+i[a];if(!i.hasOwnProperty(a)&&typeof h<"u"&&typeof h.get=="function"&&typeof h.set=="function"){var w=h.get,T=h.set;return Object.defineProperty(i,a,{configurable:!0,get:function(){return w.call(this)},set:function(S){_=""+S,T.call(this,S)}}),Object.defineProperty(i,a,{enumerable:h.enumerable}),{getValue:function(){return _},setValue:function(S){_=""+S},stopTracking:function(){i._valueTracker=null,delete i[a]}}}}function ip(i){i._valueTracker||(i._valueTracker=kw(i))}function hv(i){if(!i)return!1;var a=i._valueTracker;if(!a)return!0;var h=a.getValue(),_="";return i&&(_=uv(i)?i.checked?"true":"false":i.value),i=_,i!==h?(a.setValue(i),!0):!1}function Pp(i){if(i=i||(typeof document<"u"?document:void 0),typeof i>"u")return null;try{return i.activeElement||i.body}catch{return i.body}}function Pm(i,a){var h=a.checked;return wi({},a,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:h??i._wrapperState.initialChecked})}function Vy(i,a){var h=a.defaultValue==null?"":a.defaultValue,_=a.checked!=null?a.checked:a.defaultChecked;h=Zl(a.value!=null?a.value:h),i._wrapperState={initialChecked:_,initialValue:h,controlled:a.type==="checkbox"||a.type==="radio"?a.checked!=null:a.value!=null}}function dv(i,a){a=a.checked,a!=null&&Cg(i,"checked",a,!1)}function Am(i,a){dv(i,a);var h=Zl(a.value),_=a.type;if(h!=null)_==="number"?(h===0&&i.value===""||i.value!=h)&&(i.value=""+h):i.value!==""+h&&(i.value=""+h);else if(_==="submit"||_==="reset"){i.removeAttribute("value");return}a.hasOwnProperty("value")?Dm(i,a.type,h):a.hasOwnProperty("defaultValue")&&Dm(i,a.type,Zl(a.defaultValue)),a.checked==null&&a.defaultChecked!=null&&(i.defaultChecked=!!a.defaultChecked)}function Uy(i,a,h){if(a.hasOwnProperty("value")||a.hasOwnProperty("defaultValue")){var _=a.type;if(!(_!=="submit"&&_!=="reset"||a.value!==void 0&&a.value!==null))return;a=""+i._wrapperState.initialValue,h||a===i.value||(i.value=a),i.defaultValue=a}h=i.name,h!==""&&(i.name=""),i.defaultChecked=!!i._wrapperState.initialChecked,h!==""&&(i.name=h)}function Dm(i,a,h){(a!=="number"||Pp(i.ownerDocument)!==i)&&(h==null?i.defaultValue=""+i._wrapperState.initialValue:i.defaultValue!==""+h&&(i.defaultValue=""+h))}var rd=Array.isArray;function Yu(i,a,h,_){if(i=i.options,a){a={};for(var w=0;w<h.length;w++)a["$"+h[w]]=!0;for(h=0;h<i.length;h++)w=a.hasOwnProperty("$"+i[h].value),i[h].selected!==w&&(i[h].selected=w),w&&_&&(i[h].defaultSelected=!0)}else{for(h=""+Zl(h),a=null,w=0;w<i.length;w++){if(i[w].value===h){i[w].selected=!0,_&&(i[w].defaultSelected=!0);return}a!==null||i[w].disabled||(a=i[w])}a!==null&&(a.selected=!0)}}function zm(i,a){if(a.dangerouslySetInnerHTML!=null)throw Error(it(91));return wi({},a,{value:void 0,defaultValue:void 0,children:""+i._wrapperState.initialValue})}function qy(i,a){var h=a.value;if(h==null){if(h=a.children,a=a.defaultValue,h!=null){if(a!=null)throw Error(it(92));if(rd(h)){if(1<h.length)throw Error(it(93));h=h[0]}a=h}a==null&&(a=""),h=a}i._wrapperState={initialValue:Zl(h)}}function pv(i,a){var h=Zl(a.value),_=Zl(a.defaultValue);h!=null&&(h=""+h,h!==i.value&&(i.value=h),a.defaultValue==null&&i.defaultValue!==h&&(i.defaultValue=h)),_!=null&&(i.defaultValue=""+_)}function Gy(i){var a=i.textContent;a===i._wrapperState.initialValue&&a!==""&&a!==null&&(i.value=a)}function fv(i){switch(i){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Lm(i,a){return i==null||i==="http://www.w3.org/1999/xhtml"?fv(a):i==="http://www.w3.org/2000/svg"&&a==="foreignObject"?"http://www.w3.org/1999/xhtml":i}var np,mv=function(i){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(a,h,_,w){MSApp.execUnsafeLocalFunction(function(){return i(a,h,_,w)})}:i}(function(i,a){if(i.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in i)i.innerHTML=a;else{for(np=np||document.createElement("div"),np.innerHTML="<svg>"+a.valueOf().toString()+"</svg>",a=np.firstChild;i.firstChild;)i.removeChild(i.firstChild);for(;a.firstChild;)i.appendChild(a.firstChild)}});function md(i,a){if(a){var h=i.firstChild;if(h&&h===i.lastChild&&h.nodeType===3){h.nodeValue=a;return}}i.textContent=a}var sd={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Tw=["Webkit","ms","Moz","O"];Object.keys(sd).forEach(function(i){Tw.forEach(function(a){a=a+i.charAt(0).toUpperCase()+i.substring(1),sd[a]=sd[i]})});function gv(i,a,h){return a==null||typeof a=="boolean"||a===""?"":h||typeof a!="number"||a===0||sd.hasOwnProperty(i)&&sd[i]?(""+a).trim():a+"px"}function _v(i,a){i=i.style;for(var h in a)if(a.hasOwnProperty(h)){var _=h.indexOf("--")===0,w=gv(h,a[h],_);h==="float"&&(h="cssFloat"),_?i.setProperty(h,w):i[h]=w}}var Cw=wi({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Rm(i,a){if(a){if(Cw[i]&&(a.children!=null||a.dangerouslySetInnerHTML!=null))throw Error(it(137,i));if(a.dangerouslySetInnerHTML!=null){if(a.children!=null)throw Error(it(60));if(typeof a.dangerouslySetInnerHTML!="object"||!("__html"in a.dangerouslySetInnerHTML))throw Error(it(61))}if(a.style!=null&&typeof a.style!="object")throw Error(it(62))}}function Fm(i,a){if(i.indexOf("-")===-1)return typeof a.is=="string";switch(i){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Bm=null;function Ag(i){return i=i.target||i.srcElement||window,i.correspondingUseElement&&(i=i.correspondingUseElement),i.nodeType===3?i.parentNode:i}var Om=null,Qu=null,eh=null;function Zy(i){if(i=Ld(i)){if(typeof Om!="function")throw Error(it(280));var a=i.stateNode;a&&(a=af(a),Om(i.stateNode,i.type,a))}}function yv(i){Qu?eh?eh.push(i):eh=[i]:Qu=i}function vv(){if(Qu){var i=Qu,a=eh;if(eh=Qu=null,Zy(i),a)for(i=0;i<a.length;i++)Zy(a[i])}}function xv(i,a){return i(a)}function bv(){}var im=!1;function wv(i,a,h){if(im)return i(a,h);im=!0;try{return xv(i,a,h)}finally{im=!1,(Qu!==null||eh!==null)&&(bv(),vv())}}function gd(i,a){var h=i.stateNode;if(h===null)return null;var _=af(h);if(_===null)return null;h=_[a];e:switch(a){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(_=!_.disabled)||(i=i.type,_=!(i==="button"||i==="input"||i==="select"||i==="textarea")),i=!_;break e;default:i=!1}if(i)return null;if(h&&typeof h!="function")throw Error(it(231,a,typeof h));return h}var Nm=!1;if(Lo)try{var Wh={};Object.defineProperty(Wh,"passive",{get:function(){Nm=!0}}),window.addEventListener("test",Wh,Wh),window.removeEventListener("test",Wh,Wh)}catch{Nm=!1}function Iw(i,a,h,_,w,T,S,d,q){var me=Array.prototype.slice.call(arguments,3);try{a.apply(h,me)}catch(Pe){this.onError(Pe)}}var ad=!1,Ap=null,Dp=!1,$m=null,Ew={onError:function(i){ad=!0,Ap=i}};function Pw(i,a,h,_,w,T,S,d,q){ad=!1,Ap=null,Iw.apply(Ew,arguments)}function Aw(i,a,h,_,w,T,S,d,q){if(Pw.apply(this,arguments),ad){if(ad){var me=Ap;ad=!1,Ap=null}else throw Error(it(198));Dp||(Dp=!0,$m=me)}}function Jc(i){var a=i,h=i;if(i.alternate)for(;a.return;)a=a.return;else{i=a;do a=i,a.flags&4098&&(h=a.return),i=a.return;while(i)}return a.tag===3?h:null}function Sv(i){if(i.tag===13){var a=i.memoizedState;if(a===null&&(i=i.alternate,i!==null&&(a=i.memoizedState)),a!==null)return a.dehydrated}return null}function Hy(i){if(Jc(i)!==i)throw Error(it(188))}function Dw(i){var a=i.alternate;if(!a){if(a=Jc(i),a===null)throw Error(it(188));return a!==i?null:i}for(var h=i,_=a;;){var w=h.return;if(w===null)break;var T=w.alternate;if(T===null){if(_=w.return,_!==null){h=_;continue}break}if(w.child===T.child){for(T=w.child;T;){if(T===h)return Hy(w),i;if(T===_)return Hy(w),a;T=T.sibling}throw Error(it(188))}if(h.return!==_.return)h=w,_=T;else{for(var S=!1,d=w.child;d;){if(d===h){S=!0,h=w,_=T;break}if(d===_){S=!0,_=w,h=T;break}d=d.sibling}if(!S){for(d=T.child;d;){if(d===h){S=!0,h=T,_=w;break}if(d===_){S=!0,_=T,h=w;break}d=d.sibling}if(!S)throw Error(it(189))}}if(h.alternate!==_)throw Error(it(190))}if(h.tag!==3)throw Error(it(188));return h.stateNode.current===h?i:a}function Mv(i){return i=Dw(i),i!==null?kv(i):null}function kv(i){if(i.tag===5||i.tag===6)return i;for(i=i.child;i!==null;){var a=kv(i);if(a!==null)return a;i=i.sibling}return null}var Tv=Ms.unstable_scheduleCallback,Wy=Ms.unstable_cancelCallback,zw=Ms.unstable_shouldYield,Lw=Ms.unstable_requestPaint,Fi=Ms.unstable_now,Rw=Ms.unstable_getCurrentPriorityLevel,Dg=Ms.unstable_ImmediatePriority,Cv=Ms.unstable_UserBlockingPriority,zp=Ms.unstable_NormalPriority,Fw=Ms.unstable_LowPriority,Iv=Ms.unstable_IdlePriority,tf=null,Ja=null;function Bw(i){if(Ja&&typeof Ja.onCommitFiberRoot=="function")try{Ja.onCommitFiberRoot(tf,i,void 0,(i.current.flags&128)===128)}catch{}}var _a=Math.clz32?Math.clz32:$w,Ow=Math.log,Nw=Math.LN2;function $w(i){return i>>>=0,i===0?32:31-(Ow(i)/Nw|0)|0}var sp=64,ap=4194304;function id(i){switch(i&-i){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return i&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return i}}function Lp(i,a){var h=i.pendingLanes;if(h===0)return 0;var _=0,w=i.suspendedLanes,T=i.pingedLanes,S=h&268435455;if(S!==0){var d=S&~w;d!==0?_=id(d):(T&=S,T!==0&&(_=id(T)))}else S=h&~w,S!==0?_=id(S):T!==0&&(_=id(T));if(_===0)return 0;if(a!==0&&a!==_&&!(a&w)&&(w=_&-_,T=a&-a,w>=T||w===16&&(T&4194240)!==0))return a;if(_&4&&(_|=h&16),a=i.entangledLanes,a!==0)for(i=i.entanglements,a&=_;0<a;)h=31-_a(a),w=1<<h,_|=i[h],a&=~w;return _}function jw(i,a){switch(i){case 1:case 2:case 4:return a+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Vw(i,a){for(var h=i.suspendedLanes,_=i.pingedLanes,w=i.expirationTimes,T=i.pendingLanes;0<T;){var S=31-_a(T),d=1<<S,q=w[S];q===-1?(!(d&h)||d&_)&&(w[S]=jw(d,a)):q<=a&&(i.expiredLanes|=d),T&=~d}}function jm(i){return i=i.pendingLanes&-1073741825,i!==0?i:i&1073741824?1073741824:0}function Ev(){var i=sp;return sp<<=1,!(sp&4194240)&&(sp=64),i}function nm(i){for(var a=[],h=0;31>h;h++)a.push(i);return a}function Dd(i,a,h){i.pendingLanes|=a,a!==536870912&&(i.suspendedLanes=0,i.pingedLanes=0),i=i.eventTimes,a=31-_a(a),i[a]=h}function Uw(i,a){var h=i.pendingLanes&~a;i.pendingLanes=a,i.suspendedLanes=0,i.pingedLanes=0,i.expiredLanes&=a,i.mutableReadLanes&=a,i.entangledLanes&=a,a=i.entanglements;var _=i.eventTimes;for(i=i.expirationTimes;0<h;){var w=31-_a(h),T=1<<w;a[w]=0,_[w]=-1,i[w]=-1,h&=~T}}function zg(i,a){var h=i.entangledLanes|=a;for(i=i.entanglements;h;){var _=31-_a(h),w=1<<_;w&a|i[_]&a&&(i[_]|=a),h&=~w}}var Xr=0;function Pv(i){return i&=-i,1<i?4<i?i&268435455?16:536870912:4:1}var Av,Lg,Dv,zv,Lv,Vm=!1,op=[],Ol=null,Nl=null,$l=null,_d=new Map,yd=new Map,Ll=[],qw="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Xy(i,a){switch(i){case"focusin":case"focusout":Ol=null;break;case"dragenter":case"dragleave":Nl=null;break;case"mouseover":case"mouseout":$l=null;break;case"pointerover":case"pointerout":_d.delete(a.pointerId);break;case"gotpointercapture":case"lostpointercapture":yd.delete(a.pointerId)}}function Xh(i,a,h,_,w,T){return i===null||i.nativeEvent!==T?(i={blockedOn:a,domEventName:h,eventSystemFlags:_,nativeEvent:T,targetContainers:[w]},a!==null&&(a=Ld(a),a!==null&&Lg(a)),i):(i.eventSystemFlags|=_,a=i.targetContainers,w!==null&&a.indexOf(w)===-1&&a.push(w),i)}function Gw(i,a,h,_,w){switch(a){case"focusin":return Ol=Xh(Ol,i,a,h,_,w),!0;case"dragenter":return Nl=Xh(Nl,i,a,h,_,w),!0;case"mouseover":return $l=Xh($l,i,a,h,_,w),!0;case"pointerover":var T=w.pointerId;return _d.set(T,Xh(_d.get(T)||null,i,a,h,_,w)),!0;case"gotpointercapture":return T=w.pointerId,yd.set(T,Xh(yd.get(T)||null,i,a,h,_,w)),!0}return!1}function Rv(i){var a=$c(i.target);if(a!==null){var h=Jc(a);if(h!==null){if(a=h.tag,a===13){if(a=Sv(h),a!==null){i.blockedOn=a,Lv(i.priority,function(){Dv(h)});return}}else if(a===3&&h.stateNode.current.memoizedState.isDehydrated){i.blockedOn=h.tag===3?h.stateNode.containerInfo:null;return}}}i.blockedOn=null}function xp(i){if(i.blockedOn!==null)return!1;for(var a=i.targetContainers;0<a.length;){var h=Um(i.domEventName,i.eventSystemFlags,a[0],i.nativeEvent);if(h===null){h=i.nativeEvent;var _=new h.constructor(h.type,h);Bm=_,h.target.dispatchEvent(_),Bm=null}else return a=Ld(h),a!==null&&Lg(a),i.blockedOn=h,!1;a.shift()}return!0}function Ky(i,a,h){xp(i)&&h.delete(a)}function Zw(){Vm=!1,Ol!==null&&xp(Ol)&&(Ol=null),Nl!==null&&xp(Nl)&&(Nl=null),$l!==null&&xp($l)&&($l=null),_d.forEach(Ky),yd.forEach(Ky)}function Kh(i,a){i.blockedOn===a&&(i.blockedOn=null,Vm||(Vm=!0,Ms.unstable_scheduleCallback(Ms.unstable_NormalPriority,Zw)))}function vd(i){function a(w){return Kh(w,i)}if(0<op.length){Kh(op[0],i);for(var h=1;h<op.length;h++){var _=op[h];_.blockedOn===i&&(_.blockedOn=null)}}for(Ol!==null&&Kh(Ol,i),Nl!==null&&Kh(Nl,i),$l!==null&&Kh($l,i),_d.forEach(a),yd.forEach(a),h=0;h<Ll.length;h++)_=Ll[h],_.blockedOn===i&&(_.blockedOn=null);for(;0<Ll.length&&(h=Ll[0],h.blockedOn===null);)Rv(h),h.blockedOn===null&&Ll.shift()}var th=Oo.ReactCurrentBatchConfig,Rp=!0;function Hw(i,a,h,_){var w=Xr,T=th.transition;th.transition=null;try{Xr=1,Rg(i,a,h,_)}finally{Xr=w,th.transition=T}}function Ww(i,a,h,_){var w=Xr,T=th.transition;th.transition=null;try{Xr=4,Rg(i,a,h,_)}finally{Xr=w,th.transition=T}}function Rg(i,a,h,_){if(Rp){var w=Um(i,a,h,_);if(w===null)fm(i,a,_,Fp,h),Xy(i,_);else if(Gw(w,i,a,h,_))_.stopPropagation();else if(Xy(i,_),a&4&&-1<qw.indexOf(i)){for(;w!==null;){var T=Ld(w);if(T!==null&&Av(T),T=Um(i,a,h,_),T===null&&fm(i,a,_,Fp,h),T===w)break;w=T}w!==null&&_.stopPropagation()}else fm(i,a,_,null,h)}}var Fp=null;function Um(i,a,h,_){if(Fp=null,i=Ag(_),i=$c(i),i!==null)if(a=Jc(i),a===null)i=null;else if(h=a.tag,h===13){if(i=Sv(a),i!==null)return i;i=null}else if(h===3){if(a.stateNode.current.memoizedState.isDehydrated)return a.tag===3?a.stateNode.containerInfo:null;i=null}else a!==i&&(i=null);return Fp=i,null}function Fv(i){switch(i){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Rw()){case Dg:return 1;case Cv:return 4;case zp:case Fw:return 16;case Iv:return 536870912;default:return 16}default:return 16}}var Fl=null,Fg=null,bp=null;function Bv(){if(bp)return bp;var i,a=Fg,h=a.length,_,w="value"in Fl?Fl.value:Fl.textContent,T=w.length;for(i=0;i<h&&a[i]===w[i];i++);var S=h-i;for(_=1;_<=S&&a[h-_]===w[T-_];_++);return bp=w.slice(i,1<_?1-_:void 0)}function wp(i){var a=i.keyCode;return"charCode"in i?(i=i.charCode,i===0&&a===13&&(i=13)):i=a,i===10&&(i=13),32<=i||i===13?i:0}function lp(){return!0}function Jy(){return!1}function Ts(i){function a(h,_,w,T,S){this._reactName=h,this._targetInst=w,this.type=_,this.nativeEvent=T,this.target=S,this.currentTarget=null;for(var d in i)i.hasOwnProperty(d)&&(h=i[d],this[d]=h?h(T):T[d]);return this.isDefaultPrevented=(T.defaultPrevented!=null?T.defaultPrevented:T.returnValue===!1)?lp:Jy,this.isPropagationStopped=Jy,this}return wi(a.prototype,{preventDefault:function(){this.defaultPrevented=!0;var h=this.nativeEvent;h&&(h.preventDefault?h.preventDefault():typeof h.returnValue!="unknown"&&(h.returnValue=!1),this.isDefaultPrevented=lp)},stopPropagation:function(){var h=this.nativeEvent;h&&(h.stopPropagation?h.stopPropagation():typeof h.cancelBubble!="unknown"&&(h.cancelBubble=!0),this.isPropagationStopped=lp)},persist:function(){},isPersistent:lp}),a}var dh={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(i){return i.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Bg=Ts(dh),zd=wi({},dh,{view:0,detail:0}),Xw=Ts(zd),sm,am,Jh,rf=wi({},zd,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Og,button:0,buttons:0,relatedTarget:function(i){return i.relatedTarget===void 0?i.fromElement===i.srcElement?i.toElement:i.fromElement:i.relatedTarget},movementX:function(i){return"movementX"in i?i.movementX:(i!==Jh&&(Jh&&i.type==="mousemove"?(sm=i.screenX-Jh.screenX,am=i.screenY-Jh.screenY):am=sm=0,Jh=i),sm)},movementY:function(i){return"movementY"in i?i.movementY:am}}),Yy=Ts(rf),Kw=wi({},rf,{dataTransfer:0}),Jw=Ts(Kw),Yw=wi({},zd,{relatedTarget:0}),om=Ts(Yw),Qw=wi({},dh,{animationName:0,elapsedTime:0,pseudoElement:0}),e2=Ts(Qw),t2=wi({},dh,{clipboardData:function(i){return"clipboardData"in i?i.clipboardData:window.clipboardData}}),r2=Ts(t2),i2=wi({},dh,{data:0}),Qy=Ts(i2),n2={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},s2={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},a2={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function o2(i){var a=this.nativeEvent;return a.getModifierState?a.getModifierState(i):(i=a2[i])?!!a[i]:!1}function Og(){return o2}var l2=wi({},zd,{key:function(i){if(i.key){var a=n2[i.key]||i.key;if(a!=="Unidentified")return a}return i.type==="keypress"?(i=wp(i),i===13?"Enter":String.fromCharCode(i)):i.type==="keydown"||i.type==="keyup"?s2[i.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Og,charCode:function(i){return i.type==="keypress"?wp(i):0},keyCode:function(i){return i.type==="keydown"||i.type==="keyup"?i.keyCode:0},which:function(i){return i.type==="keypress"?wp(i):i.type==="keydown"||i.type==="keyup"?i.keyCode:0}}),c2=Ts(l2),u2=wi({},rf,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),e0=Ts(u2),h2=wi({},zd,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Og}),d2=Ts(h2),p2=wi({},dh,{propertyName:0,elapsedTime:0,pseudoElement:0}),f2=Ts(p2),m2=wi({},rf,{deltaX:function(i){return"deltaX"in i?i.deltaX:"wheelDeltaX"in i?-i.wheelDeltaX:0},deltaY:function(i){return"deltaY"in i?i.deltaY:"wheelDeltaY"in i?-i.wheelDeltaY:"wheelDelta"in i?-i.wheelDelta:0},deltaZ:0,deltaMode:0}),g2=Ts(m2),_2=[9,13,27,32],Ng=Lo&&"CompositionEvent"in window,od=null;Lo&&"documentMode"in document&&(od=document.documentMode);var y2=Lo&&"TextEvent"in window&&!od,Ov=Lo&&(!Ng||od&&8<od&&11>=od),t0=" ",r0=!1;function Nv(i,a){switch(i){case"keyup":return _2.indexOf(a.keyCode)!==-1;case"keydown":return a.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function $v(i){return i=i.detail,typeof i=="object"&&"data"in i?i.data:null}var Vu=!1;function v2(i,a){switch(i){case"compositionend":return $v(a);case"keypress":return a.which!==32?null:(r0=!0,t0);case"textInput":return i=a.data,i===t0&&r0?null:i;default:return null}}function x2(i,a){if(Vu)return i==="compositionend"||!Ng&&Nv(i,a)?(i=Bv(),bp=Fg=Fl=null,Vu=!1,i):null;switch(i){case"paste":return null;case"keypress":if(!(a.ctrlKey||a.altKey||a.metaKey)||a.ctrlKey&&a.altKey){if(a.char&&1<a.char.length)return a.char;if(a.which)return String.fromCharCode(a.which)}return null;case"compositionend":return Ov&&a.locale!=="ko"?null:a.data;default:return null}}var b2={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function i0(i){var a=i&&i.nodeName&&i.nodeName.toLowerCase();return a==="input"?!!b2[i.type]:a==="textarea"}function jv(i,a,h,_){yv(_),a=Bp(a,"onChange"),0<a.length&&(h=new Bg("onChange","change",null,h,_),i.push({event:h,listeners:a}))}var ld=null,xd=null;function w2(i){Yv(i,0)}function nf(i){var a=Gu(i);if(hv(a))return i}function S2(i,a){if(i==="change")return a}var Vv=!1;if(Lo){var lm;if(Lo){var cm="oninput"in document;if(!cm){var n0=document.createElement("div");n0.setAttribute("oninput","return;"),cm=typeof n0.oninput=="function"}lm=cm}else lm=!1;Vv=lm&&(!document.documentMode||9<document.documentMode)}function s0(){ld&&(ld.detachEvent("onpropertychange",Uv),xd=ld=null)}function Uv(i){if(i.propertyName==="value"&&nf(xd)){var a=[];jv(a,xd,i,Ag(i)),wv(w2,a)}}function M2(i,a,h){i==="focusin"?(s0(),ld=a,xd=h,ld.attachEvent("onpropertychange",Uv)):i==="focusout"&&s0()}function k2(i){if(i==="selectionchange"||i==="keyup"||i==="keydown")return nf(xd)}function T2(i,a){if(i==="click")return nf(a)}function C2(i,a){if(i==="input"||i==="change")return nf(a)}function I2(i,a){return i===a&&(i!==0||1/i===1/a)||i!==i&&a!==a}var va=typeof Object.is=="function"?Object.is:I2;function bd(i,a){if(va(i,a))return!0;if(typeof i!="object"||i===null||typeof a!="object"||a===null)return!1;var h=Object.keys(i),_=Object.keys(a);if(h.length!==_.length)return!1;for(_=0;_<h.length;_++){var w=h[_];if(!km.call(a,w)||!va(i[w],a[w]))return!1}return!0}function a0(i){for(;i&&i.firstChild;)i=i.firstChild;return i}function o0(i,a){var h=a0(i);i=0;for(var _;h;){if(h.nodeType===3){if(_=i+h.textContent.length,i<=a&&_>=a)return{node:h,offset:a-i};i=_}e:{for(;h;){if(h.nextSibling){h=h.nextSibling;break e}h=h.parentNode}h=void 0}h=a0(h)}}function qv(i,a){return i&&a?i===a?!0:i&&i.nodeType===3?!1:a&&a.nodeType===3?qv(i,a.parentNode):"contains"in i?i.contains(a):i.compareDocumentPosition?!!(i.compareDocumentPosition(a)&16):!1:!1}function Gv(){for(var i=window,a=Pp();a instanceof i.HTMLIFrameElement;){try{var h=typeof a.contentWindow.location.href=="string"}catch{h=!1}if(h)i=a.contentWindow;else break;a=Pp(i.document)}return a}function $g(i){var a=i&&i.nodeName&&i.nodeName.toLowerCase();return a&&(a==="input"&&(i.type==="text"||i.type==="search"||i.type==="tel"||i.type==="url"||i.type==="password")||a==="textarea"||i.contentEditable==="true")}function E2(i){var a=Gv(),h=i.focusedElem,_=i.selectionRange;if(a!==h&&h&&h.ownerDocument&&qv(h.ownerDocument.documentElement,h)){if(_!==null&&$g(h)){if(a=_.start,i=_.end,i===void 0&&(i=a),"selectionStart"in h)h.selectionStart=a,h.selectionEnd=Math.min(i,h.value.length);else if(i=(a=h.ownerDocument||document)&&a.defaultView||window,i.getSelection){i=i.getSelection();var w=h.textContent.length,T=Math.min(_.start,w);_=_.end===void 0?T:Math.min(_.end,w),!i.extend&&T>_&&(w=_,_=T,T=w),w=o0(h,T);var S=o0(h,_);w&&S&&(i.rangeCount!==1||i.anchorNode!==w.node||i.anchorOffset!==w.offset||i.focusNode!==S.node||i.focusOffset!==S.offset)&&(a=a.createRange(),a.setStart(w.node,w.offset),i.removeAllRanges(),T>_?(i.addRange(a),i.extend(S.node,S.offset)):(a.setEnd(S.node,S.offset),i.addRange(a)))}}for(a=[],i=h;i=i.parentNode;)i.nodeType===1&&a.push({element:i,left:i.scrollLeft,top:i.scrollTop});for(typeof h.focus=="function"&&h.focus(),h=0;h<a.length;h++)i=a[h],i.element.scrollLeft=i.left,i.element.scrollTop=i.top}}var P2=Lo&&"documentMode"in document&&11>=document.documentMode,Uu=null,qm=null,cd=null,Gm=!1;function l0(i,a,h){var _=h.window===h?h.document:h.nodeType===9?h:h.ownerDocument;Gm||Uu==null||Uu!==Pp(_)||(_=Uu,"selectionStart"in _&&$g(_)?_={start:_.selectionStart,end:_.selectionEnd}:(_=(_.ownerDocument&&_.ownerDocument.defaultView||window).getSelection(),_={anchorNode:_.anchorNode,anchorOffset:_.anchorOffset,focusNode:_.focusNode,focusOffset:_.focusOffset}),cd&&bd(cd,_)||(cd=_,_=Bp(qm,"onSelect"),0<_.length&&(a=new Bg("onSelect","select",null,a,h),i.push({event:a,listeners:_}),a.target=Uu)))}function cp(i,a){var h={};return h[i.toLowerCase()]=a.toLowerCase(),h["Webkit"+i]="webkit"+a,h["Moz"+i]="moz"+a,h}var qu={animationend:cp("Animation","AnimationEnd"),animationiteration:cp("Animation","AnimationIteration"),animationstart:cp("Animation","AnimationStart"),transitionend:cp("Transition","TransitionEnd")},um={},Zv={};Lo&&(Zv=document.createElement("div").style,"AnimationEvent"in window||(delete qu.animationend.animation,delete qu.animationiteration.animation,delete qu.animationstart.animation),"TransitionEvent"in window||delete qu.transitionend.transition);function sf(i){if(um[i])return um[i];if(!qu[i])return i;var a=qu[i],h;for(h in a)if(a.hasOwnProperty(h)&&h in Zv)return um[i]=a[h];return i}var Hv=sf("animationend"),Wv=sf("animationiteration"),Xv=sf("animationstart"),Kv=sf("transitionend"),Jv=new Map,c0="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Wl(i,a){Jv.set(i,a),Kc(a,[i])}for(var hm=0;hm<c0.length;hm++){var dm=c0[hm],A2=dm.toLowerCase(),D2=dm[0].toUpperCase()+dm.slice(1);Wl(A2,"on"+D2)}Wl(Hv,"onAnimationEnd");Wl(Wv,"onAnimationIteration");Wl(Xv,"onAnimationStart");Wl("dblclick","onDoubleClick");Wl("focusin","onFocus");Wl("focusout","onBlur");Wl(Kv,"onTransitionEnd");nh("onMouseEnter",["mouseout","mouseover"]);nh("onMouseLeave",["mouseout","mouseover"]);nh("onPointerEnter",["pointerout","pointerover"]);nh("onPointerLeave",["pointerout","pointerover"]);Kc("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Kc("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Kc("onBeforeInput",["compositionend","keypress","textInput","paste"]);Kc("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Kc("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Kc("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var nd="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),z2=new Set("cancel close invalid load scroll toggle".split(" ").concat(nd));function u0(i,a,h){var _=i.type||"unknown-event";i.currentTarget=h,Aw(_,a,void 0,i),i.currentTarget=null}function Yv(i,a){a=(a&4)!==0;for(var h=0;h<i.length;h++){var _=i[h],w=_.event;_=_.listeners;e:{var T=void 0;if(a)for(var S=_.length-1;0<=S;S--){var d=_[S],q=d.instance,me=d.currentTarget;if(d=d.listener,q!==T&&w.isPropagationStopped())break e;u0(w,d,me),T=q}else for(S=0;S<_.length;S++){if(d=_[S],q=d.instance,me=d.currentTarget,d=d.listener,q!==T&&w.isPropagationStopped())break e;u0(w,d,me),T=q}}}if(Dp)throw i=$m,Dp=!1,$m=null,i}function ni(i,a){var h=a[Km];h===void 0&&(h=a[Km]=new Set);var _=i+"__bubble";h.has(_)||(Qv(a,i,2,!1),h.add(_))}function pm(i,a,h){var _=0;a&&(_|=4),Qv(h,i,_,a)}var up="_reactListening"+Math.random().toString(36).slice(2);function wd(i){if(!i[up]){i[up]=!0,av.forEach(function(h){h!=="selectionchange"&&(z2.has(h)||pm(h,!1,i),pm(h,!0,i))});var a=i.nodeType===9?i:i.ownerDocument;a===null||a[up]||(a[up]=!0,pm("selectionchange",!1,a))}}function Qv(i,a,h,_){switch(Fv(a)){case 1:var w=Hw;break;case 4:w=Ww;break;default:w=Rg}h=w.bind(null,a,h,i),w=void 0,!Nm||a!=="touchstart"&&a!=="touchmove"&&a!=="wheel"||(w=!0),_?w!==void 0?i.addEventListener(a,h,{capture:!0,passive:w}):i.addEventListener(a,h,!0):w!==void 0?i.addEventListener(a,h,{passive:w}):i.addEventListener(a,h,!1)}function fm(i,a,h,_,w){var T=_;if(!(a&1)&&!(a&2)&&_!==null)e:for(;;){if(_===null)return;var S=_.tag;if(S===3||S===4){var d=_.stateNode.containerInfo;if(d===w||d.nodeType===8&&d.parentNode===w)break;if(S===4)for(S=_.return;S!==null;){var q=S.tag;if((q===3||q===4)&&(q=S.stateNode.containerInfo,q===w||q.nodeType===8&&q.parentNode===w))return;S=S.return}for(;d!==null;){if(S=$c(d),S===null)return;if(q=S.tag,q===5||q===6){_=T=S;continue e}d=d.parentNode}}_=_.return}wv(function(){var me=T,Pe=Ag(h),le=[];e:{var H=Jv.get(i);if(H!==void 0){var Ge=Bg,We=i;switch(i){case"keypress":if(wp(h)===0)break e;case"keydown":case"keyup":Ge=c2;break;case"focusin":We="focus",Ge=om;break;case"focusout":We="blur",Ge=om;break;case"beforeblur":case"afterblur":Ge=om;break;case"click":if(h.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Ge=Yy;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Ge=Jw;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Ge=d2;break;case Hv:case Wv:case Xv:Ge=e2;break;case Kv:Ge=f2;break;case"scroll":Ge=Xw;break;case"wheel":Ge=g2;break;case"copy":case"cut":case"paste":Ge=r2;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Ge=e0}var ke=(a&4)!==0,gt=!ke&&i==="scroll",he=ke?H!==null?H+"Capture":null:H;ke=[];for(var ne=me,_e;ne!==null;){_e=ne;var je=_e.stateNode;if(_e.tag===5&&je!==null&&(_e=je,he!==null&&(je=gd(ne,he),je!=null&&ke.push(Sd(ne,je,_e)))),gt)break;ne=ne.return}0<ke.length&&(H=new Ge(H,We,null,h,Pe),le.push({event:H,listeners:ke}))}}if(!(a&7)){e:{if(H=i==="mouseover"||i==="pointerover",Ge=i==="mouseout"||i==="pointerout",H&&h!==Bm&&(We=h.relatedTarget||h.fromElement)&&($c(We)||We[Ro]))break e;if((Ge||H)&&(H=Pe.window===Pe?Pe:(H=Pe.ownerDocument)?H.defaultView||H.parentWindow:window,Ge?(We=h.relatedTarget||h.toElement,Ge=me,We=We?$c(We):null,We!==null&&(gt=Jc(We),We!==gt||We.tag!==5&&We.tag!==6)&&(We=null)):(Ge=null,We=me),Ge!==We)){if(ke=Yy,je="onMouseLeave",he="onMouseEnter",ne="mouse",(i==="pointerout"||i==="pointerover")&&(ke=e0,je="onPointerLeave",he="onPointerEnter",ne="pointer"),gt=Ge==null?H:Gu(Ge),_e=We==null?H:Gu(We),H=new ke(je,ne+"leave",Ge,h,Pe),H.target=gt,H.relatedTarget=_e,je=null,$c(Pe)===me&&(ke=new ke(he,ne+"enter",We,h,Pe),ke.target=_e,ke.relatedTarget=gt,je=ke),gt=je,Ge&&We)t:{for(ke=Ge,he=We,ne=0,_e=ke;_e;_e=Ou(_e))ne++;for(_e=0,je=he;je;je=Ou(je))_e++;for(;0<ne-_e;)ke=Ou(ke),ne--;for(;0<_e-ne;)he=Ou(he),_e--;for(;ne--;){if(ke===he||he!==null&&ke===he.alternate)break t;ke=Ou(ke),he=Ou(he)}ke=null}else ke=null;Ge!==null&&h0(le,H,Ge,ke,!1),We!==null&&gt!==null&&h0(le,gt,We,ke,!0)}}e:{if(H=me?Gu(me):window,Ge=H.nodeName&&H.nodeName.toLowerCase(),Ge==="select"||Ge==="input"&&H.type==="file")var rt=S2;else if(i0(H))if(Vv)rt=C2;else{rt=k2;var te=M2}else(Ge=H.nodeName)&&Ge.toLowerCase()==="input"&&(H.type==="checkbox"||H.type==="radio")&&(rt=T2);if(rt&&(rt=rt(i,me))){jv(le,rt,h,Pe);break e}te&&te(i,H,me),i==="focusout"&&(te=H._wrapperState)&&te.controlled&&H.type==="number"&&Dm(H,"number",H.value)}switch(te=me?Gu(me):window,i){case"focusin":(i0(te)||te.contentEditable==="true")&&(Uu=te,qm=me,cd=null);break;case"focusout":cd=qm=Uu=null;break;case"mousedown":Gm=!0;break;case"contextmenu":case"mouseup":case"dragend":Gm=!1,l0(le,h,Pe);break;case"selectionchange":if(P2)break;case"keydown":case"keyup":l0(le,h,Pe)}var Ae;if(Ng)e:{switch(i){case"compositionstart":var ee="onCompositionStart";break e;case"compositionend":ee="onCompositionEnd";break e;case"compositionupdate":ee="onCompositionUpdate";break e}ee=void 0}else Vu?Nv(i,h)&&(ee="onCompositionEnd"):i==="keydown"&&h.keyCode===229&&(ee="onCompositionStart");ee&&(Ov&&h.locale!=="ko"&&(Vu||ee!=="onCompositionStart"?ee==="onCompositionEnd"&&Vu&&(Ae=Bv()):(Fl=Pe,Fg="value"in Fl?Fl.value:Fl.textContent,Vu=!0)),te=Bp(me,ee),0<te.length&&(ee=new Qy(ee,i,null,h,Pe),le.push({event:ee,listeners:te}),Ae?ee.data=Ae:(Ae=$v(h),Ae!==null&&(ee.data=Ae)))),(Ae=y2?v2(i,h):x2(i,h))&&(me=Bp(me,"onBeforeInput"),0<me.length&&(Pe=new Qy("onBeforeInput","beforeinput",null,h,Pe),le.push({event:Pe,listeners:me}),Pe.data=Ae))}Yv(le,a)})}function Sd(i,a,h){return{instance:i,listener:a,currentTarget:h}}function Bp(i,a){for(var h=a+"Capture",_=[];i!==null;){var w=i,T=w.stateNode;w.tag===5&&T!==null&&(w=T,T=gd(i,h),T!=null&&_.unshift(Sd(i,T,w)),T=gd(i,a),T!=null&&_.push(Sd(i,T,w))),i=i.return}return _}function Ou(i){if(i===null)return null;do i=i.return;while(i&&i.tag!==5);return i||null}function h0(i,a,h,_,w){for(var T=a._reactName,S=[];h!==null&&h!==_;){var d=h,q=d.alternate,me=d.stateNode;if(q!==null&&q===_)break;d.tag===5&&me!==null&&(d=me,w?(q=gd(h,T),q!=null&&S.unshift(Sd(h,q,d))):w||(q=gd(h,T),q!=null&&S.push(Sd(h,q,d)))),h=h.return}S.length!==0&&i.push({event:a,listeners:S})}var L2=/\r\n?/g,R2=/\u0000|\uFFFD/g;function d0(i){return(typeof i=="string"?i:""+i).replace(L2,`
`).replace(R2,"")}function hp(i,a,h){if(a=d0(a),d0(i)!==a&&h)throw Error(it(425))}function Op(){}var Zm=null,Hm=null;function Wm(i,a){return i==="textarea"||i==="noscript"||typeof a.children=="string"||typeof a.children=="number"||typeof a.dangerouslySetInnerHTML=="object"&&a.dangerouslySetInnerHTML!==null&&a.dangerouslySetInnerHTML.__html!=null}var Xm=typeof setTimeout=="function"?setTimeout:void 0,F2=typeof clearTimeout=="function"?clearTimeout:void 0,p0=typeof Promise=="function"?Promise:void 0,B2=typeof queueMicrotask=="function"?queueMicrotask:typeof p0<"u"?function(i){return p0.resolve(null).then(i).catch(O2)}:Xm;function O2(i){setTimeout(function(){throw i})}function mm(i,a){var h=a,_=0;do{var w=h.nextSibling;if(i.removeChild(h),w&&w.nodeType===8)if(h=w.data,h==="/$"){if(_===0){i.removeChild(w),vd(a);return}_--}else h!=="$"&&h!=="$?"&&h!=="$!"||_++;h=w}while(h);vd(a)}function jl(i){for(;i!=null;i=i.nextSibling){var a=i.nodeType;if(a===1||a===3)break;if(a===8){if(a=i.data,a==="$"||a==="$!"||a==="$?")break;if(a==="/$")return null}}return i}function f0(i){i=i.previousSibling;for(var a=0;i;){if(i.nodeType===8){var h=i.data;if(h==="$"||h==="$!"||h==="$?"){if(a===0)return i;a--}else h==="/$"&&a++}i=i.previousSibling}return null}var ph=Math.random().toString(36).slice(2),Ka="__reactFiber$"+ph,Md="__reactProps$"+ph,Ro="__reactContainer$"+ph,Km="__reactEvents$"+ph,N2="__reactListeners$"+ph,$2="__reactHandles$"+ph;function $c(i){var a=i[Ka];if(a)return a;for(var h=i.parentNode;h;){if(a=h[Ro]||h[Ka]){if(h=a.alternate,a.child!==null||h!==null&&h.child!==null)for(i=f0(i);i!==null;){if(h=i[Ka])return h;i=f0(i)}return a}i=h,h=i.parentNode}return null}function Ld(i){return i=i[Ka]||i[Ro],!i||i.tag!==5&&i.tag!==6&&i.tag!==13&&i.tag!==3?null:i}function Gu(i){if(i.tag===5||i.tag===6)return i.stateNode;throw Error(it(33))}function af(i){return i[Md]||null}var Jm=[],Zu=-1;function Xl(i){return{current:i}}function si(i){0>Zu||(i.current=Jm[Zu],Jm[Zu]=null,Zu--)}function ii(i,a){Zu++,Jm[Zu]=i.current,i.current=a}var Hl={},Fn=Xl(Hl),rs=Xl(!1),Gc=Hl;function sh(i,a){var h=i.type.contextTypes;if(!h)return Hl;var _=i.stateNode;if(_&&_.__reactInternalMemoizedUnmaskedChildContext===a)return _.__reactInternalMemoizedMaskedChildContext;var w={},T;for(T in h)w[T]=a[T];return _&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=a,i.__reactInternalMemoizedMaskedChildContext=w),w}function is(i){return i=i.childContextTypes,i!=null}function Np(){si(rs),si(Fn)}function m0(i,a,h){if(Fn.current!==Hl)throw Error(it(168));ii(Fn,a),ii(rs,h)}function e1(i,a,h){var _=i.stateNode;if(a=a.childContextTypes,typeof _.getChildContext!="function")return h;_=_.getChildContext();for(var w in _)if(!(w in a))throw Error(it(108,Mw(i)||"Unknown",w));return wi({},h,_)}function $p(i){return i=(i=i.stateNode)&&i.__reactInternalMemoizedMergedChildContext||Hl,Gc=Fn.current,ii(Fn,i),ii(rs,rs.current),!0}function g0(i,a,h){var _=i.stateNode;if(!_)throw Error(it(169));h?(i=e1(i,a,Gc),_.__reactInternalMemoizedMergedChildContext=i,si(rs),si(Fn),ii(Fn,i)):si(rs),ii(rs,h)}var Po=null,of=!1,gm=!1;function t1(i){Po===null?Po=[i]:Po.push(i)}function j2(i){of=!0,t1(i)}function Kl(){if(!gm&&Po!==null){gm=!0;var i=0,a=Xr;try{var h=Po;for(Xr=1;i<h.length;i++){var _=h[i];do _=_(!0);while(_!==null)}Po=null,of=!1}catch(w){throw Po!==null&&(Po=Po.slice(i+1)),Tv(Dg,Kl),w}finally{Xr=a,gm=!1}}return null}var Hu=[],Wu=0,jp=null,Vp=0,js=[],Vs=0,Zc=null,Ao=1,Do="";function Oc(i,a){Hu[Wu++]=Vp,Hu[Wu++]=jp,jp=i,Vp=a}function r1(i,a,h){js[Vs++]=Ao,js[Vs++]=Do,js[Vs++]=Zc,Zc=i;var _=Ao;i=Do;var w=32-_a(_)-1;_&=~(1<<w),h+=1;var T=32-_a(a)+w;if(30<T){var S=w-w%5;T=(_&(1<<S)-1).toString(32),_>>=S,w-=S,Ao=1<<32-_a(a)+w|h<<w|_,Do=T+i}else Ao=1<<T|h<<w|_,Do=i}function jg(i){i.return!==null&&(Oc(i,1),r1(i,1,0))}function Vg(i){for(;i===jp;)jp=Hu[--Wu],Hu[Wu]=null,Vp=Hu[--Wu],Hu[Wu]=null;for(;i===Zc;)Zc=js[--Vs],js[Vs]=null,Do=js[--Vs],js[Vs]=null,Ao=js[--Vs],js[Vs]=null}var Ss=null,ws=null,fi=!1,ga=null;function i1(i,a){var h=Us(5,null,null,0);h.elementType="DELETED",h.stateNode=a,h.return=i,a=i.deletions,a===null?(i.deletions=[h],i.flags|=16):a.push(h)}function _0(i,a){switch(i.tag){case 5:var h=i.type;return a=a.nodeType!==1||h.toLowerCase()!==a.nodeName.toLowerCase()?null:a,a!==null?(i.stateNode=a,Ss=i,ws=jl(a.firstChild),!0):!1;case 6:return a=i.pendingProps===""||a.nodeType!==3?null:a,a!==null?(i.stateNode=a,Ss=i,ws=null,!0):!1;case 13:return a=a.nodeType!==8?null:a,a!==null?(h=Zc!==null?{id:Ao,overflow:Do}:null,i.memoizedState={dehydrated:a,treeContext:h,retryLane:1073741824},h=Us(18,null,null,0),h.stateNode=a,h.return=i,i.child=h,Ss=i,ws=null,!0):!1;default:return!1}}function Ym(i){return(i.mode&1)!==0&&(i.flags&128)===0}function Qm(i){if(fi){var a=ws;if(a){var h=a;if(!_0(i,a)){if(Ym(i))throw Error(it(418));a=jl(h.nextSibling);var _=Ss;a&&_0(i,a)?i1(_,h):(i.flags=i.flags&-4097|2,fi=!1,Ss=i)}}else{if(Ym(i))throw Error(it(418));i.flags=i.flags&-4097|2,fi=!1,Ss=i}}}function y0(i){for(i=i.return;i!==null&&i.tag!==5&&i.tag!==3&&i.tag!==13;)i=i.return;Ss=i}function dp(i){if(i!==Ss)return!1;if(!fi)return y0(i),fi=!0,!1;var a;if((a=i.tag!==3)&&!(a=i.tag!==5)&&(a=i.type,a=a!=="head"&&a!=="body"&&!Wm(i.type,i.memoizedProps)),a&&(a=ws)){if(Ym(i))throw n1(),Error(it(418));for(;a;)i1(i,a),a=jl(a.nextSibling)}if(y0(i),i.tag===13){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(it(317));e:{for(i=i.nextSibling,a=0;i;){if(i.nodeType===8){var h=i.data;if(h==="/$"){if(a===0){ws=jl(i.nextSibling);break e}a--}else h!=="$"&&h!=="$!"&&h!=="$?"||a++}i=i.nextSibling}ws=null}}else ws=Ss?jl(i.stateNode.nextSibling):null;return!0}function n1(){for(var i=ws;i;)i=jl(i.nextSibling)}function ah(){ws=Ss=null,fi=!1}function Ug(i){ga===null?ga=[i]:ga.push(i)}var V2=Oo.ReactCurrentBatchConfig;function Yh(i,a,h){if(i=h.ref,i!==null&&typeof i!="function"&&typeof i!="object"){if(h._owner){if(h=h._owner,h){if(h.tag!==1)throw Error(it(309));var _=h.stateNode}if(!_)throw Error(it(147,i));var w=_,T=""+i;return a!==null&&a.ref!==null&&typeof a.ref=="function"&&a.ref._stringRef===T?a.ref:(a=function(S){var d=w.refs;S===null?delete d[T]:d[T]=S},a._stringRef=T,a)}if(typeof i!="string")throw Error(it(284));if(!h._owner)throw Error(it(290,i))}return i}function pp(i,a){throw i=Object.prototype.toString.call(a),Error(it(31,i==="[object Object]"?"object with keys {"+Object.keys(a).join(", ")+"}":i))}function v0(i){var a=i._init;return a(i._payload)}function s1(i){function a(he,ne){if(i){var _e=he.deletions;_e===null?(he.deletions=[ne],he.flags|=16):_e.push(ne)}}function h(he,ne){if(!i)return null;for(;ne!==null;)a(he,ne),ne=ne.sibling;return null}function _(he,ne){for(he=new Map;ne!==null;)ne.key!==null?he.set(ne.key,ne):he.set(ne.index,ne),ne=ne.sibling;return he}function w(he,ne){return he=Gl(he,ne),he.index=0,he.sibling=null,he}function T(he,ne,_e){return he.index=_e,i?(_e=he.alternate,_e!==null?(_e=_e.index,_e<ne?(he.flags|=2,ne):_e):(he.flags|=2,ne)):(he.flags|=1048576,ne)}function S(he){return i&&he.alternate===null&&(he.flags|=2),he}function d(he,ne,_e,je){return ne===null||ne.tag!==6?(ne=Sm(_e,he.mode,je),ne.return=he,ne):(ne=w(ne,_e),ne.return=he,ne)}function q(he,ne,_e,je){var rt=_e.type;return rt===ju?Pe(he,ne,_e.props.children,je,_e.key):ne!==null&&(ne.elementType===rt||typeof rt=="object"&&rt!==null&&rt.$$typeof===Dl&&v0(rt)===ne.type)?(je=w(ne,_e.props),je.ref=Yh(he,ne,_e),je.return=he,je):(je=Ep(_e.type,_e.key,_e.props,null,he.mode,je),je.ref=Yh(he,ne,_e),je.return=he,je)}function me(he,ne,_e,je){return ne===null||ne.tag!==4||ne.stateNode.containerInfo!==_e.containerInfo||ne.stateNode.implementation!==_e.implementation?(ne=Mm(_e,he.mode,je),ne.return=he,ne):(ne=w(ne,_e.children||[]),ne.return=he,ne)}function Pe(he,ne,_e,je,rt){return ne===null||ne.tag!==7?(ne=qc(_e,he.mode,je,rt),ne.return=he,ne):(ne=w(ne,_e),ne.return=he,ne)}function le(he,ne,_e){if(typeof ne=="string"&&ne!==""||typeof ne=="number")return ne=Sm(""+ne,he.mode,_e),ne.return=he,ne;if(typeof ne=="object"&&ne!==null){switch(ne.$$typeof){case rp:return _e=Ep(ne.type,ne.key,ne.props,null,he.mode,_e),_e.ref=Yh(he,null,ne),_e.return=he,_e;case $u:return ne=Mm(ne,he.mode,_e),ne.return=he,ne;case Dl:var je=ne._init;return le(he,je(ne._payload),_e)}if(rd(ne)||Hh(ne))return ne=qc(ne,he.mode,_e,null),ne.return=he,ne;pp(he,ne)}return null}function H(he,ne,_e,je){var rt=ne!==null?ne.key:null;if(typeof _e=="string"&&_e!==""||typeof _e=="number")return rt!==null?null:d(he,ne,""+_e,je);if(typeof _e=="object"&&_e!==null){switch(_e.$$typeof){case rp:return _e.key===rt?q(he,ne,_e,je):null;case $u:return _e.key===rt?me(he,ne,_e,je):null;case Dl:return rt=_e._init,H(he,ne,rt(_e._payload),je)}if(rd(_e)||Hh(_e))return rt!==null?null:Pe(he,ne,_e,je,null);pp(he,_e)}return null}function Ge(he,ne,_e,je,rt){if(typeof je=="string"&&je!==""||typeof je=="number")return he=he.get(_e)||null,d(ne,he,""+je,rt);if(typeof je=="object"&&je!==null){switch(je.$$typeof){case rp:return he=he.get(je.key===null?_e:je.key)||null,q(ne,he,je,rt);case $u:return he=he.get(je.key===null?_e:je.key)||null,me(ne,he,je,rt);case Dl:var te=je._init;return Ge(he,ne,_e,te(je._payload),rt)}if(rd(je)||Hh(je))return he=he.get(_e)||null,Pe(ne,he,je,rt,null);pp(ne,je)}return null}function We(he,ne,_e,je){for(var rt=null,te=null,Ae=ne,ee=ne=0,de=null;Ae!==null&&ee<_e.length;ee++){Ae.index>ee?(de=Ae,Ae=null):de=Ae.sibling;var De=H(he,Ae,_e[ee],je);if(De===null){Ae===null&&(Ae=de);break}i&&Ae&&De.alternate===null&&a(he,Ae),ne=T(De,ne,ee),te===null?rt=De:te.sibling=De,te=De,Ae=de}if(ee===_e.length)return h(he,Ae),fi&&Oc(he,ee),rt;if(Ae===null){for(;ee<_e.length;ee++)Ae=le(he,_e[ee],je),Ae!==null&&(ne=T(Ae,ne,ee),te===null?rt=Ae:te.sibling=Ae,te=Ae);return fi&&Oc(he,ee),rt}for(Ae=_(he,Ae);ee<_e.length;ee++)de=Ge(Ae,he,ee,_e[ee],je),de!==null&&(i&&de.alternate!==null&&Ae.delete(de.key===null?ee:de.key),ne=T(de,ne,ee),te===null?rt=de:te.sibling=de,te=de);return i&&Ae.forEach(function(qe){return a(he,qe)}),fi&&Oc(he,ee),rt}function ke(he,ne,_e,je){var rt=Hh(_e);if(typeof rt!="function")throw Error(it(150));if(_e=rt.call(_e),_e==null)throw Error(it(151));for(var te=rt=null,Ae=ne,ee=ne=0,de=null,De=_e.next();Ae!==null&&!De.done;ee++,De=_e.next()){Ae.index>ee?(de=Ae,Ae=null):de=Ae.sibling;var qe=H(he,Ae,De.value,je);if(qe===null){Ae===null&&(Ae=de);break}i&&Ae&&qe.alternate===null&&a(he,Ae),ne=T(qe,ne,ee),te===null?rt=qe:te.sibling=qe,te=qe,Ae=de}if(De.done)return h(he,Ae),fi&&Oc(he,ee),rt;if(Ae===null){for(;!De.done;ee++,De=_e.next())De=le(he,De.value,je),De!==null&&(ne=T(De,ne,ee),te===null?rt=De:te.sibling=De,te=De);return fi&&Oc(he,ee),rt}for(Ae=_(he,Ae);!De.done;ee++,De=_e.next())De=Ge(Ae,he,ee,De.value,je),De!==null&&(i&&De.alternate!==null&&Ae.delete(De.key===null?ee:De.key),ne=T(De,ne,ee),te===null?rt=De:te.sibling=De,te=De);return i&&Ae.forEach(function(yt){return a(he,yt)}),fi&&Oc(he,ee),rt}function gt(he,ne,_e,je){if(typeof _e=="object"&&_e!==null&&_e.type===ju&&_e.key===null&&(_e=_e.props.children),typeof _e=="object"&&_e!==null){switch(_e.$$typeof){case rp:e:{for(var rt=_e.key,te=ne;te!==null;){if(te.key===rt){if(rt=_e.type,rt===ju){if(te.tag===7){h(he,te.sibling),ne=w(te,_e.props.children),ne.return=he,he=ne;break e}}else if(te.elementType===rt||typeof rt=="object"&&rt!==null&&rt.$$typeof===Dl&&v0(rt)===te.type){h(he,te.sibling),ne=w(te,_e.props),ne.ref=Yh(he,te,_e),ne.return=he,he=ne;break e}h(he,te);break}else a(he,te);te=te.sibling}_e.type===ju?(ne=qc(_e.props.children,he.mode,je,_e.key),ne.return=he,he=ne):(je=Ep(_e.type,_e.key,_e.props,null,he.mode,je),je.ref=Yh(he,ne,_e),je.return=he,he=je)}return S(he);case $u:e:{for(te=_e.key;ne!==null;){if(ne.key===te)if(ne.tag===4&&ne.stateNode.containerInfo===_e.containerInfo&&ne.stateNode.implementation===_e.implementation){h(he,ne.sibling),ne=w(ne,_e.children||[]),ne.return=he,he=ne;break e}else{h(he,ne);break}else a(he,ne);ne=ne.sibling}ne=Mm(_e,he.mode,je),ne.return=he,he=ne}return S(he);case Dl:return te=_e._init,gt(he,ne,te(_e._payload),je)}if(rd(_e))return We(he,ne,_e,je);if(Hh(_e))return ke(he,ne,_e,je);pp(he,_e)}return typeof _e=="string"&&_e!==""||typeof _e=="number"?(_e=""+_e,ne!==null&&ne.tag===6?(h(he,ne.sibling),ne=w(ne,_e),ne.return=he,he=ne):(h(he,ne),ne=Sm(_e,he.mode,je),ne.return=he,he=ne),S(he)):h(he,ne)}return gt}var oh=s1(!0),a1=s1(!1),Up=Xl(null),qp=null,Xu=null,qg=null;function Gg(){qg=Xu=qp=null}function Zg(i){var a=Up.current;si(Up),i._currentValue=a}function eg(i,a,h){for(;i!==null;){var _=i.alternate;if((i.childLanes&a)!==a?(i.childLanes|=a,_!==null&&(_.childLanes|=a)):_!==null&&(_.childLanes&a)!==a&&(_.childLanes|=a),i===h)break;i=i.return}}function rh(i,a){qp=i,qg=Xu=null,i=i.dependencies,i!==null&&i.firstContext!==null&&(i.lanes&a&&(ts=!0),i.firstContext=null)}function Gs(i){var a=i._currentValue;if(qg!==i)if(i={context:i,memoizedValue:a,next:null},Xu===null){if(qp===null)throw Error(it(308));Xu=i,qp.dependencies={lanes:0,firstContext:i}}else Xu=Xu.next=i;return a}var jc=null;function Hg(i){jc===null?jc=[i]:jc.push(i)}function o1(i,a,h,_){var w=a.interleaved;return w===null?(h.next=h,Hg(a)):(h.next=w.next,w.next=h),a.interleaved=h,Fo(i,_)}function Fo(i,a){i.lanes|=a;var h=i.alternate;for(h!==null&&(h.lanes|=a),h=i,i=i.return;i!==null;)i.childLanes|=a,h=i.alternate,h!==null&&(h.childLanes|=a),h=i,i=i.return;return h.tag===3?h.stateNode:null}var zl=!1;function Wg(i){i.updateQueue={baseState:i.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function l1(i,a){i=i.updateQueue,a.updateQueue===i&&(a.updateQueue={baseState:i.baseState,firstBaseUpdate:i.firstBaseUpdate,lastBaseUpdate:i.lastBaseUpdate,shared:i.shared,effects:i.effects})}function zo(i,a){return{eventTime:i,lane:a,tag:0,payload:null,callback:null,next:null}}function Vl(i,a,h){var _=i.updateQueue;if(_===null)return null;if(_=_.shared,Dr&2){var w=_.pending;return w===null?a.next=a:(a.next=w.next,w.next=a),_.pending=a,Fo(i,h)}return w=_.interleaved,w===null?(a.next=a,Hg(_)):(a.next=w.next,w.next=a),_.interleaved=a,Fo(i,h)}function Sp(i,a,h){if(a=a.updateQueue,a!==null&&(a=a.shared,(h&4194240)!==0)){var _=a.lanes;_&=i.pendingLanes,h|=_,a.lanes=h,zg(i,h)}}function x0(i,a){var h=i.updateQueue,_=i.alternate;if(_!==null&&(_=_.updateQueue,h===_)){var w=null,T=null;if(h=h.firstBaseUpdate,h!==null){do{var S={eventTime:h.eventTime,lane:h.lane,tag:h.tag,payload:h.payload,callback:h.callback,next:null};T===null?w=T=S:T=T.next=S,h=h.next}while(h!==null);T===null?w=T=a:T=T.next=a}else w=T=a;h={baseState:_.baseState,firstBaseUpdate:w,lastBaseUpdate:T,shared:_.shared,effects:_.effects},i.updateQueue=h;return}i=h.lastBaseUpdate,i===null?h.firstBaseUpdate=a:i.next=a,h.lastBaseUpdate=a}function Gp(i,a,h,_){var w=i.updateQueue;zl=!1;var T=w.firstBaseUpdate,S=w.lastBaseUpdate,d=w.shared.pending;if(d!==null){w.shared.pending=null;var q=d,me=q.next;q.next=null,S===null?T=me:S.next=me,S=q;var Pe=i.alternate;Pe!==null&&(Pe=Pe.updateQueue,d=Pe.lastBaseUpdate,d!==S&&(d===null?Pe.firstBaseUpdate=me:d.next=me,Pe.lastBaseUpdate=q))}if(T!==null){var le=w.baseState;S=0,Pe=me=q=null,d=T;do{var H=d.lane,Ge=d.eventTime;if((_&H)===H){Pe!==null&&(Pe=Pe.next={eventTime:Ge,lane:0,tag:d.tag,payload:d.payload,callback:d.callback,next:null});e:{var We=i,ke=d;switch(H=a,Ge=h,ke.tag){case 1:if(We=ke.payload,typeof We=="function"){le=We.call(Ge,le,H);break e}le=We;break e;case 3:We.flags=We.flags&-65537|128;case 0:if(We=ke.payload,H=typeof We=="function"?We.call(Ge,le,H):We,H==null)break e;le=wi({},le,H);break e;case 2:zl=!0}}d.callback!==null&&d.lane!==0&&(i.flags|=64,H=w.effects,H===null?w.effects=[d]:H.push(d))}else Ge={eventTime:Ge,lane:H,tag:d.tag,payload:d.payload,callback:d.callback,next:null},Pe===null?(me=Pe=Ge,q=le):Pe=Pe.next=Ge,S|=H;if(d=d.next,d===null){if(d=w.shared.pending,d===null)break;H=d,d=H.next,H.next=null,w.lastBaseUpdate=H,w.shared.pending=null}}while(!0);if(Pe===null&&(q=le),w.baseState=q,w.firstBaseUpdate=me,w.lastBaseUpdate=Pe,a=w.shared.interleaved,a!==null){w=a;do S|=w.lane,w=w.next;while(w!==a)}else T===null&&(w.shared.lanes=0);Wc|=S,i.lanes=S,i.memoizedState=le}}function b0(i,a,h){if(i=a.effects,a.effects=null,i!==null)for(a=0;a<i.length;a++){var _=i[a],w=_.callback;if(w!==null){if(_.callback=null,_=h,typeof w!="function")throw Error(it(191,w));w.call(_)}}}var Rd={},Ya=Xl(Rd),kd=Xl(Rd),Td=Xl(Rd);function Vc(i){if(i===Rd)throw Error(it(174));return i}function Xg(i,a){switch(ii(Td,a),ii(kd,i),ii(Ya,Rd),i=a.nodeType,i){case 9:case 11:a=(a=a.documentElement)?a.namespaceURI:Lm(null,"");break;default:i=i===8?a.parentNode:a,a=i.namespaceURI||null,i=i.tagName,a=Lm(a,i)}si(Ya),ii(Ya,a)}function lh(){si(Ya),si(kd),si(Td)}function c1(i){Vc(Td.current);var a=Vc(Ya.current),h=Lm(a,i.type);a!==h&&(ii(kd,i),ii(Ya,h))}function Kg(i){kd.current===i&&(si(Ya),si(kd))}var xi=Xl(0);function Zp(i){for(var a=i;a!==null;){if(a.tag===13){var h=a.memoizedState;if(h!==null&&(h=h.dehydrated,h===null||h.data==="$?"||h.data==="$!"))return a}else if(a.tag===19&&a.memoizedProps.revealOrder!==void 0){if(a.flags&128)return a}else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===i)break;for(;a.sibling===null;){if(a.return===null||a.return===i)return null;a=a.return}a.sibling.return=a.return,a=a.sibling}return null}var _m=[];function Jg(){for(var i=0;i<_m.length;i++)_m[i]._workInProgressVersionPrimary=null;_m.length=0}var Mp=Oo.ReactCurrentDispatcher,ym=Oo.ReactCurrentBatchConfig,Hc=0,bi=null,tn=null,pn=null,Hp=!1,ud=!1,Cd=0,U2=0;function zn(){throw Error(it(321))}function Yg(i,a){if(a===null)return!1;for(var h=0;h<a.length&&h<i.length;h++)if(!va(i[h],a[h]))return!1;return!0}function Qg(i,a,h,_,w,T){if(Hc=T,bi=a,a.memoizedState=null,a.updateQueue=null,a.lanes=0,Mp.current=i===null||i.memoizedState===null?H2:W2,i=h(_,w),ud){T=0;do{if(ud=!1,Cd=0,25<=T)throw Error(it(301));T+=1,pn=tn=null,a.updateQueue=null,Mp.current=X2,i=h(_,w)}while(ud)}if(Mp.current=Wp,a=tn!==null&&tn.next!==null,Hc=0,pn=tn=bi=null,Hp=!1,a)throw Error(it(300));return i}function e_(){var i=Cd!==0;return Cd=0,i}function Xa(){var i={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return pn===null?bi.memoizedState=pn=i:pn=pn.next=i,pn}function Zs(){if(tn===null){var i=bi.alternate;i=i!==null?i.memoizedState:null}else i=tn.next;var a=pn===null?bi.memoizedState:pn.next;if(a!==null)pn=a,tn=i;else{if(i===null)throw Error(it(310));tn=i,i={memoizedState:tn.memoizedState,baseState:tn.baseState,baseQueue:tn.baseQueue,queue:tn.queue,next:null},pn===null?bi.memoizedState=pn=i:pn=pn.next=i}return pn}function Id(i,a){return typeof a=="function"?a(i):a}function vm(i){var a=Zs(),h=a.queue;if(h===null)throw Error(it(311));h.lastRenderedReducer=i;var _=tn,w=_.baseQueue,T=h.pending;if(T!==null){if(w!==null){var S=w.next;w.next=T.next,T.next=S}_.baseQueue=w=T,h.pending=null}if(w!==null){T=w.next,_=_.baseState;var d=S=null,q=null,me=T;do{var Pe=me.lane;if((Hc&Pe)===Pe)q!==null&&(q=q.next={lane:0,action:me.action,hasEagerState:me.hasEagerState,eagerState:me.eagerState,next:null}),_=me.hasEagerState?me.eagerState:i(_,me.action);else{var le={lane:Pe,action:me.action,hasEagerState:me.hasEagerState,eagerState:me.eagerState,next:null};q===null?(d=q=le,S=_):q=q.next=le,bi.lanes|=Pe,Wc|=Pe}me=me.next}while(me!==null&&me!==T);q===null?S=_:q.next=d,va(_,a.memoizedState)||(ts=!0),a.memoizedState=_,a.baseState=S,a.baseQueue=q,h.lastRenderedState=_}if(i=h.interleaved,i!==null){w=i;do T=w.lane,bi.lanes|=T,Wc|=T,w=w.next;while(w!==i)}else w===null&&(h.lanes=0);return[a.memoizedState,h.dispatch]}function xm(i){var a=Zs(),h=a.queue;if(h===null)throw Error(it(311));h.lastRenderedReducer=i;var _=h.dispatch,w=h.pending,T=a.memoizedState;if(w!==null){h.pending=null;var S=w=w.next;do T=i(T,S.action),S=S.next;while(S!==w);va(T,a.memoizedState)||(ts=!0),a.memoizedState=T,a.baseQueue===null&&(a.baseState=T),h.lastRenderedState=T}return[T,_]}function u1(){}function h1(i,a){var h=bi,_=Zs(),w=a(),T=!va(_.memoizedState,w);if(T&&(_.memoizedState=w,ts=!0),_=_.queue,t_(f1.bind(null,h,_,i),[i]),_.getSnapshot!==a||T||pn!==null&&pn.memoizedState.tag&1){if(h.flags|=2048,Ed(9,p1.bind(null,h,_,w,a),void 0,null),fn===null)throw Error(it(349));Hc&30||d1(h,a,w)}return w}function d1(i,a,h){i.flags|=16384,i={getSnapshot:a,value:h},a=bi.updateQueue,a===null?(a={lastEffect:null,stores:null},bi.updateQueue=a,a.stores=[i]):(h=a.stores,h===null?a.stores=[i]:h.push(i))}function p1(i,a,h,_){a.value=h,a.getSnapshot=_,m1(a)&&g1(i)}function f1(i,a,h){return h(function(){m1(a)&&g1(i)})}function m1(i){var a=i.getSnapshot;i=i.value;try{var h=a();return!va(i,h)}catch{return!0}}function g1(i){var a=Fo(i,1);a!==null&&ya(a,i,1,-1)}function w0(i){var a=Xa();return typeof i=="function"&&(i=i()),a.memoizedState=a.baseState=i,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Id,lastRenderedState:i},a.queue=i,i=i.dispatch=Z2.bind(null,bi,i),[a.memoizedState,i]}function Ed(i,a,h,_){return i={tag:i,create:a,destroy:h,deps:_,next:null},a=bi.updateQueue,a===null?(a={lastEffect:null,stores:null},bi.updateQueue=a,a.lastEffect=i.next=i):(h=a.lastEffect,h===null?a.lastEffect=i.next=i:(_=h.next,h.next=i,i.next=_,a.lastEffect=i)),i}function _1(){return Zs().memoizedState}function kp(i,a,h,_){var w=Xa();bi.flags|=i,w.memoizedState=Ed(1|a,h,void 0,_===void 0?null:_)}function lf(i,a,h,_){var w=Zs();_=_===void 0?null:_;var T=void 0;if(tn!==null){var S=tn.memoizedState;if(T=S.destroy,_!==null&&Yg(_,S.deps)){w.memoizedState=Ed(a,h,T,_);return}}bi.flags|=i,w.memoizedState=Ed(1|a,h,T,_)}function S0(i,a){return kp(8390656,8,i,a)}function t_(i,a){return lf(2048,8,i,a)}function y1(i,a){return lf(4,2,i,a)}function v1(i,a){return lf(4,4,i,a)}function x1(i,a){if(typeof a=="function")return i=i(),a(i),function(){a(null)};if(a!=null)return i=i(),a.current=i,function(){a.current=null}}function b1(i,a,h){return h=h!=null?h.concat([i]):null,lf(4,4,x1.bind(null,a,i),h)}function r_(){}function w1(i,a){var h=Zs();a=a===void 0?null:a;var _=h.memoizedState;return _!==null&&a!==null&&Yg(a,_[1])?_[0]:(h.memoizedState=[i,a],i)}function S1(i,a){var h=Zs();a=a===void 0?null:a;var _=h.memoizedState;return _!==null&&a!==null&&Yg(a,_[1])?_[0]:(i=i(),h.memoizedState=[i,a],i)}function M1(i,a,h){return Hc&21?(va(h,a)||(h=Ev(),bi.lanes|=h,Wc|=h,i.baseState=!0),a):(i.baseState&&(i.baseState=!1,ts=!0),i.memoizedState=h)}function q2(i,a){var h=Xr;Xr=h!==0&&4>h?h:4,i(!0);var _=ym.transition;ym.transition={};try{i(!1),a()}finally{Xr=h,ym.transition=_}}function k1(){return Zs().memoizedState}function G2(i,a,h){var _=ql(i);if(h={lane:_,action:h,hasEagerState:!1,eagerState:null,next:null},T1(i))C1(a,h);else if(h=o1(i,a,h,_),h!==null){var w=Gn();ya(h,i,_,w),I1(h,a,_)}}function Z2(i,a,h){var _=ql(i),w={lane:_,action:h,hasEagerState:!1,eagerState:null,next:null};if(T1(i))C1(a,w);else{var T=i.alternate;if(i.lanes===0&&(T===null||T.lanes===0)&&(T=a.lastRenderedReducer,T!==null))try{var S=a.lastRenderedState,d=T(S,h);if(w.hasEagerState=!0,w.eagerState=d,va(d,S)){var q=a.interleaved;q===null?(w.next=w,Hg(a)):(w.next=q.next,q.next=w),a.interleaved=w;return}}catch{}finally{}h=o1(i,a,w,_),h!==null&&(w=Gn(),ya(h,i,_,w),I1(h,a,_))}}function T1(i){var a=i.alternate;return i===bi||a!==null&&a===bi}function C1(i,a){ud=Hp=!0;var h=i.pending;h===null?a.next=a:(a.next=h.next,h.next=a),i.pending=a}function I1(i,a,h){if(h&4194240){var _=a.lanes;_&=i.pendingLanes,h|=_,a.lanes=h,zg(i,h)}}var Wp={readContext:Gs,useCallback:zn,useContext:zn,useEffect:zn,useImperativeHandle:zn,useInsertionEffect:zn,useLayoutEffect:zn,useMemo:zn,useReducer:zn,useRef:zn,useState:zn,useDebugValue:zn,useDeferredValue:zn,useTransition:zn,useMutableSource:zn,useSyncExternalStore:zn,useId:zn,unstable_isNewReconciler:!1},H2={readContext:Gs,useCallback:function(i,a){return Xa().memoizedState=[i,a===void 0?null:a],i},useContext:Gs,useEffect:S0,useImperativeHandle:function(i,a,h){return h=h!=null?h.concat([i]):null,kp(4194308,4,x1.bind(null,a,i),h)},useLayoutEffect:function(i,a){return kp(4194308,4,i,a)},useInsertionEffect:function(i,a){return kp(4,2,i,a)},useMemo:function(i,a){var h=Xa();return a=a===void 0?null:a,i=i(),h.memoizedState=[i,a],i},useReducer:function(i,a,h){var _=Xa();return a=h!==void 0?h(a):a,_.memoizedState=_.baseState=a,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:i,lastRenderedState:a},_.queue=i,i=i.dispatch=G2.bind(null,bi,i),[_.memoizedState,i]},useRef:function(i){var a=Xa();return i={current:i},a.memoizedState=i},useState:w0,useDebugValue:r_,useDeferredValue:function(i){return Xa().memoizedState=i},useTransition:function(){var i=w0(!1),a=i[0];return i=q2.bind(null,i[1]),Xa().memoizedState=i,[a,i]},useMutableSource:function(){},useSyncExternalStore:function(i,a,h){var _=bi,w=Xa();if(fi){if(h===void 0)throw Error(it(407));h=h()}else{if(h=a(),fn===null)throw Error(it(349));Hc&30||d1(_,a,h)}w.memoizedState=h;var T={value:h,getSnapshot:a};return w.queue=T,S0(f1.bind(null,_,T,i),[i]),_.flags|=2048,Ed(9,p1.bind(null,_,T,h,a),void 0,null),h},useId:function(){var i=Xa(),a=fn.identifierPrefix;if(fi){var h=Do,_=Ao;h=(_&~(1<<32-_a(_)-1)).toString(32)+h,a=":"+a+"R"+h,h=Cd++,0<h&&(a+="H"+h.toString(32)),a+=":"}else h=U2++,a=":"+a+"r"+h.toString(32)+":";return i.memoizedState=a},unstable_isNewReconciler:!1},W2={readContext:Gs,useCallback:w1,useContext:Gs,useEffect:t_,useImperativeHandle:b1,useInsertionEffect:y1,useLayoutEffect:v1,useMemo:S1,useReducer:vm,useRef:_1,useState:function(){return vm(Id)},useDebugValue:r_,useDeferredValue:function(i){var a=Zs();return M1(a,tn.memoizedState,i)},useTransition:function(){var i=vm(Id)[0],a=Zs().memoizedState;return[i,a]},useMutableSource:u1,useSyncExternalStore:h1,useId:k1,unstable_isNewReconciler:!1},X2={readContext:Gs,useCallback:w1,useContext:Gs,useEffect:t_,useImperativeHandle:b1,useInsertionEffect:y1,useLayoutEffect:v1,useMemo:S1,useReducer:xm,useRef:_1,useState:function(){return xm(Id)},useDebugValue:r_,useDeferredValue:function(i){var a=Zs();return tn===null?a.memoizedState=i:M1(a,tn.memoizedState,i)},useTransition:function(){var i=xm(Id)[0],a=Zs().memoizedState;return[i,a]},useMutableSource:u1,useSyncExternalStore:h1,useId:k1,unstable_isNewReconciler:!1};function fa(i,a){if(i&&i.defaultProps){a=wi({},a),i=i.defaultProps;for(var h in i)a[h]===void 0&&(a[h]=i[h]);return a}return a}function tg(i,a,h,_){a=i.memoizedState,h=h(_,a),h=h==null?a:wi({},a,h),i.memoizedState=h,i.lanes===0&&(i.updateQueue.baseState=h)}var cf={isMounted:function(i){return(i=i._reactInternals)?Jc(i)===i:!1},enqueueSetState:function(i,a,h){i=i._reactInternals;var _=Gn(),w=ql(i),T=zo(_,w);T.payload=a,h!=null&&(T.callback=h),a=Vl(i,T,w),a!==null&&(ya(a,i,w,_),Sp(a,i,w))},enqueueReplaceState:function(i,a,h){i=i._reactInternals;var _=Gn(),w=ql(i),T=zo(_,w);T.tag=1,T.payload=a,h!=null&&(T.callback=h),a=Vl(i,T,w),a!==null&&(ya(a,i,w,_),Sp(a,i,w))},enqueueForceUpdate:function(i,a){i=i._reactInternals;var h=Gn(),_=ql(i),w=zo(h,_);w.tag=2,a!=null&&(w.callback=a),a=Vl(i,w,_),a!==null&&(ya(a,i,_,h),Sp(a,i,_))}};function M0(i,a,h,_,w,T,S){return i=i.stateNode,typeof i.shouldComponentUpdate=="function"?i.shouldComponentUpdate(_,T,S):a.prototype&&a.prototype.isPureReactComponent?!bd(h,_)||!bd(w,T):!0}function E1(i,a,h){var _=!1,w=Hl,T=a.contextType;return typeof T=="object"&&T!==null?T=Gs(T):(w=is(a)?Gc:Fn.current,_=a.contextTypes,T=(_=_!=null)?sh(i,w):Hl),a=new a(h,T),i.memoizedState=a.state!==null&&a.state!==void 0?a.state:null,a.updater=cf,i.stateNode=a,a._reactInternals=i,_&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=w,i.__reactInternalMemoizedMaskedChildContext=T),a}function k0(i,a,h,_){i=a.state,typeof a.componentWillReceiveProps=="function"&&a.componentWillReceiveProps(h,_),typeof a.UNSAFE_componentWillReceiveProps=="function"&&a.UNSAFE_componentWillReceiveProps(h,_),a.state!==i&&cf.enqueueReplaceState(a,a.state,null)}function rg(i,a,h,_){var w=i.stateNode;w.props=h,w.state=i.memoizedState,w.refs={},Wg(i);var T=a.contextType;typeof T=="object"&&T!==null?w.context=Gs(T):(T=is(a)?Gc:Fn.current,w.context=sh(i,T)),w.state=i.memoizedState,T=a.getDerivedStateFromProps,typeof T=="function"&&(tg(i,a,T,h),w.state=i.memoizedState),typeof a.getDerivedStateFromProps=="function"||typeof w.getSnapshotBeforeUpdate=="function"||typeof w.UNSAFE_componentWillMount!="function"&&typeof w.componentWillMount!="function"||(a=w.state,typeof w.componentWillMount=="function"&&w.componentWillMount(),typeof w.UNSAFE_componentWillMount=="function"&&w.UNSAFE_componentWillMount(),a!==w.state&&cf.enqueueReplaceState(w,w.state,null),Gp(i,h,w,_),w.state=i.memoizedState),typeof w.componentDidMount=="function"&&(i.flags|=4194308)}function ch(i,a){try{var h="",_=a;do h+=Sw(_),_=_.return;while(_);var w=h}catch(T){w=`
Error generating stack: `+T.message+`
`+T.stack}return{value:i,source:a,stack:w,digest:null}}function bm(i,a,h){return{value:i,source:null,stack:h??null,digest:a??null}}function ig(i,a){try{console.error(a.value)}catch(h){setTimeout(function(){throw h})}}var K2=typeof WeakMap=="function"?WeakMap:Map;function P1(i,a,h){h=zo(-1,h),h.tag=3,h.payload={element:null};var _=a.value;return h.callback=function(){Kp||(Kp=!0,pg=_),ig(i,a)},h}function A1(i,a,h){h=zo(-1,h),h.tag=3;var _=i.type.getDerivedStateFromError;if(typeof _=="function"){var w=a.value;h.payload=function(){return _(w)},h.callback=function(){ig(i,a)}}var T=i.stateNode;return T!==null&&typeof T.componentDidCatch=="function"&&(h.callback=function(){ig(i,a),typeof _!="function"&&(Ul===null?Ul=new Set([this]):Ul.add(this));var S=a.stack;this.componentDidCatch(a.value,{componentStack:S!==null?S:""})}),h}function T0(i,a,h){var _=i.pingCache;if(_===null){_=i.pingCache=new K2;var w=new Set;_.set(a,w)}else w=_.get(a),w===void 0&&(w=new Set,_.set(a,w));w.has(h)||(w.add(h),i=uS.bind(null,i,a,h),a.then(i,i))}function C0(i){do{var a;if((a=i.tag===13)&&(a=i.memoizedState,a=a!==null?a.dehydrated!==null:!0),a)return i;i=i.return}while(i!==null);return null}function I0(i,a,h,_,w){return i.mode&1?(i.flags|=65536,i.lanes=w,i):(i===a?i.flags|=65536:(i.flags|=128,h.flags|=131072,h.flags&=-52805,h.tag===1&&(h.alternate===null?h.tag=17:(a=zo(-1,1),a.tag=2,Vl(h,a,1))),h.lanes|=1),i)}var J2=Oo.ReactCurrentOwner,ts=!1;function qn(i,a,h,_){a.child=i===null?a1(a,null,h,_):oh(a,i.child,h,_)}function E0(i,a,h,_,w){h=h.render;var T=a.ref;return rh(a,w),_=Qg(i,a,h,_,T,w),h=e_(),i!==null&&!ts?(a.updateQueue=i.updateQueue,a.flags&=-2053,i.lanes&=~w,Bo(i,a,w)):(fi&&h&&jg(a),a.flags|=1,qn(i,a,_,w),a.child)}function P0(i,a,h,_,w){if(i===null){var T=h.type;return typeof T=="function"&&!u_(T)&&T.defaultProps===void 0&&h.compare===null&&h.defaultProps===void 0?(a.tag=15,a.type=T,D1(i,a,T,_,w)):(i=Ep(h.type,null,_,a,a.mode,w),i.ref=a.ref,i.return=a,a.child=i)}if(T=i.child,!(i.lanes&w)){var S=T.memoizedProps;if(h=h.compare,h=h!==null?h:bd,h(S,_)&&i.ref===a.ref)return Bo(i,a,w)}return a.flags|=1,i=Gl(T,_),i.ref=a.ref,i.return=a,a.child=i}function D1(i,a,h,_,w){if(i!==null){var T=i.memoizedProps;if(bd(T,_)&&i.ref===a.ref)if(ts=!1,a.pendingProps=_=T,(i.lanes&w)!==0)i.flags&131072&&(ts=!0);else return a.lanes=i.lanes,Bo(i,a,w)}return ng(i,a,h,_,w)}function z1(i,a,h){var _=a.pendingProps,w=_.children,T=i!==null?i.memoizedState:null;if(_.mode==="hidden")if(!(a.mode&1))a.memoizedState={baseLanes:0,cachePool:null,transitions:null},ii(Ju,bs),bs|=h;else{if(!(h&1073741824))return i=T!==null?T.baseLanes|h:h,a.lanes=a.childLanes=1073741824,a.memoizedState={baseLanes:i,cachePool:null,transitions:null},a.updateQueue=null,ii(Ju,bs),bs|=i,null;a.memoizedState={baseLanes:0,cachePool:null,transitions:null},_=T!==null?T.baseLanes:h,ii(Ju,bs),bs|=_}else T!==null?(_=T.baseLanes|h,a.memoizedState=null):_=h,ii(Ju,bs),bs|=_;return qn(i,a,w,h),a.child}function L1(i,a){var h=a.ref;(i===null&&h!==null||i!==null&&i.ref!==h)&&(a.flags|=512,a.flags|=2097152)}function ng(i,a,h,_,w){var T=is(h)?Gc:Fn.current;return T=sh(a,T),rh(a,w),h=Qg(i,a,h,_,T,w),_=e_(),i!==null&&!ts?(a.updateQueue=i.updateQueue,a.flags&=-2053,i.lanes&=~w,Bo(i,a,w)):(fi&&_&&jg(a),a.flags|=1,qn(i,a,h,w),a.child)}function A0(i,a,h,_,w){if(is(h)){var T=!0;$p(a)}else T=!1;if(rh(a,w),a.stateNode===null)Tp(i,a),E1(a,h,_),rg(a,h,_,w),_=!0;else if(i===null){var S=a.stateNode,d=a.memoizedProps;S.props=d;var q=S.context,me=h.contextType;typeof me=="object"&&me!==null?me=Gs(me):(me=is(h)?Gc:Fn.current,me=sh(a,me));var Pe=h.getDerivedStateFromProps,le=typeof Pe=="function"||typeof S.getSnapshotBeforeUpdate=="function";le||typeof S.UNSAFE_componentWillReceiveProps!="function"&&typeof S.componentWillReceiveProps!="function"||(d!==_||q!==me)&&k0(a,S,_,me),zl=!1;var H=a.memoizedState;S.state=H,Gp(a,_,S,w),q=a.memoizedState,d!==_||H!==q||rs.current||zl?(typeof Pe=="function"&&(tg(a,h,Pe,_),q=a.memoizedState),(d=zl||M0(a,h,d,_,H,q,me))?(le||typeof S.UNSAFE_componentWillMount!="function"&&typeof S.componentWillMount!="function"||(typeof S.componentWillMount=="function"&&S.componentWillMount(),typeof S.UNSAFE_componentWillMount=="function"&&S.UNSAFE_componentWillMount()),typeof S.componentDidMount=="function"&&(a.flags|=4194308)):(typeof S.componentDidMount=="function"&&(a.flags|=4194308),a.memoizedProps=_,a.memoizedState=q),S.props=_,S.state=q,S.context=me,_=d):(typeof S.componentDidMount=="function"&&(a.flags|=4194308),_=!1)}else{S=a.stateNode,l1(i,a),d=a.memoizedProps,me=a.type===a.elementType?d:fa(a.type,d),S.props=me,le=a.pendingProps,H=S.context,q=h.contextType,typeof q=="object"&&q!==null?q=Gs(q):(q=is(h)?Gc:Fn.current,q=sh(a,q));var Ge=h.getDerivedStateFromProps;(Pe=typeof Ge=="function"||typeof S.getSnapshotBeforeUpdate=="function")||typeof S.UNSAFE_componentWillReceiveProps!="function"&&typeof S.componentWillReceiveProps!="function"||(d!==le||H!==q)&&k0(a,S,_,q),zl=!1,H=a.memoizedState,S.state=H,Gp(a,_,S,w);var We=a.memoizedState;d!==le||H!==We||rs.current||zl?(typeof Ge=="function"&&(tg(a,h,Ge,_),We=a.memoizedState),(me=zl||M0(a,h,me,_,H,We,q)||!1)?(Pe||typeof S.UNSAFE_componentWillUpdate!="function"&&typeof S.componentWillUpdate!="function"||(typeof S.componentWillUpdate=="function"&&S.componentWillUpdate(_,We,q),typeof S.UNSAFE_componentWillUpdate=="function"&&S.UNSAFE_componentWillUpdate(_,We,q)),typeof S.componentDidUpdate=="function"&&(a.flags|=4),typeof S.getSnapshotBeforeUpdate=="function"&&(a.flags|=1024)):(typeof S.componentDidUpdate!="function"||d===i.memoizedProps&&H===i.memoizedState||(a.flags|=4),typeof S.getSnapshotBeforeUpdate!="function"||d===i.memoizedProps&&H===i.memoizedState||(a.flags|=1024),a.memoizedProps=_,a.memoizedState=We),S.props=_,S.state=We,S.context=q,_=me):(typeof S.componentDidUpdate!="function"||d===i.memoizedProps&&H===i.memoizedState||(a.flags|=4),typeof S.getSnapshotBeforeUpdate!="function"||d===i.memoizedProps&&H===i.memoizedState||(a.flags|=1024),_=!1)}return sg(i,a,h,_,T,w)}function sg(i,a,h,_,w,T){L1(i,a);var S=(a.flags&128)!==0;if(!_&&!S)return w&&g0(a,h,!1),Bo(i,a,T);_=a.stateNode,J2.current=a;var d=S&&typeof h.getDerivedStateFromError!="function"?null:_.render();return a.flags|=1,i!==null&&S?(a.child=oh(a,i.child,null,T),a.child=oh(a,null,d,T)):qn(i,a,d,T),a.memoizedState=_.state,w&&g0(a,h,!0),a.child}function R1(i){var a=i.stateNode;a.pendingContext?m0(i,a.pendingContext,a.pendingContext!==a.context):a.context&&m0(i,a.context,!1),Xg(i,a.containerInfo)}function D0(i,a,h,_,w){return ah(),Ug(w),a.flags|=256,qn(i,a,h,_),a.child}var ag={dehydrated:null,treeContext:null,retryLane:0};function og(i){return{baseLanes:i,cachePool:null,transitions:null}}function F1(i,a,h){var _=a.pendingProps,w=xi.current,T=!1,S=(a.flags&128)!==0,d;if((d=S)||(d=i!==null&&i.memoizedState===null?!1:(w&2)!==0),d?(T=!0,a.flags&=-129):(i===null||i.memoizedState!==null)&&(w|=1),ii(xi,w&1),i===null)return Qm(a),i=a.memoizedState,i!==null&&(i=i.dehydrated,i!==null)?(a.mode&1?i.data==="$!"?a.lanes=8:a.lanes=1073741824:a.lanes=1,null):(S=_.children,i=_.fallback,T?(_=a.mode,T=a.child,S={mode:"hidden",children:S},!(_&1)&&T!==null?(T.childLanes=0,T.pendingProps=S):T=df(S,_,0,null),i=qc(i,_,h,null),T.return=a,i.return=a,T.sibling=i,a.child=T,a.child.memoizedState=og(h),a.memoizedState=ag,i):i_(a,S));if(w=i.memoizedState,w!==null&&(d=w.dehydrated,d!==null))return Y2(i,a,S,_,d,w,h);if(T){T=_.fallback,S=a.mode,w=i.child,d=w.sibling;var q={mode:"hidden",children:_.children};return!(S&1)&&a.child!==w?(_=a.child,_.childLanes=0,_.pendingProps=q,a.deletions=null):(_=Gl(w,q),_.subtreeFlags=w.subtreeFlags&14680064),d!==null?T=Gl(d,T):(T=qc(T,S,h,null),T.flags|=2),T.return=a,_.return=a,_.sibling=T,a.child=_,_=T,T=a.child,S=i.child.memoizedState,S=S===null?og(h):{baseLanes:S.baseLanes|h,cachePool:null,transitions:S.transitions},T.memoizedState=S,T.childLanes=i.childLanes&~h,a.memoizedState=ag,_}return T=i.child,i=T.sibling,_=Gl(T,{mode:"visible",children:_.children}),!(a.mode&1)&&(_.lanes=h),_.return=a,_.sibling=null,i!==null&&(h=a.deletions,h===null?(a.deletions=[i],a.flags|=16):h.push(i)),a.child=_,a.memoizedState=null,_}function i_(i,a){return a=df({mode:"visible",children:a},i.mode,0,null),a.return=i,i.child=a}function fp(i,a,h,_){return _!==null&&Ug(_),oh(a,i.child,null,h),i=i_(a,a.pendingProps.children),i.flags|=2,a.memoizedState=null,i}function Y2(i,a,h,_,w,T,S){if(h)return a.flags&256?(a.flags&=-257,_=bm(Error(it(422))),fp(i,a,S,_)):a.memoizedState!==null?(a.child=i.child,a.flags|=128,null):(T=_.fallback,w=a.mode,_=df({mode:"visible",children:_.children},w,0,null),T=qc(T,w,S,null),T.flags|=2,_.return=a,T.return=a,_.sibling=T,a.child=_,a.mode&1&&oh(a,i.child,null,S),a.child.memoizedState=og(S),a.memoizedState=ag,T);if(!(a.mode&1))return fp(i,a,S,null);if(w.data==="$!"){if(_=w.nextSibling&&w.nextSibling.dataset,_)var d=_.dgst;return _=d,T=Error(it(419)),_=bm(T,_,void 0),fp(i,a,S,_)}if(d=(S&i.childLanes)!==0,ts||d){if(_=fn,_!==null){switch(S&-S){case 4:w=2;break;case 16:w=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:w=32;break;case 536870912:w=268435456;break;default:w=0}w=w&(_.suspendedLanes|S)?0:w,w!==0&&w!==T.retryLane&&(T.retryLane=w,Fo(i,w),ya(_,i,w,-1))}return c_(),_=bm(Error(it(421))),fp(i,a,S,_)}return w.data==="$?"?(a.flags|=128,a.child=i.child,a=hS.bind(null,i),w._reactRetry=a,null):(i=T.treeContext,ws=jl(w.nextSibling),Ss=a,fi=!0,ga=null,i!==null&&(js[Vs++]=Ao,js[Vs++]=Do,js[Vs++]=Zc,Ao=i.id,Do=i.overflow,Zc=a),a=i_(a,_.children),a.flags|=4096,a)}function z0(i,a,h){i.lanes|=a;var _=i.alternate;_!==null&&(_.lanes|=a),eg(i.return,a,h)}function wm(i,a,h,_,w){var T=i.memoizedState;T===null?i.memoizedState={isBackwards:a,rendering:null,renderingStartTime:0,last:_,tail:h,tailMode:w}:(T.isBackwards=a,T.rendering=null,T.renderingStartTime=0,T.last=_,T.tail=h,T.tailMode=w)}function B1(i,a,h){var _=a.pendingProps,w=_.revealOrder,T=_.tail;if(qn(i,a,_.children,h),_=xi.current,_&2)_=_&1|2,a.flags|=128;else{if(i!==null&&i.flags&128)e:for(i=a.child;i!==null;){if(i.tag===13)i.memoizedState!==null&&z0(i,h,a);else if(i.tag===19)z0(i,h,a);else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===a)break e;for(;i.sibling===null;){if(i.return===null||i.return===a)break e;i=i.return}i.sibling.return=i.return,i=i.sibling}_&=1}if(ii(xi,_),!(a.mode&1))a.memoizedState=null;else switch(w){case"forwards":for(h=a.child,w=null;h!==null;)i=h.alternate,i!==null&&Zp(i)===null&&(w=h),h=h.sibling;h=w,h===null?(w=a.child,a.child=null):(w=h.sibling,h.sibling=null),wm(a,!1,w,h,T);break;case"backwards":for(h=null,w=a.child,a.child=null;w!==null;){if(i=w.alternate,i!==null&&Zp(i)===null){a.child=w;break}i=w.sibling,w.sibling=h,h=w,w=i}wm(a,!0,h,null,T);break;case"together":wm(a,!1,null,null,void 0);break;default:a.memoizedState=null}return a.child}function Tp(i,a){!(a.mode&1)&&i!==null&&(i.alternate=null,a.alternate=null,a.flags|=2)}function Bo(i,a,h){if(i!==null&&(a.dependencies=i.dependencies),Wc|=a.lanes,!(h&a.childLanes))return null;if(i!==null&&a.child!==i.child)throw Error(it(153));if(a.child!==null){for(i=a.child,h=Gl(i,i.pendingProps),a.child=h,h.return=a;i.sibling!==null;)i=i.sibling,h=h.sibling=Gl(i,i.pendingProps),h.return=a;h.sibling=null}return a.child}function Q2(i,a,h){switch(a.tag){case 3:R1(a),ah();break;case 5:c1(a);break;case 1:is(a.type)&&$p(a);break;case 4:Xg(a,a.stateNode.containerInfo);break;case 10:var _=a.type._context,w=a.memoizedProps.value;ii(Up,_._currentValue),_._currentValue=w;break;case 13:if(_=a.memoizedState,_!==null)return _.dehydrated!==null?(ii(xi,xi.current&1),a.flags|=128,null):h&a.child.childLanes?F1(i,a,h):(ii(xi,xi.current&1),i=Bo(i,a,h),i!==null?i.sibling:null);ii(xi,xi.current&1);break;case 19:if(_=(h&a.childLanes)!==0,i.flags&128){if(_)return B1(i,a,h);a.flags|=128}if(w=a.memoizedState,w!==null&&(w.rendering=null,w.tail=null,w.lastEffect=null),ii(xi,xi.current),_)break;return null;case 22:case 23:return a.lanes=0,z1(i,a,h)}return Bo(i,a,h)}var O1,lg,N1,$1;O1=function(i,a){for(var h=a.child;h!==null;){if(h.tag===5||h.tag===6)i.appendChild(h.stateNode);else if(h.tag!==4&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===a)break;for(;h.sibling===null;){if(h.return===null||h.return===a)return;h=h.return}h.sibling.return=h.return,h=h.sibling}};lg=function(){};N1=function(i,a,h,_){var w=i.memoizedProps;if(w!==_){i=a.stateNode,Vc(Ya.current);var T=null;switch(h){case"input":w=Pm(i,w),_=Pm(i,_),T=[];break;case"select":w=wi({},w,{value:void 0}),_=wi({},_,{value:void 0}),T=[];break;case"textarea":w=zm(i,w),_=zm(i,_),T=[];break;default:typeof w.onClick!="function"&&typeof _.onClick=="function"&&(i.onclick=Op)}Rm(h,_);var S;h=null;for(me in w)if(!_.hasOwnProperty(me)&&w.hasOwnProperty(me)&&w[me]!=null)if(me==="style"){var d=w[me];for(S in d)d.hasOwnProperty(S)&&(h||(h={}),h[S]="")}else me!=="dangerouslySetInnerHTML"&&me!=="children"&&me!=="suppressContentEditableWarning"&&me!=="suppressHydrationWarning"&&me!=="autoFocus"&&(fd.hasOwnProperty(me)?T||(T=[]):(T=T||[]).push(me,null));for(me in _){var q=_[me];if(d=w!=null?w[me]:void 0,_.hasOwnProperty(me)&&q!==d&&(q!=null||d!=null))if(me==="style")if(d){for(S in d)!d.hasOwnProperty(S)||q&&q.hasOwnProperty(S)||(h||(h={}),h[S]="");for(S in q)q.hasOwnProperty(S)&&d[S]!==q[S]&&(h||(h={}),h[S]=q[S])}else h||(T||(T=[]),T.push(me,h)),h=q;else me==="dangerouslySetInnerHTML"?(q=q?q.__html:void 0,d=d?d.__html:void 0,q!=null&&d!==q&&(T=T||[]).push(me,q)):me==="children"?typeof q!="string"&&typeof q!="number"||(T=T||[]).push(me,""+q):me!=="suppressContentEditableWarning"&&me!=="suppressHydrationWarning"&&(fd.hasOwnProperty(me)?(q!=null&&me==="onScroll"&&ni("scroll",i),T||d===q||(T=[])):(T=T||[]).push(me,q))}h&&(T=T||[]).push("style",h);var me=T;(a.updateQueue=me)&&(a.flags|=4)}};$1=function(i,a,h,_){h!==_&&(a.flags|=4)};function Qh(i,a){if(!fi)switch(i.tailMode){case"hidden":a=i.tail;for(var h=null;a!==null;)a.alternate!==null&&(h=a),a=a.sibling;h===null?i.tail=null:h.sibling=null;break;case"collapsed":h=i.tail;for(var _=null;h!==null;)h.alternate!==null&&(_=h),h=h.sibling;_===null?a||i.tail===null?i.tail=null:i.tail.sibling=null:_.sibling=null}}function Ln(i){var a=i.alternate!==null&&i.alternate.child===i.child,h=0,_=0;if(a)for(var w=i.child;w!==null;)h|=w.lanes|w.childLanes,_|=w.subtreeFlags&14680064,_|=w.flags&14680064,w.return=i,w=w.sibling;else for(w=i.child;w!==null;)h|=w.lanes|w.childLanes,_|=w.subtreeFlags,_|=w.flags,w.return=i,w=w.sibling;return i.subtreeFlags|=_,i.childLanes=h,a}function eS(i,a,h){var _=a.pendingProps;switch(Vg(a),a.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ln(a),null;case 1:return is(a.type)&&Np(),Ln(a),null;case 3:return _=a.stateNode,lh(),si(rs),si(Fn),Jg(),_.pendingContext&&(_.context=_.pendingContext,_.pendingContext=null),(i===null||i.child===null)&&(dp(a)?a.flags|=4:i===null||i.memoizedState.isDehydrated&&!(a.flags&256)||(a.flags|=1024,ga!==null&&(gg(ga),ga=null))),lg(i,a),Ln(a),null;case 5:Kg(a);var w=Vc(Td.current);if(h=a.type,i!==null&&a.stateNode!=null)N1(i,a,h,_,w),i.ref!==a.ref&&(a.flags|=512,a.flags|=2097152);else{if(!_){if(a.stateNode===null)throw Error(it(166));return Ln(a),null}if(i=Vc(Ya.current),dp(a)){_=a.stateNode,h=a.type;var T=a.memoizedProps;switch(_[Ka]=a,_[Md]=T,i=(a.mode&1)!==0,h){case"dialog":ni("cancel",_),ni("close",_);break;case"iframe":case"object":case"embed":ni("load",_);break;case"video":case"audio":for(w=0;w<nd.length;w++)ni(nd[w],_);break;case"source":ni("error",_);break;case"img":case"image":case"link":ni("error",_),ni("load",_);break;case"details":ni("toggle",_);break;case"input":Vy(_,T),ni("invalid",_);break;case"select":_._wrapperState={wasMultiple:!!T.multiple},ni("invalid",_);break;case"textarea":qy(_,T),ni("invalid",_)}Rm(h,T),w=null;for(var S in T)if(T.hasOwnProperty(S)){var d=T[S];S==="children"?typeof d=="string"?_.textContent!==d&&(T.suppressHydrationWarning!==!0&&hp(_.textContent,d,i),w=["children",d]):typeof d=="number"&&_.textContent!==""+d&&(T.suppressHydrationWarning!==!0&&hp(_.textContent,d,i),w=["children",""+d]):fd.hasOwnProperty(S)&&d!=null&&S==="onScroll"&&ni("scroll",_)}switch(h){case"input":ip(_),Uy(_,T,!0);break;case"textarea":ip(_),Gy(_);break;case"select":case"option":break;default:typeof T.onClick=="function"&&(_.onclick=Op)}_=w,a.updateQueue=_,_!==null&&(a.flags|=4)}else{S=w.nodeType===9?w:w.ownerDocument,i==="http://www.w3.org/1999/xhtml"&&(i=fv(h)),i==="http://www.w3.org/1999/xhtml"?h==="script"?(i=S.createElement("div"),i.innerHTML="<script><\/script>",i=i.removeChild(i.firstChild)):typeof _.is=="string"?i=S.createElement(h,{is:_.is}):(i=S.createElement(h),h==="select"&&(S=i,_.multiple?S.multiple=!0:_.size&&(S.size=_.size))):i=S.createElementNS(i,h),i[Ka]=a,i[Md]=_,O1(i,a,!1,!1),a.stateNode=i;e:{switch(S=Fm(h,_),h){case"dialog":ni("cancel",i),ni("close",i),w=_;break;case"iframe":case"object":case"embed":ni("load",i),w=_;break;case"video":case"audio":for(w=0;w<nd.length;w++)ni(nd[w],i);w=_;break;case"source":ni("error",i),w=_;break;case"img":case"image":case"link":ni("error",i),ni("load",i),w=_;break;case"details":ni("toggle",i),w=_;break;case"input":Vy(i,_),w=Pm(i,_),ni("invalid",i);break;case"option":w=_;break;case"select":i._wrapperState={wasMultiple:!!_.multiple},w=wi({},_,{value:void 0}),ni("invalid",i);break;case"textarea":qy(i,_),w=zm(i,_),ni("invalid",i);break;default:w=_}Rm(h,w),d=w;for(T in d)if(d.hasOwnProperty(T)){var q=d[T];T==="style"?_v(i,q):T==="dangerouslySetInnerHTML"?(q=q?q.__html:void 0,q!=null&&mv(i,q)):T==="children"?typeof q=="string"?(h!=="textarea"||q!=="")&&md(i,q):typeof q=="number"&&md(i,""+q):T!=="suppressContentEditableWarning"&&T!=="suppressHydrationWarning"&&T!=="autoFocus"&&(fd.hasOwnProperty(T)?q!=null&&T==="onScroll"&&ni("scroll",i):q!=null&&Cg(i,T,q,S))}switch(h){case"input":ip(i),Uy(i,_,!1);break;case"textarea":ip(i),Gy(i);break;case"option":_.value!=null&&i.setAttribute("value",""+Zl(_.value));break;case"select":i.multiple=!!_.multiple,T=_.value,T!=null?Yu(i,!!_.multiple,T,!1):_.defaultValue!=null&&Yu(i,!!_.multiple,_.defaultValue,!0);break;default:typeof w.onClick=="function"&&(i.onclick=Op)}switch(h){case"button":case"input":case"select":case"textarea":_=!!_.autoFocus;break e;case"img":_=!0;break e;default:_=!1}}_&&(a.flags|=4)}a.ref!==null&&(a.flags|=512,a.flags|=2097152)}return Ln(a),null;case 6:if(i&&a.stateNode!=null)$1(i,a,i.memoizedProps,_);else{if(typeof _!="string"&&a.stateNode===null)throw Error(it(166));if(h=Vc(Td.current),Vc(Ya.current),dp(a)){if(_=a.stateNode,h=a.memoizedProps,_[Ka]=a,(T=_.nodeValue!==h)&&(i=Ss,i!==null))switch(i.tag){case 3:hp(_.nodeValue,h,(i.mode&1)!==0);break;case 5:i.memoizedProps.suppressHydrationWarning!==!0&&hp(_.nodeValue,h,(i.mode&1)!==0)}T&&(a.flags|=4)}else _=(h.nodeType===9?h:h.ownerDocument).createTextNode(_),_[Ka]=a,a.stateNode=_}return Ln(a),null;case 13:if(si(xi),_=a.memoizedState,i===null||i.memoizedState!==null&&i.memoizedState.dehydrated!==null){if(fi&&ws!==null&&a.mode&1&&!(a.flags&128))n1(),ah(),a.flags|=98560,T=!1;else if(T=dp(a),_!==null&&_.dehydrated!==null){if(i===null){if(!T)throw Error(it(318));if(T=a.memoizedState,T=T!==null?T.dehydrated:null,!T)throw Error(it(317));T[Ka]=a}else ah(),!(a.flags&128)&&(a.memoizedState=null),a.flags|=4;Ln(a),T=!1}else ga!==null&&(gg(ga),ga=null),T=!0;if(!T)return a.flags&65536?a:null}return a.flags&128?(a.lanes=h,a):(_=_!==null,_!==(i!==null&&i.memoizedState!==null)&&_&&(a.child.flags|=8192,a.mode&1&&(i===null||xi.current&1?rn===0&&(rn=3):c_())),a.updateQueue!==null&&(a.flags|=4),Ln(a),null);case 4:return lh(),lg(i,a),i===null&&wd(a.stateNode.containerInfo),Ln(a),null;case 10:return Zg(a.type._context),Ln(a),null;case 17:return is(a.type)&&Np(),Ln(a),null;case 19:if(si(xi),T=a.memoizedState,T===null)return Ln(a),null;if(_=(a.flags&128)!==0,S=T.rendering,S===null)if(_)Qh(T,!1);else{if(rn!==0||i!==null&&i.flags&128)for(i=a.child;i!==null;){if(S=Zp(i),S!==null){for(a.flags|=128,Qh(T,!1),_=S.updateQueue,_!==null&&(a.updateQueue=_,a.flags|=4),a.subtreeFlags=0,_=h,h=a.child;h!==null;)T=h,i=_,T.flags&=14680066,S=T.alternate,S===null?(T.childLanes=0,T.lanes=i,T.child=null,T.subtreeFlags=0,T.memoizedProps=null,T.memoizedState=null,T.updateQueue=null,T.dependencies=null,T.stateNode=null):(T.childLanes=S.childLanes,T.lanes=S.lanes,T.child=S.child,T.subtreeFlags=0,T.deletions=null,T.memoizedProps=S.memoizedProps,T.memoizedState=S.memoizedState,T.updateQueue=S.updateQueue,T.type=S.type,i=S.dependencies,T.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext}),h=h.sibling;return ii(xi,xi.current&1|2),a.child}i=i.sibling}T.tail!==null&&Fi()>uh&&(a.flags|=128,_=!0,Qh(T,!1),a.lanes=4194304)}else{if(!_)if(i=Zp(S),i!==null){if(a.flags|=128,_=!0,h=i.updateQueue,h!==null&&(a.updateQueue=h,a.flags|=4),Qh(T,!0),T.tail===null&&T.tailMode==="hidden"&&!S.alternate&&!fi)return Ln(a),null}else 2*Fi()-T.renderingStartTime>uh&&h!==1073741824&&(a.flags|=128,_=!0,Qh(T,!1),a.lanes=4194304);T.isBackwards?(S.sibling=a.child,a.child=S):(h=T.last,h!==null?h.sibling=S:a.child=S,T.last=S)}return T.tail!==null?(a=T.tail,T.rendering=a,T.tail=a.sibling,T.renderingStartTime=Fi(),a.sibling=null,h=xi.current,ii(xi,_?h&1|2:h&1),a):(Ln(a),null);case 22:case 23:return l_(),_=a.memoizedState!==null,i!==null&&i.memoizedState!==null!==_&&(a.flags|=8192),_&&a.mode&1?bs&1073741824&&(Ln(a),a.subtreeFlags&6&&(a.flags|=8192)):Ln(a),null;case 24:return null;case 25:return null}throw Error(it(156,a.tag))}function tS(i,a){switch(Vg(a),a.tag){case 1:return is(a.type)&&Np(),i=a.flags,i&65536?(a.flags=i&-65537|128,a):null;case 3:return lh(),si(rs),si(Fn),Jg(),i=a.flags,i&65536&&!(i&128)?(a.flags=i&-65537|128,a):null;case 5:return Kg(a),null;case 13:if(si(xi),i=a.memoizedState,i!==null&&i.dehydrated!==null){if(a.alternate===null)throw Error(it(340));ah()}return i=a.flags,i&65536?(a.flags=i&-65537|128,a):null;case 19:return si(xi),null;case 4:return lh(),null;case 10:return Zg(a.type._context),null;case 22:case 23:return l_(),null;case 24:return null;default:return null}}var mp=!1,Rn=!1,rS=typeof WeakSet=="function"?WeakSet:Set,zt=null;function Ku(i,a){var h=i.ref;if(h!==null)if(typeof h=="function")try{h(null)}catch(_){Ei(i,a,_)}else h.current=null}function cg(i,a,h){try{h()}catch(_){Ei(i,a,_)}}var L0=!1;function iS(i,a){if(Zm=Rp,i=Gv(),$g(i)){if("selectionStart"in i)var h={start:i.selectionStart,end:i.selectionEnd};else e:{h=(h=i.ownerDocument)&&h.defaultView||window;var _=h.getSelection&&h.getSelection();if(_&&_.rangeCount!==0){h=_.anchorNode;var w=_.anchorOffset,T=_.focusNode;_=_.focusOffset;try{h.nodeType,T.nodeType}catch{h=null;break e}var S=0,d=-1,q=-1,me=0,Pe=0,le=i,H=null;t:for(;;){for(var Ge;le!==h||w!==0&&le.nodeType!==3||(d=S+w),le!==T||_!==0&&le.nodeType!==3||(q=S+_),le.nodeType===3&&(S+=le.nodeValue.length),(Ge=le.firstChild)!==null;)H=le,le=Ge;for(;;){if(le===i)break t;if(H===h&&++me===w&&(d=S),H===T&&++Pe===_&&(q=S),(Ge=le.nextSibling)!==null)break;le=H,H=le.parentNode}le=Ge}h=d===-1||q===-1?null:{start:d,end:q}}else h=null}h=h||{start:0,end:0}}else h=null;for(Hm={focusedElem:i,selectionRange:h},Rp=!1,zt=a;zt!==null;)if(a=zt,i=a.child,(a.subtreeFlags&1028)!==0&&i!==null)i.return=a,zt=i;else for(;zt!==null;){a=zt;try{var We=a.alternate;if(a.flags&1024)switch(a.tag){case 0:case 11:case 15:break;case 1:if(We!==null){var ke=We.memoizedProps,gt=We.memoizedState,he=a.stateNode,ne=he.getSnapshotBeforeUpdate(a.elementType===a.type?ke:fa(a.type,ke),gt);he.__reactInternalSnapshotBeforeUpdate=ne}break;case 3:var _e=a.stateNode.containerInfo;_e.nodeType===1?_e.textContent="":_e.nodeType===9&&_e.documentElement&&_e.removeChild(_e.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(it(163))}}catch(je){Ei(a,a.return,je)}if(i=a.sibling,i!==null){i.return=a.return,zt=i;break}zt=a.return}return We=L0,L0=!1,We}function hd(i,a,h){var _=a.updateQueue;if(_=_!==null?_.lastEffect:null,_!==null){var w=_=_.next;do{if((w.tag&i)===i){var T=w.destroy;w.destroy=void 0,T!==void 0&&cg(a,h,T)}w=w.next}while(w!==_)}}function uf(i,a){if(a=a.updateQueue,a=a!==null?a.lastEffect:null,a!==null){var h=a=a.next;do{if((h.tag&i)===i){var _=h.create;h.destroy=_()}h=h.next}while(h!==a)}}function ug(i){var a=i.ref;if(a!==null){var h=i.stateNode;switch(i.tag){case 5:i=h;break;default:i=h}typeof a=="function"?a(i):a.current=i}}function j1(i){var a=i.alternate;a!==null&&(i.alternate=null,j1(a)),i.child=null,i.deletions=null,i.sibling=null,i.tag===5&&(a=i.stateNode,a!==null&&(delete a[Ka],delete a[Md],delete a[Km],delete a[N2],delete a[$2])),i.stateNode=null,i.return=null,i.dependencies=null,i.memoizedProps=null,i.memoizedState=null,i.pendingProps=null,i.stateNode=null,i.updateQueue=null}function V1(i){return i.tag===5||i.tag===3||i.tag===4}function R0(i){e:for(;;){for(;i.sibling===null;){if(i.return===null||V1(i.return))return null;i=i.return}for(i.sibling.return=i.return,i=i.sibling;i.tag!==5&&i.tag!==6&&i.tag!==18;){if(i.flags&2||i.child===null||i.tag===4)continue e;i.child.return=i,i=i.child}if(!(i.flags&2))return i.stateNode}}function hg(i,a,h){var _=i.tag;if(_===5||_===6)i=i.stateNode,a?h.nodeType===8?h.parentNode.insertBefore(i,a):h.insertBefore(i,a):(h.nodeType===8?(a=h.parentNode,a.insertBefore(i,h)):(a=h,a.appendChild(i)),h=h._reactRootContainer,h!=null||a.onclick!==null||(a.onclick=Op));else if(_!==4&&(i=i.child,i!==null))for(hg(i,a,h),i=i.sibling;i!==null;)hg(i,a,h),i=i.sibling}function dg(i,a,h){var _=i.tag;if(_===5||_===6)i=i.stateNode,a?h.insertBefore(i,a):h.appendChild(i);else if(_!==4&&(i=i.child,i!==null))for(dg(i,a,h),i=i.sibling;i!==null;)dg(i,a,h),i=i.sibling}var Tn=null,ma=!1;function Al(i,a,h){for(h=h.child;h!==null;)U1(i,a,h),h=h.sibling}function U1(i,a,h){if(Ja&&typeof Ja.onCommitFiberUnmount=="function")try{Ja.onCommitFiberUnmount(tf,h)}catch{}switch(h.tag){case 5:Rn||Ku(h,a);case 6:var _=Tn,w=ma;Tn=null,Al(i,a,h),Tn=_,ma=w,Tn!==null&&(ma?(i=Tn,h=h.stateNode,i.nodeType===8?i.parentNode.removeChild(h):i.removeChild(h)):Tn.removeChild(h.stateNode));break;case 18:Tn!==null&&(ma?(i=Tn,h=h.stateNode,i.nodeType===8?mm(i.parentNode,h):i.nodeType===1&&mm(i,h),vd(i)):mm(Tn,h.stateNode));break;case 4:_=Tn,w=ma,Tn=h.stateNode.containerInfo,ma=!0,Al(i,a,h),Tn=_,ma=w;break;case 0:case 11:case 14:case 15:if(!Rn&&(_=h.updateQueue,_!==null&&(_=_.lastEffect,_!==null))){w=_=_.next;do{var T=w,S=T.destroy;T=T.tag,S!==void 0&&(T&2||T&4)&&cg(h,a,S),w=w.next}while(w!==_)}Al(i,a,h);break;case 1:if(!Rn&&(Ku(h,a),_=h.stateNode,typeof _.componentWillUnmount=="function"))try{_.props=h.memoizedProps,_.state=h.memoizedState,_.componentWillUnmount()}catch(d){Ei(h,a,d)}Al(i,a,h);break;case 21:Al(i,a,h);break;case 22:h.mode&1?(Rn=(_=Rn)||h.memoizedState!==null,Al(i,a,h),Rn=_):Al(i,a,h);break;default:Al(i,a,h)}}function F0(i){var a=i.updateQueue;if(a!==null){i.updateQueue=null;var h=i.stateNode;h===null&&(h=i.stateNode=new rS),a.forEach(function(_){var w=dS.bind(null,i,_);h.has(_)||(h.add(_),_.then(w,w))})}}function pa(i,a){var h=a.deletions;if(h!==null)for(var _=0;_<h.length;_++){var w=h[_];try{var T=i,S=a,d=S;e:for(;d!==null;){switch(d.tag){case 5:Tn=d.stateNode,ma=!1;break e;case 3:Tn=d.stateNode.containerInfo,ma=!0;break e;case 4:Tn=d.stateNode.containerInfo,ma=!0;break e}d=d.return}if(Tn===null)throw Error(it(160));U1(T,S,w),Tn=null,ma=!1;var q=w.alternate;q!==null&&(q.return=null),w.return=null}catch(me){Ei(w,a,me)}}if(a.subtreeFlags&12854)for(a=a.child;a!==null;)q1(a,i),a=a.sibling}function q1(i,a){var h=i.alternate,_=i.flags;switch(i.tag){case 0:case 11:case 14:case 15:if(pa(a,i),Wa(i),_&4){try{hd(3,i,i.return),uf(3,i)}catch(ke){Ei(i,i.return,ke)}try{hd(5,i,i.return)}catch(ke){Ei(i,i.return,ke)}}break;case 1:pa(a,i),Wa(i),_&512&&h!==null&&Ku(h,h.return);break;case 5:if(pa(a,i),Wa(i),_&512&&h!==null&&Ku(h,h.return),i.flags&32){var w=i.stateNode;try{md(w,"")}catch(ke){Ei(i,i.return,ke)}}if(_&4&&(w=i.stateNode,w!=null)){var T=i.memoizedProps,S=h!==null?h.memoizedProps:T,d=i.type,q=i.updateQueue;if(i.updateQueue=null,q!==null)try{d==="input"&&T.type==="radio"&&T.name!=null&&dv(w,T),Fm(d,S);var me=Fm(d,T);for(S=0;S<q.length;S+=2){var Pe=q[S],le=q[S+1];Pe==="style"?_v(w,le):Pe==="dangerouslySetInnerHTML"?mv(w,le):Pe==="children"?md(w,le):Cg(w,Pe,le,me)}switch(d){case"input":Am(w,T);break;case"textarea":pv(w,T);break;case"select":var H=w._wrapperState.wasMultiple;w._wrapperState.wasMultiple=!!T.multiple;var Ge=T.value;Ge!=null?Yu(w,!!T.multiple,Ge,!1):H!==!!T.multiple&&(T.defaultValue!=null?Yu(w,!!T.multiple,T.defaultValue,!0):Yu(w,!!T.multiple,T.multiple?[]:"",!1))}w[Md]=T}catch(ke){Ei(i,i.return,ke)}}break;case 6:if(pa(a,i),Wa(i),_&4){if(i.stateNode===null)throw Error(it(162));w=i.stateNode,T=i.memoizedProps;try{w.nodeValue=T}catch(ke){Ei(i,i.return,ke)}}break;case 3:if(pa(a,i),Wa(i),_&4&&h!==null&&h.memoizedState.isDehydrated)try{vd(a.containerInfo)}catch(ke){Ei(i,i.return,ke)}break;case 4:pa(a,i),Wa(i);break;case 13:pa(a,i),Wa(i),w=i.child,w.flags&8192&&(T=w.memoizedState!==null,w.stateNode.isHidden=T,!T||w.alternate!==null&&w.alternate.memoizedState!==null||(a_=Fi())),_&4&&F0(i);break;case 22:if(Pe=h!==null&&h.memoizedState!==null,i.mode&1?(Rn=(me=Rn)||Pe,pa(a,i),Rn=me):pa(a,i),Wa(i),_&8192){if(me=i.memoizedState!==null,(i.stateNode.isHidden=me)&&!Pe&&i.mode&1)for(zt=i,Pe=i.child;Pe!==null;){for(le=zt=Pe;zt!==null;){switch(H=zt,Ge=H.child,H.tag){case 0:case 11:case 14:case 15:hd(4,H,H.return);break;case 1:Ku(H,H.return);var We=H.stateNode;if(typeof We.componentWillUnmount=="function"){_=H,h=H.return;try{a=_,We.props=a.memoizedProps,We.state=a.memoizedState,We.componentWillUnmount()}catch(ke){Ei(_,h,ke)}}break;case 5:Ku(H,H.return);break;case 22:if(H.memoizedState!==null){O0(le);continue}}Ge!==null?(Ge.return=H,zt=Ge):O0(le)}Pe=Pe.sibling}e:for(Pe=null,le=i;;){if(le.tag===5){if(Pe===null){Pe=le;try{w=le.stateNode,me?(T=w.style,typeof T.setProperty=="function"?T.setProperty("display","none","important"):T.display="none"):(d=le.stateNode,q=le.memoizedProps.style,S=q!=null&&q.hasOwnProperty("display")?q.display:null,d.style.display=gv("display",S))}catch(ke){Ei(i,i.return,ke)}}}else if(le.tag===6){if(Pe===null)try{le.stateNode.nodeValue=me?"":le.memoizedProps}catch(ke){Ei(i,i.return,ke)}}else if((le.tag!==22&&le.tag!==23||le.memoizedState===null||le===i)&&le.child!==null){le.child.return=le,le=le.child;continue}if(le===i)break e;for(;le.sibling===null;){if(le.return===null||le.return===i)break e;Pe===le&&(Pe=null),le=le.return}Pe===le&&(Pe=null),le.sibling.return=le.return,le=le.sibling}}break;case 19:pa(a,i),Wa(i),_&4&&F0(i);break;case 21:break;default:pa(a,i),Wa(i)}}function Wa(i){var a=i.flags;if(a&2){try{e:{for(var h=i.return;h!==null;){if(V1(h)){var _=h;break e}h=h.return}throw Error(it(160))}switch(_.tag){case 5:var w=_.stateNode;_.flags&32&&(md(w,""),_.flags&=-33);var T=R0(i);dg(i,T,w);break;case 3:case 4:var S=_.stateNode.containerInfo,d=R0(i);hg(i,d,S);break;default:throw Error(it(161))}}catch(q){Ei(i,i.return,q)}i.flags&=-3}a&4096&&(i.flags&=-4097)}function nS(i,a,h){zt=i,G1(i)}function G1(i,a,h){for(var _=(i.mode&1)!==0;zt!==null;){var w=zt,T=w.child;if(w.tag===22&&_){var S=w.memoizedState!==null||mp;if(!S){var d=w.alternate,q=d!==null&&d.memoizedState!==null||Rn;d=mp;var me=Rn;if(mp=S,(Rn=q)&&!me)for(zt=w;zt!==null;)S=zt,q=S.child,S.tag===22&&S.memoizedState!==null?N0(w):q!==null?(q.return=S,zt=q):N0(w);for(;T!==null;)zt=T,G1(T),T=T.sibling;zt=w,mp=d,Rn=me}B0(i)}else w.subtreeFlags&8772&&T!==null?(T.return=w,zt=T):B0(i)}}function B0(i){for(;zt!==null;){var a=zt;if(a.flags&8772){var h=a.alternate;try{if(a.flags&8772)switch(a.tag){case 0:case 11:case 15:Rn||uf(5,a);break;case 1:var _=a.stateNode;if(a.flags&4&&!Rn)if(h===null)_.componentDidMount();else{var w=a.elementType===a.type?h.memoizedProps:fa(a.type,h.memoizedProps);_.componentDidUpdate(w,h.memoizedState,_.__reactInternalSnapshotBeforeUpdate)}var T=a.updateQueue;T!==null&&b0(a,T,_);break;case 3:var S=a.updateQueue;if(S!==null){if(h=null,a.child!==null)switch(a.child.tag){case 5:h=a.child.stateNode;break;case 1:h=a.child.stateNode}b0(a,S,h)}break;case 5:var d=a.stateNode;if(h===null&&a.flags&4){h=d;var q=a.memoizedProps;switch(a.type){case"button":case"input":case"select":case"textarea":q.autoFocus&&h.focus();break;case"img":q.src&&(h.src=q.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(a.memoizedState===null){var me=a.alternate;if(me!==null){var Pe=me.memoizedState;if(Pe!==null){var le=Pe.dehydrated;le!==null&&vd(le)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(it(163))}Rn||a.flags&512&&ug(a)}catch(H){Ei(a,a.return,H)}}if(a===i){zt=null;break}if(h=a.sibling,h!==null){h.return=a.return,zt=h;break}zt=a.return}}function O0(i){for(;zt!==null;){var a=zt;if(a===i){zt=null;break}var h=a.sibling;if(h!==null){h.return=a.return,zt=h;break}zt=a.return}}function N0(i){for(;zt!==null;){var a=zt;try{switch(a.tag){case 0:case 11:case 15:var h=a.return;try{uf(4,a)}catch(q){Ei(a,h,q)}break;case 1:var _=a.stateNode;if(typeof _.componentDidMount=="function"){var w=a.return;try{_.componentDidMount()}catch(q){Ei(a,w,q)}}var T=a.return;try{ug(a)}catch(q){Ei(a,T,q)}break;case 5:var S=a.return;try{ug(a)}catch(q){Ei(a,S,q)}}}catch(q){Ei(a,a.return,q)}if(a===i){zt=null;break}var d=a.sibling;if(d!==null){d.return=a.return,zt=d;break}zt=a.return}}var sS=Math.ceil,Xp=Oo.ReactCurrentDispatcher,n_=Oo.ReactCurrentOwner,qs=Oo.ReactCurrentBatchConfig,Dr=0,fn=null,Zi=null,Cn=0,bs=0,Ju=Xl(0),rn=0,Pd=null,Wc=0,hf=0,s_=0,dd=null,es=null,a_=0,uh=1/0,Eo=null,Kp=!1,pg=null,Ul=null,gp=!1,Bl=null,Jp=0,pd=0,fg=null,Cp=-1,Ip=0;function Gn(){return Dr&6?Fi():Cp!==-1?Cp:Cp=Fi()}function ql(i){return i.mode&1?Dr&2&&Cn!==0?Cn&-Cn:V2.transition!==null?(Ip===0&&(Ip=Ev()),Ip):(i=Xr,i!==0||(i=window.event,i=i===void 0?16:Fv(i.type)),i):1}function ya(i,a,h,_){if(50<pd)throw pd=0,fg=null,Error(it(185));Dd(i,h,_),(!(Dr&2)||i!==fn)&&(i===fn&&(!(Dr&2)&&(hf|=h),rn===4&&Rl(i,Cn)),ns(i,_),h===1&&Dr===0&&!(a.mode&1)&&(uh=Fi()+500,of&&Kl()))}function ns(i,a){var h=i.callbackNode;Vw(i,a);var _=Lp(i,i===fn?Cn:0);if(_===0)h!==null&&Wy(h),i.callbackNode=null,i.callbackPriority=0;else if(a=_&-_,i.callbackPriority!==a){if(h!=null&&Wy(h),a===1)i.tag===0?j2($0.bind(null,i)):t1($0.bind(null,i)),B2(function(){!(Dr&6)&&Kl()}),h=null;else{switch(Pv(_)){case 1:h=Dg;break;case 4:h=Cv;break;case 16:h=zp;break;case 536870912:h=Iv;break;default:h=zp}h=Q1(h,Z1.bind(null,i))}i.callbackPriority=a,i.callbackNode=h}}function Z1(i,a){if(Cp=-1,Ip=0,Dr&6)throw Error(it(327));var h=i.callbackNode;if(ih()&&i.callbackNode!==h)return null;var _=Lp(i,i===fn?Cn:0);if(_===0)return null;if(_&30||_&i.expiredLanes||a)a=Yp(i,_);else{a=_;var w=Dr;Dr|=2;var T=W1();(fn!==i||Cn!==a)&&(Eo=null,uh=Fi()+500,Uc(i,a));do try{lS();break}catch(d){H1(i,d)}while(!0);Gg(),Xp.current=T,Dr=w,Zi!==null?a=0:(fn=null,Cn=0,a=rn)}if(a!==0){if(a===2&&(w=jm(i),w!==0&&(_=w,a=mg(i,w))),a===1)throw h=Pd,Uc(i,0),Rl(i,_),ns(i,Fi()),h;if(a===6)Rl(i,_);else{if(w=i.current.alternate,!(_&30)&&!aS(w)&&(a=Yp(i,_),a===2&&(T=jm(i),T!==0&&(_=T,a=mg(i,T))),a===1))throw h=Pd,Uc(i,0),Rl(i,_),ns(i,Fi()),h;switch(i.finishedWork=w,i.finishedLanes=_,a){case 0:case 1:throw Error(it(345));case 2:Nc(i,es,Eo);break;case 3:if(Rl(i,_),(_&130023424)===_&&(a=a_+500-Fi(),10<a)){if(Lp(i,0)!==0)break;if(w=i.suspendedLanes,(w&_)!==_){Gn(),i.pingedLanes|=i.suspendedLanes&w;break}i.timeoutHandle=Xm(Nc.bind(null,i,es,Eo),a);break}Nc(i,es,Eo);break;case 4:if(Rl(i,_),(_&4194240)===_)break;for(a=i.eventTimes,w=-1;0<_;){var S=31-_a(_);T=1<<S,S=a[S],S>w&&(w=S),_&=~T}if(_=w,_=Fi()-_,_=(120>_?120:480>_?480:1080>_?1080:1920>_?1920:3e3>_?3e3:4320>_?4320:1960*sS(_/1960))-_,10<_){i.timeoutHandle=Xm(Nc.bind(null,i,es,Eo),_);break}Nc(i,es,Eo);break;case 5:Nc(i,es,Eo);break;default:throw Error(it(329))}}}return ns(i,Fi()),i.callbackNode===h?Z1.bind(null,i):null}function mg(i,a){var h=dd;return i.current.memoizedState.isDehydrated&&(Uc(i,a).flags|=256),i=Yp(i,a),i!==2&&(a=es,es=h,a!==null&&gg(a)),i}function gg(i){es===null?es=i:es.push.apply(es,i)}function aS(i){for(var a=i;;){if(a.flags&16384){var h=a.updateQueue;if(h!==null&&(h=h.stores,h!==null))for(var _=0;_<h.length;_++){var w=h[_],T=w.getSnapshot;w=w.value;try{if(!va(T(),w))return!1}catch{return!1}}}if(h=a.child,a.subtreeFlags&16384&&h!==null)h.return=a,a=h;else{if(a===i)break;for(;a.sibling===null;){if(a.return===null||a.return===i)return!0;a=a.return}a.sibling.return=a.return,a=a.sibling}}return!0}function Rl(i,a){for(a&=~s_,a&=~hf,i.suspendedLanes|=a,i.pingedLanes&=~a,i=i.expirationTimes;0<a;){var h=31-_a(a),_=1<<h;i[h]=-1,a&=~_}}function $0(i){if(Dr&6)throw Error(it(327));ih();var a=Lp(i,0);if(!(a&1))return ns(i,Fi()),null;var h=Yp(i,a);if(i.tag!==0&&h===2){var _=jm(i);_!==0&&(a=_,h=mg(i,_))}if(h===1)throw h=Pd,Uc(i,0),Rl(i,a),ns(i,Fi()),h;if(h===6)throw Error(it(345));return i.finishedWork=i.current.alternate,i.finishedLanes=a,Nc(i,es,Eo),ns(i,Fi()),null}function o_(i,a){var h=Dr;Dr|=1;try{return i(a)}finally{Dr=h,Dr===0&&(uh=Fi()+500,of&&Kl())}}function Xc(i){Bl!==null&&Bl.tag===0&&!(Dr&6)&&ih();var a=Dr;Dr|=1;var h=qs.transition,_=Xr;try{if(qs.transition=null,Xr=1,i)return i()}finally{Xr=_,qs.transition=h,Dr=a,!(Dr&6)&&Kl()}}function l_(){bs=Ju.current,si(Ju)}function Uc(i,a){i.finishedWork=null,i.finishedLanes=0;var h=i.timeoutHandle;if(h!==-1&&(i.timeoutHandle=-1,F2(h)),Zi!==null)for(h=Zi.return;h!==null;){var _=h;switch(Vg(_),_.tag){case 1:_=_.type.childContextTypes,_!=null&&Np();break;case 3:lh(),si(rs),si(Fn),Jg();break;case 5:Kg(_);break;case 4:lh();break;case 13:si(xi);break;case 19:si(xi);break;case 10:Zg(_.type._context);break;case 22:case 23:l_()}h=h.return}if(fn=i,Zi=i=Gl(i.current,null),Cn=bs=a,rn=0,Pd=null,s_=hf=Wc=0,es=dd=null,jc!==null){for(a=0;a<jc.length;a++)if(h=jc[a],_=h.interleaved,_!==null){h.interleaved=null;var w=_.next,T=h.pending;if(T!==null){var S=T.next;T.next=w,_.next=S}h.pending=_}jc=null}return i}function H1(i,a){do{var h=Zi;try{if(Gg(),Mp.current=Wp,Hp){for(var _=bi.memoizedState;_!==null;){var w=_.queue;w!==null&&(w.pending=null),_=_.next}Hp=!1}if(Hc=0,pn=tn=bi=null,ud=!1,Cd=0,n_.current=null,h===null||h.return===null){rn=1,Pd=a,Zi=null;break}e:{var T=i,S=h.return,d=h,q=a;if(a=Cn,d.flags|=32768,q!==null&&typeof q=="object"&&typeof q.then=="function"){var me=q,Pe=d,le=Pe.tag;if(!(Pe.mode&1)&&(le===0||le===11||le===15)){var H=Pe.alternate;H?(Pe.updateQueue=H.updateQueue,Pe.memoizedState=H.memoizedState,Pe.lanes=H.lanes):(Pe.updateQueue=null,Pe.memoizedState=null)}var Ge=C0(S);if(Ge!==null){Ge.flags&=-257,I0(Ge,S,d,T,a),Ge.mode&1&&T0(T,me,a),a=Ge,q=me;var We=a.updateQueue;if(We===null){var ke=new Set;ke.add(q),a.updateQueue=ke}else We.add(q);break e}else{if(!(a&1)){T0(T,me,a),c_();break e}q=Error(it(426))}}else if(fi&&d.mode&1){var gt=C0(S);if(gt!==null){!(gt.flags&65536)&&(gt.flags|=256),I0(gt,S,d,T,a),Ug(ch(q,d));break e}}T=q=ch(q,d),rn!==4&&(rn=2),dd===null?dd=[T]:dd.push(T),T=S;do{switch(T.tag){case 3:T.flags|=65536,a&=-a,T.lanes|=a;var he=P1(T,q,a);x0(T,he);break e;case 1:d=q;var ne=T.type,_e=T.stateNode;if(!(T.flags&128)&&(typeof ne.getDerivedStateFromError=="function"||_e!==null&&typeof _e.componentDidCatch=="function"&&(Ul===null||!Ul.has(_e)))){T.flags|=65536,a&=-a,T.lanes|=a;var je=A1(T,d,a);x0(T,je);break e}}T=T.return}while(T!==null)}K1(h)}catch(rt){a=rt,Zi===h&&h!==null&&(Zi=h=h.return);continue}break}while(!0)}function W1(){var i=Xp.current;return Xp.current=Wp,i===null?Wp:i}function c_(){(rn===0||rn===3||rn===2)&&(rn=4),fn===null||!(Wc&268435455)&&!(hf&268435455)||Rl(fn,Cn)}function Yp(i,a){var h=Dr;Dr|=2;var _=W1();(fn!==i||Cn!==a)&&(Eo=null,Uc(i,a));do try{oS();break}catch(w){H1(i,w)}while(!0);if(Gg(),Dr=h,Xp.current=_,Zi!==null)throw Error(it(261));return fn=null,Cn=0,rn}function oS(){for(;Zi!==null;)X1(Zi)}function lS(){for(;Zi!==null&&!zw();)X1(Zi)}function X1(i){var a=Y1(i.alternate,i,bs);i.memoizedProps=i.pendingProps,a===null?K1(i):Zi=a,n_.current=null}function K1(i){var a=i;do{var h=a.alternate;if(i=a.return,a.flags&32768){if(h=tS(h,a),h!==null){h.flags&=32767,Zi=h;return}if(i!==null)i.flags|=32768,i.subtreeFlags=0,i.deletions=null;else{rn=6,Zi=null;return}}else if(h=eS(h,a,bs),h!==null){Zi=h;return}if(a=a.sibling,a!==null){Zi=a;return}Zi=a=i}while(a!==null);rn===0&&(rn=5)}function Nc(i,a,h){var _=Xr,w=qs.transition;try{qs.transition=null,Xr=1,cS(i,a,h,_)}finally{qs.transition=w,Xr=_}return null}function cS(i,a,h,_){do ih();while(Bl!==null);if(Dr&6)throw Error(it(327));h=i.finishedWork;var w=i.finishedLanes;if(h===null)return null;if(i.finishedWork=null,i.finishedLanes=0,h===i.current)throw Error(it(177));i.callbackNode=null,i.callbackPriority=0;var T=h.lanes|h.childLanes;if(Uw(i,T),i===fn&&(Zi=fn=null,Cn=0),!(h.subtreeFlags&2064)&&!(h.flags&2064)||gp||(gp=!0,Q1(zp,function(){return ih(),null})),T=(h.flags&15990)!==0,h.subtreeFlags&15990||T){T=qs.transition,qs.transition=null;var S=Xr;Xr=1;var d=Dr;Dr|=4,n_.current=null,iS(i,h),q1(h,i),E2(Hm),Rp=!!Zm,Hm=Zm=null,i.current=h,nS(h),Lw(),Dr=d,Xr=S,qs.transition=T}else i.current=h;if(gp&&(gp=!1,Bl=i,Jp=w),T=i.pendingLanes,T===0&&(Ul=null),Bw(h.stateNode),ns(i,Fi()),a!==null)for(_=i.onRecoverableError,h=0;h<a.length;h++)w=a[h],_(w.value,{componentStack:w.stack,digest:w.digest});if(Kp)throw Kp=!1,i=pg,pg=null,i;return Jp&1&&i.tag!==0&&ih(),T=i.pendingLanes,T&1?i===fg?pd++:(pd=0,fg=i):pd=0,Kl(),null}function ih(){if(Bl!==null){var i=Pv(Jp),a=qs.transition,h=Xr;try{if(qs.transition=null,Xr=16>i?16:i,Bl===null)var _=!1;else{if(i=Bl,Bl=null,Jp=0,Dr&6)throw Error(it(331));var w=Dr;for(Dr|=4,zt=i.current;zt!==null;){var T=zt,S=T.child;if(zt.flags&16){var d=T.deletions;if(d!==null){for(var q=0;q<d.length;q++){var me=d[q];for(zt=me;zt!==null;){var Pe=zt;switch(Pe.tag){case 0:case 11:case 15:hd(8,Pe,T)}var le=Pe.child;if(le!==null)le.return=Pe,zt=le;else for(;zt!==null;){Pe=zt;var H=Pe.sibling,Ge=Pe.return;if(j1(Pe),Pe===me){zt=null;break}if(H!==null){H.return=Ge,zt=H;break}zt=Ge}}}var We=T.alternate;if(We!==null){var ke=We.child;if(ke!==null){We.child=null;do{var gt=ke.sibling;ke.sibling=null,ke=gt}while(ke!==null)}}zt=T}}if(T.subtreeFlags&2064&&S!==null)S.return=T,zt=S;else e:for(;zt!==null;){if(T=zt,T.flags&2048)switch(T.tag){case 0:case 11:case 15:hd(9,T,T.return)}var he=T.sibling;if(he!==null){he.return=T.return,zt=he;break e}zt=T.return}}var ne=i.current;for(zt=ne;zt!==null;){S=zt;var _e=S.child;if(S.subtreeFlags&2064&&_e!==null)_e.return=S,zt=_e;else e:for(S=ne;zt!==null;){if(d=zt,d.flags&2048)try{switch(d.tag){case 0:case 11:case 15:uf(9,d)}}catch(rt){Ei(d,d.return,rt)}if(d===S){zt=null;break e}var je=d.sibling;if(je!==null){je.return=d.return,zt=je;break e}zt=d.return}}if(Dr=w,Kl(),Ja&&typeof Ja.onPostCommitFiberRoot=="function")try{Ja.onPostCommitFiberRoot(tf,i)}catch{}_=!0}return _}finally{Xr=h,qs.transition=a}}return!1}function j0(i,a,h){a=ch(h,a),a=P1(i,a,1),i=Vl(i,a,1),a=Gn(),i!==null&&(Dd(i,1,a),ns(i,a))}function Ei(i,a,h){if(i.tag===3)j0(i,i,h);else for(;a!==null;){if(a.tag===3){j0(a,i,h);break}else if(a.tag===1){var _=a.stateNode;if(typeof a.type.getDerivedStateFromError=="function"||typeof _.componentDidCatch=="function"&&(Ul===null||!Ul.has(_))){i=ch(h,i),i=A1(a,i,1),a=Vl(a,i,1),i=Gn(),a!==null&&(Dd(a,1,i),ns(a,i));break}}a=a.return}}function uS(i,a,h){var _=i.pingCache;_!==null&&_.delete(a),a=Gn(),i.pingedLanes|=i.suspendedLanes&h,fn===i&&(Cn&h)===h&&(rn===4||rn===3&&(Cn&130023424)===Cn&&500>Fi()-a_?Uc(i,0):s_|=h),ns(i,a)}function J1(i,a){a===0&&(i.mode&1?(a=ap,ap<<=1,!(ap&130023424)&&(ap=4194304)):a=1);var h=Gn();i=Fo(i,a),i!==null&&(Dd(i,a,h),ns(i,h))}function hS(i){var a=i.memoizedState,h=0;a!==null&&(h=a.retryLane),J1(i,h)}function dS(i,a){var h=0;switch(i.tag){case 13:var _=i.stateNode,w=i.memoizedState;w!==null&&(h=w.retryLane);break;case 19:_=i.stateNode;break;default:throw Error(it(314))}_!==null&&_.delete(a),J1(i,h)}var Y1;Y1=function(i,a,h){if(i!==null)if(i.memoizedProps!==a.pendingProps||rs.current)ts=!0;else{if(!(i.lanes&h)&&!(a.flags&128))return ts=!1,Q2(i,a,h);ts=!!(i.flags&131072)}else ts=!1,fi&&a.flags&1048576&&r1(a,Vp,a.index);switch(a.lanes=0,a.tag){case 2:var _=a.type;Tp(i,a),i=a.pendingProps;var w=sh(a,Fn.current);rh(a,h),w=Qg(null,a,_,i,w,h);var T=e_();return a.flags|=1,typeof w=="object"&&w!==null&&typeof w.render=="function"&&w.$$typeof===void 0?(a.tag=1,a.memoizedState=null,a.updateQueue=null,is(_)?(T=!0,$p(a)):T=!1,a.memoizedState=w.state!==null&&w.state!==void 0?w.state:null,Wg(a),w.updater=cf,a.stateNode=w,w._reactInternals=a,rg(a,_,i,h),a=sg(null,a,_,!0,T,h)):(a.tag=0,fi&&T&&jg(a),qn(null,a,w,h),a=a.child),a;case 16:_=a.elementType;e:{switch(Tp(i,a),i=a.pendingProps,w=_._init,_=w(_._payload),a.type=_,w=a.tag=fS(_),i=fa(_,i),w){case 0:a=ng(null,a,_,i,h);break e;case 1:a=A0(null,a,_,i,h);break e;case 11:a=E0(null,a,_,i,h);break e;case 14:a=P0(null,a,_,fa(_.type,i),h);break e}throw Error(it(306,_,""))}return a;case 0:return _=a.type,w=a.pendingProps,w=a.elementType===_?w:fa(_,w),ng(i,a,_,w,h);case 1:return _=a.type,w=a.pendingProps,w=a.elementType===_?w:fa(_,w),A0(i,a,_,w,h);case 3:e:{if(R1(a),i===null)throw Error(it(387));_=a.pendingProps,T=a.memoizedState,w=T.element,l1(i,a),Gp(a,_,null,h);var S=a.memoizedState;if(_=S.element,T.isDehydrated)if(T={element:_,isDehydrated:!1,cache:S.cache,pendingSuspenseBoundaries:S.pendingSuspenseBoundaries,transitions:S.transitions},a.updateQueue.baseState=T,a.memoizedState=T,a.flags&256){w=ch(Error(it(423)),a),a=D0(i,a,_,h,w);break e}else if(_!==w){w=ch(Error(it(424)),a),a=D0(i,a,_,h,w);break e}else for(ws=jl(a.stateNode.containerInfo.firstChild),Ss=a,fi=!0,ga=null,h=a1(a,null,_,h),a.child=h;h;)h.flags=h.flags&-3|4096,h=h.sibling;else{if(ah(),_===w){a=Bo(i,a,h);break e}qn(i,a,_,h)}a=a.child}return a;case 5:return c1(a),i===null&&Qm(a),_=a.type,w=a.pendingProps,T=i!==null?i.memoizedProps:null,S=w.children,Wm(_,w)?S=null:T!==null&&Wm(_,T)&&(a.flags|=32),L1(i,a),qn(i,a,S,h),a.child;case 6:return i===null&&Qm(a),null;case 13:return F1(i,a,h);case 4:return Xg(a,a.stateNode.containerInfo),_=a.pendingProps,i===null?a.child=oh(a,null,_,h):qn(i,a,_,h),a.child;case 11:return _=a.type,w=a.pendingProps,w=a.elementType===_?w:fa(_,w),E0(i,a,_,w,h);case 7:return qn(i,a,a.pendingProps,h),a.child;case 8:return qn(i,a,a.pendingProps.children,h),a.child;case 12:return qn(i,a,a.pendingProps.children,h),a.child;case 10:e:{if(_=a.type._context,w=a.pendingProps,T=a.memoizedProps,S=w.value,ii(Up,_._currentValue),_._currentValue=S,T!==null)if(va(T.value,S)){if(T.children===w.children&&!rs.current){a=Bo(i,a,h);break e}}else for(T=a.child,T!==null&&(T.return=a);T!==null;){var d=T.dependencies;if(d!==null){S=T.child;for(var q=d.firstContext;q!==null;){if(q.context===_){if(T.tag===1){q=zo(-1,h&-h),q.tag=2;var me=T.updateQueue;if(me!==null){me=me.shared;var Pe=me.pending;Pe===null?q.next=q:(q.next=Pe.next,Pe.next=q),me.pending=q}}T.lanes|=h,q=T.alternate,q!==null&&(q.lanes|=h),eg(T.return,h,a),d.lanes|=h;break}q=q.next}}else if(T.tag===10)S=T.type===a.type?null:T.child;else if(T.tag===18){if(S=T.return,S===null)throw Error(it(341));S.lanes|=h,d=S.alternate,d!==null&&(d.lanes|=h),eg(S,h,a),S=T.sibling}else S=T.child;if(S!==null)S.return=T;else for(S=T;S!==null;){if(S===a){S=null;break}if(T=S.sibling,T!==null){T.return=S.return,S=T;break}S=S.return}T=S}qn(i,a,w.children,h),a=a.child}return a;case 9:return w=a.type,_=a.pendingProps.children,rh(a,h),w=Gs(w),_=_(w),a.flags|=1,qn(i,a,_,h),a.child;case 14:return _=a.type,w=fa(_,a.pendingProps),w=fa(_.type,w),P0(i,a,_,w,h);case 15:return D1(i,a,a.type,a.pendingProps,h);case 17:return _=a.type,w=a.pendingProps,w=a.elementType===_?w:fa(_,w),Tp(i,a),a.tag=1,is(_)?(i=!0,$p(a)):i=!1,rh(a,h),E1(a,_,w),rg(a,_,w,h),sg(null,a,_,!0,i,h);case 19:return B1(i,a,h);case 22:return z1(i,a,h)}throw Error(it(156,a.tag))};function Q1(i,a){return Tv(i,a)}function pS(i,a,h,_){this.tag=i,this.key=h,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=a,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=_,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Us(i,a,h,_){return new pS(i,a,h,_)}function u_(i){return i=i.prototype,!(!i||!i.isReactComponent)}function fS(i){if(typeof i=="function")return u_(i)?1:0;if(i!=null){if(i=i.$$typeof,i===Eg)return 11;if(i===Pg)return 14}return 2}function Gl(i,a){var h=i.alternate;return h===null?(h=Us(i.tag,a,i.key,i.mode),h.elementType=i.elementType,h.type=i.type,h.stateNode=i.stateNode,h.alternate=i,i.alternate=h):(h.pendingProps=a,h.type=i.type,h.flags=0,h.subtreeFlags=0,h.deletions=null),h.flags=i.flags&14680064,h.childLanes=i.childLanes,h.lanes=i.lanes,h.child=i.child,h.memoizedProps=i.memoizedProps,h.memoizedState=i.memoizedState,h.updateQueue=i.updateQueue,a=i.dependencies,h.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext},h.sibling=i.sibling,h.index=i.index,h.ref=i.ref,h}function Ep(i,a,h,_,w,T){var S=2;if(_=i,typeof i=="function")u_(i)&&(S=1);else if(typeof i=="string")S=5;else e:switch(i){case ju:return qc(h.children,w,T,a);case Ig:S=8,w|=8;break;case Tm:return i=Us(12,h,a,w|2),i.elementType=Tm,i.lanes=T,i;case Cm:return i=Us(13,h,a,w),i.elementType=Cm,i.lanes=T,i;case Im:return i=Us(19,h,a,w),i.elementType=Im,i.lanes=T,i;case cv:return df(h,w,T,a);default:if(typeof i=="object"&&i!==null)switch(i.$$typeof){case ov:S=10;break e;case lv:S=9;break e;case Eg:S=11;break e;case Pg:S=14;break e;case Dl:S=16,_=null;break e}throw Error(it(130,i==null?i:typeof i,""))}return a=Us(S,h,a,w),a.elementType=i,a.type=_,a.lanes=T,a}function qc(i,a,h,_){return i=Us(7,i,_,a),i.lanes=h,i}function df(i,a,h,_){return i=Us(22,i,_,a),i.elementType=cv,i.lanes=h,i.stateNode={isHidden:!1},i}function Sm(i,a,h){return i=Us(6,i,null,a),i.lanes=h,i}function Mm(i,a,h){return a=Us(4,i.children!==null?i.children:[],i.key,a),a.lanes=h,a.stateNode={containerInfo:i.containerInfo,pendingChildren:null,implementation:i.implementation},a}function mS(i,a,h,_,w){this.tag=a,this.containerInfo=i,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=nm(0),this.expirationTimes=nm(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=nm(0),this.identifierPrefix=_,this.onRecoverableError=w,this.mutableSourceEagerHydrationData=null}function h_(i,a,h,_,w,T,S,d,q){return i=new mS(i,a,h,d,q),a===1?(a=1,T===!0&&(a|=8)):a=0,T=Us(3,null,null,a),i.current=T,T.stateNode=i,T.memoizedState={element:_,isDehydrated:h,cache:null,transitions:null,pendingSuspenseBoundaries:null},Wg(T),i}function gS(i,a,h){var _=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:$u,key:_==null?null:""+_,children:i,containerInfo:a,implementation:h}}function ex(i){if(!i)return Hl;i=i._reactInternals;e:{if(Jc(i)!==i||i.tag!==1)throw Error(it(170));var a=i;do{switch(a.tag){case 3:a=a.stateNode.context;break e;case 1:if(is(a.type)){a=a.stateNode.__reactInternalMemoizedMergedChildContext;break e}}a=a.return}while(a!==null);throw Error(it(171))}if(i.tag===1){var h=i.type;if(is(h))return e1(i,h,a)}return a}function tx(i,a,h,_,w,T,S,d,q){return i=h_(h,_,!0,i,w,T,S,d,q),i.context=ex(null),h=i.current,_=Gn(),w=ql(h),T=zo(_,w),T.callback=a??null,Vl(h,T,w),i.current.lanes=w,Dd(i,w,_),ns(i,_),i}function pf(i,a,h,_){var w=a.current,T=Gn(),S=ql(w);return h=ex(h),a.context===null?a.context=h:a.pendingContext=h,a=zo(T,S),a.payload={element:i},_=_===void 0?null:_,_!==null&&(a.callback=_),i=Vl(w,a,S),i!==null&&(ya(i,w,S,T),Sp(i,w,S)),S}function Qp(i){if(i=i.current,!i.child)return null;switch(i.child.tag){case 5:return i.child.stateNode;default:return i.child.stateNode}}function V0(i,a){if(i=i.memoizedState,i!==null&&i.dehydrated!==null){var h=i.retryLane;i.retryLane=h!==0&&h<a?h:a}}function d_(i,a){V0(i,a),(i=i.alternate)&&V0(i,a)}function _S(){return null}var rx=typeof reportError=="function"?reportError:function(i){console.error(i)};function p_(i){this._internalRoot=i}ff.prototype.render=p_.prototype.render=function(i){var a=this._internalRoot;if(a===null)throw Error(it(409));pf(i,a,null,null)};ff.prototype.unmount=p_.prototype.unmount=function(){var i=this._internalRoot;if(i!==null){this._internalRoot=null;var a=i.containerInfo;Xc(function(){pf(null,i,null,null)}),a[Ro]=null}};function ff(i){this._internalRoot=i}ff.prototype.unstable_scheduleHydration=function(i){if(i){var a=zv();i={blockedOn:null,target:i,priority:a};for(var h=0;h<Ll.length&&a!==0&&a<Ll[h].priority;h++);Ll.splice(h,0,i),h===0&&Rv(i)}};function f_(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11)}function mf(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11&&(i.nodeType!==8||i.nodeValue!==" react-mount-point-unstable "))}function U0(){}function yS(i,a,h,_,w){if(w){if(typeof _=="function"){var T=_;_=function(){var me=Qp(S);T.call(me)}}var S=tx(a,_,i,0,null,!1,!1,"",U0);return i._reactRootContainer=S,i[Ro]=S.current,wd(i.nodeType===8?i.parentNode:i),Xc(),S}for(;w=i.lastChild;)i.removeChild(w);if(typeof _=="function"){var d=_;_=function(){var me=Qp(q);d.call(me)}}var q=h_(i,0,!1,null,null,!1,!1,"",U0);return i._reactRootContainer=q,i[Ro]=q.current,wd(i.nodeType===8?i.parentNode:i),Xc(function(){pf(a,q,h,_)}),q}function gf(i,a,h,_,w){var T=h._reactRootContainer;if(T){var S=T;if(typeof w=="function"){var d=w;w=function(){var q=Qp(S);d.call(q)}}pf(a,S,i,w)}else S=yS(h,a,i,w,_);return Qp(S)}Av=function(i){switch(i.tag){case 3:var a=i.stateNode;if(a.current.memoizedState.isDehydrated){var h=id(a.pendingLanes);h!==0&&(zg(a,h|1),ns(a,Fi()),!(Dr&6)&&(uh=Fi()+500,Kl()))}break;case 13:Xc(function(){var _=Fo(i,1);if(_!==null){var w=Gn();ya(_,i,1,w)}}),d_(i,1)}};Lg=function(i){if(i.tag===13){var a=Fo(i,134217728);if(a!==null){var h=Gn();ya(a,i,134217728,h)}d_(i,134217728)}};Dv=function(i){if(i.tag===13){var a=ql(i),h=Fo(i,a);if(h!==null){var _=Gn();ya(h,i,a,_)}d_(i,a)}};zv=function(){return Xr};Lv=function(i,a){var h=Xr;try{return Xr=i,a()}finally{Xr=h}};Om=function(i,a,h){switch(a){case"input":if(Am(i,h),a=h.name,h.type==="radio"&&a!=null){for(h=i;h.parentNode;)h=h.parentNode;for(h=h.querySelectorAll("input[name="+JSON.stringify(""+a)+'][type="radio"]'),a=0;a<h.length;a++){var _=h[a];if(_!==i&&_.form===i.form){var w=af(_);if(!w)throw Error(it(90));hv(_),Am(_,w)}}}break;case"textarea":pv(i,h);break;case"select":a=h.value,a!=null&&Yu(i,!!h.multiple,a,!1)}};xv=o_;bv=Xc;var vS={usingClientEntryPoint:!1,Events:[Ld,Gu,af,yv,vv,o_]},ed={findFiberByHostInstance:$c,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},xS={bundleType:ed.bundleType,version:ed.version,rendererPackageName:ed.rendererPackageName,rendererConfig:ed.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Oo.ReactCurrentDispatcher,findHostInstanceByFiber:function(i){return i=Mv(i),i===null?null:i.stateNode},findFiberByHostInstance:ed.findFiberByHostInstance||_S,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var _p=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!_p.isDisabled&&_p.supportsFiber)try{tf=_p.inject(xS),Ja=_p}catch{}}ks.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=vS;ks.createPortal=function(i,a){var h=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!f_(a))throw Error(it(200));return gS(i,a,null,h)};ks.createRoot=function(i,a){if(!f_(i))throw Error(it(299));var h=!1,_="",w=rx;return a!=null&&(a.unstable_strictMode===!0&&(h=!0),a.identifierPrefix!==void 0&&(_=a.identifierPrefix),a.onRecoverableError!==void 0&&(w=a.onRecoverableError)),a=h_(i,1,!1,null,null,h,!1,_,w),i[Ro]=a.current,wd(i.nodeType===8?i.parentNode:i),new p_(a)};ks.findDOMNode=function(i){if(i==null)return null;if(i.nodeType===1)return i;var a=i._reactInternals;if(a===void 0)throw typeof i.render=="function"?Error(it(188)):(i=Object.keys(i).join(","),Error(it(268,i)));return i=Mv(a),i=i===null?null:i.stateNode,i};ks.flushSync=function(i){return Xc(i)};ks.hydrate=function(i,a,h){if(!mf(a))throw Error(it(200));return gf(null,i,a,!0,h)};ks.hydrateRoot=function(i,a,h){if(!f_(i))throw Error(it(405));var _=h!=null&&h.hydratedSources||null,w=!1,T="",S=rx;if(h!=null&&(h.unstable_strictMode===!0&&(w=!0),h.identifierPrefix!==void 0&&(T=h.identifierPrefix),h.onRecoverableError!==void 0&&(S=h.onRecoverableError)),a=tx(a,null,i,1,h??null,w,!1,T,S),i[Ro]=a.current,wd(i),_)for(i=0;i<_.length;i++)h=_[i],w=h._getVersion,w=w(h._source),a.mutableSourceEagerHydrationData==null?a.mutableSourceEagerHydrationData=[h,w]:a.mutableSourceEagerHydrationData.push(h,w);return new ff(a)};ks.render=function(i,a,h){if(!mf(a))throw Error(it(200));return gf(null,i,a,!1,h)};ks.unmountComponentAtNode=function(i){if(!mf(i))throw Error(it(40));return i._reactRootContainer?(Xc(function(){gf(null,null,i,!1,function(){i._reactRootContainer=null,i[Ro]=null})}),!0):!1};ks.unstable_batchedUpdates=o_;ks.unstable_renderSubtreeIntoContainer=function(i,a,h,_){if(!mf(h))throw Error(it(200));if(i==null||i._reactInternals===void 0)throw Error(it(38));return gf(i,a,h,!1,_)};ks.version="18.3.1-next-f1338f8080-20240426";function ix(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(ix)}catch(i){console.error(i)}}ix(),iv.exports=ks;var bS=iv.exports,nx,q0=bS;nx=q0.createRoot,q0.hydrateRoot;const wS="/assets/Vector-mo6qIbH5.svg",SS=()=>Ee.jsx("div",{className:"flex h-[60px] min-w-[580px] items-center justify-start text-nowrap bg-headerBackgroundWhite",children:Ee.jsxs("div",{className:"ml-[20px] inline-flex items-center",children:[Ee.jsx("img",{src:wS,alt:"logo",width:"45",height:"40",className:"min-h-[45px] min-w-[50px]"}),Ee.jsx("h1",{className:"ml-4 min-w-[500px] font-IBMPlexSerif text-2xl font-bold ",children:"Test Demo"})]})}),sx="data:image/svg+xml,%3csvg%20width='15'%20height='15'%20viewBox='0%200%2015%2015'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M7.5%209.09696L1.91065%2014.6863C1.70152%2014.8954%201.43536%2015%201.11217%2015C0.788973%2015%200.522813%2014.8954%200.313688%2014.6863C0.104562%2014.4772%200%2014.211%200%2013.8878C0%2013.5646%200.104562%2013.2985%200.313688%2013.0894L5.90304%207.5L0.313688%201.91065C0.104562%201.70152%200%201.43536%200%201.11217C0%200.788973%200.104562%200.522813%200.313688%200.313688C0.522813%200.104562%200.788973%200%201.11217%200C1.43536%200%201.70152%200.104562%201.91065%200.313688L7.5%205.90304L13.0894%200.313688C13.2985%200.104562%2013.5646%200%2013.8878%200C14.211%200%2014.4772%200.104562%2014.6863%200.313688C14.8954%200.522813%2015%200.788973%2015%201.11217C15%201.43536%2014.8954%201.70152%2014.6863%201.91065L9.09696%207.5L14.6863%2013.0894C14.8954%2013.2985%2015%2013.5646%2015%2013.8878C15%2014.211%2014.8954%2014.4772%2014.6863%2014.6863C14.4772%2014.8954%2014.211%2015%2013.8878%2015C13.5646%2015%2013.2985%2014.8954%2013.0894%2014.6863L7.5%209.09696Z'%20fill='black'/%3e%3c/svg%3e",MS=i=>Ee.jsx("button",{className:"absolute right-3 top-3 z-10",onClick:()=>i.setOpenLeftSidebar(!1),"aria-label":"Close left sidebar",children:Ee.jsx("img",{src:sx,className:"h-3 w-3",alt:"Close"})}),kS="data:image/svg+xml,%3csvg%20width='22'%20height='22'%20viewBox='0%200%2022%2022'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3crect%20width='22'%20height='22'%20fill='url(%23pattern0_493_19897)'/%3e%3cdefs%3e%3cpattern%20id='pattern0_493_19897'%20patternContentUnits='objectBoundingBox'%20width='1'%20height='1'%3e%3cuse%20xlink:href='%23image0_493_19897'%20transform='scale(0.0104167)'/%3e%3c/pattern%3e%3cimage%20id='image0_493_19897'%20width='96'%20height='96'%20xlink:href='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAABgCAYAAADimHc4AAAACXBIWXMAAAsTAAALEwEAmpwYAAACyElEQVR4nO2dvYoUURBGjyiGomiiwQ7GvoL4EJoYbCK+gPgCPoSZmBmsS+NPKmJqYiooiIKpYCaKIpQIuzAMM9v/XXXrfh9U2DScc6tqmqFpUBRFURRFURRFGZ8bwGPgM/ALMMf6C9yuReoF4IUzcKtVwiXgYwDYVqOEU8CbAJCtVgm3AsC1miW8DgDWekrYJ0nOAn8CQLWj+r+HDmrqhFUA6LZW74HTwJNaOuFaQAHUJCGqgGokRBZQhYToAtJLKEFAagmlCEgroSQBKSWUJiCdhBIFpJJQqoA0EkoWkEJC6QKKl5BBQNESsggoVkImAUVKyCagOAkZBfSRMNX9BiergK4SJIB5gbRJkADmB3KSBAkgz8hLsQNMAvyhmDrAH4wtVBpBSID7KTR1gD8I0wjyh2EOpR2ABLifQlMH+IMwjSB/GOZQ2gFIgPsptJ512PE1JnUA08NvgDM9/vHSCGJ6+MeZQoJ2AMPgTyVBAhgOfwoJ6QW8BL6OXLgnwV+X8FwC2Hpy94AvE8z8tvedh9wjbQc0G/D6SlgCfloBzQ54XSUsBT+lgKYFXpuEJeGnE9B0hLdLwtLwUwloesDbJsEDfhoBTU/4mxK84KcQcDgQ/nGu9Lj+6shninQCmpHw+2Tqk1+8gAzwrWQB+zOMmKXGTgoBXV7vWQ1Ystuunwt+0QLaJKxG/Mzcdr0E9JCwGvmgtRT84jvAtkhog9cmYUn4aQTYkYT7HRfmrmeHuRduagHWszY7YemTX70AW5PgBb/qDrCJ/rKUAHwFSgD+EDWCKLeq3wEmAf6n0NQB/iCs1hG0FwCCOdbbCJ8w+R0AhDnVUwLkVQAQ5lR3CJCbAUCYQ30DzhHkQ26lfcrKJqi7BMpF4EMAKLZQPSRgzgPPAsCxGesHcI/guQ48Aj4BPwNAs5H1HXgHPAAue8NVFEVRFEVRFIXi8w/pnUnzD27c5QAAAABJRU5ErkJggg=='/%3e%3c/defs%3e%3c/svg%3e",TS=({percentage:i})=>{const h=2*Math.PI*60,_=h-h*i/100;let w="text-red-500";return i==0?w="text-gray-300":i>=75?w="text-[#32AC03]":i>=25?w="text-[#FAE107]":i<25&&(w="text-[#F00101]"),Ee.jsxs("div",{className:"relative mb-4 h-40 w-40",children:[Ee.jsxs("svg",{className:"absolute inset-0 h-full w-full -rotate-90 transform",children:[Ee.jsx("circle",{className:"text-gray-300",strokeWidth:"25",stroke:"currentColor",fill:"transparent",r:60,cx:"50%",cy:"50%"}),Ee.jsx("circle",{className:`duration-1 transition-colors ${w}`,strokeWidth:"25",strokeLinecap:"butt",stroke:"currentColor",fill:"transparent",r:60,cx:"50%",cy:"50%",style:{strokeDasharray:h,strokeDashoffset:_,transition:"stroke-dashoffset 1s ease-in-out"}})]}),Ee.jsx("div",{className:`flex h-full w-full items-center justify-center text-2xl font-semibold transition-colors duration-500 ${w}`,children:i!==0?`${i.toFixed(0)}%`:"--"})]})};let Nu=[{id:"water",value:.91,color:"#A7344E",name:"Domain 1",bgColorTWClass:"bg-[#A7344E]"},{id:"social",value:.72,color:"#B94E31",name:"Domain 2",bgColorTWClass:"bg-[#B94E31]"},{id:"air",value:.9,color:"#E16727",name:"Domain 3",bgColorTWClass:"bg-[#E16727]"},{id:"economy",value:.64,color:"#D78935",name:"Domain 4",bgColorTWClass:"bg-[#D78935]"},{id:"ecosystems",value:.8,color:"#D5A227",name:"Domain 5",bgColorTWClass:"bg-[#D5A227]"},{id:"culture",value:.05,color:"#DAC32F",name:"Domain 6",bgColorTWClass:"bg-[#DAC32F]"},{id:"biodiversity",value:.72,color:"#A9B646",name:"Domain 7",bgColorTWClass:"bg-[#A9B646]"},{id:"carbon",value:.84,color:"#2FBD89",name:"Domain 8",bgColorTWClass:"bg-[#2FBD89]"},{id:"infrastructure",value:1,color:"#4EA09F",name:"Domain 9",bgColorTWClass:"bg-[#4EA09F]"}];const CS=({domainScores:i})=>{const a=Jt.useRef(null),h=Jt.useRef(null),[_,w]=Jt.useState("--"),[T,S]=Jt.useState("currentColor"),[d,q]=Jt.useState(null);return Object.keys(i).length>0&&(Nu=Nu.map(le=>{const H=i[le.id];return{...le,value:H}})),Jt.useEffect(()=>{const Pe=a.current;if(!Pe)return;const le=Nu.length,H=2*Math.PI/le,Ge=Math.PI/2;return Nu.forEach((We,ke)=>{const gt=ke*H-Ge,he=gt+H,ne=40,_e=ne+We.value*125,je=Math.cos(gt)*ne,rt=Math.sin(gt)*ne,te=Math.cos(he)*ne,Ae=Math.sin(he)*ne,ee=Math.cos(he)*_e,de=Math.sin(he)*_e,De=Math.cos(gt)*_e,qe=Math.sin(gt)*_e,yt=he-gt<=Math.PI?"0":"1",bt=[`M ${je} ${rt}`,`A ${ne} ${ne} 0 ${yt} 1 ${te} ${Ae}`,`L ${ee} ${de}`,`A ${_e} ${_e} 0 ${yt} 0 ${De} ${qe}`,"Z"].join(" "),Et=document.createElementNS("http://www.w3.org/2000/svg","path");Et.setAttribute("d",bt),Et.setAttribute("fill",We.color),Et.setAttribute("class","aster__solid-arc transition-colors duration-100 ease-out"),Et.addEventListener("mouseover",()=>{Pe.querySelectorAll("path.aster__solid-arc").forEach(Ye=>{Ye!==Et&&Ye.setAttribute("fill","#d3d3d3")}),w((We.value*100).toFixed(0)),S(We.color),q(We.name)}),Et.addEventListener("mouseout",()=>{Pe.querySelectorAll("path.aster__solid-arc").forEach((Ye,Fe)=>{Ye.setAttribute("fill",Nu[Fe].color)}),w("--"),S("currentColor"),q(null)}),Pe.appendChild(Et);const or=ne+125,hr=[`M ${Math.cos(gt)*ne} ${Math.sin(gt)*ne}`,`A ${ne} ${ne} 0 ${yt} 1 ${Math.cos(he)*ne} ${Math.sin(he)*ne}`,`L ${Math.cos(he)*or} ${Math.sin(he)*or}`,`A ${or} ${or} 0 ${yt} 0 ${Math.cos(gt)*or} ${Math.sin(gt)*or}`,"Z"].join(" "),ht=document.createElementNS("http://www.w3.org/2000/svg","path");ht.setAttribute("d",hr),ht.setAttribute("fill","none"),ht.setAttribute("stroke","#ededf1"),ht.setAttribute("stroke-width","1"),Pe.appendChild(ht)}),()=>{Pe.querySelectorAll("path.aster__solid-arc").forEach(We=>{We.remove()})}},[i]),Ee.jsxs("div",{children:[Ee.jsx("div",{className:"h-[11rem] w-full",children:Ee.jsx("svg",{className:"aster__plot flex flex-shrink flex-row justify-start",preserveAspectRatio:"xMidYMid",viewBox:"0 0 400 400",children:Ee.jsx("g",{id:"chart",transform:"translate(165,170)",ref:a,children:Ee.jsx("text",{className:"text-3xl font-bold text-leftSidebarRightBorder",dy:".35em",textAnchor:"middle",fill:T,children:_})})})}),Ee.jsxs("div",{className:"mb-2 ml-1",children:[Ee.jsx("h1",{className:"pb-2 font-BeVietnamPro text-sm font-bold text-leftSidebarOverallResilience",children:"Legend"}),Ee.jsx("div",{className:"flex max-w-[194px] flex-wrap items-center justify-between",ref:h,children:Nu.map((Pe,le)=>Ee.jsxs("div",{className:`mb-1 inline-flex min-w-[50%] items-center ${d&&d!==Pe.name?"text-gray-400 opacity-50":"text-black opacity-100"}`,children:[Ee.jsx("div",{className:`mr-1 h-[14px] w-[14px] rounded-sm transition-colors duration-100 ease-out ${d&&d!==Pe.name?"bg-gray-400":Pe.bgColorTWClass}`}),Ee.jsx("p",{className:"font-BeVietnamPro text-xs",children:Pe.name})]},le))})]})]})};function IS({overallResilienceScore:i,domainScores:a}){let h;return i&&i<1?h=i*100:i?h=i:h=0,Ee.jsxs("div",{id:"left-sidebar-body",className:"flex w-full flex-1 flex-col px-leftSidebarXAxis",children:[Ee.jsx("h3",{className:"pb-2 pt-3 font-BeVietnamPro text-xs text-leftSidebarNotifier",children:"The following information pertains to the selected region"}),Ee.jsx("h1",{className:"font-BeVietnamePro text-sm font-bold text-leftSidebarOverallResilience",children:"OVERALL SCORE"}),Ee.jsx(TS,{percentage:h}),Ee.jsx("h1",{className:"font-BeVietnamePro pb-2 text-sm font-bold text-leftSidebarOverallResilience",children:"INDIVIDUAL DOMAIN SCORES"}),Ee.jsx("div",{className:"mb-1 w-[200px]",children:Ee.jsx(CS,{domainScores:a})}),Ee.jsxs("button",{className:"mt-2 flex w-full flex-row items-center rounded-md border-[1px] border-black p-1",children:[Ee.jsx("img",{src:kS,alt:"Graph Report",className:"ml-2 mr-2 h-5 w-5"}),Ee.jsx("h1",{className:"font-BeVietnamPro font-bold",children:"VIEW REPORT"})]})]})}const ES=({onClick:i})=>Ee.jsxs("button",{onClick:i,className:"absolute left-1 top-1 z-30 flex h-10 w-10 flex-col items-center justify-center rounded border border-gray-400 bg-white p-2",children:[Ee.jsx("div",{className:"mb-1 h-0.5 w-6 bg-gray-800"}),Ee.jsx("div",{className:"mb-1 h-0.5 w-6 bg-gray-800"}),Ee.jsx("div",{className:"h-0.5 w-6 bg-gray-800"})]}),ax={Alabama:"AL",Alaska:"AK",Arizona:"AZ",Arkansas:"AR",California:"CA",Colorado:"CO",Connecticut:"CT",Delaware:"DE",Florida:"FL",Georgia:"GA",Hawaii:"HI",Idaho:"ID",Illinois:"IL",Indiana:"IN",Iowa:"IA",Kansas:"KS",Kentucky:"KY",Louisiana:"LA",Maine:"ME",Maryland:"MD",Massachusetts:"MA",Michigan:"MI",Minnesota:"MN",Mississippi:"MS",Missouri:"MO",Montana:"MT",Nebraska:"NE",Nevada:"NV","New Hampshire":"NH","New Jersey":"NJ","New Mexico":"NM","New York":"NY","North Carolina":"NC","North Dakota":"ND",Ohio:"OH",Oklahoma:"OK",Oregon:"OR",Pennsylvania:"PA","Rhode Island":"RI","South Carolina":"SC","South Dakota":"SD",Tennessee:"TN",Texas:"TX",Utah:"UT",Vermont:"VT",Virginia:"VA",Washington:"WA","West Virginia":"WV",Wisconsin:"WI",Wyoming:"WY","":""};function PS({selectedCountyName:i,selectedStateName:a,selectedCensusTract:h}){return Ee.jsx("div",{id:"left-sidebar-header",className:"relative flex h-[89px] w-full items-center border-b-[1px] border-solid border-leftSidebarHeaderBottomBorder bg-leftSidebarHeaderBackground pl-[18px]",children:Ee.jsxs("div",{children:[Ee.jsx("h1",{className:"font-BeVietnamPro text-sm font-bold text-leftSidebarHeaderLabelTextColor",children:"SELECTED REGION"}),i===""&&a===""?Ee.jsx("h1",{className:"min-h-[49px] max-w-[80%] font-BeVietnamPro text-base font-bold text-leftSidebarHeaderLabelTextColor",children:"Click on a region to view data"}):Ee.jsxs("h1",{className:"font-BeVietnamPro text-base font-bold ",children:[i,","," ",ax[a]," ",Ee.jsx("br",{}),"Tract ",h]})]})})}const AS=({selectedCountyName:i,selectedStateName:a,selectedCensusTract:h,selectedMetricValue:_})=>{var Ge;const[w,T]=Jt.useState(!0),[S,d]=Jt.useState(!1),[q,me]=Jt.useState({});Jt.useEffect(()=>{w||d(!0)},[w]),Jt.useEffect(()=>{(async()=>{try{const he=(await(await fetch("https://major-sculpin.nceas.ucsb.edu/api/summary_info")).text()).trim().split(`
`),ne=he[0].split(","),_e=he.slice(1).reduce((je,rt)=>{const te=rt.split(","),Ae=te[0],ee=ne.reduce((de,De,qe)=>(De!=="geoid"&&(de[De]=parseFloat(te[qe])),de),{});return je[Ae]=ee,je},{});me(_e)}catch(ke){console.error("Error fetching summary info data:",ke)}})()},[]);const Pe=()=>{w||d(!1)},le=((Ge=q[h])==null?void 0:Ge.overall_resilience)||null,H=q[h]||{};return Ee.jsxs("div",{className:"",children:[Ee.jsxs("aside",{id:"left-sidebar",className:`absolute z-10 h-[calc(100vh-140px)] w-[233px] border-r-[1px] border-solid border-leftSidebarRightBorder bg-white transition-transform duration-300 ease-in-out ${w?"translate-x-0":"-translate-x-full"}`,onTransitionEnd:Pe,children:[Ee.jsx(MS,{setOpenLeftSidebar:T}),Ee.jsx(PS,{selectedCountyName:i,selectedStateName:a,selectedCensusTract:h}),Ee.jsx(IS,{overallResilienceScore:le,domainScores:H})]}),!w&&!S&&Ee.jsx("div",{id:"hamburger-toggle-for-left-sidebar",className:"relative flex min-w-10 max-w-10",children:Ee.jsx(ES,{onClick:()=>T(!0)})})]})};var ox={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.3.2/LICENSE.txt
 */(function(i,a){(function(h,_){i.exports=_()})(vg,function(){var h={},_={};function w(S,d,q){if(_[S]=q,S==="index"){var me="var sharedModule = {}; ("+_.shared+")(sharedModule); ("+_.worker+")(sharedModule);",Pe={};return _.shared(Pe),_.index(h,Pe),typeof window<"u"&&h.setWorkerUrl(window.URL.createObjectURL(new Blob([me],{type:"text/javascript"}))),h}}w("shared",["exports"],function(S){function d(r,e,n,o){return new(n||(n=Promise))(function(c,f){function g(k){try{x(o.next(k))}catch(E){f(E)}}function y(k){try{x(o.throw(k))}catch(E){f(E)}}function x(k){var E;k.done?c(k.value):(E=k.value,E instanceof n?E:new n(function(P){P(E)})).then(g,y)}x((o=o.apply(r,e||[])).next())})}function q(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}typeof SuppressedError=="function"&&SuppressedError;var me=Pe;function Pe(r,e){this.x=r,this.y=e}Pe.prototype={clone:function(){return new Pe(this.x,this.y)},add:function(r){return this.clone()._add(r)},sub:function(r){return this.clone()._sub(r)},multByPoint:function(r){return this.clone()._multByPoint(r)},divByPoint:function(r){return this.clone()._divByPoint(r)},mult:function(r){return this.clone()._mult(r)},div:function(r){return this.clone()._div(r)},rotate:function(r){return this.clone()._rotate(r)},rotateAround:function(r,e){return this.clone()._rotateAround(r,e)},matMult:function(r){return this.clone()._matMult(r)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(r){return this.x===r.x&&this.y===r.y},dist:function(r){return Math.sqrt(this.distSqr(r))},distSqr:function(r){var e=r.x-this.x,n=r.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(r){return Math.atan2(this.y-r.y,this.x-r.x)},angleWith:function(r){return this.angleWithSep(r.x,r.y)},angleWithSep:function(r,e){return Math.atan2(this.x*e-this.y*r,this.x*r+this.y*e)},_matMult:function(r){var e=r[2]*this.x+r[3]*this.y;return this.x=r[0]*this.x+r[1]*this.y,this.y=e,this},_add:function(r){return this.x+=r.x,this.y+=r.y,this},_sub:function(r){return this.x-=r.x,this.y-=r.y,this},_mult:function(r){return this.x*=r,this.y*=r,this},_div:function(r){return this.x/=r,this.y/=r,this},_multByPoint:function(r){return this.x*=r.x,this.y*=r.y,this},_divByPoint:function(r){return this.x/=r.x,this.y/=r.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var r=this.y;return this.y=this.x,this.x=-r,this},_rotate:function(r){var e=Math.cos(r),n=Math.sin(r),o=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=o,this},_rotateAround:function(r,e){var n=Math.cos(r),o=Math.sin(r),c=e.y+o*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-o*(this.y-e.y),this.y=c,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Pe.convert=function(r){return r instanceof Pe?r:Array.isArray(r)?new Pe(r[0],r[1]):r};var le=q(me),H=Ge;function Ge(r,e,n,o){this.cx=3*r,this.bx=3*(n-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(o-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=e,this.p2x=n,this.p2y=o}Ge.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,e){if(e===void 0&&(e=1e-6),r<0)return 0;if(r>1)return 1;for(var n=r,o=0;o<8;o++){var c=this.sampleCurveX(n)-r;if(Math.abs(c)<e)return n;var f=this.sampleCurveDerivativeX(n);if(Math.abs(f)<1e-6)break;n-=c/f}var g=0,y=1;for(n=r,o=0;o<20&&(c=this.sampleCurveX(n),!(Math.abs(c-r)<e));o++)r>c?g=n:y=n,n=.5*(y-g)+g;return n},solve:function(r,e){return this.sampleCurveY(this.solveCurveX(r,e))}};var We=q(H);let ke,gt;function he(){return ke==null&&(ke=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),ke}function ne(){if(gt==null&&(gt=!1,he())){const e=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(e){for(let o=0;o<5*5;o++){const c=4*o;e.fillStyle=`rgb(${c},${c+1},${c+2})`,e.fillRect(o%5,Math.floor(o/5),1,1)}const n=e.getImageData(0,0,5,5).data;for(let o=0;o<5*5*4;o++)if(o%4!=3&&n[o]!==o){gt=!0;break}}}return gt||!1}function _e(r,e,n,o){const c=new We(r,e,n,o);return f=>c.solve(f)}const je=_e(.25,.1,.25,1);function rt(r,e,n){return Math.min(n,Math.max(e,r))}function te(r,e,n){const o=n-e,c=((r-e)%o+o)%o+e;return c===e?n:c}function Ae(r,...e){for(const n of e)for(const o in n)r[o]=n[o];return r}let ee=1;function de(r,e,n){const o={};for(const c in r)o[c]=e.call(this,r[c],c,r);return o}function De(r,e,n){const o={};for(const c in r)e.call(this,r[c],c,r)&&(o[c]=r[c]);return o}function qe(r){return Array.isArray(r)?r.map(qe):typeof r=="object"&&r?de(r,qe):r}const yt={};function bt(r){yt[r]||(typeof console<"u"&&console.warn(r),yt[r]=!0)}function Et(r,e,n){return(n.y-r.y)*(e.x-r.x)>(e.y-r.y)*(n.x-r.x)}function or(r){return typeof WorkerGlobalScope<"u"&&r!==void 0&&r instanceof WorkerGlobalScope}let hr=null;function ht(r){return typeof ImageBitmap<"u"&&r instanceof ImageBitmap}const Ye="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Fe(r,e,n,o,c){return d(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const f=new VideoFrame(r,{timestamp:0});try{const g=f==null?void 0:f.format;if(!g||!g.startsWith("BGR")&&!g.startsWith("RGB"))throw new Error(`Unrecognized format ${g}`);const y=g.startsWith("BGR"),x=new Uint8ClampedArray(o*c*4);if(yield f.copyTo(x,function(k,E,P,L,F){const $=4*Math.max(-E,0),U=(Math.max(0,P)-P)*L*4+$,W=4*L,re=Math.max(0,E),we=Math.max(0,P);return{rect:{x:re,y:we,width:Math.min(k.width,E+L)-re,height:Math.min(k.height,P+F)-we},layout:[{offset:U,stride:W}]}}(r,e,n,o,c)),y)for(let k=0;k<x.length;k+=4){const E=x[k];x[k]=x[k+2],x[k+2]=E}return x}finally{f.close()}})}let dt,St;const Ze="AbortError";function Ot(){return new Error(Ze)}const Yt={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Ht(r){return Yt.REGISTERED_PROTOCOLS[r.substring(0,r.indexOf("://"))]}const nr="global-dispatcher";class Qt extends Error{constructor(e,n,o,c){super(`AJAXError: ${n} (${e}): ${o}`),this.status=e,this.statusText=n,this.url=o,this.body=c}}const Ir=()=>or(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Lt=function(r,e){if(/:\/\//.test(r.url)&&!/^https?:|^file:/.test(r.url)){const o=Ht(r.url);if(o)return o(r,e);if(or(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:r,targetMapId:nr},e)}if(!(/^file:/.test(n=r.url)||/^file:/.test(Ir())&&!/^\w+:/.test(n))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(o,c){return d(this,void 0,void 0,function*(){const f=new Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,cache:o.cache,referrer:Ir(),signal:c.signal});o.type==="json"&&f.headers.set("Accept","application/json");const g=yield fetch(f);if(!g.ok){const k=yield g.blob();throw new Qt(g.status,g.statusText,o.url,k)}let y;y=o.type==="arrayBuffer"||o.type==="image"?g.arrayBuffer():o.type==="json"?g.json():g.text();const x=yield y;if(c.signal.aborted)throw Ot();return{data:x,cacheControl:g.headers.get("Cache-Control"),expires:g.headers.get("Expires")}})}(r,e);if(or(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:r,mustQueue:!0,targetMapId:nr},e)}var n;return function(o,c){return new Promise((f,g)=>{const y=new XMLHttpRequest;y.open(o.method||"GET",o.url,!0),o.type!=="arrayBuffer"&&o.type!=="image"||(y.responseType="arraybuffer");for(const x in o.headers)y.setRequestHeader(x,o.headers[x]);o.type==="json"&&(y.responseType="text",y.setRequestHeader("Accept","application/json")),y.withCredentials=o.credentials==="include",y.onerror=()=>{g(new Error(y.statusText))},y.onload=()=>{if(!c.signal.aborted)if((y.status>=200&&y.status<300||y.status===0)&&y.response!==null){let x=y.response;if(o.type==="json")try{x=JSON.parse(y.response)}catch(k){return void g(k)}f({data:x,cacheControl:y.getResponseHeader("Cache-Control"),expires:y.getResponseHeader("Expires")})}else{const x=new Blob([y.response],{type:y.getResponseHeader("Content-Type")});g(new Qt(y.status,y.statusText,o.url,x))}},c.signal.addEventListener("abort",()=>{y.abort(),g(Ot())}),y.send(o.body)})}(r,e)};function lr(r){if(!r||r.indexOf("://")<=0||r.indexOf("data:image/")===0||r.indexOf("blob:")===0)return!0;const e=new URL(r),n=window.location;return e.protocol===n.protocol&&e.host===n.host}function Er(r,e,n){n[r]&&n[r].indexOf(e)!==-1||(n[r]=n[r]||[],n[r].push(e))}function _r(r,e,n){if(n&&n[r]){const o=n[r].indexOf(e);o!==-1&&n[r].splice(o,1)}}class dr{constructor(e,n={}){Ae(this,n),this.type=e}}class sr extends dr{constructor(e,n={}){super("error",Ae({error:e},n))}}class zr{on(e,n){return this._listeners=this._listeners||{},Er(e,n,this._listeners),this}off(e,n){return _r(e,n,this._listeners),_r(e,n,this._oneTimeListeners),this}once(e,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},Er(e,n,this._oneTimeListeners),this):new Promise(o=>this.once(e,o))}fire(e,n){typeof e=="string"&&(e=new dr(e,n||{}));const o=e.type;if(this.listens(o)){e.target=this;const c=this._listeners&&this._listeners[o]?this._listeners[o].slice():[];for(const y of c)y.call(this,e);const f=this._oneTimeListeners&&this._oneTimeListeners[o]?this._oneTimeListeners[o].slice():[];for(const y of f)_r(o,y,this._oneTimeListeners),y.call(this,e);const g=this._eventedParent;g&&(Ae(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),g.fire(e))}else e instanceof sr&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,n){return this._eventedParent=e,this._eventedParentData=n,this}}var Ce={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const ai=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function oi(r,e){const n={};for(const o in r)o!=="ref"&&(n[o]=r[o]);return ai.forEach(o=>{o in e&&(n[o]=e[o])}),n}function er(r,e){if(Array.isArray(r)){if(!Array.isArray(e)||r.length!==e.length)return!1;for(let n=0;n<r.length;n++)if(!er(r[n],e[n]))return!1;return!0}if(typeof r=="object"&&r!==null&&e!==null){if(typeof e!="object"||Object.keys(r).length!==Object.keys(e).length)return!1;for(const n in r)if(!er(r[n],e[n]))return!1;return!0}return r===e}function fr(r,e){r.push(e)}function Qr(r,e,n){fr(n,{command:"addSource",args:[r,e[r]]})}function Tr(r,e,n){fr(e,{command:"removeSource",args:[r]}),n[r]=!0}function Rr(r,e,n,o){Tr(r,n,o),Qr(r,e,n)}function Hi(r,e,n){let o;for(o in r[n])if(Object.prototype.hasOwnProperty.call(r[n],o)&&o!=="data"&&!er(r[n][o],e[n][o]))return!1;for(o in e[n])if(Object.prototype.hasOwnProperty.call(e[n],o)&&o!=="data"&&!er(r[n][o],e[n][o]))return!1;return!0}function cr(r,e,n,o,c,f){r=r||{},e=e||{};for(const g in r)Object.prototype.hasOwnProperty.call(r,g)&&(er(r[g],e[g])||n.push({command:f,args:[o,g,e[g],c]}));for(const g in e)Object.prototype.hasOwnProperty.call(e,g)&&!Object.prototype.hasOwnProperty.call(r,g)&&(er(r[g],e[g])||n.push({command:f,args:[o,g,e[g],c]}))}function nn(r){return r.id}function Wi(r,e){return r[e.id]=e,r}class Je{constructor(e,n,o,c){this.message=(e?`${e}: `:"")+o,c&&(this.identifier=c),n!=null&&n.__line__&&(this.line=n.__line__)}}function Kr(r,...e){for(const n of e)for(const o in n)r[o]=n[o];return r}class Jr extends Error{constructor(e,n){super(n),this.message=n,this.key=e}}class Xi{constructor(e,n=[]){this.parent=e,this.bindings={};for(const[o,c]of n)this.bindings[o]=c}concat(e){return new Xi(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const li={kind:"null"},Xe={kind:"number"},Rt={kind:"string"},Nt={kind:"boolean"},mi={kind:"color"},Bi={kind:"object"},Ut={kind:"value"},ss={kind:"collator"},as={kind:"formatted"},Si={kind:"padding"},X={kind:"resolvedImage"},R={kind:"variableAnchorOffsetCollection"};function B(r,e){return{kind:"array",itemType:r,N:e}}function j(r){if(r.kind==="array"){const e=j(r.itemType);return typeof r.N=="number"?`array<${e}, ${r.N}>`:r.itemType.kind==="value"?"array":`array<${e}>`}return r.kind}const Y=[li,Xe,Rt,Nt,mi,as,Bi,B(Ut),Si,X,R];function ce(r,e){if(e.kind==="error")return null;if(r.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!ce(r.itemType,e.itemType))&&(typeof r.N!="number"||r.N===e.N))return null}else{if(r.kind===e.kind)return null;if(r.kind==="value"){for(const n of Y)if(!ce(n,e))return null}}return`Expected ${j(r)} but found ${j(e)} instead.`}function fe(r,e){return e.some(n=>n.kind===r.kind)}function xe(r,e){return e.some(n=>n==="null"?r===null:n==="array"?Array.isArray(r):n==="object"?r&&!Array.isArray(r)&&typeof r=="object":n===typeof r)}function se(r,e){return r.kind==="array"&&e.kind==="array"?r.itemType.kind===e.itemType.kind&&typeof r.N=="number":r.kind===e.kind}const Me=.96422,Ne=.82521,Re=4/29,ze=6/29,Dt=3*ze*ze,Pt=ze*ze*ze,Xt=Math.PI/180,$t=180/Math.PI;function ur(r){return(r%=360)<0&&(r+=360),r}function Ar([r,e,n,o]){let c,f;const g=ci((.2225045*(r=$r(r))+.7168786*(e=$r(e))+.0606169*(n=$r(n)))/1);r===e&&e===n?c=f=g:(c=ci((.4360747*r+.3850649*e+.1430804*n)/Me),f=ci((.0139322*r+.0971045*e+.7141733*n)/Ne));const y=116*g-16;return[y<0?0:y,500*(c-g),200*(g-f),o]}function $r(r){return r<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function ci(r){return r>Pt?Math.pow(r,1/3):r/Dt+Re}function qt([r,e,n,o]){let c=(r+16)/116,f=isNaN(e)?c:c+e/500,g=isNaN(n)?c:c-n/200;return c=1*ui(c),f=Me*ui(f),g=Ne*ui(g),[Yr(3.1338561*f-1.6168667*c-.4906146*g),Yr(-.9787684*f+1.9161415*c+.033454*g),Yr(.0719453*f-.2289914*c+1.4052427*g),o]}function Yr(r){return(r=r<=.00304?12.92*r:1.055*Math.pow(r,1/2.4)-.055)<0?0:r>1?1:r}function ui(r){return r>ze?r*r*r:Dt*(r-Re)}function sn(r){return parseInt(r.padEnd(2,r),16)/255}function an(r,e){return gi(e?r/100:r,0,1)}function gi(r,e,n){return Math.min(Math.max(e,r),n)}function xa(r){return!r.some(Number.isNaN)}const Yc={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Pr{constructor(e,n,o,c=1,f=!0){this.r=e,this.g=n,this.b=o,this.a=c,f||(this.r*=c,this.g*=c,this.b*=c,c||this.overwriteGetter("rgb",[e,n,o,c]))}static parse(e){if(e instanceof Pr)return e;if(typeof e!="string")return;const n=function(o){if((o=o.toLowerCase().trim())==="transparent")return[0,0,0,0];const c=Yc[o];if(c){const[g,y,x]=c;return[g/255,y/255,x/255,1]}if(o.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(o)){const g=o.length<6?1:2;let y=1;return[sn(o.slice(y,y+=g)),sn(o.slice(y,y+=g)),sn(o.slice(y,y+=g)),sn(o.slice(y,y+g)||"ff")]}if(o.startsWith("rgb")){const g=o.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(g){const[y,x,k,E,P,L,F,$,U,W,re,we]=g,oe=[E||" ",F||" ",W].join("");if(oe==="  "||oe==="  /"||oe===",,"||oe===",,,"){const ve=[k,L,U].join(""),Be=ve==="%%%"?100:ve===""?255:0;if(Be){const Oe=[gi(+x/Be,0,1),gi(+P/Be,0,1),gi(+$/Be,0,1),re?an(+re,we):1];if(xa(Oe))return Oe}}return}}const f=o.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(f){const[g,y,x,k,E,P,L,F,$]=f,U=[x||" ",E||" ",L].join("");if(U==="  "||U==="  /"||U===",,"||U===",,,"){const W=[+y,gi(+k,0,100),gi(+P,0,100),F?an(+F,$):1];if(xa(W))return function([re,we,oe,ve]){function Be(Oe){const ft=(Oe+re/30)%12,kt=we*Math.min(oe,1-oe);return oe-kt*Math.max(-1,Math.min(ft-3,9-ft,1))}return re=ur(re),we/=100,oe/=100,[Be(0),Be(8),Be(4),ve]}(W)}}}(e);return n?new Pr(...n,!1):void 0}get rgb(){const{r:e,g:n,b:o,a:c}=this,f=c||1/0;return this.overwriteGetter("rgb",[e/f,n/f,o/f,c])}get hcl(){return this.overwriteGetter("hcl",function(e){const[n,o,c,f]=Ar(e),g=Math.sqrt(o*o+c*c);return[Math.round(1e4*g)?ur(Math.atan2(c,o)*$t):NaN,g,n,f]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Ar(this.rgb))}overwriteGetter(e,n){return Object.defineProperty(this,e,{value:n}),n}toString(){const[e,n,o,c]=this.rgb;return`rgba(${[e,n,o].map(f=>Math.round(255*f)).join(",")},${c})`}}Pr.black=new Pr(0,0,0,1),Pr.white=new Pr(1,1,1,1),Pr.transparent=new Pr(0,0,0,0),Pr.red=new Pr(1,0,0,1);class Jl{constructor(e,n,o){this.sensitivity=e?n?"variant":"case":n?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Yl{constructor(e,n,o,c,f){this.text=e,this.image=n,this.scale=o,this.fontStack=c,this.textColor=f}}class mn{constructor(e){this.sections=e}static fromString(e){return new mn([new Yl(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof mn?e:mn.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}}class on{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof on)return e;if(typeof e=="number")return new on([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const n of e)if(typeof n!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new on(e)}}toString(){return JSON.stringify(this.values)}}const Qa=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Oi{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Oi)return e;if(Array.isArray(e)&&!(e.length<1)&&e.length%2==0){for(let n=0;n<e.length;n+=2){const o=e[n],c=e[n+1];if(typeof o!="string"||!Qa.has(o)||!Array.isArray(c)||c.length!==2||typeof c[0]!="number"||typeof c[1]!="number")return}return new Oi(e)}}toString(){return JSON.stringify(this.values)}}class Pi{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Pi({name:e,available:!1}):null}}function No(r,e,n,o){return typeof r=="number"&&r>=0&&r<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof n=="number"&&n>=0&&n<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[r,e,n,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[r,e,n,o]:[r,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ln(r){if(r===null||typeof r=="string"||typeof r=="boolean"||typeof r=="number"||r instanceof Pr||r instanceof Jl||r instanceof mn||r instanceof on||r instanceof Oi||r instanceof Pi)return!0;if(Array.isArray(r)){for(const e of r)if(!ln(e))return!1;return!0}if(typeof r=="object"){for(const e in r)if(!ln(r[e]))return!1;return!0}return!1}function hi(r){if(r===null)return li;if(typeof r=="string")return Rt;if(typeof r=="boolean")return Nt;if(typeof r=="number")return Xe;if(r instanceof Pr)return mi;if(r instanceof Jl)return ss;if(r instanceof mn)return as;if(r instanceof on)return Si;if(r instanceof Oi)return R;if(r instanceof Pi)return X;if(Array.isArray(r)){const e=r.length;let n;for(const o of r){const c=hi(o);if(n){if(n===c)continue;n=Ut;break}n=c}return B(n||Ut,e)}return Bi}function eo(r){const e=typeof r;return r===null?"":e==="string"||e==="number"||e==="boolean"?String(r):r instanceof Pr||r instanceof mn||r instanceof on||r instanceof Oi||r instanceof Pi?r.toString():JSON.stringify(r)}class Hs{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(e.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!ln(e[1]))return n.error("invalid value");const o=e[1];let c=hi(o);const f=n.expectedType;return c.kind!=="array"||c.N!==0||!f||f.kind!=="array"||typeof f.N=="number"&&f.N!==0||(c=f),new Hs(c,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class ri{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Ws={string:Rt,number:Xe,boolean:Nt,object:Bi};class En{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let o,c=1;const f=e[0];if(f==="array"){let y,x;if(e.length>2){const k=e[1];if(typeof k!="string"||!(k in Ws)||k==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);y=Ws[k],c++}else y=Ut;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);x=e[2],c++}o=B(y,x)}else{if(!Ws[f])throw new Error(`Types doesn't contain name = ${f}`);o=Ws[f]}const g=[];for(;c<e.length;c++){const y=n.parse(e[c],c,Ut);if(!y)return null;g.push(y)}return new En(o,g)}evaluate(e){for(let n=0;n<this.args.length;n++){const o=this.args[n].evaluate(e);if(!ce(this.type,hi(o)))return o;if(n===this.args.length-1)throw new ri(`Expected value to be of type ${j(this.type)}, but found ${j(hi(o))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const to={"to-boolean":Nt,"to-color":mi,"to-number":Xe,"to-string":Rt};class Wn{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const o=e[0];if(!to[o])throw new Error(`Can't parse ${o} as it is not part of the known types`);if((o==="to-boolean"||o==="to-string")&&e.length!==2)return n.error("Expected one argument.");const c=to[o],f=[];for(let g=1;g<e.length;g++){const y=n.parse(e[g],g,Ut);if(!y)return null;f.push(y)}return new Wn(c,f)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let n,o;for(const c of this.args){if(n=c.evaluate(e),o=null,n instanceof Pr)return n;if(typeof n=="string"){const f=e.parseColor(n);if(f)return f}else if(Array.isArray(n)&&(o=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:No(n[0],n[1],n[2],n[3]),!o))return new Pr(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new ri(o||`Could not parse color from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"padding":{let n;for(const o of this.args){n=o.evaluate(e);const c=on.parse(n);if(c)return c}throw new ri(`Could not parse padding from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"variableAnchorOffsetCollection":{let n;for(const o of this.args){n=o.evaluate(e);const c=Oi.parse(n);if(c)return c}throw new ri(`Could not parse variableAnchorOffsetCollection from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"number":{let n=null;for(const o of this.args){if(n=o.evaluate(e),n===null)return 0;const c=Number(n);if(!isNaN(c))return c}throw new ri(`Could not convert ${JSON.stringify(n)} to number.`)}case"formatted":return mn.fromString(eo(this.args[0].evaluate(e)));case"resolvedImage":return Pi.fromString(eo(this.args[0].evaluate(e)));default:return eo(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const Ql=["Unknown","Point","LineString","Polygon"];class ba{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Ql[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let n=this._parseColorCache[e];return n||(n=this._parseColorCache[e]=Pr.parse(e)),n}}class br{constructor(e,n,o=[],c,f=new Xi,g=[]){this.registry=e,this.path=o,this.key=o.map(y=>`[${y}]`).join(""),this.scope=f,this.errors=g,this.expectedType=c,this._isConstant=n}parse(e,n,o,c,f={}){return n?this.concat(n,o,c)._parse(e,f):this._parse(e,f)}_parse(e,n){function o(c,f,g){return g==="assert"?new En(f,[c]):g==="coerce"?new Wn(f,[c]):c}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const c=e[0];if(typeof c!="string")return this.error(`Expression name must be a string, but found ${typeof c} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const f=this.registry[c];if(f){let g=f.parse(e,this);if(!g)return null;if(this.expectedType){const y=this.expectedType,x=g.type;if(y.kind!=="string"&&y.kind!=="number"&&y.kind!=="boolean"&&y.kind!=="object"&&y.kind!=="array"||x.kind!=="value")if(y.kind!=="color"&&y.kind!=="formatted"&&y.kind!=="resolvedImage"||x.kind!=="value"&&x.kind!=="string")if(y.kind!=="padding"||x.kind!=="value"&&x.kind!=="number"&&x.kind!=="array")if(y.kind!=="variableAnchorOffsetCollection"||x.kind!=="value"&&x.kind!=="array"){if(this.checkSubtype(y,x))return null}else g=o(g,y,n.typeAnnotation||"coerce");else g=o(g,y,n.typeAnnotation||"coerce");else g=o(g,y,n.typeAnnotation||"coerce");else g=o(g,y,n.typeAnnotation||"assert")}if(!(g instanceof Hs)&&g.type.kind!=="resolvedImage"&&this._isConstant(g)){const y=new ba;try{g=new Hs(g.type,g.evaluate(y))}catch(x){return this.error(x.message),null}}return g}return this.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,n,o){const c=typeof e=="number"?this.path.concat(e):this.path,f=o?this.scope.concat(o):this.scope;return new br(this.registry,this._isConstant,c,n||null,f,this.errors)}error(e,...n){const o=`${this.key}${n.map(c=>`[${c}]`).join("")}`;this.errors.push(new Jr(o,e))}checkSubtype(e,n){const o=ce(e,n);return o&&this.error(o),o}}class ro{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const o=[];for(let f=1;f<e.length-1;f+=2){const g=e[f];if(typeof g!="string")return n.error(`Expected string, but found ${typeof g} instead.`,f);if(/[^a-zA-Z0-9_]/.test(g))return n.error("Variable names must contain only alphanumeric characters or '_'.",f);const y=n.parse(e[f+1],f+1);if(!y)return null;o.push([g,y])}const c=n.parse(e[e.length-1],e.length-1,n.expectedType,o);return c?new ro(o,c):null}outputDefined(){return this.result.outputDefined()}}class Xs{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(e.length!==2||typeof e[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");const o=e[1];return n.scope.has(o)?new Xs(o,n.scope.get(o)):n.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class ec{constructor(e,n,o){this.type=e,this.index=n,this.input=o}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=n.parse(e[1],1,Xe),c=n.parse(e[2],2,B(n.expectedType||Ut));return o&&c?new ec(c.type.itemType,o,c):null}evaluate(e){const n=this.index.evaluate(e),o=this.input.evaluate(e);if(n<0)throw new ri(`Array index out of bounds: ${n} < 0.`);if(n>=o.length)throw new ri(`Array index out of bounds: ${n} > ${o.length-1}.`);if(n!==Math.floor(n))throw new ri(`Array index must be an integer, but found ${n} instead.`);return o[n]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class $o{constructor(e,n){this.type=Nt,this.needle=e,this.haystack=n}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=n.parse(e[1],1,Ut),c=n.parse(e[2],2,Ut);return o&&c?fe(o.type,[Nt,Rt,Xe,li,Ut])?new $o(o,c):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${j(o.type)} instead`):null}evaluate(e){const n=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!o)return!1;if(!xe(n,["boolean","string","number","null"]))throw new ri(`Expected first argument to be of type boolean, string, number or null, but found ${j(hi(n))} instead.`);if(!xe(o,["string","array"]))throw new ri(`Expected second argument to be of type array or string, but found ${j(hi(o))} instead.`);return o.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class io{constructor(e,n,o){this.type=Xe,this.needle=e,this.haystack=n,this.fromIndex=o}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=n.parse(e[1],1,Ut),c=n.parse(e[2],2,Ut);if(!o||!c)return null;if(!fe(o.type,[Nt,Rt,Xe,li,Ut]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${j(o.type)} instead`);if(e.length===4){const f=n.parse(e[3],3,Xe);return f?new io(o,c,f):null}return new io(o,c)}evaluate(e){const n=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!xe(n,["boolean","string","number","null"]))throw new ri(`Expected first argument to be of type boolean, string, number or null, but found ${j(hi(n))} instead.`);if(!xe(o,["string","array"]))throw new ri(`Expected second argument to be of type array or string, but found ${j(hi(o))} instead.`);if(this.fromIndex){const c=this.fromIndex.evaluate(e);return o.indexOf(n,c)}return o.indexOf(n)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class tc{constructor(e,n,o,c,f,g){this.inputType=e,this.type=n,this.input=o,this.cases=c,this.outputs=f,this.otherwise=g}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return n.error("Expected an even number of arguments.");let o,c;n.expectedType&&n.expectedType.kind!=="value"&&(c=n.expectedType);const f={},g=[];for(let k=2;k<e.length-1;k+=2){let E=e[k];const P=e[k+1];Array.isArray(E)||(E=[E]);const L=n.concat(k);if(E.length===0)return L.error("Expected at least one branch label.");for(const $ of E){if(typeof $!="number"&&typeof $!="string")return L.error("Branch labels must be numbers or strings.");if(typeof $=="number"&&Math.abs($)>Number.MAX_SAFE_INTEGER)return L.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof $=="number"&&Math.floor($)!==$)return L.error("Numeric branch labels must be integer values.");if(o){if(L.checkSubtype(o,hi($)))return null}else o=hi($);if(f[String($)]!==void 0)return L.error("Branch labels must be unique.");f[String($)]=g.length}const F=n.parse(P,k,c);if(!F)return null;c=c||F.type,g.push(F)}const y=n.parse(e[1],1,Ut);if(!y)return null;const x=n.parse(e[e.length-1],e.length-1,c);return x?y.type.kind!=="value"&&n.concat(1).checkSubtype(o,y.type)?null:new tc(o,c,y,f,g,x):null}evaluate(e){const n=this.input.evaluate(e);return(hi(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}}class jo{constructor(e,n,o){this.type=e,this.branches=n,this.otherwise=o}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return n.error("Expected an odd number of arguments.");let o;n.expectedType&&n.expectedType.kind!=="value"&&(o=n.expectedType);const c=[];for(let g=1;g<e.length-1;g+=2){const y=n.parse(e[g],g,Nt);if(!y)return null;const x=n.parse(e[g+1],g+1,o);if(!x)return null;c.push([y,x]),o=o||x.type}const f=n.parse(e[e.length-1],e.length-1,o);if(!f)return null;if(!o)throw new Error("Can't infer output type");return new jo(o,c,f)}evaluate(e){for(const[n,o]of this.branches)if(n.evaluate(e))return o.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[n,o]of this.branches)e(n),e(o);e(this.otherwise)}outputDefined(){return this.branches.every(([e,n])=>n.outputDefined())&&this.otherwise.outputDefined()}}class no{constructor(e,n,o,c){this.type=e,this.input=n,this.beginIndex=o,this.endIndex=c}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=n.parse(e[1],1,Ut),c=n.parse(e[2],2,Xe);if(!o||!c)return null;if(!fe(o.type,[B(Ut),Rt,Ut]))return n.error(`Expected first argument to be of type array or string, but found ${j(o.type)} instead`);if(e.length===4){const f=n.parse(e[3],3,Xe);return f?new no(o.type,o,c,f):null}return new no(o.type,o,c)}evaluate(e){const n=this.input.evaluate(e),o=this.beginIndex.evaluate(e);if(!xe(n,["string","array"]))throw new ri(`Expected first argument to be of type array or string, but found ${j(hi(n))} instead.`);if(this.endIndex){const c=this.endIndex.evaluate(e);return n.slice(o,c)}return n.slice(o)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function Vo(r,e){const n=r.length-1;let o,c,f=0,g=n,y=0;for(;f<=g;)if(y=Math.floor((f+g)/2),o=r[y],c=r[y+1],o<=e){if(y===n||e<c)return y;f=y+1}else{if(!(o>e))throw new ri("Input is not a number.");g=y-1}return 0}class so{constructor(e,n,o){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(const[c,f]of o)this.labels.push(c),this.outputs.push(f)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");const o=n.parse(e[1],1,Xe);if(!o)return null;const c=[];let f=null;n.expectedType&&n.expectedType.kind!=="value"&&(f=n.expectedType);for(let g=1;g<e.length;g+=2){const y=g===1?-1/0:e[g],x=e[g+1],k=g,E=g+1;if(typeof y!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(c.length&&c[c.length-1][0]>=y)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',k);const P=n.parse(x,E,f);if(!P)return null;f=f||P.type,c.push([y,P])}return new so(f,o,c)}evaluate(e){const n=this.labels,o=this.outputs;if(n.length===1)return o[0].evaluate(e);const c=this.input.evaluate(e);if(c<=n[0])return o[0].evaluate(e);const f=n.length;return c>=n[f-1]?o[f-1].evaluate(e):o[Vo(n,c)].evaluate(e)}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function fh(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var mh=rc;function rc(r,e,n,o){this.cx=3*r,this.bx=3*(n-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(o-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=e,this.p2x=n,this.p2y=o}rc.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,e){if(e===void 0&&(e=1e-6),r<0)return 0;if(r>1)return 1;for(var n=r,o=0;o<8;o++){var c=this.sampleCurveX(n)-r;if(Math.abs(c)<e)return n;var f=this.sampleCurveDerivativeX(n);if(Math.abs(f)<1e-6)break;n-=c/f}var g=0,y=1;for(n=r,o=0;o<20&&(c=this.sampleCurveX(n),!(Math.abs(c-r)<e));o++)r>c?g=n:y=n,n=.5*(y-g)+g;return n},solve:function(r,e){return this.sampleCurveY(this.solveCurveX(r,e))}};var Qc=fh(mh);function Ks(r,e,n){return r+n*(e-r)}function ao(r,e,n){return r.map((o,c)=>Ks(o,e[c],n))}const Ni={number:Ks,color:function(r,e,n,o="rgb"){switch(o){case"rgb":{const[c,f,g,y]=ao(r.rgb,e.rgb,n);return new Pr(c,f,g,y,!1)}case"hcl":{const[c,f,g,y]=r.hcl,[x,k,E,P]=e.hcl;let L,F;if(isNaN(c)||isNaN(x))isNaN(c)?isNaN(x)?L=NaN:(L=x,g!==1&&g!==0||(F=k)):(L=c,E!==1&&E!==0||(F=f));else{let we=x-c;x>c&&we>180?we-=360:x<c&&c-x>180&&(we+=360),L=c+n*we}const[$,U,W,re]=function([we,oe,ve,Be]){return we=isNaN(we)?0:we*Xt,qt([ve,Math.cos(we)*oe,Math.sin(we)*oe,Be])}([L,F??Ks(f,k,n),Ks(g,E,n),Ks(y,P,n)]);return new Pr($,U,W,re,!1)}case"lab":{const[c,f,g,y]=qt(ao(r.lab,e.lab,n));return new Pr(c,f,g,y,!1)}}},array:ao,padding:function(r,e,n){return new on(ao(r.values,e.values,n))},variableAnchorOffsetCollection:function(r,e,n){const o=r.values,c=e.values;if(o.length!==c.length)throw new ri(`Cannot interpolate values of different length. from: ${r.toString()}, to: ${e.toString()}`);const f=[];for(let g=0;g<o.length;g+=2){if(o[g]!==c[g])throw new ri(`Cannot interpolate values containing mismatched anchors. from[${g}]: ${o[g]}, to[${g}]: ${c[g]}`);f.push(o[g]);const[y,x]=o[g+1],[k,E]=c[g+1];f.push([Ks(y,k,n),Ks(x,E,n)])}return new Oi(f)}};class gn{constructor(e,n,o,c,f){this.type=e,this.operator=n,this.interpolation=o,this.input=c,this.labels=[],this.outputs=[];for(const[g,y]of f)this.labels.push(g),this.outputs.push(y)}static interpolationFactor(e,n,o,c){let f=0;if(e.name==="exponential")f=wa(n,e.base,o,c);else if(e.name==="linear")f=wa(n,1,o,c);else if(e.name==="cubic-bezier"){const g=e.controlPoints;f=new Qc(g[0],g[1],g[2],g[3]).solve(wa(n,1,o,c))}return f}static parse(e,n){let[o,c,f,...g]=e;if(!Array.isArray(c)||c.length===0)return n.error("Expected an interpolation type expression.",1);if(c[0]==="linear")c={name:"linear"};else if(c[0]==="exponential"){const k=c[1];if(typeof k!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);c={name:"exponential",base:k}}else{if(c[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(c[0])}`,1,0);{const k=c.slice(1);if(k.length!==4||k.some(E=>typeof E!="number"||E<0||E>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);c={name:"cubic-bezier",controlPoints:k}}}if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(f=n.parse(f,2,Xe),!f)return null;const y=[];let x=null;o==="interpolate-hcl"||o==="interpolate-lab"?x=mi:n.expectedType&&n.expectedType.kind!=="value"&&(x=n.expectedType);for(let k=0;k<g.length;k+=2){const E=g[k],P=g[k+1],L=k+3,F=k+4;if(typeof E!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',L);if(y.length&&y[y.length-1][0]>=E)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',L);const $=n.parse(P,F,x);if(!$)return null;x=x||$.type,y.push([E,$])}return se(x,Xe)||se(x,mi)||se(x,Si)||se(x,R)||se(x,B(Xe))?new gn(x,o,c,f,y):n.error(`Type ${j(x)} is not interpolatable.`)}evaluate(e){const n=this.labels,o=this.outputs;if(n.length===1)return o[0].evaluate(e);const c=this.input.evaluate(e);if(c<=n[0])return o[0].evaluate(e);const f=n.length;if(c>=n[f-1])return o[f-1].evaluate(e);const g=Vo(n,c),y=gn.interpolationFactor(this.interpolation,c,n[g],n[g+1]),x=o[g].evaluate(e),k=o[g+1].evaluate(e);switch(this.operator){case"interpolate":return Ni[this.type.kind](x,k,y);case"interpolate-hcl":return Ni.color(x,k,y,"hcl");case"interpolate-lab":return Ni.color(x,k,y,"lab")}}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function wa(r,e,n,o){const c=o-n,f=r-n;return c===0?0:e===1?f/c:(Math.pow(e,f)-1)/(Math.pow(e,c)-1)}class os{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expectected at least one argument.");let o=null;const c=n.expectedType;c&&c.kind!=="value"&&(o=c);const f=[];for(const y of e.slice(1)){const x=n.parse(y,1+f.length,o,void 0,{typeAnnotation:"omit"});if(!x)return null;o=o||x.type,f.push(x)}if(!o)throw new Error("No output type");const g=c&&f.some(y=>ce(c,y.type));return new os(g?Ut:o,f)}evaluate(e){let n,o=null,c=0;for(const f of this.args)if(c++,o=f.evaluate(e),o&&o instanceof Pi&&!o.available&&(n||(n=o.name),o=null,c===this.args.length&&(o=n)),o!==null)break;return o}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}function ic(r,e){return r==="=="||r==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Uo(r,e,n,o){return o.compare(e,n)===0}function Sa(r,e,n){const o=r!=="=="&&r!=="!=";return class lx{constructor(f,g,y){this.type=Nt,this.lhs=f,this.rhs=g,this.collator=y,this.hasUntypedArgument=f.type.kind==="value"||g.type.kind==="value"}static parse(f,g){if(f.length!==3&&f.length!==4)return g.error("Expected two or three arguments.");const y=f[0];let x=g.parse(f[1],1,Ut);if(!x)return null;if(!ic(y,x.type))return g.concat(1).error(`"${y}" comparisons are not supported for type '${j(x.type)}'.`);let k=g.parse(f[2],2,Ut);if(!k)return null;if(!ic(y,k.type))return g.concat(2).error(`"${y}" comparisons are not supported for type '${j(k.type)}'.`);if(x.type.kind!==k.type.kind&&x.type.kind!=="value"&&k.type.kind!=="value")return g.error(`Cannot compare types '${j(x.type)}' and '${j(k.type)}'.`);o&&(x.type.kind==="value"&&k.type.kind!=="value"?x=new En(k.type,[x]):x.type.kind!=="value"&&k.type.kind==="value"&&(k=new En(x.type,[k])));let E=null;if(f.length===4){if(x.type.kind!=="string"&&k.type.kind!=="string"&&x.type.kind!=="value"&&k.type.kind!=="value")return g.error("Cannot use collator to compare non-string types.");if(E=g.parse(f[3],3,ss),!E)return null}return new lx(x,k,E)}evaluate(f){const g=this.lhs.evaluate(f),y=this.rhs.evaluate(f);if(o&&this.hasUntypedArgument){const x=hi(g),k=hi(y);if(x.kind!==k.kind||x.kind!=="string"&&x.kind!=="number")throw new ri(`Expected arguments for "${r}" to be (string, string) or (number, number), but found (${x.kind}, ${k.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const x=hi(g),k=hi(y);if(x.kind!=="string"||k.kind!=="string")return e(f,g,y)}return this.collator?n(f,g,y,this.collator.evaluate(f)):e(f,g,y)}eachChild(f){f(this.lhs),f(this.rhs),this.collator&&f(this.collator)}outputDefined(){return!0}}}const nc=Sa("==",function(r,e,n){return e===n},Uo),qo=Sa("!=",function(r,e,n){return e!==n},function(r,e,n,o){return!Uo(0,e,n,o)}),eu=Sa("<",function(r,e,n){return e<n},function(r,e,n,o){return o.compare(e,n)<0}),tu=Sa(">",function(r,e,n){return e>n},function(r,e,n,o){return o.compare(e,n)>0}),Ma=Sa("<=",function(r,e,n){return e<=n},function(r,e,n,o){return o.compare(e,n)<=0}),gh=Sa(">=",function(r,e,n){return e>=n},function(r,e,n,o){return o.compare(e,n)>=0});class Go{constructor(e,n,o){this.type=ss,this.locale=o,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(e.length!==2)return n.error("Expected one argument.");const o=e[1];if(typeof o!="object"||Array.isArray(o))return n.error("Collator options argument must be an object.");const c=n.parse(o["case-sensitive"]!==void 0&&o["case-sensitive"],1,Nt);if(!c)return null;const f=n.parse(o["diacritic-sensitive"]!==void 0&&o["diacritic-sensitive"],1,Nt);if(!f)return null;let g=null;return o.locale&&(g=n.parse(o.locale,1,Rt),!g)?null:new Go(c,f,g)}evaluate(e){return new Jl(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}class sc{constructor(e,n,o,c,f){this.type=Rt,this.number=e,this.locale=n,this.currency=o,this.minFractionDigits=c,this.maxFractionDigits=f}static parse(e,n){if(e.length!==3)return n.error("Expected two arguments.");const o=n.parse(e[1],1,Xe);if(!o)return null;const c=e[2];if(typeof c!="object"||Array.isArray(c))return n.error("NumberFormat options argument must be an object.");let f=null;if(c.locale&&(f=n.parse(c.locale,1,Rt),!f))return null;let g=null;if(c.currency&&(g=n.parse(c.currency,1,Rt),!g))return null;let y=null;if(c["min-fraction-digits"]&&(y=n.parse(c["min-fraction-digits"],1,Xe),!y))return null;let x=null;return c["max-fraction-digits"]&&(x=n.parse(c["max-fraction-digits"],1,Xe),!x)?null:new sc(o,f,g,y,x)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class ka{constructor(e){this.type=as,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const o=e[1];if(!Array.isArray(o)&&typeof o=="object")return n.error("First argument must be an image or text section.");const c=[];let f=!1;for(let g=1;g<=e.length-1;++g){const y=e[g];if(f&&typeof y=="object"&&!Array.isArray(y)){f=!1;let x=null;if(y["font-scale"]&&(x=n.parse(y["font-scale"],1,Xe),!x))return null;let k=null;if(y["text-font"]&&(k=n.parse(y["text-font"],1,B(Rt)),!k))return null;let E=null;if(y["text-color"]&&(E=n.parse(y["text-color"],1,mi),!E))return null;const P=c[c.length-1];P.scale=x,P.font=k,P.textColor=E}else{const x=n.parse(e[g],1,Ut);if(!x)return null;const k=x.type.kind;if(k!=="string"&&k!=="value"&&k!=="null"&&k!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");f=!0,c.push({content:x,scale:null,font:null,textColor:null})}}return new ka(c)}evaluate(e){return new mn(this.sections.map(n=>{const o=n.content.evaluate(e);return hi(o)===X?new Yl("",o,null,null,null):new Yl(eo(o),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null)}))}eachChild(e){for(const n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor)}outputDefined(){return!1}}class oo{constructor(e){this.type=X,this.input=e}static parse(e,n){if(e.length!==2)return n.error("Expected two arguments.");const o=n.parse(e[1],1,Rt);return o?new oo(o):n.error("No image name provided.")}evaluate(e){const n=this.input.evaluate(e),o=Pi.fromString(n);return o&&e.availableImages&&(o.available=e.availableImages.indexOf(n)>-1),o}eachChild(e){e(this.input)}outputDefined(){return!1}}class Ta{constructor(e){this.type=Xe,this.input=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);const o=n.parse(e[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${j(o.type)} instead.`):new Ta(o):null}evaluate(e){const n=this.input.evaluate(e);if(typeof n=="string"||Array.isArray(n))return n.length;throw new ri(`Expected value to be of type string or array, but found ${j(hi(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const _n=8192;function wr(r,e){const n=(180+r[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r[1]*Math.PI/360)))/360,c=Math.pow(2,e.z);return[Math.round(n*c*_n),Math.round(o*c*_n)]}function ac(r,e){const n=Math.pow(2,e.z);return[(c=(r[0]/_n+e.x)/n,360*c-180),(o=(r[1]/_n+e.y)/n,360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90)];var o,c}function Ca(r,e){r[0]=Math.min(r[0],e[0]),r[1]=Math.min(r[1],e[1]),r[2]=Math.max(r[2],e[0]),r[3]=Math.max(r[3],e[1])}function Ia(r,e){return!(r[0]<=e[0]||r[2]>=e[2]||r[1]<=e[1]||r[3]>=e[3])}function _h(r,e,n){const o=r[0]-e[0],c=r[1]-e[1],f=r[0]-n[0],g=r[1]-n[1];return o*g-f*c==0&&o*f<=0&&c*g<=0}function Zo(r,e,n,o){return(c=[o[0]-n[0],o[1]-n[1]])[0]*(f=[e[0]-r[0],e[1]-r[1]])[1]-c[1]*f[0]!=0&&!(!oc(r,e,n,o)||!oc(n,o,r,e));var c,f}function yh(r,e,n){for(const o of n)for(let c=0;c<o.length-1;++c)if(Zo(r,e,o[c],o[c+1]))return!0;return!1}function Ea(r,e,n=!1){let o=!1;for(const y of e)for(let x=0;x<y.length-1;x++){if(_h(r,y[x],y[x+1]))return n;(f=y[x])[1]>(c=r)[1]!=(g=y[x+1])[1]>c[1]&&c[0]<(g[0]-f[0])*(c[1]-f[1])/(g[1]-f[1])+f[0]&&(o=!o)}var c,f,g;return o}function vh(r,e){for(const n of e)if(Ea(r,n))return!0;return!1}function ru(r,e){for(const n of r)if(!Ea(n,e))return!1;for(let n=0;n<r.length-1;++n)if(yh(r[n],r[n+1],e))return!1;return!0}function xh(r,e){for(const n of e)if(ru(r,n))return!0;return!1}function oc(r,e,n,o){const c=o[0]-n[0],f=o[1]-n[1],g=(r[0]-n[0])*f-c*(r[1]-n[1]),y=(e[0]-n[0])*f-c*(e[1]-n[1]);return g>0&&y<0||g<0&&y>0}function lc(r,e,n){const o=[];for(let c=0;c<r.length;c++){const f=[];for(let g=0;g<r[c].length;g++){const y=wr(r[c][g],n);Ca(e,y),f.push(y)}o.push(f)}return o}function iu(r,e,n){const o=[];for(let c=0;c<r.length;c++){const f=lc(r[c],e,n);o.push(f)}return o}function nu(r,e,n,o){if(r[0]<n[0]||r[0]>n[2]){const c=.5*o;let f=r[0]-n[0]>c?-o:n[0]-r[0]>c?o:0;f===0&&(f=r[0]-n[2]>c?-o:n[2]-r[0]>c?o:0),r[0]+=f}Ca(e,r)}function su(r,e,n,o){const c=Math.pow(2,o.z)*_n,f=[o.x*_n,o.y*_n],g=[];for(const y of r)for(const x of y){const k=[x.x+f[0],x.y+f[1]];nu(k,e,n,c),g.push(k)}return g}function au(r,e,n,o){const c=Math.pow(2,o.z)*_n,f=[o.x*_n,o.y*_n],g=[];for(const x of r){const k=[];for(const E of x){const P=[E.x+f[0],E.y+f[1]];Ca(e,P),k.push(P)}g.push(k)}if(e[2]-e[0]<=c/2){(y=e)[0]=y[1]=1/0,y[2]=y[3]=-1/0;for(const x of g)for(const k of x)nu(k,e,n,c)}var y;return g}class Js{constructor(e,n){this.type=Nt,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(ln(e[1])){const o=e[1];if(o.type==="FeatureCollection"){const c=[];for(const f of o.features){const{type:g,coordinates:y}=f.geometry;g==="Polygon"&&c.push(y),g==="MultiPolygon"&&c.push(...y)}if(c.length)return new Js(o,{type:"MultiPolygon",coordinates:c})}else if(o.type==="Feature"){const c=o.geometry.type;if(c==="Polygon"||c==="MultiPolygon")return new Js(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new Js(o,o)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(n,o){const c=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],g=n.canonicalID();if(o.type==="Polygon"){const y=lc(o.coordinates,f,g),x=su(n.geometry(),c,f,g);if(!Ia(c,f))return!1;for(const k of x)if(!Ea(k,y))return!1}if(o.type==="MultiPolygon"){const y=iu(o.coordinates,f,g),x=su(n.geometry(),c,f,g);if(!Ia(c,f))return!1;for(const k of x)if(!vh(k,y))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(n,o){const c=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],g=n.canonicalID();if(o.type==="Polygon"){const y=lc(o.coordinates,f,g),x=au(n.geometry(),c,f,g);if(!Ia(c,f))return!1;for(const k of x)if(!ru(k,y))return!1}if(o.type==="MultiPolygon"){const y=iu(o.coordinates,f,g),x=au(n.geometry(),c,f,g);if(!Ia(c,f))return!1;for(const k of x)if(!xh(k,y))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let ou=class{constructor(r=[],e=bh){if(this.data=r,this.length=this.data.length,this.compare=e,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(r){this.data.push(r),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const r=this.data[0],e=this.data.pop();return this.length--,this.length>0&&(this.data[0]=e,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:e,compare:n}=this,o=e[r];for(;r>0;){const c=r-1>>1,f=e[c];if(n(o,f)>=0)break;e[r]=f,r=c}e[r]=o}_down(r){const{data:e,compare:n}=this,o=this.length>>1,c=e[r];for(;r<o;){let f=1+(r<<1),g=e[f];const y=f+1;if(y<this.length&&n(e[y],g)<0&&(f=y,g=e[y]),n(g,c)>=0)break;e[r]=g,r=f}e[r]=c}};function bh(r,e){return r<e?-1:r>e?1:0}function wh(r,e,n,o,c){lu(r,e,n,o||r.length-1,c||Sh)}function lu(r,e,n,o,c){for(;o>n;){if(o-n>600){var f=o-n+1,g=e-n+1,y=Math.log(f),x=.5*Math.exp(2*y/3),k=.5*Math.sqrt(y*x*(f-x)/f)*(g-f/2<0?-1:1);lu(r,e,Math.max(n,Math.floor(e-g*x/f+k)),Math.min(o,Math.floor(e+(f-g)*x/f+k)),c)}var E=r[e],P=n,L=o;for(Pa(r,n,e),c(r[o],E)>0&&Pa(r,n,o);P<L;){for(Pa(r,P,L),P++,L--;c(r[P],E)<0;)P++;for(;c(r[L],E)>0;)L--}c(r[n],E)===0?Pa(r,n,L):Pa(r,++L,o),L<=e&&(n=L+1),e<=L&&(o=L-1)}}function Pa(r,e,n){var o=r[e];r[e]=r[n],r[n]=o}function Sh(r,e){return r<e?-1:r>e?1:0}function Ho(r,e){if(r.length<=1)return[r];const n=[];let o,c;for(const f of r){const g=kh(f);g!==0&&(f.area=Math.abs(g),c===void 0&&(c=g<0),c===g<0?(o&&n.push(o),o=[f]):o.push(f))}if(o&&n.push(o),e>1)for(let f=0;f<n.length;f++)n[f].length<=e||(wh(n[f],e,1,n[f].length-1,Mh),n[f]=n[f].slice(0,e));return n}function Mh(r,e){return e.area-r.area}function kh(r){let e=0;for(let n,o,c=0,f=r.length,g=f-1;c<f;g=c++)n=r[c],o=r[g],e+=(o.x-n.x)*(n.y+o.y);return e}const cc=1/298.257223563,cu=cc*(2-cc),uu=Math.PI/180;class uc{constructor(e){const n=6378.137*uu*1e3,o=Math.cos(e*uu),c=1/(1-cu*(1-o*o)),f=Math.sqrt(c);this.kx=n*f*o,this.ky=n*f*c*(1-cu)}distance(e,n){const o=this.wrap(e[0]-n[0])*this.kx,c=(e[1]-n[1])*this.ky;return Math.sqrt(o*o+c*c)}pointOnLine(e,n){let o,c,f,g,y=1/0;for(let x=0;x<e.length-1;x++){let k=e[x][0],E=e[x][1],P=this.wrap(e[x+1][0]-k)*this.kx,L=(e[x+1][1]-E)*this.ky,F=0;P===0&&L===0||(F=(this.wrap(n[0]-k)*this.kx*P+(n[1]-E)*this.ky*L)/(P*P+L*L),F>1?(k=e[x+1][0],E=e[x+1][1]):F>0&&(k+=P/this.kx*F,E+=L/this.ky*F)),P=this.wrap(n[0]-k)*this.kx,L=(n[1]-E)*this.ky;const $=P*P+L*L;$<y&&(y=$,o=k,c=E,f=x,g=F)}return{point:[o,c],index:f,t:Math.max(0,Math.min(1,g))}}wrap(e){for(;e<-180;)e+=360;for(;e>180;)e-=360;return e}}function hu(r,e){return e[0]-r[0]}function Aa(r){return r[1]-r[0]+1}function ls(r,e){return r[1]>=r[0]&&r[1]<e}function Wo(r,e){if(r[0]>r[1])return[null,null];const n=Aa(r);if(e){if(n===2)return[r,null];const c=Math.floor(n/2);return[[r[0],r[0]+c],[r[0]+c,r[1]]]}if(n===1)return[r,null];const o=Math.floor(n/2)-1;return[[r[0],r[0]+o],[r[0]+o+1,r[1]]]}function Da(r,e){if(!ls(e,r.length))return[1/0,1/0,-1/0,-1/0];const n=[1/0,1/0,-1/0,-1/0];for(let o=e[0];o<=e[1];++o)Ca(n,r[o]);return n}function lo(r){const e=[1/0,1/0,-1/0,-1/0];for(const n of r)for(const o of n)Ca(e,o);return e}function ei(r){return r[0]!==-1/0&&r[1]!==-1/0&&r[2]!==1/0&&r[3]!==1/0}function hc(r,e,n){if(!ei(r)||!ei(e))return NaN;let o=0,c=0;return r[2]<e[0]&&(o=e[0]-r[2]),r[0]>e[2]&&(o=r[0]-e[2]),r[1]>e[3]&&(c=r[1]-e[3]),r[3]<e[1]&&(c=e[1]-r[3]),n.distance([0,0],[o,c])}function Wt(r,e,n){const o=n.pointOnLine(e,r);return n.distance(r,o.point)}function co(r,e,n,o,c){const f=Math.min(Wt(r,[n,o],c),Wt(e,[n,o],c)),g=Math.min(Wt(n,[r,e],c),Wt(o,[r,e],c));return Math.min(f,g)}function qr(r,e,n,o,c){if(!ls(e,r.length)||!ls(o,n.length))return 1/0;let f=1/0;for(let g=e[0];g<e[1];++g){const y=r[g],x=r[g+1];for(let k=o[0];k<o[1];++k){const E=n[k],P=n[k+1];if(Zo(y,x,E,P))return 0;f=Math.min(f,co(y,x,E,P,c))}}return f}function Gr(r,e,n,o,c){if(!ls(e,r.length)||!ls(o,n.length))return NaN;let f=1/0;for(let g=e[0];g<=e[1];++g)for(let y=o[0];y<=o[1];++y)if(f=Math.min(f,c.distance(r[g],n[y])),f===0)return f;return f}function Cs(r,e,n){if(Ea(r,e,!0))return 0;let o=1/0;for(const c of e){const f=c[0],g=c[c.length-1];if(f!==g&&(o=Math.min(o,Wt(r,[g,f],n)),o===0))return o;const y=n.pointOnLine(c,r);if(o=Math.min(o,n.distance(r,y.point)),o===0)return o}return o}function du(r,e,n,o){if(!ls(e,r.length))return NaN;for(let f=e[0];f<=e[1];++f)if(Ea(r[f],n,!0))return 0;let c=1/0;for(let f=e[0];f<e[1];++f){const g=r[f],y=r[f+1];for(const x of n)for(let k=0,E=x.length,P=E-1;k<E;P=k++){const L=x[P],F=x[k];if(Zo(g,y,L,F))return 0;c=Math.min(c,co(g,y,L,F,o))}}return c}function dc(r,e){for(const n of r)for(const o of n)if(Ea(o,e,!0))return!0;return!1}function Th(r,e,n,o=1/0){const c=lo(r),f=lo(e);if(o!==1/0&&hc(c,f,n)>=o)return o;if(Ia(c,f)){if(dc(r,e))return 0}else if(dc(e,r))return 0;let g=1/0;for(const y of r)for(let x=0,k=y.length,E=k-1;x<k;E=x++){const P=y[E],L=y[x];for(const F of e)for(let $=0,U=F.length,W=U-1;$<U;W=$++){const re=F[W],we=F[$];if(Zo(P,L,re,we))return 0;g=Math.min(g,co(P,L,re,we,n))}}return g}function pu(r,e,n,o,c,f){if(!f)return;const g=hc(Da(o,f),c,n);g<e&&r.push([g,f,[0,0]])}function Xo(r,e,n,o,c,f,g){if(!f||!g)return;const y=hc(Da(o,f),Da(c,g),n);y<e&&r.push([y,f,g])}function Ko(r,e,n,o,c=1/0){let f=Math.min(o.distance(r[0],n[0][0]),c);if(f===0)return f;const g=new ou([[0,[0,r.length-1],[0,0]]],hu),y=lo(n);for(;g.length>0;){const x=g.pop();if(x[0]>=f)continue;const k=x[1],E=e?50:100;if(Aa(k)<=E){if(!ls(k,r.length))return NaN;if(e){const P=du(r,k,n,o);if(isNaN(P)||P===0)return P;f=Math.min(f,P)}else for(let P=k[0];P<=k[1];++P){const L=Cs(r[P],n,o);if(f=Math.min(f,L),f===0)return 0}}else{const P=Wo(k,e);pu(g,f,o,r,y,P[0]),pu(g,f,o,r,y,P[1])}}return f}function uo(r,e,n,o,c,f=1/0){let g=Math.min(f,c.distance(r[0],n[0]));if(g===0)return g;const y=new ou([[0,[0,r.length-1],[0,n.length-1]]],hu);for(;y.length>0;){const x=y.pop();if(x[0]>=g)continue;const k=x[1],E=x[2],P=e?50:100,L=o?50:100;if(Aa(k)<=P&&Aa(E)<=L){if(!ls(k,r.length)&&ls(E,n.length))return NaN;let F;if(e&&o)F=qr(r,k,n,E,c),g=Math.min(g,F);else if(e&&!o){const $=r.slice(k[0],k[1]+1);for(let U=E[0];U<=E[1];++U)if(F=Wt(n[U],$,c),g=Math.min(g,F),g===0)return g}else if(!e&&o){const $=n.slice(E[0],E[1]+1);for(let U=k[0];U<=k[1];++U)if(F=Wt(r[U],$,c),g=Math.min(g,F),g===0)return g}else F=Gr(r,k,n,E,c),g=Math.min(g,F)}else{const F=Wo(k,e),$=Wo(E,o);Xo(y,g,c,r,n,F[0],$[0]),Xo(y,g,c,r,n,F[0],$[1]),Xo(y,g,c,r,n,F[1],$[0]),Xo(y,g,c,r,n,F[1],$[1])}}return g}function Jo(r){return r.type==="MultiPolygon"?r.coordinates.map(e=>({type:"Polygon",coordinates:e})):r.type==="MultiLineString"?r.coordinates.map(e=>({type:"LineString",coordinates:e})):r.type==="MultiPoint"?r.coordinates.map(e=>({type:"Point",coordinates:e})):[r]}class Is{constructor(e,n){this.type=Xe,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'distance' expression requires exactly one argument, but found ${e.length-1} instead.`);if(ln(e[1])){const o=e[1];if(o.type==="FeatureCollection")return new Is(o,o.features.map(c=>Jo(c.geometry)).flat());if(o.type==="Feature")return new Is(o,Jo(o.geometry));if("type"in o&&"coordinates"in o)return new Is(o,Jo(o))}return n.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(n,o){const c=n.geometry(),f=c.flat().map(x=>ac([x.x,x.y],n.canonical));if(c.length===0)return NaN;const g=new uc(f[0][1]);let y=1/0;for(const x of o){switch(x.type){case"Point":y=Math.min(y,uo(f,!1,[x.coordinates],!1,g,y));break;case"LineString":y=Math.min(y,uo(f,!1,x.coordinates,!0,g,y));break;case"Polygon":y=Math.min(y,Ko(f,!1,x.coordinates,g,y))}if(y===0)return y}return y}(e,this.geometries);if(e.geometryType()==="LineString")return function(n,o){const c=n.geometry(),f=c.flat().map(x=>ac([x.x,x.y],n.canonical));if(c.length===0)return NaN;const g=new uc(f[0][1]);let y=1/0;for(const x of o){switch(x.type){case"Point":y=Math.min(y,uo(f,!0,[x.coordinates],!1,g,y));break;case"LineString":y=Math.min(y,uo(f,!0,x.coordinates,!0,g,y));break;case"Polygon":y=Math.min(y,Ko(f,!0,x.coordinates,g,y))}if(y===0)return y}return y}(e,this.geometries);if(e.geometryType()==="Polygon")return function(n,o){const c=n.geometry();if(c.length===0||c[0].length===0)return NaN;const f=Ho(c,0).map(x=>x.map(k=>k.map(E=>ac([E.x,E.y],n.canonical)))),g=new uc(f[0][0][0][1]);let y=1/0;for(const x of o)for(const k of f){switch(x.type){case"Point":y=Math.min(y,Ko([x.coordinates],!1,k,g,y));break;case"LineString":y=Math.min(y,Ko(x.coordinates,!0,k,g,y));break;case"Polygon":y=Math.min(y,Th(k,x.coordinates,g,y))}if(y===0)return y}return y}(e,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const Es={"==":nc,"!=":qo,">":tu,"<":eu,">=":gh,"<=":Ma,array:En,at:ec,boolean:En,case:jo,coalesce:os,collator:Go,format:ka,image:oo,in:$o,"index-of":io,interpolate:gn,"interpolate-hcl":gn,"interpolate-lab":gn,length:Ta,let:ro,literal:Hs,match:tc,number:En,"number-format":sc,object:En,slice:no,step:so,string:En,"to-boolean":Wn,"to-color":Wn,"to-number":Wn,"to-string":Wn,var:Xs,within:Js,distance:Is};class Ki{constructor(e,n,o,c){this.name=e,this.type=n,this._evaluate=o,this.args=c}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,n){const o=e[0],c=Ki.definitions[o];if(!c)return n.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const f=Array.isArray(c)?c[0]:c.type,g=Array.isArray(c)?[[c[1],c[2]]]:c.overloads,y=g.filter(([k])=>!Array.isArray(k)||k.length===e.length-1);let x=null;for(const[k,E]of y){x=new br(n.registry,ho,n.path,null,n.scope);const P=[];let L=!1;for(let F=1;F<e.length;F++){const $=e[F],U=Array.isArray(k)?k[F-1]:k.type,W=x.parse($,1+P.length,U);if(!W){L=!0;break}P.push(W)}if(!L)if(Array.isArray(k)&&k.length!==P.length)x.error(`Expected ${k.length} arguments, but found ${P.length} instead.`);else{for(let F=0;F<P.length;F++){const $=Array.isArray(k)?k[F]:k.type,U=P[F];x.concat(F+1).checkSubtype($,U.type)}if(x.errors.length===0)return new Ki(o,f,E,P)}}if(y.length===1)n.errors.push(...x.errors);else{const k=(y.length?y:g).map(([P])=>{return L=P,Array.isArray(L)?`(${L.map(j).join(", ")})`:`(${j(L.type)}...)`;var L}).join(" | "),E=[];for(let P=1;P<e.length;P++){const L=n.parse(e[P],1+E.length);if(!L)return null;E.push(j(L.type))}n.error(`Expected arguments of type ${k}, but found (${E.join(", ")}) instead.`)}return null}static register(e,n){Ki.definitions=n;for(const o in n)e[o]=Ki}}function fu(r,[e,n,o,c]){e=e.evaluate(r),n=n.evaluate(r),o=o.evaluate(r);const f=c?c.evaluate(r):1,g=No(e,n,o,f);if(g)throw new ri(g);return new Pr(e/255,n/255,o/255,f,!1)}function mu(r,e){return r in e}function pc(r,e){const n=e[r];return n===void 0?null:n}function cs(r){return{type:r}}function ho(r){if(r instanceof Xs)return ho(r.boundExpression);if(r instanceof Ki&&r.name==="error"||r instanceof Go||r instanceof Js||r instanceof Is)return!1;const e=r instanceof Wn||r instanceof En;let n=!0;return r.eachChild(o=>{n=e?n&&ho(o):n&&o instanceof Hs}),!!n&&po(r)&&fo(r,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function po(r){if(r instanceof Ki&&(r.name==="get"&&r.args.length===1||r.name==="feature-state"||r.name==="has"&&r.args.length===1||r.name==="properties"||r.name==="geometry-type"||r.name==="id"||/^filter-/.test(r.name))||r instanceof Js||r instanceof Is)return!1;let e=!0;return r.eachChild(n=>{e&&!po(n)&&(e=!1)}),e}function za(r){if(r instanceof Ki&&r.name==="feature-state")return!1;let e=!0;return r.eachChild(n=>{e&&!za(n)&&(e=!1)}),e}function fo(r,e){if(r instanceof Ki&&e.indexOf(r.name)>=0)return!1;let n=!0;return r.eachChild(o=>{n&&!fo(o,e)&&(n=!1)}),n}function La(r){return{result:"success",value:r}}function Ys(r){return{result:"error",value:r}}function Xn(r){return r["property-type"]==="data-driven"||r["property-type"]==="cross-faded-data-driven"}function gu(r){return!!r.expression&&r.expression.parameters.indexOf("zoom")>-1}function Yo(r){return!!r.expression&&r.expression.interpolated}function yr(r){return r instanceof Number?"number":r instanceof String?"string":r instanceof Boolean?"boolean":Array.isArray(r)?"array":r===null?"null":typeof r}function Ra(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)}function Qo(r){return r}function Qs(r,e){const n=e.type==="color",o=r.stops&&typeof r.stops[0][0]=="object",c=o||!(o||r.property!==void 0),f=r.type||(Yo(e)?"exponential":"interval");if(n||e.type==="padding"){const E=n?Pr.parse:on.parse;(r=Kr({},r)).stops&&(r.stops=r.stops.map(P=>[P[0],E(P[1])])),r.default=E(r.default?r.default:e.default)}if(r.colorSpace&&(g=r.colorSpace)!=="rgb"&&g!=="hcl"&&g!=="lab")throw new Error(`Unknown color space: "${r.colorSpace}"`);var g;let y,x,k;if(f==="exponential")y=fc;else if(f==="interval")y=_u;else if(f==="categorical"){y=mo,x=Object.create(null);for(const E of r.stops)x[E[0]]=E[1];k=typeof r.stops[0][0]}else{if(f!=="identity")throw new Error(`Unknown function type "${f}"`);y=Fa}if(o){const E={},P=[];for(let $=0;$<r.stops.length;$++){const U=r.stops[$],W=U[0].zoom;E[W]===void 0&&(E[W]={zoom:W,type:r.type,property:r.property,default:r.default,stops:[]},P.push(W)),E[W].stops.push([U[0].value,U[1]])}const L=[];for(const $ of P)L.push([E[$].zoom,Qs(E[$],e)]);const F={name:"linear"};return{kind:"composite",interpolationType:F,interpolationFactor:gn.interpolationFactor.bind(void 0,F),zoomStops:L.map($=>$[0]),evaluate:({zoom:$},U)=>fc({stops:L,base:r.base},e,$).evaluate($,U)}}if(c){const E=f==="exponential"?{name:"exponential",base:r.base!==void 0?r.base:1}:null;return{kind:"camera",interpolationType:E,interpolationFactor:gn.interpolationFactor.bind(void 0,E),zoomStops:r.stops.map(P=>P[0]),evaluate:({zoom:P})=>y(r,e,P,x,k)}}return{kind:"source",evaluate(E,P){const L=P&&P.properties?P.properties[r.property]:void 0;return L===void 0?us(r.default,e.default):y(r,e,L,x,k)}}}function us(r,e,n){return r!==void 0?r:e!==void 0?e:n!==void 0?n:void 0}function mo(r,e,n,o,c){return us(typeof n===c?o[n]:void 0,r.default,e.default)}function _u(r,e,n){if(yr(n)!=="number")return us(r.default,e.default);const o=r.stops.length;if(o===1||n<=r.stops[0][0])return r.stops[0][1];if(n>=r.stops[o-1][0])return r.stops[o-1][1];const c=Vo(r.stops.map(f=>f[0]),n);return r.stops[c][1]}function fc(r,e,n){const o=r.base!==void 0?r.base:1;if(yr(n)!=="number")return us(r.default,e.default);const c=r.stops.length;if(c===1||n<=r.stops[0][0])return r.stops[0][1];if(n>=r.stops[c-1][0])return r.stops[c-1][1];const f=Vo(r.stops.map(E=>E[0]),n),g=function(E,P,L,F){const $=F-L,U=E-L;return $===0?0:P===1?U/$:(Math.pow(P,U)-1)/(Math.pow(P,$)-1)}(n,o,r.stops[f][0],r.stops[f+1][0]),y=r.stops[f][1],x=r.stops[f+1][1],k=Ni[e.type]||Qo;return typeof y.evaluate=="function"?{evaluate(...E){const P=y.evaluate.apply(void 0,E),L=x.evaluate.apply(void 0,E);if(P!==void 0&&L!==void 0)return k(P,L,g,r.colorSpace)}}:k(y,x,g,r.colorSpace)}function Fa(r,e,n){switch(e.type){case"color":n=Pr.parse(n);break;case"formatted":n=mn.fromString(n.toString());break;case"resolvedImage":n=Pi.fromString(n.toString());break;case"padding":n=on.parse(n);break;default:yr(n)===e.type||e.type==="enum"&&e.values[n]||(n=void 0)}return us(n,r.default,e.default)}Ki.register(Es,{error:[{kind:"error"},[Rt],(r,[e])=>{throw new ri(e.evaluate(r))}],typeof:[Rt,[Ut],(r,[e])=>j(hi(e.evaluate(r)))],"to-rgba":[B(Xe,4),[mi],(r,[e])=>{const[n,o,c,f]=e.evaluate(r).rgb;return[255*n,255*o,255*c,f]}],rgb:[mi,[Xe,Xe,Xe],fu],rgba:[mi,[Xe,Xe,Xe,Xe],fu],has:{type:Nt,overloads:[[[Rt],(r,[e])=>mu(e.evaluate(r),r.properties())],[[Rt,Bi],(r,[e,n])=>mu(e.evaluate(r),n.evaluate(r))]]},get:{type:Ut,overloads:[[[Rt],(r,[e])=>pc(e.evaluate(r),r.properties())],[[Rt,Bi],(r,[e,n])=>pc(e.evaluate(r),n.evaluate(r))]]},"feature-state":[Ut,[Rt],(r,[e])=>pc(e.evaluate(r),r.featureState||{})],properties:[Bi,[],r=>r.properties()],"geometry-type":[Rt,[],r=>r.geometryType()],id:[Ut,[],r=>r.id()],zoom:[Xe,[],r=>r.globals.zoom],"heatmap-density":[Xe,[],r=>r.globals.heatmapDensity||0],"line-progress":[Xe,[],r=>r.globals.lineProgress||0],accumulated:[Ut,[],r=>r.globals.accumulated===void 0?null:r.globals.accumulated],"+":[Xe,cs(Xe),(r,e)=>{let n=0;for(const o of e)n+=o.evaluate(r);return n}],"*":[Xe,cs(Xe),(r,e)=>{let n=1;for(const o of e)n*=o.evaluate(r);return n}],"-":{type:Xe,overloads:[[[Xe,Xe],(r,[e,n])=>e.evaluate(r)-n.evaluate(r)],[[Xe],(r,[e])=>-e.evaluate(r)]]},"/":[Xe,[Xe,Xe],(r,[e,n])=>e.evaluate(r)/n.evaluate(r)],"%":[Xe,[Xe,Xe],(r,[e,n])=>e.evaluate(r)%n.evaluate(r)],ln2:[Xe,[],()=>Math.LN2],pi:[Xe,[],()=>Math.PI],e:[Xe,[],()=>Math.E],"^":[Xe,[Xe,Xe],(r,[e,n])=>Math.pow(e.evaluate(r),n.evaluate(r))],sqrt:[Xe,[Xe],(r,[e])=>Math.sqrt(e.evaluate(r))],log10:[Xe,[Xe],(r,[e])=>Math.log(e.evaluate(r))/Math.LN10],ln:[Xe,[Xe],(r,[e])=>Math.log(e.evaluate(r))],log2:[Xe,[Xe],(r,[e])=>Math.log(e.evaluate(r))/Math.LN2],sin:[Xe,[Xe],(r,[e])=>Math.sin(e.evaluate(r))],cos:[Xe,[Xe],(r,[e])=>Math.cos(e.evaluate(r))],tan:[Xe,[Xe],(r,[e])=>Math.tan(e.evaluate(r))],asin:[Xe,[Xe],(r,[e])=>Math.asin(e.evaluate(r))],acos:[Xe,[Xe],(r,[e])=>Math.acos(e.evaluate(r))],atan:[Xe,[Xe],(r,[e])=>Math.atan(e.evaluate(r))],min:[Xe,cs(Xe),(r,e)=>Math.min(...e.map(n=>n.evaluate(r)))],max:[Xe,cs(Xe),(r,e)=>Math.max(...e.map(n=>n.evaluate(r)))],abs:[Xe,[Xe],(r,[e])=>Math.abs(e.evaluate(r))],round:[Xe,[Xe],(r,[e])=>{const n=e.evaluate(r);return n<0?-Math.round(-n):Math.round(n)}],floor:[Xe,[Xe],(r,[e])=>Math.floor(e.evaluate(r))],ceil:[Xe,[Xe],(r,[e])=>Math.ceil(e.evaluate(r))],"filter-==":[Nt,[Rt,Ut],(r,[e,n])=>r.properties()[e.value]===n.value],"filter-id-==":[Nt,[Ut],(r,[e])=>r.id()===e.value],"filter-type-==":[Nt,[Rt],(r,[e])=>r.geometryType()===e.value],"filter-<":[Nt,[Rt,Ut],(r,[e,n])=>{const o=r.properties()[e.value],c=n.value;return typeof o==typeof c&&o<c}],"filter-id-<":[Nt,[Ut],(r,[e])=>{const n=r.id(),o=e.value;return typeof n==typeof o&&n<o}],"filter->":[Nt,[Rt,Ut],(r,[e,n])=>{const o=r.properties()[e.value],c=n.value;return typeof o==typeof c&&o>c}],"filter-id->":[Nt,[Ut],(r,[e])=>{const n=r.id(),o=e.value;return typeof n==typeof o&&n>o}],"filter-<=":[Nt,[Rt,Ut],(r,[e,n])=>{const o=r.properties()[e.value],c=n.value;return typeof o==typeof c&&o<=c}],"filter-id-<=":[Nt,[Ut],(r,[e])=>{const n=r.id(),o=e.value;return typeof n==typeof o&&n<=o}],"filter->=":[Nt,[Rt,Ut],(r,[e,n])=>{const o=r.properties()[e.value],c=n.value;return typeof o==typeof c&&o>=c}],"filter-id->=":[Nt,[Ut],(r,[e])=>{const n=r.id(),o=e.value;return typeof n==typeof o&&n>=o}],"filter-has":[Nt,[Ut],(r,[e])=>e.value in r.properties()],"filter-has-id":[Nt,[],r=>r.id()!==null&&r.id()!==void 0],"filter-type-in":[Nt,[B(Rt)],(r,[e])=>e.value.indexOf(r.geometryType())>=0],"filter-id-in":[Nt,[B(Ut)],(r,[e])=>e.value.indexOf(r.id())>=0],"filter-in-small":[Nt,[Rt,B(Ut)],(r,[e,n])=>n.value.indexOf(r.properties()[e.value])>=0],"filter-in-large":[Nt,[Rt,B(Ut)],(r,[e,n])=>function(o,c,f,g){for(;f<=g;){const y=f+g>>1;if(c[y]===o)return!0;c[y]>o?g=y-1:f=y+1}return!1}(r.properties()[e.value],n.value,0,n.value.length-1)],all:{type:Nt,overloads:[[[Nt,Nt],(r,[e,n])=>e.evaluate(r)&&n.evaluate(r)],[cs(Nt),(r,e)=>{for(const n of e)if(!n.evaluate(r))return!1;return!0}]]},any:{type:Nt,overloads:[[[Nt,Nt],(r,[e,n])=>e.evaluate(r)||n.evaluate(r)],[cs(Nt),(r,e)=>{for(const n of e)if(n.evaluate(r))return!0;return!1}]]},"!":[Nt,[Nt],(r,[e])=>!e.evaluate(r)],"is-supported-script":[Nt,[Rt],(r,[e])=>{const n=r.globals&&r.globals.isSupportedScript;return!n||n(e.evaluate(r))}],upcase:[Rt,[Rt],(r,[e])=>e.evaluate(r).toUpperCase()],downcase:[Rt,[Rt],(r,[e])=>e.evaluate(r).toLowerCase()],concat:[Rt,cs(Ut),(r,e)=>e.map(n=>eo(n.evaluate(r))).join("")],"resolved-locale":[Rt,[ss],(r,[e])=>e.evaluate(r).resolvedLocale()]});class mc{constructor(e,n){var o;this.expression=e,this._warningHistory={},this._evaluator=new ba,this._defaultValue=n?(o=n).type==="color"&&Ra(o.default)?new Pr(0,0,0,0):o.type==="color"?Pr.parse(o.default)||null:o.type==="padding"?on.parse(o.default)||null:o.type==="variableAnchorOffsetCollection"?Oi.parse(o.default)||null:o.default===void 0?null:o.default:null,this._enumValues=n&&n.type==="enum"?n.values:null}evaluateWithoutErrorHandling(e,n,o,c,f,g){return this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=o,this._evaluator.canonical=c,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=g,this.expression.evaluate(this._evaluator)}evaluate(e,n,o,c,f,g){this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=o||null,this._evaluator.canonical=c,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=g||null;try{const y=this.expression.evaluate(this._evaluator);if(y==null||typeof y=="number"&&y!=y)return this._defaultValue;if(this._enumValues&&!(y in this._enumValues))throw new ri(`Expected value to be one of ${Object.keys(this._enumValues).map(x=>JSON.stringify(x)).join(", ")}, but found ${JSON.stringify(y)} instead.`);return y}catch(y){return this._warningHistory[y.message]||(this._warningHistory[y.message]=!0,typeof console<"u"&&console.warn(y.message)),this._defaultValue}}}function el(r){return Array.isArray(r)&&r.length>0&&typeof r[0]=="string"&&r[0]in Es}function tl(r,e){const n=new br(Es,ho,[],e?function(c){const f={color:mi,string:Rt,number:Xe,enum:Rt,boolean:Nt,formatted:as,padding:Si,resolvedImage:X,variableAnchorOffsetCollection:R};return c.type==="array"?B(f[c.value]||Ut,c.length):f[c.type]}(e):void 0),o=n.parse(r,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return o?La(new mc(o,e)):Ys(n.errors)}class rl{constructor(e,n){this.kind=e,this._styleExpression=n,this.isStateDependent=e!=="constant"&&!za(n.expression)}evaluateWithoutErrorHandling(e,n,o,c,f,g){return this._styleExpression.evaluateWithoutErrorHandling(e,n,o,c,f,g)}evaluate(e,n,o,c,f,g){return this._styleExpression.evaluate(e,n,o,c,f,g)}}class go{constructor(e,n,o,c){this.kind=e,this.zoomStops=o,this._styleExpression=n,this.isStateDependent=e!=="camera"&&!za(n.expression),this.interpolationType=c}evaluateWithoutErrorHandling(e,n,o,c,f,g){return this._styleExpression.evaluateWithoutErrorHandling(e,n,o,c,f,g)}evaluate(e,n,o,c,f,g){return this._styleExpression.evaluate(e,n,o,c,f,g)}interpolationFactor(e,n,o){return this.interpolationType?gn.interpolationFactor(this.interpolationType,e,n,o):0}}function _o(r,e){const n=tl(r,e);if(n.result==="error")return n;const o=n.value.expression,c=po(o);if(!c&&!Xn(e))return Ys([new Jr("","data expressions not supported")]);const f=fo(o,["zoom"]);if(!f&&!gu(e))return Ys([new Jr("","zoom expressions not supported")]);const g=$i(o);return g||f?g instanceof Jr?Ys([g]):g instanceof gn&&!Yo(e)?Ys([new Jr("",'"interpolate" expressions cannot be used with this property')]):La(g?new go(c?"camera":"composite",n.value,g.labels,g instanceof gn?g.interpolation:void 0):new rl(c?"constant":"source",n.value)):Ys([new Jr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Kn{constructor(e,n){this._parameters=e,this._specification=n,Kr(this,Qs(this._parameters,this._specification))}static deserialize(e){return new Kn(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function $i(r){let e=null;if(r instanceof ro)e=$i(r.result);else if(r instanceof os){for(const n of r.args)if(e=$i(n),e)break}else(r instanceof so||r instanceof gn)&&r.input instanceof Ki&&r.input.name==="zoom"&&(e=r);return e instanceof Jr||r.eachChild(n=>{const o=$i(n);o instanceof Jr?e=o:!e&&o?e=new Jr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&o&&e!==o&&(e=new Jr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function ea(r){if(r===!0||r===!1)return!0;if(!Array.isArray(r)||r.length===0)return!1;switch(r[0]){case"has":return r.length>=2&&r[1]!=="$id"&&r[1]!=="$type";case"in":return r.length>=3&&(typeof r[1]!="string"||Array.isArray(r[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return r.length!==3||Array.isArray(r[1])||Array.isArray(r[2]);case"any":case"all":for(const e of r.slice(1))if(!ea(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const gc={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function yo(r){if(r==null)return{filter:()=>!0,needGeometry:!1};ea(r)||(r=vo(r));const e=tl(r,gc);if(e.result==="error")throw new Error(e.value.map(n=>`${n.key}: ${n.message}`).join(", "));return{filter:(n,o,c)=>e.value.evaluate(n,o,{},c),needGeometry:Ba(r)}}function Ch(r,e){return r<e?-1:r>e?1:0}function Ba(r){if(!Array.isArray(r))return!1;if(r[0]==="within"||r[0]==="distance")return!0;for(let e=1;e<r.length;e++)if(Ba(r[e]))return!0;return!1}function vo(r){if(!r)return!0;const e=r[0];return r.length<=1?e!=="any":e==="=="?Oa(r[1],r[2],"=="):e==="!="?nl(Oa(r[1],r[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Oa(r[1],r[2],e):e==="any"?(n=r.slice(1),["any"].concat(n.map(vo))):e==="all"?["all"].concat(r.slice(1).map(vo)):e==="none"?["all"].concat(r.slice(1).map(vo).map(nl)):e==="in"?_c(r[1],r.slice(2)):e==="!in"?nl(_c(r[1],r.slice(2))):e==="has"?il(r[1]):e!=="!has"||nl(il(r[1]));var n}function Oa(r,e,n){switch(r){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,r,e]}}function _c(r,e){if(e.length===0)return!1;switch(r){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(n=>typeof n!=typeof e[0])?["filter-in-large",r,["literal",e.sort(Ch)]]:["filter-in-small",r,["literal",e]]}}function il(r){switch(r){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",r]}}function nl(r){return["!",r]}function ta(r){const e=typeof r;if(e==="number"||e==="boolean"||e==="string"||r==null)return JSON.stringify(r);if(Array.isArray(r)){let c="[";for(const f of r)c+=`${ta(f)},`;return`${c}]`}const n=Object.keys(r).sort();let o="{";for(let c=0;c<n.length;c++)o+=`${JSON.stringify(n[c])}:${ta(r[n[c]])},`;return`${o}}`}function Ih(r){let e="";for(const n of ai)e+=`/${ta(r[n])}`;return e}function sl(r){const e=r.value;return e?[new Je(r.key,e,"constants have been deprecated as of v8")]:[]}function ti(r){return r instanceof Number||r instanceof String||r instanceof Boolean?r.valueOf():r}function hs(r){if(Array.isArray(r))return r.map(hs);if(r instanceof Object&&!(r instanceof Number||r instanceof String||r instanceof Boolean)){const e={};for(const n in r)e[n]=hs(r[n]);return e}return ti(r)}function yn(r){const e=r.key,n=r.value,o=r.valueSpec||{},c=r.objectElementValidators||{},f=r.style,g=r.styleSpec,y=r.validateSpec;let x=[];const k=yr(n);if(k!=="object")return[new Je(e,n,`object expected, ${k} found`)];for(const E in n){const P=E.split(".")[0],L=o[P]||o["*"];let F;if(c[P])F=c[P];else if(o[P])F=y;else if(c["*"])F=c["*"];else{if(!o["*"]){x.push(new Je(e,n[E],`unknown property "${E}"`));continue}F=y}x=x.concat(F({key:(e&&`${e}.`)+E,value:n[E],valueSpec:L,style:f,styleSpec:g,object:n,objectKey:E,validateSpec:y},n))}for(const E in o)c[E]||o[E].required&&o[E].default===void 0&&n[E]===void 0&&x.push(new Je(e,n,`missing required property "${E}"`));return x}function al(r){const e=r.value,n=r.valueSpec,o=r.style,c=r.styleSpec,f=r.key,g=r.arrayElementValidator||r.validateSpec;if(yr(e)!=="array")return[new Je(f,e,`array expected, ${yr(e)} found`)];if(n.length&&e.length!==n.length)return[new Je(f,e,`array length ${n.length} expected, length ${e.length} found`)];if(n["min-length"]&&e.length<n["min-length"])return[new Je(f,e,`array length at least ${n["min-length"]} expected, length ${e.length} found`)];let y={type:n.value,values:n.values};c.$version<7&&(y.function=n.function),yr(n.value)==="object"&&(y=n.value);let x=[];for(let k=0;k<e.length;k++)x=x.concat(g({array:e,arrayIndex:k,value:e[k],valueSpec:y,validateSpec:r.validateSpec,style:o,styleSpec:c,key:`${f}[${k}]`}));return x}function yc(r){const e=r.key,n=r.value,o=r.valueSpec;let c=yr(n);return c==="number"&&n!=n&&(c="NaN"),c!=="number"?[new Je(e,n,`number expected, ${c} found`)]:"minimum"in o&&n<o.minimum?[new Je(e,n,`${n} is less than the minimum value ${o.minimum}`)]:"maximum"in o&&n>o.maximum?[new Je(e,n,`${n} is greater than the maximum value ${o.maximum}`)]:[]}function ol(r){const e=r.valueSpec,n=ti(r.value.type);let o,c,f,g={};const y=n!=="categorical"&&r.value.property===void 0,x=!y,k=yr(r.value.stops)==="array"&&yr(r.value.stops[0])==="array"&&yr(r.value.stops[0][0])==="object",E=yn({key:r.key,value:r.value,valueSpec:r.styleSpec.function,validateSpec:r.validateSpec,style:r.style,styleSpec:r.styleSpec,objectElementValidators:{stops:function(F){if(n==="identity")return[new Je(F.key,F.value,'identity function may not have a "stops" property')];let $=[];const U=F.value;return $=$.concat(al({key:F.key,value:U,valueSpec:F.valueSpec,validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec,arrayElementValidator:P})),yr(U)==="array"&&U.length===0&&$.push(new Je(F.key,U,"array must have at least one stop")),$},default:function(F){return F.validateSpec({key:F.key,value:F.value,valueSpec:e,validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec})}}});return n==="identity"&&y&&E.push(new Je(r.key,r.value,'missing required property "property"')),n==="identity"||r.value.stops||E.push(new Je(r.key,r.value,'missing required property "stops"')),n==="exponential"&&r.valueSpec.expression&&!Yo(r.valueSpec)&&E.push(new Je(r.key,r.value,"exponential functions not supported")),r.styleSpec.$version>=8&&(x&&!Xn(r.valueSpec)?E.push(new Je(r.key,r.value,"property functions not supported")):y&&!gu(r.valueSpec)&&E.push(new Je(r.key,r.value,"zoom functions not supported"))),n!=="categorical"&&!k||r.value.property!==void 0||E.push(new Je(r.key,r.value,'"property" property is required')),E;function P(F){let $=[];const U=F.value,W=F.key;if(yr(U)!=="array")return[new Je(W,U,`array expected, ${yr(U)} found`)];if(U.length!==2)return[new Je(W,U,`array length 2 expected, length ${U.length} found`)];if(k){if(yr(U[0])!=="object")return[new Je(W,U,`object expected, ${yr(U[0])} found`)];if(U[0].zoom===void 0)return[new Je(W,U,"object stop key must have zoom")];if(U[0].value===void 0)return[new Je(W,U,"object stop key must have value")];if(f&&f>ti(U[0].zoom))return[new Je(W,U[0].zoom,"stop zoom values must appear in ascending order")];ti(U[0].zoom)!==f&&(f=ti(U[0].zoom),c=void 0,g={}),$=$.concat(yn({key:`${W}[0]`,value:U[0],valueSpec:{zoom:{}},validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec,objectElementValidators:{zoom:yc,value:L}}))}else $=$.concat(L({key:`${W}[0]`,value:U[0],valueSpec:{},validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec},U));return el(hs(U[1]))?$.concat([new Je(`${W}[1]`,U[1],"expressions are not allowed in function stops.")]):$.concat(F.validateSpec({key:`${W}[1]`,value:U[1],valueSpec:e,validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec}))}function L(F,$){const U=yr(F.value),W=ti(F.value),re=F.value!==null?F.value:$;if(o){if(U!==o)return[new Je(F.key,re,`${U} stop domain type must match previous stop domain type ${o}`)]}else o=U;if(U!=="number"&&U!=="string"&&U!=="boolean")return[new Je(F.key,re,"stop domain value must be a number, string, or boolean")];if(U!=="number"&&n!=="categorical"){let we=`number expected, ${U} found`;return Xn(e)&&n===void 0&&(we+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Je(F.key,re,we)]}return n!=="categorical"||U!=="number"||isFinite(W)&&Math.floor(W)===W?n!=="categorical"&&U==="number"&&c!==void 0&&W<c?[new Je(F.key,re,"stop domain values must appear in ascending order")]:(c=W,n==="categorical"&&W in g?[new Je(F.key,re,"stop domain values must be unique")]:(g[W]=!0,[])):[new Je(F.key,re,`integer expected, found ${W}`)]}}function ds(r){const e=(r.expressionContext==="property"?_o:tl)(hs(r.value),r.valueSpec);if(e.result==="error")return e.value.map(o=>new Je(`${r.key}${o.key}`,r.value,o.message));const n=e.value.expression||e.value._styleExpression.expression;if(r.expressionContext==="property"&&r.propertyKey==="text-font"&&!n.outputDefined())return[new Je(r.key,r.value,`Invalid data expression for "${r.propertyKey}". Output values must be contained as literals within the expression.`)];if(r.expressionContext==="property"&&r.propertyType==="layout"&&!za(n))return[new Je(r.key,r.value,'"feature-state" data expressions are not supported with layout properties.')];if(r.expressionContext==="filter"&&!za(n))return[new Je(r.key,r.value,'"feature-state" data expressions are not supported with filters.')];if(r.expressionContext&&r.expressionContext.indexOf("cluster")===0){if(!fo(n,["zoom","feature-state"]))return[new Je(r.key,r.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(r.expressionContext==="cluster-initial"&&!po(n))return[new Je(r.key,r.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Na(r){const e=r.key,n=r.value,o=r.valueSpec,c=[];return Array.isArray(o.values)?o.values.indexOf(ti(n))===-1&&c.push(new Je(e,n,`expected one of [${o.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(o.values).indexOf(ti(n))===-1&&c.push(new Je(e,n,`expected one of [${Object.keys(o.values).join(", ")}], ${JSON.stringify(n)} found`)),c}function ll(r){return ea(hs(r.value))?ds(Kr({},r,{expressionContext:"filter",valueSpec:{value:"boolean"}})):cl(r)}function cl(r){const e=r.value,n=r.key;if(yr(e)!=="array")return[new Je(n,e,`array expected, ${yr(e)} found`)];const o=r.styleSpec;let c,f=[];if(e.length<1)return[new Je(n,e,"filter array must have at least 1 element")];switch(f=f.concat(Na({key:`${n}[0]`,value:e[0],valueSpec:o.filter_operator,style:r.style,styleSpec:r.styleSpec})),ti(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&ti(e[1])==="$type"&&f.push(new Je(n,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&f.push(new Je(n,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(c=yr(e[1]),c!=="string"&&f.push(new Je(`${n}[1]`,e[1],`string expected, ${c} found`)));for(let g=2;g<e.length;g++)c=yr(e[g]),ti(e[1])==="$type"?f=f.concat(Na({key:`${n}[${g}]`,value:e[g],valueSpec:o.geometry_type,style:r.style,styleSpec:r.styleSpec})):c!=="string"&&c!=="number"&&c!=="boolean"&&f.push(new Je(`${n}[${g}]`,e[g],`string, number, or boolean expected, ${c} found`));break;case"any":case"all":case"none":for(let g=1;g<e.length;g++)f=f.concat(cl({key:`${n}[${g}]`,value:e[g],style:r.style,styleSpec:r.styleSpec}));break;case"has":case"!has":c=yr(e[1]),e.length!==2?f.push(new Je(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):c!=="string"&&f.push(new Je(`${n}[1]`,e[1],`string expected, ${c} found`))}return f}function ul(r,e){const n=r.key,o=r.validateSpec,c=r.style,f=r.styleSpec,g=r.value,y=r.objectKey,x=f[`${e}_${r.layerType}`];if(!x)return[];const k=y.match(/^(.*)-transition$/);if(e==="paint"&&k&&x[k[1]]&&x[k[1]].transition)return o({key:n,value:g,valueSpec:f.transition,style:c,styleSpec:f});const E=r.valueSpec||x[y];if(!E)return[new Je(n,g,`unknown property "${y}"`)];let P;if(yr(g)==="string"&&Xn(E)&&!E.tokens&&(P=/^{([^}]+)}$/.exec(g)))return[new Je(n,g,`"${y}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(P[1])} }\`.`)];const L=[];return r.layerType==="symbol"&&(y==="text-field"&&c&&!c.glyphs&&L.push(new Je(n,g,'use of "text-field" requires a style "glyphs" property')),y==="text-font"&&Ra(hs(g))&&ti(g.type)==="identity"&&L.push(new Je(n,g,'"text-font" does not support identity functions'))),L.concat(o({key:r.key,value:g,valueSpec:E,style:c,styleSpec:f,expressionContext:"property",propertyType:e,propertyKey:y}))}function hl(r){return ul(r,"paint")}function dl(r){return ul(r,"layout")}function yu(r){let e=[];const n=r.value,o=r.key,c=r.style,f=r.styleSpec;n.type||n.ref||e.push(new Je(o,n,'either "type" or "ref" is required'));let g=ti(n.type);const y=ti(n.ref);if(n.id){const x=ti(n.id);for(let k=0;k<r.arrayIndex;k++){const E=c.layers[k];ti(E.id)===x&&e.push(new Je(o,n.id,`duplicate layer id "${n.id}", previously used at line ${E.id.__line__}`))}}if("ref"in n){let x;["type","source","source-layer","filter","layout"].forEach(k=>{k in n&&e.push(new Je(o,n[k],`"${k}" is prohibited for ref layers`))}),c.layers.forEach(k=>{ti(k.id)===y&&(x=k)}),x?x.ref?e.push(new Je(o,n.ref,"ref cannot reference another ref layer")):g=ti(x.type):e.push(new Je(o,n.ref,`ref layer "${y}" not found`))}else if(g!=="background")if(n.source){const x=c.sources&&c.sources[n.source],k=x&&ti(x.type);x?k==="vector"&&g==="raster"?e.push(new Je(o,n.source,`layer "${n.id}" requires a raster source`)):k!=="raster-dem"&&g==="hillshade"?e.push(new Je(o,n.source,`layer "${n.id}" requires a raster-dem source`)):k==="raster"&&g!=="raster"?e.push(new Je(o,n.source,`layer "${n.id}" requires a vector source`)):k!=="vector"||n["source-layer"]?k==="raster-dem"&&g!=="hillshade"?e.push(new Je(o,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):g!=="line"||!n.paint||!n.paint["line-gradient"]||k==="geojson"&&x.lineMetrics||e.push(new Je(o,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Je(o,n,`layer "${n.id}" must specify a "source-layer"`)):e.push(new Je(o,n.source,`source "${n.source}" not found`))}else e.push(new Je(o,n,'missing required property "source"'));return e=e.concat(yn({key:o,value:n,valueSpec:f.layer,style:r.style,styleSpec:r.styleSpec,validateSpec:r.validateSpec,objectElementValidators:{"*":()=>[],type:()=>r.validateSpec({key:`${o}.type`,value:n.type,valueSpec:f.layer.type,style:r.style,styleSpec:r.styleSpec,validateSpec:r.validateSpec,object:n,objectKey:"type"}),filter:ll,layout:x=>yn({layer:n,key:x.key,value:x.value,style:x.style,styleSpec:x.styleSpec,validateSpec:x.validateSpec,objectElementValidators:{"*":k=>dl(Kr({layerType:g},k))}}),paint:x=>yn({layer:n,key:x.key,value:x.value,style:x.style,styleSpec:x.styleSpec,validateSpec:x.validateSpec,objectElementValidators:{"*":k=>hl(Kr({layerType:g},k))}})}})),e}function Ps(r){const e=r.value,n=r.key,o=yr(e);return o!=="string"?[new Je(n,e,`string expected, ${o} found`)]:[]}const As={promoteId:function({key:r,value:e}){if(yr(e)==="string")return Ps({key:r,value:e});{const n=[];for(const o in e)n.push(...Ps({key:`${r}.${o}`,value:e[o]}));return n}}};function vc(r){const e=r.value,n=r.key,o=r.styleSpec,c=r.style,f=r.validateSpec;if(!e.type)return[new Je(n,e,'"type" is required')];const g=ti(e.type);let y;switch(g){case"vector":case"raster":return y=yn({key:n,value:e,valueSpec:o[`source_${g.replace("-","_")}`],style:r.style,styleSpec:o,objectElementValidators:As,validateSpec:f}),y;case"raster-dem":return y=function(x){var k;const E=(k=x.sourceName)!==null&&k!==void 0?k:"",P=x.value,L=x.styleSpec,F=L.source_raster_dem,$=x.style;let U=[];const W=yr(P);if(P===void 0)return U;if(W!=="object")return U.push(new Je("source_raster_dem",P,`object expected, ${W} found`)),U;const re=ti(P.encoding)==="custom",we=["redFactor","greenFactor","blueFactor","baseShift"],oe=x.value.encoding?`"${x.value.encoding}"`:"Default";for(const ve in P)!re&&we.includes(ve)?U.push(new Je(ve,P[ve],`In "${E}": "${ve}" is only valid when "encoding" is set to "custom". ${oe} encoding found`)):F[ve]?U=U.concat(x.validateSpec({key:ve,value:P[ve],valueSpec:F[ve],validateSpec:x.validateSpec,style:$,styleSpec:L})):U.push(new Je(ve,P[ve],`unknown property "${ve}"`));return U}({sourceName:n,value:e,style:r.style,styleSpec:o,validateSpec:f}),y;case"geojson":if(y=yn({key:n,value:e,valueSpec:o.source_geojson,style:c,styleSpec:o,validateSpec:f,objectElementValidators:As}),e.cluster)for(const x in e.clusterProperties){const[k,E]=e.clusterProperties[x],P=typeof k=="string"?[k,["accumulated"],["get",x]]:k;y.push(...ds({key:`${n}.${x}.map`,value:E,validateSpec:f,expressionContext:"cluster-map"})),y.push(...ds({key:`${n}.${x}.reduce`,value:P,validateSpec:f,expressionContext:"cluster-reduce"}))}return y;case"video":return yn({key:n,value:e,valueSpec:o.source_video,style:c,validateSpec:f,styleSpec:o});case"image":return yn({key:n,value:e,valueSpec:o.source_image,style:c,validateSpec:f,styleSpec:o});case"canvas":return[new Je(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Na({key:`${n}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:c,validateSpec:f,styleSpec:o})}}function xc(r){const e=r.value,n=r.styleSpec,o=n.light,c=r.style;let f=[];const g=yr(e);if(e===void 0)return f;if(g!=="object")return f=f.concat([new Je("light",e,`object expected, ${g} found`)]),f;for(const y in e){const x=y.match(/^(.*)-transition$/);f=f.concat(x&&o[x[1]]&&o[x[1]].transition?r.validateSpec({key:y,value:e[y],valueSpec:n.transition,validateSpec:r.validateSpec,style:c,styleSpec:n}):o[y]?r.validateSpec({key:y,value:e[y],valueSpec:o[y],validateSpec:r.validateSpec,style:c,styleSpec:n}):[new Je(y,e[y],`unknown property "${y}"`)])}return f}function Ds(r){const e=r.value,n=r.styleSpec,o=n.sky,c=r.style,f=yr(e);if(e===void 0)return[];if(f!=="object")return[new Je("sky",e,`object expected, ${f} found`)];let g=[];for(const y in e)g=g.concat(o[y]?r.validateSpec({key:y,value:e[y],valueSpec:o[y],style:c,styleSpec:n}):[new Je(y,e[y],`unknown property "${y}"`)]);return g}function vu(r){const e=r.value,n=r.styleSpec,o=n.terrain,c=r.style;let f=[];const g=yr(e);if(e===void 0)return f;if(g!=="object")return f=f.concat([new Je("terrain",e,`object expected, ${g} found`)]),f;for(const y in e)f=f.concat(o[y]?r.validateSpec({key:y,value:e[y],valueSpec:o[y],validateSpec:r.validateSpec,style:c,styleSpec:n}):[new Je(y,e[y],`unknown property "${y}"`)]);return f}function xu(r){let e=[];const n=r.value,o=r.key;if(Array.isArray(n)){const c=[],f=[];for(const g in n)n[g].id&&c.includes(n[g].id)&&e.push(new Je(o,n,`all the sprites' ids must be unique, but ${n[g].id} is duplicated`)),c.push(n[g].id),n[g].url&&f.includes(n[g].url)&&e.push(new Je(o,n,`all the sprites' URLs must be unique, but ${n[g].url} is duplicated`)),f.push(n[g].url),e=e.concat(yn({key:`${o}[${g}]`,value:n[g],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:r.validateSpec}));return e}return Ps({key:o,value:n})}const bc={"*":()=>[],array:al,boolean:function(r){const e=r.value,n=r.key,o=yr(e);return o!=="boolean"?[new Je(n,e,`boolean expected, ${o} found`)]:[]},number:yc,color:function(r){const e=r.key,n=r.value,o=yr(n);return o!=="string"?[new Je(e,n,`color expected, ${o} found`)]:Pr.parse(String(n))?[]:[new Je(e,n,`color expected, "${n}" found`)]},constants:sl,enum:Na,filter:ll,function:ol,layer:yu,object:yn,source:vc,light:xc,sky:Ds,terrain:vu,string:Ps,formatted:function(r){return Ps(r).length===0?[]:ds(r)},resolvedImage:function(r){return Ps(r).length===0?[]:ds(r)},padding:function(r){const e=r.key,n=r.value;if(yr(n)==="array"){if(n.length<1||n.length>4)return[new Je(e,n,`padding requires 1 to 4 values; ${n.length} values found`)];const o={type:"number"};let c=[];for(let f=0;f<n.length;f++)c=c.concat(r.validateSpec({key:`${e}[${f}]`,value:n[f],validateSpec:r.validateSpec,valueSpec:o}));return c}return yc({key:e,value:n,valueSpec:{}})},variableAnchorOffsetCollection:function(r){const e=r.key,n=r.value,o=yr(n),c=r.styleSpec;if(o!=="array"||n.length<1||n.length%2!=0)return[new Je(e,n,"variableAnchorOffsetCollection requires a non-empty array of even length")];let f=[];for(let g=0;g<n.length;g+=2)f=f.concat(Na({key:`${e}[${g}]`,value:n[g],valueSpec:c.layout_symbol["text-anchor"]})),f=f.concat(al({key:`${e}[${g+1}]`,value:n[g+1],valueSpec:{length:2,value:"number"},validateSpec:r.validateSpec,style:r.style,styleSpec:c}));return f},sprite:xu};function $a(r){const e=r.value,n=r.valueSpec,o=r.styleSpec;return r.validateSpec=$a,n.expression&&Ra(ti(e))?ol(r):n.expression&&el(hs(e))?ds(r):n.type&&bc[n.type]?bc[n.type](r):yn(Kr({},r,{valueSpec:n.type?o[n.type]:n}))}function wc(r){const e=r.value,n=r.key,o=Ps(r);return o.length||(e.indexOf("{fontstack}")===-1&&o.push(new Je(n,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&o.push(new Je(n,e,'"glyphs" url must include a "{range}" token'))),o}function cn(r,e=Ce){let n=[];return n=n.concat($a({key:"",value:r,valueSpec:e.$root,styleSpec:e,style:r,validateSpec:$a,objectElementValidators:{glyphs:wc,"*":()=>[]}})),r.constants&&(n=n.concat(sl({key:"constants",value:r.constants,style:r,styleSpec:e,validateSpec:$a}))),Sc(n)}function Zr(r){return function(e){return r({...e,validateSpec:$a})}}function Sc(r){return[].concat(r).sort((e,n)=>e.line-n.line)}function vn(r){return function(...e){return Sc(r.apply(this,e))}}cn.source=vn(Zr(vc)),cn.sprite=vn(Zr(xu)),cn.glyphs=vn(Zr(wc)),cn.light=vn(Zr(xc)),cn.sky=vn(Zr(Ds)),cn.terrain=vn(Zr(vu)),cn.layer=vn(Zr(yu)),cn.filter=vn(Zr(ll)),cn.paintProperty=vn(Zr(hl)),cn.layoutProperty=vn(Zr(dl));const zs=cn,bu=zs.light,Mc=zs.paintProperty,wu=zs.layoutProperty;function pl(r,e){let n=!1;if(e&&e.length)for(const o of e)r.fire(new sr(new Error(o.message))),n=!0;return n}class ra{constructor(e,n,o){const c=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const g=new Int32Array(this.arrayBuffer);e=g[0],this.d=(n=g[1])+2*(o=g[2]);for(let x=0;x<this.d*this.d;x++){const k=g[3+x],E=g[3+x+1];c.push(k===E?null:g.subarray(k,E))}const y=g[3+c.length+1];this.keys=g.subarray(g[3+c.length],y),this.bboxes=g.subarray(y),this.insert=this._insertReadonly}else{this.d=n+2*o;for(let g=0;g<this.d*this.d;g++)c.push([]);this.keys=[],this.bboxes=[]}this.n=n,this.extent=e,this.padding=o,this.scale=n/e,this.uid=0;const f=o/n*e;this.min=-f,this.max=e+f}insert(e,n,o,c,f){this._forEachCell(n,o,c,f,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(n),this.bboxes.push(o),this.bboxes.push(c),this.bboxes.push(f)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,n,o,c,f,g){this.cells[f].push(g)}query(e,n,o,c,f){const g=this.min,y=this.max;if(e<=g&&n<=g&&y<=o&&y<=c&&!f)return Array.prototype.slice.call(this.keys);{const x=[];return this._forEachCell(e,n,o,c,this._queryCell,x,{},f),x}}_queryCell(e,n,o,c,f,g,y,x){const k=this.cells[f];if(k!==null){const E=this.keys,P=this.bboxes;for(let L=0;L<k.length;L++){const F=k[L];if(y[F]===void 0){const $=4*F;(x?x(P[$+0],P[$+1],P[$+2],P[$+3]):e<=P[$+2]&&n<=P[$+3]&&o>=P[$+0]&&c>=P[$+1])?(y[F]=!0,g.push(E[F])):y[F]=!1}}}}_forEachCell(e,n,o,c,f,g,y,x){const k=this._convertToCellCoord(e),E=this._convertToCellCoord(n),P=this._convertToCellCoord(o),L=this._convertToCellCoord(c);for(let F=k;F<=P;F++)for(let $=E;$<=L;$++){const U=this.d*$+F;if((!x||x(this._convertFromCellCoord(F),this._convertFromCellCoord($),this._convertFromCellCoord(F+1),this._convertFromCellCoord($+1)))&&f.call(this,e,n,o,c,U,g,y,x))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,n=3+this.cells.length+1+1;let o=0;for(let g=0;g<this.cells.length;g++)o+=this.cells[g].length;const c=new Int32Array(n+o+this.keys.length+this.bboxes.length);c[0]=this.extent,c[1]=this.n,c[2]=this.padding;let f=n;for(let g=0;g<e.length;g++){const y=e[g];c[3+g]=f,c.set(y,f),f+=y.length}return c[3+e.length]=f,c.set(this.keys,f),f+=this.keys.length,c[3+e.length+1]=f,c.set(this.bboxes,f),f+=this.bboxes.length,c.buffer}static serialize(e,n){const o=e.toArrayBuffer();return n&&n.push(o),{buffer:o}}static deserialize(e){return new ra(e.buffer)}}const Ls={};function _t(r,e,n={}){if(Ls[r])throw new Error(`${r} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:r,writeable:!1}),Ls[r]={klass:e,omit:n.omit||[],shallow:n.shallow||[]}}_t("Object",Object),_t("TransferableGridIndex",ra),_t("Color",Pr),_t("Error",Error),_t("AJAXError",Qt),_t("ResolvedImage",Pi),_t("StylePropertyFunction",Kn),_t("StyleExpression",mc,{omit:["_evaluator"]}),_t("ZoomDependentExpression",go),_t("ZoomConstantExpression",rl),_t("CompoundExpression",Ki,{omit:["_evaluate"]});for(const r in Es)Es[r]._classRegistryKey||_t(`Expression_${r}`,Es[r]);function kc(r){return r&&typeof ArrayBuffer<"u"&&(r instanceof ArrayBuffer||r.constructor&&r.constructor.name==="ArrayBuffer")}function xo(r,e){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||r instanceof Blob||r instanceof Error)return r;if(kc(r)||ht(r))return e&&e.push(r),r;if(ArrayBuffer.isView(r)){const n=r;return e&&e.push(n.buffer),n}if(r instanceof ImageData)return e&&e.push(r.data.buffer),r;if(Array.isArray(r)){const n=[];for(const o of r)n.push(xo(o,e));return n}if(typeof r=="object"){const n=r.constructor,o=n._classRegistryKey;if(!o)throw new Error(`can't serialize object of unregistered class ${n.name}`);if(!Ls[o])throw new Error(`${o} is not registered.`);const c=n.serialize?n.serialize(r,e):{};if(n.serialize){if(e&&c===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const f in r){if(!r.hasOwnProperty(f)||Ls[o].omit.indexOf(f)>=0)continue;const g=r[f];c[f]=Ls[o].shallow.indexOf(f)>=0?g:xo(g,e)}r instanceof Error&&(c.message=r.message)}if(c.$name)throw new Error("$name property is reserved for worker serialization logic.");return o!=="Object"&&(c.$name=o),c}throw new Error("can't serialize object of type "+typeof r)}function Jn(r){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||r instanceof Blob||r instanceof Error||kc(r)||ht(r)||ArrayBuffer.isView(r)||r instanceof ImageData)return r;if(Array.isArray(r))return r.map(Jn);if(typeof r=="object"){const e=r.$name||"Object";if(!Ls[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:n}=Ls[e];if(!n)throw new Error(`can't deserialize unregistered class ${e}`);if(n.deserialize)return n.deserialize(r);const o=Object.create(n.prototype);for(const c of Object.keys(r)){if(c==="$name")continue;const f=r[c];o[c]=Ls[e].shallow.indexOf(c)>=0?f:Jn(f)}return o}throw new Error("can't deserialize object of type "+typeof r)}class Su{constructor(){this.first=!0}update(e,n){const o=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=o,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=o,!0):(this.lastFloorZoom>o?(this.lastIntegerZoom=o+1,this.lastIntegerZoomTime=n):this.lastFloorZoom<o&&(this.lastIntegerZoom=o,this.lastIntegerZoomTime=n),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=o,!0))}}const ot={"Latin-1 Supplement":r=>r>=128&&r<=255,Arabic:r=>r>=1536&&r<=1791,"Arabic Supplement":r=>r>=1872&&r<=1919,"Arabic Extended-A":r=>r>=2208&&r<=2303,"Hangul Jamo":r=>r>=4352&&r<=4607,"Unified Canadian Aboriginal Syllabics":r=>r>=5120&&r<=5759,Khmer:r=>r>=6016&&r<=6143,"Unified Canadian Aboriginal Syllabics Extended":r=>r>=6320&&r<=6399,"General Punctuation":r=>r>=8192&&r<=8303,"Letterlike Symbols":r=>r>=8448&&r<=8527,"Number Forms":r=>r>=8528&&r<=8591,"Miscellaneous Technical":r=>r>=8960&&r<=9215,"Control Pictures":r=>r>=9216&&r<=9279,"Optical Character Recognition":r=>r>=9280&&r<=9311,"Enclosed Alphanumerics":r=>r>=9312&&r<=9471,"Geometric Shapes":r=>r>=9632&&r<=9727,"Miscellaneous Symbols":r=>r>=9728&&r<=9983,"Miscellaneous Symbols and Arrows":r=>r>=11008&&r<=11263,"CJK Radicals Supplement":r=>r>=11904&&r<=12031,"Kangxi Radicals":r=>r>=12032&&r<=12255,"Ideographic Description Characters":r=>r>=12272&&r<=12287,"CJK Symbols and Punctuation":r=>r>=12288&&r<=12351,Hiragana:r=>r>=12352&&r<=12447,Katakana:r=>r>=12448&&r<=12543,Bopomofo:r=>r>=12544&&r<=12591,"Hangul Compatibility Jamo":r=>r>=12592&&r<=12687,Kanbun:r=>r>=12688&&r<=12703,"Bopomofo Extended":r=>r>=12704&&r<=12735,"CJK Strokes":r=>r>=12736&&r<=12783,"Katakana Phonetic Extensions":r=>r>=12784&&r<=12799,"Enclosed CJK Letters and Months":r=>r>=12800&&r<=13055,"CJK Compatibility":r=>r>=13056&&r<=13311,"CJK Unified Ideographs Extension A":r=>r>=13312&&r<=19903,"Yijing Hexagram Symbols":r=>r>=19904&&r<=19967,"CJK Unified Ideographs":r=>r>=19968&&r<=40959,"Yi Syllables":r=>r>=40960&&r<=42127,"Yi Radicals":r=>r>=42128&&r<=42191,"Hangul Jamo Extended-A":r=>r>=43360&&r<=43391,"Hangul Syllables":r=>r>=44032&&r<=55215,"Hangul Jamo Extended-B":r=>r>=55216&&r<=55295,"Private Use Area":r=>r>=57344&&r<=63743,"CJK Compatibility Ideographs":r=>r>=63744&&r<=64255,"Arabic Presentation Forms-A":r=>r>=64336&&r<=65023,"Vertical Forms":r=>r>=65040&&r<=65055,"CJK Compatibility Forms":r=>r>=65072&&r<=65103,"Small Form Variants":r=>r>=65104&&r<=65135,"Arabic Presentation Forms-B":r=>r>=65136&&r<=65279,"Halfwidth and Fullwidth Forms":r=>r>=65280&&r<=65519};function Rs(r){for(const e of r)if(Tc(e.charCodeAt(0)))return!0;return!1}function Eh(r){for(const e of r)if(!Mu(e.charCodeAt(0)))return!1;return!0}function Mu(r){return!(ot.Arabic(r)||ot["Arabic Supplement"](r)||ot["Arabic Extended-A"](r)||ot["Arabic Presentation Forms-A"](r)||ot["Arabic Presentation Forms-B"](r))}function Tc(r){return!(r!==746&&r!==747&&(r<4352||!(ot["Bopomofo Extended"](r)||ot.Bopomofo(r)||ot["CJK Compatibility Forms"](r)&&!(r>=65097&&r<=65103)||ot["CJK Compatibility Ideographs"](r)||ot["CJK Compatibility"](r)||ot["CJK Radicals Supplement"](r)||ot["CJK Strokes"](r)||!(!ot["CJK Symbols and Punctuation"](r)||r>=12296&&r<=12305||r>=12308&&r<=12319||r===12336)||ot["CJK Unified Ideographs Extension A"](r)||ot["CJK Unified Ideographs"](r)||ot["Enclosed CJK Letters and Months"](r)||ot["Hangul Compatibility Jamo"](r)||ot["Hangul Jamo Extended-A"](r)||ot["Hangul Jamo Extended-B"](r)||ot["Hangul Jamo"](r)||ot["Hangul Syllables"](r)||ot.Hiragana(r)||ot["Ideographic Description Characters"](r)||ot.Kanbun(r)||ot["Kangxi Radicals"](r)||ot["Katakana Phonetic Extensions"](r)||ot.Katakana(r)&&r!==12540||!(!ot["Halfwidth and Fullwidth Forms"](r)||r===65288||r===65289||r===65293||r>=65306&&r<=65310||r===65339||r===65341||r===65343||r>=65371&&r<=65503||r===65507||r>=65512&&r<=65519)||!(!ot["Small Form Variants"](r)||r>=65112&&r<=65118||r>=65123&&r<=65126)||ot["Unified Canadian Aboriginal Syllabics"](r)||ot["Unified Canadian Aboriginal Syllabics Extended"](r)||ot["Vertical Forms"](r)||ot["Yijing Hexagram Symbols"](r)||ot["Yi Syllables"](r)||ot["Yi Radicals"](r))))}function Cc(r){return!(Tc(r)||function(e){return!!(ot["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||ot["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||ot["Letterlike Symbols"](e)||ot["Number Forms"](e)||ot["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||ot["Control Pictures"](e)&&e!==9251||ot["Optical Character Recognition"](e)||ot["Enclosed Alphanumerics"](e)||ot["Geometric Shapes"](e)||ot["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||ot["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||ot["CJK Symbols and Punctuation"](e)||ot.Katakana(e)||ot["Private Use Area"](e)||ot["CJK Compatibility Forms"](e)||ot["Small Form Variants"](e)||ot["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(r))}function xn(r){return r>=1424&&r<=2303||ot["Arabic Presentation Forms-A"](r)||ot["Arabic Presentation Forms-B"](r)}function ku(r,e){return!(!e&&xn(r)||r>=2304&&r<=3583||r>=3840&&r<=4255||ot.Khmer(r))}function fl(r){for(const e of r)if(xn(e.charCodeAt(0)))return!0;return!1}const Fs=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(r){this.pluginStatus=r.pluginStatus,this.pluginURL=r.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(r){this.applyArabicShaping=r.applyArabicShaping,this.processBidirectionalText=r.processBidirectionalText,this.processStyledBidirectionalText=r.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class Fr{constructor(e,n){this.zoom=e,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.zoomHistory=n.zoomHistory,this.transition=n.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Su,this.transition={})}isSupportedScript(e){return function(n,o){for(const c of n)if(!ku(c.charCodeAt(0),o))return!1;return!0}(e,Fs.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,n=e-Math.floor(e),o=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:n+(1-n)*o}:{fromScale:.5,toScale:1,t:1-(1-o)*n}}}class ml{constructor(e,n){this.property=e,this.value=n,this.expression=function(o,c){if(Ra(o))return new Kn(o,c);if(el(o)){const f=_o(o,c);if(f.result==="error")throw new Error(f.value.map(g=>`${g.key}: ${g.message}`).join(", "));return f.value}{let f=o;return c.type==="color"&&typeof o=="string"?f=Pr.parse(o):c.type!=="padding"||typeof o!="number"&&!Array.isArray(o)?c.type==="variableAnchorOffsetCollection"&&Array.isArray(o)&&(f=Oi.parse(o)):f=on.parse(o),{kind:"constant",evaluate:()=>f}}}(n===void 0?e.specification.default:n,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,n,o){return this.property.possiblyEvaluate(this,e,n,o)}}class ja{constructor(e){this.property=e,this.value=new ml(e,void 0)}transitioned(e,n){return new Tu(this.property,this.value,n,Ae({},e.transition,this.transition),e.now)}untransitioned(){return new Tu(this.property,this.value,null,{},0)}}class Va{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return qe(this._values[e].value.value)}setValue(e,n){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new ja(this._values[e].property)),this._values[e].value=new ml(this._values[e].property,n===null?void 0:qe(n))}getTransition(e){return qe(this._values[e].transition)}setTransition(e,n){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new ja(this._values[e].property)),this._values[e].transition=qe(n)||void 0}serialize(){const e={};for(const n of Object.keys(this._values)){const o=this.getValue(n);o!==void 0&&(e[n]=o);const c=this.getTransition(n);c!==void 0&&(e[`${n}-transition`]=c)}return e}transitioned(e,n){const o=new Ic(this._properties);for(const c of Object.keys(this._values))o._values[c]=this._values[c].transitioned(e,n._values[c]);return o}untransitioned(){const e=new Ic(this._properties);for(const n of Object.keys(this._values))e._values[n]=this._values[n].untransitioned();return e}}class Tu{constructor(e,n,o,c,f){this.property=e,this.value=n,this.begin=f+c.delay||0,this.end=this.begin+c.duration||0,e.specification.transition&&(c.delay||c.duration)&&(this.prior=o)}possiblyEvaluate(e,n,o){const c=e.now||0,f=this.value.possiblyEvaluate(e,n,o),g=this.prior;if(g){if(c>this.end)return this.prior=null,f;if(this.value.isDataDriven())return this.prior=null,f;if(c<this.begin)return g.possiblyEvaluate(e,n,o);{const y=(c-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(e,n,o),f,function(x){if(x<=0)return 0;if(x>=1)return 1;const k=x*x,E=k*x;return 4*(x<.5?E:3*(x-k)+E-.75)}(y))}}return f}}class Ic{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,n,o){const c=new gl(this._properties);for(const f of Object.keys(this._values))c._values[f]=this._values[f].possiblyEvaluate(e,n,o);return c}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class bo{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}hasValue(e){return this._values[e].value!==void 0}getValue(e){return qe(this._values[e].value)}setValue(e,n){this._values[e]=new ml(this._values[e].property,n===null?void 0:qe(n))}serialize(){const e={};for(const n of Object.keys(this._values)){const o=this.getValue(n);o!==void 0&&(e[n]=o)}return e}possiblyEvaluate(e,n,o){const c=new gl(this._properties);for(const f of Object.keys(this._values))c._values[f]=this._values[f].possiblyEvaluate(e,n,o);return c}}class Yn{constructor(e,n,o){this.property=e,this.value=n,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,n,o,c){return this.property.evaluate(this.value,this.parameters,e,n,o,c)}}class gl{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Tt{constructor(e){this.specification=e}possiblyEvaluate(e,n){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(n)}interpolate(e,n,o){const c=Ni[this.specification.type];return c?c(e,n,o):e}}class Ft{constructor(e,n){this.specification=e,this.overrides=n}possiblyEvaluate(e,n,o,c){return new Yn(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(n,null,{},o,c)}:e.expression,n)}interpolate(e,n,o){if(e.value.kind!=="constant"||n.value.kind!=="constant")return e;if(e.value.value===void 0||n.value.value===void 0)return new Yn(this,{kind:"constant",value:void 0},e.parameters);const c=Ni[this.specification.type];if(c){const f=c(e.value.value,n.value.value,o);return new Yn(this,{kind:"constant",value:f},e.parameters)}return e}evaluate(e,n,o,c,f,g){return e.kind==="constant"?e.value:e.evaluate(n,o,c,f,g)}}class p extends Ft{possiblyEvaluate(e,n,o,c){if(e.value===void 0)return new Yn(this,{kind:"constant",value:void 0},n);if(e.expression.kind==="constant"){const f=e.expression.evaluate(n,null,{},o,c),g=e.property.specification.type==="resolvedImage"&&typeof f!="string"?f.name:f,y=this._calculate(g,g,g,n);return new Yn(this,{kind:"constant",value:y},n)}if(e.expression.kind==="camera"){const f=this._calculate(e.expression.evaluate({zoom:n.zoom-1}),e.expression.evaluate({zoom:n.zoom}),e.expression.evaluate({zoom:n.zoom+1}),n);return new Yn(this,{kind:"constant",value:f},n)}return new Yn(this,e.expression,n)}evaluate(e,n,o,c,f,g){if(e.kind==="source"){const y=e.evaluate(n,o,c,f,g);return this._calculate(y,y,y,n)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(n.zoom)-1},o,c),e.evaluate({zoom:Math.floor(n.zoom)},o,c),e.evaluate({zoom:Math.floor(n.zoom)+1},o,c),n):e.value}_calculate(e,n,o,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:e,to:n}:{from:o,to:n}}interpolate(e){return e}}class t{constructor(e){this.specification=e}possiblyEvaluate(e,n,o,c){if(e.value!==void 0){if(e.expression.kind==="constant"){const f=e.expression.evaluate(n,null,{},o,c);return this._calculate(f,f,f,n)}return this._calculate(e.expression.evaluate(new Fr(Math.floor(n.zoom-1),n)),e.expression.evaluate(new Fr(Math.floor(n.zoom),n)),e.expression.evaluate(new Fr(Math.floor(n.zoom+1),n)),n)}}_calculate(e,n,o,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:e,to:n}:{from:o,to:n}}interpolate(e){return e}}class s{constructor(e){this.specification=e}possiblyEvaluate(e,n,o,c){return!!e.expression.evaluate(n,null,{},o,c)}interpolate(){return!1}}class l{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const n in e){const o=e[n];o.specification.overridable&&this.overridableProperties.push(n);const c=this.defaultPropertyValues[n]=new ml(o,void 0),f=this.defaultTransitionablePropertyValues[n]=new ja(o);this.defaultTransitioningPropertyValues[n]=f.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=c.possiblyEvaluate({})}}}_t("DataDrivenProperty",Ft),_t("DataConstantProperty",Tt),_t("CrossFadedDataDrivenProperty",p),_t("CrossFadedProperty",t),_t("ColorRampProperty",s);const u="-transition";class m extends zr{constructor(e,n){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1},e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),n.layout&&(this._unevaluatedLayout=new bo(n.layout)),n.paint)){this._transitionablePaint=new Va(n.paint);for(const o in e.paint)this.setPaintProperty(o,e.paint[o],{validate:!1});for(const o in e.layout)this.setLayoutProperty(o,e.layout[o],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new gl(n.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,n,o={}){n!=null&&this._validate(wu,`layers.${this.id}.layout.${e}`,e,n,o)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,n):this.visibility=n)}getPaintProperty(e){return e.endsWith(u)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,n,o={}){if(n!=null&&this._validate(Mc,`layers.${this.id}.paint.${e}`,e,n,o))return!1;if(e.endsWith(u))return this._transitionablePaint.setTransition(e.slice(0,-11),n||void 0),!1;{const c=this._transitionablePaint._values[e],f=c.property.specification["property-type"]==="cross-faded-data-driven",g=c.value.isDataDriven(),y=c.value;this._transitionablePaint.setValue(e,n),this._handleSpecialPaintPropertyUpdate(e);const x=this._transitionablePaint._values[e].value;return x.isDataDriven()||g||f||this._handleOverridablePaintPropertyUpdate(e,y,x)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,n,o){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,n){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,n)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),De(e,(n,o)=>!(n===void 0||o==="layout"&&!Object.keys(n).length||o==="paint"&&!Object.keys(n).length))}_validate(e,n,o,c,f={}){return(!f||f.validate!==!1)&&pl(this,e.call(zs,{key:n,layerType:this.type,objectKey:o,value:c,styleSpec:Ce,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const n=this.paint.get(e);if(n instanceof Yn&&Xn(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}}const v={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class b{constructor(e,n){this._structArray=e,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class M{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,n){return e._trim(),n&&(e.isTransferred=!0,n.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const n=Object.create(this.prototype);return n.arrayBuffer=e.arrayBuffer,n.length=e.length,n.capacity=e.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function I(r,e=1){let n=0,o=0;return{members:r.map(c=>{const f=v[c.type].BYTES_PER_ELEMENT,g=n=z(n,Math.max(e,f)),y=c.components||1;return o=Math.max(o,f),n+=f*y,{name:c.name,type:c.type,components:y,offset:g}}),size:z(n,Math.max(o,e)),alignment:e}}function z(r,e){return Math.ceil(r/e)*e}class D extends M{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n){const o=this.length;return this.resize(o+1),this.emplace(o,e,n)}emplace(e,n,o){const c=2*e;return this.int16[c+0]=n,this.int16[c+1]=o,e}}D.prototype.bytesPerElement=4,_t("StructArrayLayout2i4",D);class O extends M{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o){const c=this.length;return this.resize(c+1),this.emplace(c,e,n,o)}emplace(e,n,o,c){const f=3*e;return this.int16[f+0]=n,this.int16[f+1]=o,this.int16[f+2]=c,e}}O.prototype.bytesPerElement=6,_t("StructArrayLayout3i6",O);class V extends M{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,c){const f=this.length;return this.resize(f+1),this.emplace(f,e,n,o,c)}emplace(e,n,o,c,f){const g=4*e;return this.int16[g+0]=n,this.int16[g+1]=o,this.int16[g+2]=c,this.int16[g+3]=f,e}}V.prototype.bytesPerElement=8,_t("StructArrayLayout4i8",V);class G extends M{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,c,f,g){const y=this.length;return this.resize(y+1),this.emplace(y,e,n,o,c,f,g)}emplace(e,n,o,c,f,g,y){const x=6*e;return this.int16[x+0]=n,this.int16[x+1]=o,this.int16[x+2]=c,this.int16[x+3]=f,this.int16[x+4]=g,this.int16[x+5]=y,e}}G.prototype.bytesPerElement=12,_t("StructArrayLayout2i4i12",G);class Q extends M{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,c,f,g){const y=this.length;return this.resize(y+1),this.emplace(y,e,n,o,c,f,g)}emplace(e,n,o,c,f,g,y){const x=4*e,k=8*e;return this.int16[x+0]=n,this.int16[x+1]=o,this.uint8[k+4]=c,this.uint8[k+5]=f,this.uint8[k+6]=g,this.uint8[k+7]=y,e}}Q.prototype.bytesPerElement=8,_t("StructArrayLayout2i4ub8",Q);class Z extends M{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n){const o=this.length;return this.resize(o+1),this.emplace(o,e,n)}emplace(e,n,o){const c=2*e;return this.float32[c+0]=n,this.float32[c+1]=o,e}}Z.prototype.bytesPerElement=8,_t("StructArrayLayout2f8",Z);class ie extends M{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o,c,f,g,y,x,k,E){const P=this.length;return this.resize(P+1),this.emplace(P,e,n,o,c,f,g,y,x,k,E)}emplace(e,n,o,c,f,g,y,x,k,E,P){const L=10*e;return this.uint16[L+0]=n,this.uint16[L+1]=o,this.uint16[L+2]=c,this.uint16[L+3]=f,this.uint16[L+4]=g,this.uint16[L+5]=y,this.uint16[L+6]=x,this.uint16[L+7]=k,this.uint16[L+8]=E,this.uint16[L+9]=P,e}}ie.prototype.bytesPerElement=20,_t("StructArrayLayout10ui20",ie);class pe extends M{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o,c,f,g,y,x,k,E,P,L){const F=this.length;return this.resize(F+1),this.emplace(F,e,n,o,c,f,g,y,x,k,E,P,L)}emplace(e,n,o,c,f,g,y,x,k,E,P,L,F){const $=12*e;return this.int16[$+0]=n,this.int16[$+1]=o,this.int16[$+2]=c,this.int16[$+3]=f,this.uint16[$+4]=g,this.uint16[$+5]=y,this.uint16[$+6]=x,this.uint16[$+7]=k,this.int16[$+8]=E,this.int16[$+9]=P,this.int16[$+10]=L,this.int16[$+11]=F,e}}pe.prototype.bytesPerElement=24,_t("StructArrayLayout4i4ui4i24",pe);class J extends M{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o){const c=this.length;return this.resize(c+1),this.emplace(c,e,n,o)}emplace(e,n,o,c){const f=3*e;return this.float32[f+0]=n,this.float32[f+1]=o,this.float32[f+2]=c,e}}J.prototype.bytesPerElement=12,_t("StructArrayLayout3f12",J);class ge extends M{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint32[1*e+0]=n,e}}ge.prototype.bytesPerElement=4,_t("StructArrayLayout1ul4",ge);class Se extends M{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o,c,f,g,y,x,k){const E=this.length;return this.resize(E+1),this.emplace(E,e,n,o,c,f,g,y,x,k)}emplace(e,n,o,c,f,g,y,x,k,E){const P=10*e,L=5*e;return this.int16[P+0]=n,this.int16[P+1]=o,this.int16[P+2]=c,this.int16[P+3]=f,this.int16[P+4]=g,this.int16[P+5]=y,this.uint32[L+3]=x,this.uint16[P+8]=k,this.uint16[P+9]=E,e}}Se.prototype.bytesPerElement=20,_t("StructArrayLayout6i1ul2ui20",Se);class Te extends M{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,c,f,g){const y=this.length;return this.resize(y+1),this.emplace(y,e,n,o,c,f,g)}emplace(e,n,o,c,f,g,y){const x=6*e;return this.int16[x+0]=n,this.int16[x+1]=o,this.int16[x+2]=c,this.int16[x+3]=f,this.int16[x+4]=g,this.int16[x+5]=y,e}}Te.prototype.bytesPerElement=12,_t("StructArrayLayout2i2i2i12",Te);class Le extends M{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,c,f){const g=this.length;return this.resize(g+1),this.emplace(g,e,n,o,c,f)}emplace(e,n,o,c,f,g){const y=4*e,x=8*e;return this.float32[y+0]=n,this.float32[y+1]=o,this.float32[y+2]=c,this.int16[x+6]=f,this.int16[x+7]=g,e}}Le.prototype.bytesPerElement=16,_t("StructArrayLayout2f1f2i16",Le);class Ue extends M{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,c,f,g){const y=this.length;return this.resize(y+1),this.emplace(y,e,n,o,c,f,g)}emplace(e,n,o,c,f,g,y){const x=16*e,k=4*e,E=8*e;return this.uint8[x+0]=n,this.uint8[x+1]=o,this.float32[k+1]=c,this.float32[k+2]=f,this.int16[E+6]=g,this.int16[E+7]=y,e}}Ue.prototype.bytesPerElement=16,_t("StructArrayLayout2ub2f2i16",Ue);class st extends M{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o){const c=this.length;return this.resize(c+1),this.emplace(c,e,n,o)}emplace(e,n,o,c){const f=3*e;return this.uint16[f+0]=n,this.uint16[f+1]=o,this.uint16[f+2]=c,e}}st.prototype.bytesPerElement=6,_t("StructArrayLayout3ui6",st);class pt extends M{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,c,f,g,y,x,k,E,P,L,F,$,U,W,re){const we=this.length;return this.resize(we+1),this.emplace(we,e,n,o,c,f,g,y,x,k,E,P,L,F,$,U,W,re)}emplace(e,n,o,c,f,g,y,x,k,E,P,L,F,$,U,W,re,we){const oe=24*e,ve=12*e,Be=48*e;return this.int16[oe+0]=n,this.int16[oe+1]=o,this.uint16[oe+2]=c,this.uint16[oe+3]=f,this.uint32[ve+2]=g,this.uint32[ve+3]=y,this.uint32[ve+4]=x,this.uint16[oe+10]=k,this.uint16[oe+11]=E,this.uint16[oe+12]=P,this.float32[ve+7]=L,this.float32[ve+8]=F,this.uint8[Be+36]=$,this.uint8[Be+37]=U,this.uint8[Be+38]=W,this.uint32[ve+10]=re,this.int16[oe+22]=we,e}}pt.prototype.bytesPerElement=48,_t("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",pt);class Ke extends M{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,c,f,g,y,x,k,E,P,L,F,$,U,W,re,we,oe,ve,Be,Oe,ft,kt,ct,at,xt,At){const ut=this.length;return this.resize(ut+1),this.emplace(ut,e,n,o,c,f,g,y,x,k,E,P,L,F,$,U,W,re,we,oe,ve,Be,Oe,ft,kt,ct,at,xt,At)}emplace(e,n,o,c,f,g,y,x,k,E,P,L,F,$,U,W,re,we,oe,ve,Be,Oe,ft,kt,ct,at,xt,At,ut){const $e=32*e,Mt=16*e;return this.int16[$e+0]=n,this.int16[$e+1]=o,this.int16[$e+2]=c,this.int16[$e+3]=f,this.int16[$e+4]=g,this.int16[$e+5]=y,this.int16[$e+6]=x,this.int16[$e+7]=k,this.uint16[$e+8]=E,this.uint16[$e+9]=P,this.uint16[$e+10]=L,this.uint16[$e+11]=F,this.uint16[$e+12]=$,this.uint16[$e+13]=U,this.uint16[$e+14]=W,this.uint16[$e+15]=re,this.uint16[$e+16]=we,this.uint16[$e+17]=oe,this.uint16[$e+18]=ve,this.uint16[$e+19]=Be,this.uint16[$e+20]=Oe,this.uint16[$e+21]=ft,this.uint16[$e+22]=kt,this.uint32[Mt+12]=ct,this.float32[Mt+13]=at,this.float32[Mt+14]=xt,this.uint16[$e+30]=At,this.uint16[$e+31]=ut,e}}Ke.prototype.bytesPerElement=64,_t("StructArrayLayout8i15ui1ul2f2ui64",Ke);class tt extends M{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.float32[1*e+0]=n,e}}tt.prototype.bytesPerElement=4,_t("StructArrayLayout1f4",tt);class vt extends M{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o){const c=this.length;return this.resize(c+1),this.emplace(c,e,n,o)}emplace(e,n,o,c){const f=3*e;return this.uint16[6*e+0]=n,this.float32[f+1]=o,this.float32[f+2]=c,e}}vt.prototype.bytesPerElement=12,_t("StructArrayLayout1ui2f12",vt);class jt extends M{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o){const c=this.length;return this.resize(c+1),this.emplace(c,e,n,o)}emplace(e,n,o,c){const f=4*e;return this.uint32[2*e+0]=n,this.uint16[f+2]=o,this.uint16[f+3]=c,e}}jt.prototype.bytesPerElement=8,_t("StructArrayLayout1ul2ui8",jt);class nt extends M{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n){const o=this.length;return this.resize(o+1),this.emplace(o,e,n)}emplace(e,n,o){const c=2*e;return this.uint16[c+0]=n,this.uint16[c+1]=o,e}}nt.prototype.bytesPerElement=4,_t("StructArrayLayout2ui4",nt);class lt extends M{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint16[1*e+0]=n,e}}lt.prototype.bytesPerElement=2,_t("StructArrayLayout1ui2",lt);class Bt extends M{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,c){const f=this.length;return this.resize(f+1),this.emplace(f,e,n,o,c)}emplace(e,n,o,c,f){const g=4*e;return this.float32[g+0]=n,this.float32[g+1]=o,this.float32[g+2]=c,this.float32[g+3]=f,e}}Bt.prototype.bytesPerElement=16,_t("StructArrayLayout4f16",Bt);class jr extends b{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new le(this.anchorPointX,this.anchorPointY)}}jr.prototype.size=20;class Gt extends Se{get(e){return new jr(this,e)}}_t("CollisionBoxArray",Gt);class ar extends b{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}ar.prototype.size=48;class Vr extends pt{get(e){return new ar(this,e)}}_t("PlacedSymbolArray",Vr);class ji extends b{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}ji.prototype.size=64;class Bn extends Ke{get(e){return new ji(this,e)}}_t("SymbolInstanceArray",Bn);class Ur extends tt{getoffsetX(e){return this.float32[1*e+0]}}_t("GlyphOffsetArray",Ur);class Ji extends O{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}_t("SymbolLineVertexArray",Ji);class Yi extends b{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}Yi.prototype.size=12;class Vi extends vt{get(e){return new Yi(this,e)}}_t("TextAnchorOffsetArray",Vi);class Ui extends b{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Ui.prototype.size=8;class On extends jt{get(e){return new Ui(this,e)}}_t("FeatureIndexArray",On);class ia extends D{}class _l extends D{}class Bs extends D{}class Os extends G{}class yl extends Q{}class Ec extends Z{}class Ai extends ie{}class Pn extends pe{}class ps extends J{}class na extends ge{}class Di extends Te{}class qi extends Ue{}class _i extends st{}class Sr extends nt{}const Hr=I([{name:"a_pos",components:2,type:"Int16"}],4),{members:Pc}=Hr;class yi{constructor(e=[]){this.segments=e}prepareSegment(e,n,o,c){let f=this.segments[this.segments.length-1];return e>yi.MAX_VERTEX_ARRAY_LENGTH&&bt(`Max vertices per segment is ${yi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!f||f.vertexLength+e>yi.MAX_VERTEX_ARRAY_LENGTH||f.sortKey!==c)&&(f={vertexOffset:n.length,primitiveOffset:o.length,vertexLength:0,primitiveLength:0},c!==void 0&&(f.sortKey=c),this.segments.push(f)),f}get(){return this.segments}destroy(){for(const e of this.segments)for(const n in e.vaos)e.vaos[n].destroy()}static simpleSegment(e,n,o,c){return new yi([{vertexOffset:e,primitiveOffset:n,vertexLength:o,primitiveLength:c,vaos:{},sortKey:0}])}}function Ac(r,e){return 256*(r=rt(Math.floor(r),0,255))+rt(Math.floor(e),0,255)}yi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,_t("SegmentVector",yi);const wo=I([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var sa={exports:{}},fs={exports:{}};fs.exports=function(r,e){var n,o,c,f,g,y,x,k;for(o=r.length-(n=3&r.length),c=e,g=3432918353,y=461845907,k=0;k<o;)x=255&r.charCodeAt(k)|(255&r.charCodeAt(++k))<<8|(255&r.charCodeAt(++k))<<16|(255&r.charCodeAt(++k))<<24,++k,c=27492+(65535&(f=5*(65535&(c=(c^=x=(65535&(x=(x=(65535&x)*g+(((x>>>16)*g&65535)<<16)&4294967295)<<15|x>>>17))*y+(((x>>>16)*y&65535)<<16)&4294967295)<<13|c>>>19))+((5*(c>>>16)&65535)<<16)&4294967295))+((58964+(f>>>16)&65535)<<16);switch(x=0,n){case 3:x^=(255&r.charCodeAt(k+2))<<16;case 2:x^=(255&r.charCodeAt(k+1))<<8;case 1:c^=x=(65535&(x=(x=(65535&(x^=255&r.charCodeAt(k)))*g+(((x>>>16)*g&65535)<<16)&4294967295)<<15|x>>>17))*y+(((x>>>16)*y&65535)<<16)&4294967295}return c^=r.length,c=2246822507*(65535&(c^=c>>>16))+((2246822507*(c>>>16)&65535)<<16)&4294967295,c=3266489909*(65535&(c^=c>>>13))+((3266489909*(c>>>16)&65535)<<16)&4294967295,(c^=c>>>16)>>>0};var Cu=fs.exports,vl={exports:{}};vl.exports=function(r,e){for(var n,o=r.length,c=e^o,f=0;o>=4;)n=1540483477*(65535&(n=255&r.charCodeAt(f)|(255&r.charCodeAt(++f))<<8|(255&r.charCodeAt(++f))<<16|(255&r.charCodeAt(++f))<<24))+((1540483477*(n>>>16)&65535)<<16),c=1540483477*(65535&c)+((1540483477*(c>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),o-=4,++f;switch(o){case 3:c^=(255&r.charCodeAt(f+2))<<16;case 2:c^=(255&r.charCodeAt(f+1))<<8;case 1:c=1540483477*(65535&(c^=255&r.charCodeAt(f)))+((1540483477*(c>>>16)&65535)<<16)}return c=1540483477*(65535&(c^=c>>>13))+((1540483477*(c>>>16)&65535)<<16),(c^=c>>>15)>>>0};var Dc=Cu,xl=vl.exports;sa.exports=Dc,sa.exports.murmur3=Dc,sa.exports.murmur2=xl;var bl=q(sa.exports);class Ua{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,n,o,c){this.ids.push(Fd(e)),this.positions.push(n,o,c)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const n=Fd(e);let o=0,c=this.ids.length-1;for(;o<c;){const g=o+c>>1;this.ids[g]>=n?c=g:o=g+1}const f=[];for(;this.ids[o]===n;)f.push({index:this.positions[3*o],start:this.positions[3*o+1],end:this.positions[3*o+2]}),o++;return f}static serialize(e,n){const o=new Float64Array(e.ids),c=new Uint32Array(e.positions);return Iu(o,c,0,o.length-1),n&&n.push(o.buffer,c.buffer),{ids:o,positions:c}}static deserialize(e){const n=new Ua;return n.ids=e.ids,n.positions=e.positions,n.indexed=!0,n}}function Fd(r){const e=+r;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:bl(String(r))}function Iu(r,e,n,o){for(;n<o;){const c=r[n+o>>1];let f=n-1,g=o+1;for(;;){do f++;while(r[f]<c);do g--;while(r[g]>c);if(f>=g)break;zc(r,f,g),zc(e,3*f,3*g),zc(e,3*f+1,3*g+1),zc(e,3*f+2,3*g+2)}g-n<o-g?(Iu(r,e,n,g),n=g+1):(Iu(r,e,g+1,o),o=g)}}function zc(r,e,n){const o=r[e];r[e]=r[n],r[n]=o}_t("FeaturePositionMap",Ua);class So{constructor(e,n){this.gl=e.gl,this.location=n}}class Mo extends So{constructor(e,n){super(e,n),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class Eu extends So{constructor(e,n){super(e,n),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class Ph extends So{constructor(e,n){super(e,n),this.current=Pr.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const Bd=new Float32Array(16);function Ah(r){return[Ac(255*r.r,255*r.g),Ac(255*r.b,255*r.a)]}class di{constructor(e,n,o){this.value=e,this.uniformNames=n.map(c=>`u_${c}`),this.type=o}setUniform(e,n,o){e.set(o.constantOr(this.value))}getBinding(e,n,o){return this.type==="color"?new Ph(e,n):new Mo(e,n)}}class wl{constructor(e,n){this.uniformNames=n.map(o=>`u_${o}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,n){this.pixelRatioFrom=n.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=n.tlbr,this.patternTo=e.tlbr}setUniform(e,n,o,c){const f=c==="u_pattern_to"?this.patternTo:c==="u_pattern_from"?this.patternFrom:c==="u_pixel_ratio_to"?this.pixelRatioTo:c==="u_pixel_ratio_from"?this.pixelRatioFrom:null;f&&e.set(f)}getBinding(e,n,o){return o.substr(0,9)==="u_pattern"?new Eu(e,n):new Mo(e,n)}}class C{constructor(e,n,o,c){this.expression=e,this.type=o,this.maxValue=0,this.paintVertexAttributes=n.map(f=>({name:`a_${f}`,type:"Float32",components:o==="color"?2:1,offset:0})),this.paintVertexArray=new c}populatePaintArray(e,n,o,c,f){const g=this.paintVertexArray.length,y=this.expression.evaluate(new Fr(0),n,{},c,[],f);this.paintVertexArray.resize(e),this._setPaintValue(g,e,y)}updatePaintArray(e,n,o,c){const f=this.expression.evaluate({zoom:0},o,c);this._setPaintValue(e,n,f)}_setPaintValue(e,n,o){if(this.type==="color"){const c=Ah(o);for(let f=e;f<n;f++)this.paintVertexArray.emplace(f,c[0],c[1])}else{for(let c=e;c<n;c++)this.paintVertexArray.emplace(c,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class A{constructor(e,n,o,c,f,g){this.expression=e,this.uniformNames=n.map(y=>`u_${y}_t`),this.type=o,this.useIntegerZoom=c,this.zoom=f,this.maxValue=0,this.paintVertexAttributes=n.map(y=>({name:`a_${y}`,type:"Float32",components:o==="color"?4:2,offset:0})),this.paintVertexArray=new g}populatePaintArray(e,n,o,c,f){const g=this.expression.evaluate(new Fr(this.zoom),n,{},c,[],f),y=this.expression.evaluate(new Fr(this.zoom+1),n,{},c,[],f),x=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(x,e,g,y)}updatePaintArray(e,n,o,c){const f=this.expression.evaluate({zoom:this.zoom},o,c),g=this.expression.evaluate({zoom:this.zoom+1},o,c);this._setPaintValue(e,n,f,g)}_setPaintValue(e,n,o,c){if(this.type==="color"){const f=Ah(o),g=Ah(c);for(let y=e;y<n;y++)this.paintVertexArray.emplace(y,f[0],f[1],g[0],g[1])}else{for(let f=e;f<n;f++)this.paintVertexArray.emplace(f,o,c);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(c))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,n){const o=this.useIntegerZoom?Math.floor(n.zoom):n.zoom,c=rt(this.expression.interpolationFactor(o,this.zoom,this.zoom+1),0,1);e.set(c)}getBinding(e,n,o){return new Mo(e,n)}}class N{constructor(e,n,o,c,f,g){this.expression=e,this.type=n,this.useIntegerZoom=o,this.zoom=c,this.layerId=g,this.zoomInPaintVertexArray=new f,this.zoomOutPaintVertexArray=new f}populatePaintArray(e,n,o){const c=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(c,e,n.patterns&&n.patterns[this.layerId],o)}updatePaintArray(e,n,o,c,f){this._setPaintValues(e,n,o.patterns&&o.patterns[this.layerId],f)}_setPaintValues(e,n,o,c){if(!c||!o)return;const{min:f,mid:g,max:y}=o,x=c[f],k=c[g],E=c[y];if(x&&k&&E)for(let P=e;P<n;P++)this.zoomInPaintVertexArray.emplace(P,k.tl[0],k.tl[1],k.br[0],k.br[1],x.tl[0],x.tl[1],x.br[0],x.br[1],k.pixelRatio,x.pixelRatio),this.zoomOutPaintVertexArray.emplace(P,k.tl[0],k.tl[1],k.br[0],k.br[1],E.tl[0],E.tl[1],E.br[0],E.br[1],k.pixelRatio,E.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,wo.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,wo.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class K{constructor(e,n,o){this.binders={},this._buffers=[];const c=[];for(const f in e.paint._values){if(!o(f))continue;const g=e.paint.get(f);if(!(g instanceof Yn&&Xn(g.property.specification)))continue;const y=ye(f,e.type),x=g.value,k=g.property.specification.type,E=g.property.useIntegerZoom,P=g.property.specification["property-type"],L=P==="cross-faded"||P==="cross-faded-data-driven";if(x.kind==="constant")this.binders[f]=L?new wl(x.value,y):new di(x.value,y,k),c.push(`/u_${f}`);else if(x.kind==="source"||L){const F=ae(f,k,"source");this.binders[f]=L?new N(x,k,E,n,F,e.id):new C(x,y,k,F),c.push(`/a_${f}`)}else{const F=ae(f,k,"composite");this.binders[f]=new A(x,y,k,E,n,F),c.push(`/z_${f}`)}}this.cacheKey=c.sort().join("")}getMaxValue(e){const n=this.binders[e];return n instanceof C||n instanceof A?n.maxValue:0}populatePaintArrays(e,n,o,c,f){for(const g in this.binders){const y=this.binders[g];(y instanceof C||y instanceof A||y instanceof N)&&y.populatePaintArray(e,n,o,c,f)}}setConstantPatternPositions(e,n){for(const o in this.binders){const c=this.binders[o];c instanceof wl&&c.setConstantPatternPositions(e,n)}}updatePaintArrays(e,n,o,c,f){let g=!1;for(const y in e){const x=n.getPositions(y);for(const k of x){const E=o.feature(k.index);for(const P in this.binders){const L=this.binders[P];if((L instanceof C||L instanceof A||L instanceof N)&&L.expression.isStateDependent===!0){const F=c.paint.get(P);L.expression=F.value,L.updatePaintArray(k.start,k.end,E,e[y],f),g=!0}}}}return g}defines(){const e=[];for(const n in this.binders){const o=this.binders[n];(o instanceof di||o instanceof wl)&&e.push(...o.uniformNames.map(c=>`#define HAS_UNIFORM_${c}`))}return e}getBinderAttributes(){const e=[];for(const n in this.binders){const o=this.binders[n];if(o instanceof C||o instanceof A)for(let c=0;c<o.paintVertexAttributes.length;c++)e.push(o.paintVertexAttributes[c].name);else if(o instanceof N)for(let c=0;c<wo.members.length;c++)e.push(wo.members[c].name)}return e}getBinderUniforms(){const e=[];for(const n in this.binders){const o=this.binders[n];if(o instanceof di||o instanceof wl||o instanceof A)for(const c of o.uniformNames)e.push(c)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,n){const o=[];for(const c in this.binders){const f=this.binders[c];if(f instanceof di||f instanceof wl||f instanceof A){for(const g of f.uniformNames)if(n[g]){const y=f.getBinding(e,n[g],g);o.push({name:g,property:c,binding:y})}}}return o}setUniforms(e,n,o,c){for(const{name:f,property:g,binding:y}of n)this.binders[g].setUniform(y,c,o.get(g),f)}updatePaintBuffers(e){this._buffers=[];for(const n in this.binders){const o=this.binders[n];if(e&&o instanceof N){const c=e.fromScale===2?o.zoomInPaintVertexBuffer:o.zoomOutPaintVertexBuffer;c&&this._buffers.push(c)}else(o instanceof C||o instanceof A)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(e){for(const n in this.binders){const o=this.binders[n];(o instanceof C||o instanceof A||o instanceof N)&&o.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const n=this.binders[e];(n instanceof C||n instanceof A||n instanceof N)&&n.destroy()}}}class ue{constructor(e,n,o=()=>!0){this.programConfigurations={};for(const c of e)this.programConfigurations[c.id]=new K(c,n,o);this.needsUpload=!1,this._featureMap=new Ua,this._bufferOffset=0}populatePaintArrays(e,n,o,c,f,g){for(const y in this.programConfigurations)this.programConfigurations[y].populatePaintArrays(e,n,c,f,g);n.id!==void 0&&this._featureMap.add(n.id,o,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,n,o,c){for(const f of o)this.needsUpload=this.programConfigurations[f.id].updatePaintArrays(e,this._featureMap,n,f,c)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function ye(r,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[r]||[r.replace(`${e}-`,"").replace(/-/g,"_")]}function ae(r,e,n){const o={color:{source:Z,composite:Bt},number:{source:tt,composite:Z}},c=function(f){return{"line-pattern":{source:Ai,composite:Ai},"fill-pattern":{source:Ai,composite:Ai},"fill-extrusion-pattern":{source:Ai,composite:Ai}}[f]}(r);return c&&c[n]||o[e][n]}_t("ConstantBinder",di),_t("CrossFadedConstantBinder",wl),_t("SourceExpressionBinder",C),_t("CrossFadedCompositeBinder",N),_t("CompositeExpressionBinder",A),_t("ProgramConfiguration",K,{omit:["_buffers"]}),_t("ProgramConfigurationSet",ue);const be=8192,Ie=Math.pow(2,14)-1,Ve=-Ie-1;function He(r){const e=be/r.extent,n=r.loadGeometry();for(let o=0;o<n.length;o++){const c=n[o];for(let f=0;f<c.length;f++){const g=c[f],y=Math.round(g.x*e),x=Math.round(g.y*e);g.x=rt(y,Ve,Ie),g.y=rt(x,Ve,Ie),(y<g.x||y>g.x+1||x<g.y||x>g.y+1)&&bt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return n}function mt(r,e){return{type:r.type,id:r.id,properties:r.properties,geometry:e?He(r):[]}}function et(r,e,n,o,c){r.emplaceBack(2*e+(o+1)/2,2*n+(c+1)/2)}class Ct{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new _l,this.indexArray=new _i,this.segments=new yi,this.programConfigurations=new ue(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,o){const c=this.layers[0],f=[];let g=null,y=!1;c.type==="circle"&&(g=c.layout.get("circle-sort-key"),y=!g.isConstant());for(const{feature:x,id:k,index:E,sourceLayerIndex:P}of e){const L=this.layers[0]._featureFilter.needGeometry,F=mt(x,L);if(!this.layers[0]._featureFilter.filter(new Fr(this.zoom),F,o))continue;const $=y?g.evaluate(F,{},o):void 0,U={id:k,properties:x.properties,type:x.type,sourceLayerIndex:P,index:E,geometry:L?F.geometry:He(x),patterns:{},sortKey:$};f.push(U)}y&&f.sort((x,k)=>x.sortKey-k.sortKey);for(const x of f){const{geometry:k,index:E,sourceLayerIndex:P}=x,L=e[E].feature;this.addFeature(x,k,E,o),n.featureIndex.insert(L,k,E,P,this.index)}}update(e,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Pc),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,o,c){for(const f of n)for(const g of f){const y=g.x,x=g.y;if(y<0||y>=be||x<0||x>=be)continue;const k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),E=k.vertexLength;et(this.layoutVertexArray,y,x,-1,-1),et(this.layoutVertexArray,y,x,1,-1),et(this.layoutVertexArray,y,x,1,1),et(this.layoutVertexArray,y,x,-1,1),this.indexArray.emplaceBack(E,E+1,E+2),this.indexArray.emplaceBack(E,E+3,E+2),k.vertexLength+=4,k.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{},c)}}function It(r,e){for(let n=0;n<r.length;n++)if(Qe(e,r[n]))return!0;for(let n=0;n<e.length;n++)if(Qe(r,e[n]))return!0;return!!Cr(r,e)}function pr(r,e,n){return!!Qe(r,e)||!!Mi(e,r,n)}function mr(r,e){if(r.length===1)return gr(e,r[0]);for(let n=0;n<e.length;n++){const o=e[n];for(let c=0;c<o.length;c++)if(Qe(r,o[c]))return!0}for(let n=0;n<r.length;n++)if(gr(e,r[n]))return!0;for(let n=0;n<e.length;n++)if(Cr(r,e[n]))return!0;return!1}function Mr(r,e,n){if(r.length>1){if(Cr(r,e))return!0;for(let o=0;o<e.length;o++)if(Mi(e[o],r,n))return!0}for(let o=0;o<r.length;o++)if(Mi(r[o],e,n))return!0;return!1}function Cr(r,e){if(r.length===0||e.length===0)return!1;for(let n=0;n<r.length-1;n++){const o=r[n],c=r[n+1];for(let f=0;f<e.length-1;f++)if(Qi(o,c,e[f],e[f+1]))return!0}return!1}function Qi(r,e,n,o){return Et(r,n,o)!==Et(e,n,o)&&Et(r,e,n)!==Et(r,e,o)}function Mi(r,e,n){const o=n*n;if(e.length===1)return r.distSqr(e[0])<o;for(let c=1;c<e.length;c++)if(bn(r,e[c-1],e[c])<o)return!0;return!1}function bn(r,e,n){const o=e.distSqr(n);if(o===0)return r.distSqr(e);const c=((r.x-e.x)*(n.x-e.x)+(r.y-e.y)*(n.y-e.y))/o;return r.distSqr(c<0?e:c>1?n:n.sub(e)._mult(c)._add(e))}function gr(r,e){let n,o,c,f=!1;for(let g=0;g<r.length;g++){n=r[g];for(let y=0,x=n.length-1;y<n.length;x=y++)o=n[y],c=n[x],o.y>e.y!=c.y>e.y&&e.x<(c.x-o.x)*(e.y-o.y)/(c.y-o.y)+o.x&&(f=!f)}return f}function Qe(r,e){let n=!1;for(let o=0,c=r.length-1;o<r.length;c=o++){const f=r[o],g=r[c];f.y>e.y!=g.y>e.y&&e.x<(g.x-f.x)*(e.y-f.y)/(g.y-f.y)+f.x&&(n=!n)}return n}function Vt(r,e,n){const o=n[0],c=n[2];if(r.x<o.x&&e.x<o.x||r.x>c.x&&e.x>c.x||r.y<o.y&&e.y<o.y||r.y>c.y&&e.y>c.y)return!1;const f=Et(r,e,n[0]);return f!==Et(r,e,n[1])||f!==Et(r,e,n[2])||f!==Et(r,e,n[3])}function tr(r,e,n){const o=e.paint.get(r).value;return o.kind==="constant"?o.value:n.programConfigurations.get(e.id).getMaxValue(r)}function rr(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function ki(r,e,n,o,c){if(!e[0]&&!e[1])return r;const f=le.convert(e)._mult(c);n==="viewport"&&f._rotate(-o);const g=[];for(let y=0;y<r.length;y++)g.push(r[y].sub(f));return g}let Wr,vr;_t("CircleBucket",Ct,{omit:["layers"]});var Lr={get paint(){return vr=vr||new l({"circle-radius":new Ft(Ce.paint_circle["circle-radius"]),"circle-color":new Ft(Ce.paint_circle["circle-color"]),"circle-blur":new Ft(Ce.paint_circle["circle-blur"]),"circle-opacity":new Ft(Ce.paint_circle["circle-opacity"]),"circle-translate":new Tt(Ce.paint_circle["circle-translate"]),"circle-translate-anchor":new Tt(Ce.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Tt(Ce.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Tt(Ce.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ft(Ce.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ft(Ce.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ft(Ce.paint_circle["circle-stroke-opacity"])})},get layout(){return Wr=Wr||new l({"circle-sort-key":new Ft(Ce.layout_circle["circle-sort-key"])})}},Kt=1e-6,kr=typeof Float32Array<"u"?Float32Array:Array;function Nn(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function aa(r,e,n){var o=e[0],c=e[1],f=e[2],g=e[3],y=e[4],x=e[5],k=e[6],E=e[7],P=e[8],L=e[9],F=e[10],$=e[11],U=e[12],W=e[13],re=e[14],we=e[15],oe=n[0],ve=n[1],Be=n[2],Oe=n[3];return r[0]=oe*o+ve*y+Be*P+Oe*U,r[1]=oe*c+ve*x+Be*L+Oe*W,r[2]=oe*f+ve*k+Be*F+Oe*re,r[3]=oe*g+ve*E+Be*$+Oe*we,r[4]=(oe=n[4])*o+(ve=n[5])*y+(Be=n[6])*P+(Oe=n[7])*U,r[5]=oe*c+ve*x+Be*L+Oe*W,r[6]=oe*f+ve*k+Be*F+Oe*re,r[7]=oe*g+ve*E+Be*$+Oe*we,r[8]=(oe=n[8])*o+(ve=n[9])*y+(Be=n[10])*P+(Oe=n[11])*U,r[9]=oe*c+ve*x+Be*L+Oe*W,r[10]=oe*f+ve*k+Be*F+Oe*re,r[11]=oe*g+ve*E+Be*$+Oe*we,r[12]=(oe=n[12])*o+(ve=n[13])*y+(Be=n[14])*P+(Oe=n[15])*U,r[13]=oe*c+ve*x+Be*L+Oe*W,r[14]=oe*f+ve*k+Be*F+Oe*re,r[15]=oe*g+ve*E+Be*$+Oe*we,r}Math.hypot||(Math.hypot=function(){for(var r=0,e=arguments.length;e--;)r+=arguments[e]*arguments[e];return Math.sqrt(r)});var Qn,Sl=aa;function oa(r,e,n){var o=e[0],c=e[1],f=e[2],g=e[3];return r[0]=n[0]*o+n[4]*c+n[8]*f+n[12]*g,r[1]=n[1]*o+n[5]*c+n[9]*f+n[13]*g,r[2]=n[2]*o+n[6]*c+n[10]*f+n[14]*g,r[3]=n[3]*o+n[7]*c+n[11]*f+n[15]*g,r}Qn=new kr(4),kr!=Float32Array&&(Qn[0]=0,Qn[1]=0,Qn[2]=0,Qn[3]=0);class la extends m{constructor(e){super(e,Lr)}createBucket(e){return new Ct(e)}queryRadius(e){const n=e;return tr("circle-radius",this,n)+tr("circle-stroke-width",this,n)+rr(this.paint.get("circle-translate"))}queryIntersectsFeature(e,n,o,c,f,g,y,x){const k=ki(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),g.angle,y),E=this.paint.get("circle-radius").evaluate(n,o)+this.paint.get("circle-stroke-width").evaluate(n,o),P=this.paint.get("circle-pitch-alignment")==="map",L=P?k:function($,U){return $.map(W=>qa(W,U))}(k,x),F=P?E*y:E;for(const $ of c)for(const U of $){const W=P?U:qa(U,x);let re=F;const we=oa([],[U.x,U.y,0,1],x);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?re*=we[3]/g.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(re*=g.cameraToCenterDistance/we[3]),pr(L,W,re))return!0}return!1}}function qa(r,e){const n=oa([],[r.x,r.y,0,1],e);return new le(n[0]/n[3],n[1]/n[3])}class Ml extends Ct{}let Ga;_t("HeatmapBucket",Ml,{omit:["layers"]});var Dh={get paint(){return Ga=Ga||new l({"heatmap-radius":new Ft(Ce.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ft(Ce.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Tt(Ce.paint_heatmap["heatmap-intensity"]),"heatmap-color":new s(Ce.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Tt(Ce.paint_heatmap["heatmap-opacity"])})}};function Lc(r,{width:e,height:n},o,c){if(c){if(c instanceof Uint8ClampedArray)c=new Uint8Array(c.buffer);else if(c.length!==e*n*o)throw new RangeError(`mismatched image size. expected: ${c.length} but got: ${e*n*o}`)}else c=new Uint8Array(e*n*o);return r.width=e,r.height=n,r.data=c,r}function m_(r,{width:e,height:n},o){if(e===r.width&&n===r.height)return;const c=Lc({},{width:e,height:n},o);_f(r,c,{x:0,y:0},{x:0,y:0},{width:Math.min(r.width,e),height:Math.min(r.height,n)},o),r.width=e,r.height=n,r.data=c.data}function _f(r,e,n,o,c,f){if(c.width===0||c.height===0)return e;if(c.width>r.width||c.height>r.height||n.x>r.width-c.width||n.y>r.height-c.height)throw new RangeError("out of range source coordinates for image copy");if(c.width>e.width||c.height>e.height||o.x>e.width-c.width||o.y>e.height-c.height)throw new RangeError("out of range destination coordinates for image copy");const g=r.data,y=e.data;if(g===y)throw new Error("srcData equals dstData, so image is already copied");for(let x=0;x<c.height;x++){const k=((n.y+x)*r.width+n.x)*f,E=((o.y+x)*e.width+o.x)*f;for(let P=0;P<c.width*f;P++)y[E+P]=g[k+P]}return e}class zh{constructor(e,n){Lc(this,e,1,n)}resize(e){m_(this,e,1)}clone(){return new zh({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,o,c,f){_f(e,n,o,c,f,1)}}class ms{constructor(e,n){Lc(this,e,4,n)}resize(e){m_(this,e,4)}replace(e,n){n?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new ms({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,o,c,f){_f(e,n,o,c,f,4)}}function g_(r){const e={},n=r.resolution||256,o=r.clips?r.clips.length:1,c=r.image||new ms({width:n,height:o});if(Math.log(n)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${n}`);const f=(g,y,x)=>{e[r.evaluationKey]=x;const k=r.expression.evaluate(e);c.data[g+y+0]=Math.floor(255*k.r/k.a),c.data[g+y+1]=Math.floor(255*k.g/k.a),c.data[g+y+2]=Math.floor(255*k.b/k.a),c.data[g+y+3]=Math.floor(255*k.a)};if(r.clips)for(let g=0,y=0;g<o;++g,y+=4*n)for(let x=0,k=0;x<n;x++,k+=4){const E=x/(n-1),{start:P,end:L}=r.clips[g];f(y,k,P*(1-E)+L*E)}else for(let g=0,y=0;g<n;g++,y+=4)f(0,y,g/(n-1));return c}_t("AlphaImage",zh),_t("RGBAImage",ms);class fx extends m{createBucket(e){return new Ml(e)}constructor(e){super(e,Dh),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=g_({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let __;var mx={get paint(){return __=__||new l({"hillshade-illumination-direction":new Tt(Ce.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Tt(Ce.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Tt(Ce.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Tt(Ce.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Tt(Ce.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Tt(Ce.paint_hillshade["hillshade-accent-color"])})}};class gx extends m{constructor(e){super(e,mx)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const _x=I([{name:"a_pos",components:2,type:"Int16"}],4),{members:yx}=_x;var yf={exports:{}};function Od(r,e,n){n=n||2;var o,c,f,g,y,x,k,E=e&&e.length,P=E?e[0]*n:r.length,L=y_(r,0,P,n,!0),F=[];if(!L||L.next===L.prev)return F;if(E&&(L=function(U,W,re,we){var oe,ve,Be,Oe=[];for(oe=0,ve=W.length;oe<ve;oe++)(Be=y_(U,W[oe]*we,oe<ve-1?W[oe+1]*we:U.length,we,!1))===Be.next&&(Be.steiner=!0),Oe.push(Tx(Be));for(Oe.sort(Sx),oe=0;oe<Oe.length;oe++)re=Mx(Oe[oe],re);return re}(r,e,L,n)),r.length>80*n){o=f=r[0],c=g=r[1];for(var $=n;$<P;$+=n)(y=r[$])<o&&(o=y),(x=r[$+1])<c&&(c=x),y>f&&(f=y),x>g&&(g=x);k=(k=Math.max(f-o,g-c))!==0?32767/k:0}return Lh(L,F,n,o,c,k,0),F}function y_(r,e,n,o,c){var f,g;if(c===bf(r,e,n,o)>0)for(f=e;f<n;f+=o)g=b_(f,r[f],r[f+1],g);else for(f=n-o;f>=e;f-=o)g=b_(f,r[f],r[f+1],g);return g&&Nd(g,g.next)&&(Fh(g),g=g.next),g}function Rc(r,e){if(!r)return r;e||(e=r);var n,o=r;do if(n=!1,o.steiner||!Nd(o,o.next)&&vi(o.prev,o,o.next)!==0)o=o.next;else{if(Fh(o),(o=e=o.prev)===o.next)break;n=!0}while(n||o!==e);return e}function Lh(r,e,n,o,c,f,g){if(r){!g&&f&&function(E,P,L,F){var $=E;do $.z===0&&($.z=vf($.x,$.y,P,L,F)),$.prevZ=$.prev,$.nextZ=$.next,$=$.next;while($!==E);$.prevZ.nextZ=null,$.prevZ=null,function(U){var W,re,we,oe,ve,Be,Oe,ft,kt=1;do{for(re=U,U=null,ve=null,Be=0;re;){for(Be++,we=re,Oe=0,W=0;W<kt&&(Oe++,we=we.nextZ);W++);for(ft=kt;Oe>0||ft>0&&we;)Oe!==0&&(ft===0||!we||re.z<=we.z)?(oe=re,re=re.nextZ,Oe--):(oe=we,we=we.nextZ,ft--),ve?ve.nextZ=oe:U=oe,oe.prevZ=ve,ve=oe;re=we}ve.nextZ=null,kt*=2}while(Be>1)}($)}(r,o,c,f);for(var y,x,k=r;r.prev!==r.next;)if(y=r.prev,x=r.next,f?xx(r,o,c,f):vx(r))e.push(y.i/n|0),e.push(r.i/n|0),e.push(x.i/n|0),Fh(r),r=x.next,k=x.next;else if((r=x)===k){g?g===1?Lh(r=bx(Rc(r),e,n),e,n,o,c,f,2):g===2&&wx(r,e,n,o,c,f):Lh(Rc(r),e,n,o,c,f,1);break}}}function vx(r){var e=r.prev,n=r,o=r.next;if(vi(e,n,o)>=0)return!1;for(var c=e.x,f=n.x,g=o.x,y=e.y,x=n.y,k=o.y,E=c<f?c<g?c:g:f<g?f:g,P=y<x?y<k?y:k:x<k?x:k,L=c>f?c>g?c:g:f>g?f:g,F=y>x?y>k?y:k:x>k?x:k,$=o.next;$!==e;){if($.x>=E&&$.x<=L&&$.y>=P&&$.y<=F&&Pu(c,y,f,x,g,k,$.x,$.y)&&vi($.prev,$,$.next)>=0)return!1;$=$.next}return!0}function xx(r,e,n,o){var c=r.prev,f=r,g=r.next;if(vi(c,f,g)>=0)return!1;for(var y=c.x,x=f.x,k=g.x,E=c.y,P=f.y,L=g.y,F=y<x?y<k?y:k:x<k?x:k,$=E<P?E<L?E:L:P<L?P:L,U=y>x?y>k?y:k:x>k?x:k,W=E>P?E>L?E:L:P>L?P:L,re=vf(F,$,e,n,o),we=vf(U,W,e,n,o),oe=r.prevZ,ve=r.nextZ;oe&&oe.z>=re&&ve&&ve.z<=we;){if(oe.x>=F&&oe.x<=U&&oe.y>=$&&oe.y<=W&&oe!==c&&oe!==g&&Pu(y,E,x,P,k,L,oe.x,oe.y)&&vi(oe.prev,oe,oe.next)>=0||(oe=oe.prevZ,ve.x>=F&&ve.x<=U&&ve.y>=$&&ve.y<=W&&ve!==c&&ve!==g&&Pu(y,E,x,P,k,L,ve.x,ve.y)&&vi(ve.prev,ve,ve.next)>=0))return!1;ve=ve.nextZ}for(;oe&&oe.z>=re;){if(oe.x>=F&&oe.x<=U&&oe.y>=$&&oe.y<=W&&oe!==c&&oe!==g&&Pu(y,E,x,P,k,L,oe.x,oe.y)&&vi(oe.prev,oe,oe.next)>=0)return!1;oe=oe.prevZ}for(;ve&&ve.z<=we;){if(ve.x>=F&&ve.x<=U&&ve.y>=$&&ve.y<=W&&ve!==c&&ve!==g&&Pu(y,E,x,P,k,L,ve.x,ve.y)&&vi(ve.prev,ve,ve.next)>=0)return!1;ve=ve.nextZ}return!0}function bx(r,e,n){var o=r;do{var c=o.prev,f=o.next.next;!Nd(c,f)&&v_(c,o,o.next,f)&&Rh(c,f)&&Rh(f,c)&&(e.push(c.i/n|0),e.push(o.i/n|0),e.push(f.i/n|0),Fh(o),Fh(o.next),o=r=f),o=o.next}while(o!==r);return Rc(o)}function wx(r,e,n,o,c,f){var g=r;do{for(var y=g.next.next;y!==g.prev;){if(g.i!==y.i&&Cx(g,y)){var x=x_(g,y);return g=Rc(g,g.next),x=Rc(x,x.next),Lh(g,e,n,o,c,f,0),void Lh(x,e,n,o,c,f,0)}y=y.next}g=g.next}while(g!==r)}function Sx(r,e){return r.x-e.x}function Mx(r,e){var n=function(c,f){var g,y=f,x=c.x,k=c.y,E=-1/0;do{if(k<=y.y&&k>=y.next.y&&y.next.y!==y.y){var P=y.x+(k-y.y)*(y.next.x-y.x)/(y.next.y-y.y);if(P<=x&&P>E&&(E=P,g=y.x<y.next.x?y:y.next,P===x))return g}y=y.next}while(y!==f);if(!g)return null;var L,F=g,$=g.x,U=g.y,W=1/0;y=g;do x>=y.x&&y.x>=$&&x!==y.x&&Pu(k<U?x:E,k,$,U,k<U?E:x,k,y.x,y.y)&&(L=Math.abs(k-y.y)/(x-y.x),Rh(y,c)&&(L<W||L===W&&(y.x>g.x||y.x===g.x&&kx(g,y)))&&(g=y,W=L)),y=y.next;while(y!==F);return g}(r,e);if(!n)return e;var o=x_(n,r);return Rc(o,o.next),Rc(n,n.next)}function kx(r,e){return vi(r.prev,r,e.prev)<0&&vi(e.next,r,r.next)<0}function vf(r,e,n,o,c){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-n)*c|0)|r<<8))|r<<4))|r<<2))|r<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-o)*c|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Tx(r){var e=r,n=r;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==r);return n}function Pu(r,e,n,o,c,f,g,y){return(c-g)*(e-y)>=(r-g)*(f-y)&&(r-g)*(o-y)>=(n-g)*(e-y)&&(n-g)*(f-y)>=(c-g)*(o-y)}function Cx(r,e){return r.next.i!==e.i&&r.prev.i!==e.i&&!function(n,o){var c=n;do{if(c.i!==n.i&&c.next.i!==n.i&&c.i!==o.i&&c.next.i!==o.i&&v_(c,c.next,n,o))return!0;c=c.next}while(c!==n);return!1}(r,e)&&(Rh(r,e)&&Rh(e,r)&&function(n,o){var c=n,f=!1,g=(n.x+o.x)/2,y=(n.y+o.y)/2;do c.y>y!=c.next.y>y&&c.next.y!==c.y&&g<(c.next.x-c.x)*(y-c.y)/(c.next.y-c.y)+c.x&&(f=!f),c=c.next;while(c!==n);return f}(r,e)&&(vi(r.prev,r,e.prev)||vi(r,e.prev,e))||Nd(r,e)&&vi(r.prev,r,r.next)>0&&vi(e.prev,e,e.next)>0)}function vi(r,e,n){return(e.y-r.y)*(n.x-e.x)-(e.x-r.x)*(n.y-e.y)}function Nd(r,e){return r.x===e.x&&r.y===e.y}function v_(r,e,n,o){var c=jd(vi(r,e,n)),f=jd(vi(r,e,o)),g=jd(vi(n,o,r)),y=jd(vi(n,o,e));return c!==f&&g!==y||!(c!==0||!$d(r,n,e))||!(f!==0||!$d(r,o,e))||!(g!==0||!$d(n,r,o))||!(y!==0||!$d(n,e,o))}function $d(r,e,n){return e.x<=Math.max(r.x,n.x)&&e.x>=Math.min(r.x,n.x)&&e.y<=Math.max(r.y,n.y)&&e.y>=Math.min(r.y,n.y)}function jd(r){return r>0?1:r<0?-1:0}function Rh(r,e){return vi(r.prev,r,r.next)<0?vi(r,e,r.next)>=0&&vi(r,r.prev,e)>=0:vi(r,e,r.prev)<0||vi(r,r.next,e)<0}function x_(r,e){var n=new xf(r.i,r.x,r.y),o=new xf(e.i,e.x,e.y),c=r.next,f=e.prev;return r.next=e,e.prev=r,n.next=c,c.prev=n,o.next=n,n.prev=o,f.next=o,o.prev=f,o}function b_(r,e,n,o){var c=new xf(r,e,n);return o?(c.next=o.next,c.prev=o,o.next.prev=c,o.next=c):(c.prev=c,c.next=c),c}function Fh(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function xf(r,e,n){this.i=r,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function bf(r,e,n,o){for(var c=0,f=e,g=n-o;f<n;f+=o)c+=(r[g]-r[f])*(r[f+1]+r[g+1]),g=f;return c}yf.exports=Od,yf.exports.default=Od,Od.deviation=function(r,e,n,o){var c=e&&e.length,f=Math.abs(bf(r,0,c?e[0]*n:r.length,n));if(c)for(var g=0,y=e.length;g<y;g++)f-=Math.abs(bf(r,e[g]*n,g<y-1?e[g+1]*n:r.length,n));var x=0;for(g=0;g<o.length;g+=3){var k=o[g]*n,E=o[g+1]*n,P=o[g+2]*n;x+=Math.abs((r[k]-r[P])*(r[E+1]-r[k+1])-(r[k]-r[E])*(r[P+1]-r[k+1]))}return f===0&&x===0?0:Math.abs((x-f)/f)},Od.flatten=function(r){for(var e=r[0][0].length,n={vertices:[],holes:[],dimensions:e},o=0,c=0;c<r.length;c++){for(var f=0;f<r[c].length;f++)for(var g=0;g<e;g++)n.vertices.push(r[c][f][g]);c>0&&n.holes.push(o+=r[c-1].length)}return n};var w_=q(yf.exports);function wf(r,e,n){const o=n.patternDependencies;let c=!1;for(const f of e){const g=f.paint.get(`${r}-pattern`);g.isConstant()||(c=!0);const y=g.constantOr(null);y&&(c=!0,o[y.to]=!0,o[y.from]=!0)}return c}function Sf(r,e,n,o,c){const f=c.patternDependencies;for(const g of e){const y=g.paint.get(`${r}-pattern`).value;if(y.kind!=="constant"){let x=y.evaluate({zoom:o-1},n,{},c.availableImages),k=y.evaluate({zoom:o},n,{},c.availableImages),E=y.evaluate({zoom:o+1},n,{},c.availableImages);x=x&&x.name?x.name:x,k=k&&k.name?k.name:k,E=E&&E.name?E.name:E,f[x]=!0,f[k]=!0,f[E]=!0,n.patterns[g.id]={min:x,mid:k,max:E}}}return n}class Mf{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Bs,this.indexArray=new _i,this.indexArray2=new Sr,this.programConfigurations=new ue(e.layers,e.zoom),this.segments=new yi,this.segments2=new yi,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,o){this.hasPattern=wf("fill",this.layers,n);const c=this.layers[0].layout.get("fill-sort-key"),f=!c.isConstant(),g=[];for(const{feature:y,id:x,index:k,sourceLayerIndex:E}of e){const P=this.layers[0]._featureFilter.needGeometry,L=mt(y,P);if(!this.layers[0]._featureFilter.filter(new Fr(this.zoom),L,o))continue;const F=f?c.evaluate(L,{},o,n.availableImages):void 0,$={id:x,properties:y.properties,type:y.type,sourceLayerIndex:E,index:k,geometry:P?L.geometry:He(y),patterns:{},sortKey:F};g.push($)}f&&g.sort((y,x)=>y.sortKey-x.sortKey);for(const y of g){const{geometry:x,index:k,sourceLayerIndex:E}=y;if(this.hasPattern){const P=Sf("fill",this.layers,y,this.zoom,n);this.patternFeatures.push(P)}else this.addFeature(y,x,k,o,{});n.featureIndex.insert(e[k].feature,x,k,E,this.index)}}update(e,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,o)}addFeatures(e,n,o){for(const c of this.patternFeatures)this.addFeature(c,c.geometry,c.index,n,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,yx),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,n,o,c,f){for(const g of Ho(n,500)){let y=0;for(const F of g)y+=F.length;const x=this.segments.prepareSegment(y,this.layoutVertexArray,this.indexArray),k=x.vertexLength,E=[],P=[];for(const F of g){if(F.length===0)continue;F!==g[0]&&P.push(E.length/2);const $=this.segments2.prepareSegment(F.length,this.layoutVertexArray,this.indexArray2),U=$.vertexLength;this.layoutVertexArray.emplaceBack(F[0].x,F[0].y),this.indexArray2.emplaceBack(U+F.length-1,U),E.push(F[0].x),E.push(F[0].y);for(let W=1;W<F.length;W++)this.layoutVertexArray.emplaceBack(F[W].x,F[W].y),this.indexArray2.emplaceBack(U+W-1,U+W),E.push(F[W].x),E.push(F[W].y);$.vertexLength+=F.length,$.primitiveLength+=F.length}const L=w_(E,P);for(let F=0;F<L.length;F+=3)this.indexArray.emplaceBack(k+L[F],k+L[F+1],k+L[F+2]);x.vertexLength+=y,x.primitiveLength+=L.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,f,c)}}let S_,M_;_t("FillBucket",Mf,{omit:["layers","patternFeatures"]});var Ix={get paint(){return M_=M_||new l({"fill-antialias":new Tt(Ce.paint_fill["fill-antialias"]),"fill-opacity":new Ft(Ce.paint_fill["fill-opacity"]),"fill-color":new Ft(Ce.paint_fill["fill-color"]),"fill-outline-color":new Ft(Ce.paint_fill["fill-outline-color"]),"fill-translate":new Tt(Ce.paint_fill["fill-translate"]),"fill-translate-anchor":new Tt(Ce.paint_fill["fill-translate-anchor"]),"fill-pattern":new p(Ce.paint_fill["fill-pattern"])})},get layout(){return S_=S_||new l({"fill-sort-key":new Ft(Ce.layout_fill["fill-sort-key"])})}};class Ex extends m{constructor(e){super(e,Ix)}recalculate(e,n){super.recalculate(e,n);const o=this.paint._values["fill-outline-color"];o.value.kind==="constant"&&o.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new Mf(e)}queryRadius(){return rr(this.paint.get("fill-translate"))}queryIntersectsFeature(e,n,o,c,f,g,y){return mr(ki(e,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),g.angle,y),c)}isTileClipped(){return!0}}const Px=I([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Ax=I([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Dx}=Px;var kl={},zx=me,k_=Au;function Au(r,e,n,o,c){this.properties={},this.extent=n,this.type=0,this._pbf=r,this._geometry=-1,this._keys=o,this._values=c,r.readFields(Lx,this,e)}function Lx(r,e,n){r==1?e.id=n.readVarint():r==2?function(o,c){for(var f=o.readVarint()+o.pos;o.pos<f;){var g=c._keys[o.readVarint()],y=c._values[o.readVarint()];c.properties[g]=y}}(n,e):r==3?e.type=n.readVarint():r==4&&(e._geometry=n.pos)}function Rx(r){for(var e,n,o=0,c=0,f=r.length,g=f-1;c<f;g=c++)o+=((n=r[g]).x-(e=r[c]).x)*(e.y+n.y);return o}Au.types=["Unknown","Point","LineString","Polygon"],Au.prototype.loadGeometry=function(){var r=this._pbf;r.pos=this._geometry;for(var e,n=r.readVarint()+r.pos,o=1,c=0,f=0,g=0,y=[];r.pos<n;){if(c<=0){var x=r.readVarint();o=7&x,c=x>>3}if(c--,o===1||o===2)f+=r.readSVarint(),g+=r.readSVarint(),o===1&&(e&&y.push(e),e=[]),e.push(new zx(f,g));else{if(o!==7)throw new Error("unknown command "+o);e&&e.push(e[0].clone())}}return e&&y.push(e),y},Au.prototype.bbox=function(){var r=this._pbf;r.pos=this._geometry;for(var e=r.readVarint()+r.pos,n=1,o=0,c=0,f=0,g=1/0,y=-1/0,x=1/0,k=-1/0;r.pos<e;){if(o<=0){var E=r.readVarint();n=7&E,o=E>>3}if(o--,n===1||n===2)(c+=r.readSVarint())<g&&(g=c),c>y&&(y=c),(f+=r.readSVarint())<x&&(x=f),f>k&&(k=f);else if(n!==7)throw new Error("unknown command "+n)}return[g,x,y,k]},Au.prototype.toGeoJSON=function(r,e,n){var o,c,f=this.extent*Math.pow(2,n),g=this.extent*r,y=this.extent*e,x=this.loadGeometry(),k=Au.types[this.type];function E(F){for(var $=0;$<F.length;$++){var U=F[$];F[$]=[360*(U.x+g)/f-180,360/Math.PI*Math.atan(Math.exp((180-360*(U.y+y)/f)*Math.PI/180))-90]}}switch(this.type){case 1:var P=[];for(o=0;o<x.length;o++)P[o]=x[o][0];E(x=P);break;case 2:for(o=0;o<x.length;o++)E(x[o]);break;case 3:for(x=function(F){var $=F.length;if($<=1)return[F];for(var U,W,re=[],we=0;we<$;we++){var oe=Rx(F[we]);oe!==0&&(W===void 0&&(W=oe<0),W===oe<0?(U&&re.push(U),U=[F[we]]):U.push(F[we]))}return U&&re.push(U),re}(x),o=0;o<x.length;o++)for(c=0;c<x[o].length;c++)E(x[o][c])}x.length===1?x=x[0]:k="Multi"+k;var L={type:"Feature",geometry:{type:k,coordinates:x},properties:this.properties};return"id"in this&&(L.id=this.id),L};var Fx=k_,T_=C_;function C_(r,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=r,this._keys=[],this._values=[],this._features=[],r.readFields(Bx,this,e),this.length=this._features.length}function Bx(r,e,n){r===15?e.version=n.readVarint():r===1?e.name=n.readString():r===5?e.extent=n.readVarint():r===2?e._features.push(n.pos):r===3?e._keys.push(n.readString()):r===4&&e._values.push(function(o){for(var c=null,f=o.readVarint()+o.pos;o.pos<f;){var g=o.readVarint()>>3;c=g===1?o.readString():g===2?o.readFloat():g===3?o.readDouble():g===4?o.readVarint64():g===5?o.readVarint():g===6?o.readSVarint():g===7?o.readBoolean():null}return c}(n))}C_.prototype.feature=function(r){if(r<0||r>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[r];var e=this._pbf.readVarint()+this._pbf.pos;return new Fx(this._pbf,e,this.extent,this._keys,this._values)};var Ox=T_;function Nx(r,e,n){if(r===3){var o=new Ox(n,n.readVarint()+n.pos);o.length&&(e[o.name]=o)}}kl.VectorTile=function(r,e){this.layers=r.readFields(Nx,{},e)},kl.VectorTileFeature=k_,kl.VectorTileLayer=T_;const $x=kl.VectorTileFeature.types,kf=Math.pow(2,13);function Bh(r,e,n,o,c,f,g,y){r.emplaceBack(e,n,2*Math.floor(o*kf)+g,c*kf*2,f*kf*2,Math.round(y))}class Tf{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Os,this.centroidVertexArray=new ia,this.indexArray=new _i,this.programConfigurations=new ue(e.layers,e.zoom),this.segments=new yi,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,o){this.features=[],this.hasPattern=wf("fill-extrusion",this.layers,n);for(const{feature:c,id:f,index:g,sourceLayerIndex:y}of e){const x=this.layers[0]._featureFilter.needGeometry,k=mt(c,x);if(!this.layers[0]._featureFilter.filter(new Fr(this.zoom),k,o))continue;const E={id:f,sourceLayerIndex:y,index:g,geometry:x?k.geometry:He(c),properties:c.properties,type:c.type,patterns:{}};this.hasPattern?this.features.push(Sf("fill-extrusion",this.layers,E,this.zoom,n)):this.addFeature(E,E.geometry,g,o,{}),n.featureIndex.insert(c,E.geometry,g,y,this.index,!0)}}addFeatures(e,n,o){for(const c of this.features){const{geometry:f}=c;this.addFeature(c,f,c.index,n,o)}}update(e,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,o)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Dx),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Ax.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,n,o,c,f){const g={x:0,y:0,vertexCount:0};for(const y of Ho(n,500)){let x=0;for(const $ of y)x+=$.length;let k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const $ of y){if($.length===0||Vx($))continue;let U=0;for(let W=0;W<$.length;W++){const re=$[W];if(W>=1){const we=$[W-1];if(!jx(re,we)){k.vertexLength+4>yi.MAX_VERTEX_ARRAY_LENGTH&&(k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const oe=re.sub(we)._perp()._unit(),ve=we.dist(re);U+ve>32768&&(U=0),Bh(this.layoutVertexArray,re.x,re.y,oe.x,oe.y,0,0,U),Bh(this.layoutVertexArray,re.x,re.y,oe.x,oe.y,0,1,U),g.x+=2*re.x,g.y+=2*re.y,g.vertexCount+=2,U+=ve,Bh(this.layoutVertexArray,we.x,we.y,oe.x,oe.y,0,0,U),Bh(this.layoutVertexArray,we.x,we.y,oe.x,oe.y,0,1,U),g.x+=2*we.x,g.y+=2*we.y,g.vertexCount+=2;const Be=k.vertexLength;this.indexArray.emplaceBack(Be,Be+2,Be+1),this.indexArray.emplaceBack(Be+1,Be+2,Be+3),k.vertexLength+=4,k.primitiveLength+=2}}}}if(k.vertexLength+x>yi.MAX_VERTEX_ARRAY_LENGTH&&(k=this.segments.prepareSegment(x,this.layoutVertexArray,this.indexArray)),$x[e.type]!=="Polygon")continue;const E=[],P=[],L=k.vertexLength;for(const $ of y)if($.length!==0){$!==y[0]&&P.push(E.length/2);for(let U=0;U<$.length;U++){const W=$[U];Bh(this.layoutVertexArray,W.x,W.y,0,0,1,1,0),g.x+=W.x,g.y+=W.y,g.vertexCount+=1,E.push(W.x),E.push(W.y)}}const F=w_(E,P);for(let $=0;$<F.length;$+=3)this.indexArray.emplaceBack(L+F[$],L+F[$+2],L+F[$+1]);k.primitiveLength+=F.length/3,k.vertexLength+=x}for(let y=0;y<g.vertexCount;y++)this.centroidVertexArray.emplaceBack(Math.floor(g.x/g.vertexCount),Math.floor(g.y/g.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,f,c)}}function jx(r,e){return r.x===e.x&&(r.x<0||r.x>be)||r.y===e.y&&(r.y<0||r.y>be)}function Vx(r){return r.every(e=>e.x<0)||r.every(e=>e.x>be)||r.every(e=>e.y<0)||r.every(e=>e.y>be)}let I_;_t("FillExtrusionBucket",Tf,{omit:["layers","features"]});var Ux={get paint(){return I_=I_||new l({"fill-extrusion-opacity":new Tt(Ce["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ft(Ce["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Tt(Ce["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Tt(Ce["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new p(Ce["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Ft(Ce["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ft(Ce["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Tt(Ce["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class qx extends m{constructor(e){super(e,Ux)}createBucket(e){return new Tf(e)}queryRadius(){return rr(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(e,n,o,c,f,g,y,x){const k=ki(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),g.angle,y),E=this.paint.get("fill-extrusion-height").evaluate(n,o),P=this.paint.get("fill-extrusion-base").evaluate(n,o),L=function($,U,W,re){const we=[];for(const oe of $){const ve=[oe.x,oe.y,0,1];oa(ve,ve,U),we.push(new le(ve[0]/ve[3],ve[1]/ve[3]))}return we}(k,x),F=function($,U,W,re){const we=[],oe=[],ve=re[8]*U,Be=re[9]*U,Oe=re[10]*U,ft=re[11]*U,kt=re[8]*W,ct=re[9]*W,at=re[10]*W,xt=re[11]*W;for(const At of $){const ut=[],$e=[];for(const Mt of At){const wt=Mt.x,Zt=Mt.y,Or=re[0]*wt+re[4]*Zt+re[12],Nr=re[1]*wt+re[5]*Zt+re[13],Ti=re[2]*wt+re[6]*Zt+re[14],_s=re[3]*wt+re[7]*Zt+re[15],wn=Ti+Oe,Li=_s+ft,en=Or+kt,Sn=Nr+ct,An=Ti+at,Mn=_s+xt,Ci=new le((Or+ve)/Li,(Nr+Be)/Li);Ci.z=wn/Li,ut.push(Ci);const Gi=new le(en/Mn,Sn/Mn);Gi.z=An/Mn,$e.push(Gi)}we.push(ut),oe.push($e)}return[we,oe]}(c,P,E,x);return function($,U,W){let re=1/0;mr(W,U)&&(re=E_(W,U[0]));for(let we=0;we<U.length;we++){const oe=U[we],ve=$[we];for(let Be=0;Be<oe.length-1;Be++){const Oe=oe[Be],ft=[Oe,oe[Be+1],ve[Be+1],ve[Be],Oe];It(W,ft)&&(re=Math.min(re,E_(W,ft)))}}return re!==1/0&&re}(F[0],F[1],L)}}function Oh(r,e){return r.x*e.x+r.y*e.y}function E_(r,e){if(r.length===1){let n=0;const o=e[n++];let c;for(;!c||o.equals(c);)if(c=e[n++],!c)return 1/0;for(;n<e.length;n++){const f=e[n],g=r[0],y=c.sub(o),x=f.sub(o),k=g.sub(o),E=Oh(y,y),P=Oh(y,x),L=Oh(x,x),F=Oh(k,y),$=Oh(k,x),U=E*L-P*P,W=(L*F-P*$)/U,re=(E*$-P*F)/U,we=o.z*(1-W-re)+c.z*W+f.z*re;if(isFinite(we))return we}return 1/0}{let n=1/0;for(const o of e)n=Math.min(n,o.z);return n}}const Gx=I([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Zx}=Gx,Hx=I([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Wx}=Hx,Xx=kl.VectorTileFeature.types,Kx=Math.cos(Math.PI/180*37.5),P_=Math.pow(2,14)/.5;class Cf{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new yl,this.layoutVertexArray2=new Ec,this.indexArray=new _i,this.programConfigurations=new ue(e.layers,e.zoom),this.segments=new yi,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,o){this.hasPattern=wf("line",this.layers,n);const c=this.layers[0].layout.get("line-sort-key"),f=!c.isConstant(),g=[];for(const{feature:y,id:x,index:k,sourceLayerIndex:E}of e){const P=this.layers[0]._featureFilter.needGeometry,L=mt(y,P);if(!this.layers[0]._featureFilter.filter(new Fr(this.zoom),L,o))continue;const F=f?c.evaluate(L,{},o):void 0,$={id:x,properties:y.properties,type:y.type,sourceLayerIndex:E,index:k,geometry:P?L.geometry:He(y),patterns:{},sortKey:F};g.push($)}f&&g.sort((y,x)=>y.sortKey-x.sortKey);for(const y of g){const{geometry:x,index:k,sourceLayerIndex:E}=y;if(this.hasPattern){const P=Sf("line",this.layers,y,this.zoom,n);this.patternFeatures.push(P)}else this.addFeature(y,x,k,o,{});n.featureIndex.insert(e[k].feature,x,k,E,this.index)}}update(e,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,o)}addFeatures(e,n,o){for(const c of this.patternFeatures)this.addFeature(c,c.geometry,c.index,n,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Wx)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Zx),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,n,o,c,f){const g=this.layers[0].layout,y=g.get("line-join").evaluate(e,{}),x=g.get("line-cap"),k=g.get("line-miter-limit"),E=g.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const P of n)this.addLine(P,e,y,x,k,E);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,f,c)}addLine(e,n,o,c,f,g){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let re=0;re<e.length-1;re++)this.totalDistance+=e[re].dist(e[re+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const y=Xx[n.type]==="Polygon";let x=e.length;for(;x>=2&&e[x-1].equals(e[x-2]);)x--;let k=0;for(;k<x-1&&e[k].equals(e[k+1]);)k++;if(x<(y?3:2))return;o==="bevel"&&(f=1.05);const E=this.overscaling<=16?15*be/(512*this.overscaling):0,P=this.segments.prepareSegment(10*x,this.layoutVertexArray,this.indexArray);let L,F,$,U,W;this.e1=this.e2=-1,y&&(L=e[x-2],W=e[k].sub(L)._unit()._perp());for(let re=k;re<x;re++){if($=re===x-1?y?e[k+1]:void 0:e[re+1],$&&e[re].equals($))continue;W&&(U=W),L&&(F=L),L=e[re],W=$?$.sub(L)._unit()._perp():U,U=U||W;let we=U.add(W);we.x===0&&we.y===0||we._unit();const oe=U.x*W.x+U.y*W.y,ve=we.x*W.x+we.y*W.y,Be=ve!==0?1/ve:1/0,Oe=2*Math.sqrt(2-2*ve),ft=ve<Kx&&F&&$,kt=U.x*W.y-U.y*W.x>0;if(ft&&re>k){const xt=L.dist(F);if(xt>2*E){const At=L.sub(L.sub(F)._mult(E/xt)._round());this.updateDistance(F,At),this.addCurrentVertex(At,U,0,0,P),F=At}}const ct=F&&$;let at=ct?o:y?"butt":c;if(ct&&at==="round"&&(Be<g?at="miter":Be<=2&&(at="fakeround")),at==="miter"&&Be>f&&(at="bevel"),at==="bevel"&&(Be>2&&(at="flipbevel"),Be<f&&(at="miter")),F&&this.updateDistance(F,L),at==="miter")we._mult(Be),this.addCurrentVertex(L,we,0,0,P);else if(at==="flipbevel"){if(Be>100)we=W.mult(-1);else{const xt=Be*U.add(W).mag()/U.sub(W).mag();we._perp()._mult(xt*(kt?-1:1))}this.addCurrentVertex(L,we,0,0,P),this.addCurrentVertex(L,we.mult(-1),0,0,P)}else if(at==="bevel"||at==="fakeround"){const xt=-Math.sqrt(Be*Be-1),At=kt?xt:0,ut=kt?0:xt;if(F&&this.addCurrentVertex(L,U,At,ut,P),at==="fakeround"){const $e=Math.round(180*Oe/Math.PI/20);for(let Mt=1;Mt<$e;Mt++){let wt=Mt/$e;if(wt!==.5){const Or=wt-.5;wt+=wt*Or*(wt-1)*((1.0904+oe*(oe*(3.55645-1.43519*oe)-3.2452))*Or*Or+(.848013+oe*(.215638*oe-1.06021)))}const Zt=W.sub(U)._mult(wt)._add(U)._unit()._mult(kt?-1:1);this.addHalfVertex(L,Zt.x,Zt.y,!1,kt,0,P)}}$&&this.addCurrentVertex(L,W,-At,-ut,P)}else if(at==="butt")this.addCurrentVertex(L,we,0,0,P);else if(at==="square"){const xt=F?1:-1;this.addCurrentVertex(L,we,xt,xt,P)}else at==="round"&&(F&&(this.addCurrentVertex(L,U,0,0,P),this.addCurrentVertex(L,U,1,1,P,!0)),$&&(this.addCurrentVertex(L,W,-1,-1,P,!0),this.addCurrentVertex(L,W,0,0,P)));if(ft&&re<x-1){const xt=L.dist($);if(xt>2*E){const At=L.add($.sub(L)._mult(E/xt)._round());this.updateDistance(L,At),this.addCurrentVertex(At,W,0,0,P),L=At}}}}addCurrentVertex(e,n,o,c,f,g=!1){const y=n.y*c-n.x,x=-n.y-n.x*c;this.addHalfVertex(e,n.x+n.y*o,n.y-n.x*o,g,!1,o,f),this.addHalfVertex(e,y,x,g,!0,-c,f),this.distance>P_/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,n,o,c,f,g))}addHalfVertex({x:e,y:n},o,c,f,g,y,x){const k=.5*(this.lineClips?this.scaledDistance*(P_-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(f?1:0),(n<<1)+(g?1:0),Math.round(63*o)+128,Math.round(63*c)+128,1+(y===0?0:y<0?-1:1)|(63&k)<<2,k>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const E=x.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,E),x.primitiveLength++),g?this.e2=E:this.e1=E}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,n){this.distance+=e.dist(n),this.updateScaledDistance()}}let A_,D_;_t("LineBucket",Cf,{omit:["layers","patternFeatures"]});var z_={get paint(){return D_=D_||new l({"line-opacity":new Ft(Ce.paint_line["line-opacity"]),"line-color":new Ft(Ce.paint_line["line-color"]),"line-translate":new Tt(Ce.paint_line["line-translate"]),"line-translate-anchor":new Tt(Ce.paint_line["line-translate-anchor"]),"line-width":new Ft(Ce.paint_line["line-width"]),"line-gap-width":new Ft(Ce.paint_line["line-gap-width"]),"line-offset":new Ft(Ce.paint_line["line-offset"]),"line-blur":new Ft(Ce.paint_line["line-blur"]),"line-dasharray":new t(Ce.paint_line["line-dasharray"]),"line-pattern":new p(Ce.paint_line["line-pattern"]),"line-gradient":new s(Ce.paint_line["line-gradient"])})},get layout(){return A_=A_||new l({"line-cap":new Tt(Ce.layout_line["line-cap"]),"line-join":new Ft(Ce.layout_line["line-join"]),"line-miter-limit":new Tt(Ce.layout_line["line-miter-limit"]),"line-round-limit":new Tt(Ce.layout_line["line-round-limit"]),"line-sort-key":new Ft(Ce.layout_line["line-sort-key"])})}};class Jx extends Ft{possiblyEvaluate(e,n){return n=new Fr(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,zoomHistory:n.zoomHistory,transition:n.transition}),super.possiblyEvaluate(e,n)}evaluate(e,n,o,c){return n=Ae({},n,{zoom:Math.floor(n.zoom)}),super.evaluate(e,n,o,c)}}let Vd;class Yx extends m{constructor(e){super(e,z_),this.gradientVersion=0,Vd||(Vd=new Jx(z_.paint.properties["line-width"].specification),Vd.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(e){if(e==="line-gradient"){const n=this.gradientExpression();this.stepInterpolant=!!function(o){return o._styleExpression!==void 0}(n)&&n._styleExpression.expression instanceof so,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,n){super.recalculate(e,n),this.paint._values["line-floorwidth"]=Vd.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new Cf(e)}queryRadius(e){const n=e,o=L_(tr("line-width",this,n),tr("line-gap-width",this,n)),c=tr("line-offset",this,n);return o/2+Math.abs(c)+rr(this.paint.get("line-translate"))}queryIntersectsFeature(e,n,o,c,f,g,y){const x=ki(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),g.angle,y),k=y/2*L_(this.paint.get("line-width").evaluate(n,o),this.paint.get("line-gap-width").evaluate(n,o)),E=this.paint.get("line-offset").evaluate(n,o);return E&&(c=function(P,L){const F=[];for(let $=0;$<P.length;$++){const U=P[$],W=[];for(let re=0;re<U.length;re++){const we=U[re-1],oe=U[re],ve=U[re+1],Be=re===0?new le(0,0):oe.sub(we)._unit()._perp(),Oe=re===U.length-1?new le(0,0):ve.sub(oe)._unit()._perp(),ft=Be._add(Oe)._unit(),kt=ft.x*Oe.x+ft.y*Oe.y;kt!==0&&ft._mult(1/kt),W.push(ft._mult(L)._add(oe))}F.push(W)}return F}(c,E*y)),function(P,L,F){for(let $=0;$<L.length;$++){const U=L[$];if(P.length>=3){for(let W=0;W<U.length;W++)if(Qe(P,U[W]))return!0}if(Mr(P,U,F))return!0}return!1}(x,c,k)}isTileClipped(){return!0}}function L_(r,e){return e>0?e+2*r:r}const Qx=I([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),eb=I([{name:"a_projected_pos",components:3,type:"Float32"}],4);I([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const tb=I([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);I([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const R_=I([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),rb=I([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function ib(r,e,n){return r.sections.forEach(o=>{o.text=function(c,f,g){const y=f.layout.get("text-transform").evaluate(g,{});return y==="uppercase"?c=c.toLocaleUpperCase():y==="lowercase"&&(c=c.toLocaleLowerCase()),Fs.applyArabicShaping&&(c=Fs.applyArabicShaping(c)),c}(o.text,e,n)}),r}I([{name:"triangle",components:3,type:"Uint16"}]),I([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),I([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),I([{type:"Float32",name:"offsetX"}]),I([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),I([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Nh={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var zi=24,F_=Br,B_=function(r,e,n,o,c){var f,g,y=8*c-o-1,x=(1<<y)-1,k=x>>1,E=-7,P=c-1,L=-1,F=r[e+P];for(P+=L,f=F&(1<<-E)-1,F>>=-E,E+=y;E>0;f=256*f+r[e+P],P+=L,E-=8);for(g=f&(1<<-E)-1,f>>=-E,E+=o;E>0;g=256*g+r[e+P],P+=L,E-=8);if(f===0)f=1-k;else{if(f===x)return g?NaN:1/0*(F?-1:1);g+=Math.pow(2,o),f-=k}return(F?-1:1)*g*Math.pow(2,f-o)},O_=function(r,e,n,o,c,f){var g,y,x,k=8*f-c-1,E=(1<<k)-1,P=E>>1,L=c===23?Math.pow(2,-24)-Math.pow(2,-77):0,F=0,$=1,U=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(y=isNaN(e)?1:0,g=E):(g=Math.floor(Math.log(e)/Math.LN2),e*(x=Math.pow(2,-g))<1&&(g--,x*=2),(e+=g+P>=1?L/x:L*Math.pow(2,1-P))*x>=2&&(g++,x/=2),g+P>=E?(y=0,g=E):g+P>=1?(y=(e*x-1)*Math.pow(2,c),g+=P):(y=e*Math.pow(2,P-1)*Math.pow(2,c),g=0));c>=8;r[n+F]=255&y,F+=$,y/=256,c-=8);for(g=g<<c|y,k+=c;k>0;r[n+F]=255&g,F+=$,g/=256,k-=8);r[n+F-$]|=128*U};function Br(r){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(r)?r:new Uint8Array(r||0),this.pos=0,this.type=0,this.length=this.buf.length}Br.Varint=0,Br.Fixed64=1,Br.Bytes=2,Br.Fixed32=5;var If=4294967296,N_=1/If,$_=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function ko(r){return r.type===Br.Bytes?r.readVarint()+r.pos:r.pos+1}function Du(r,e,n){return n?4294967296*e+(r>>>0):4294967296*(e>>>0)+(r>>>0)}function j_(r,e,n){var o=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(o);for(var c=n.pos-1;c>=r;c--)n.buf[c+o]=n.buf[c]}function nb(r,e){for(var n=0;n<r.length;n++)e.writeVarint(r[n])}function sb(r,e){for(var n=0;n<r.length;n++)e.writeSVarint(r[n])}function ab(r,e){for(var n=0;n<r.length;n++)e.writeFloat(r[n])}function ob(r,e){for(var n=0;n<r.length;n++)e.writeDouble(r[n])}function lb(r,e){for(var n=0;n<r.length;n++)e.writeBoolean(r[n])}function cb(r,e){for(var n=0;n<r.length;n++)e.writeFixed32(r[n])}function ub(r,e){for(var n=0;n<r.length;n++)e.writeSFixed32(r[n])}function hb(r,e){for(var n=0;n<r.length;n++)e.writeFixed64(r[n])}function db(r,e){for(var n=0;n<r.length;n++)e.writeSFixed64(r[n])}function Ud(r,e){return(r[e]|r[e+1]<<8|r[e+2]<<16)+16777216*r[e+3]}function zu(r,e,n){r[n]=e,r[n+1]=e>>>8,r[n+2]=e>>>16,r[n+3]=e>>>24}function V_(r,e){return(r[e]|r[e+1]<<8|r[e+2]<<16)+(r[e+3]<<24)}Br.prototype={destroy:function(){this.buf=null},readFields:function(r,e,n){for(n=n||this.length;this.pos<n;){var o=this.readVarint(),c=o>>3,f=this.pos;this.type=7&o,r(c,e,this),this.pos===f&&this.skip(o)}return e},readMessage:function(r,e){return this.readFields(r,e,this.readVarint()+this.pos)},readFixed32:function(){var r=Ud(this.buf,this.pos);return this.pos+=4,r},readSFixed32:function(){var r=V_(this.buf,this.pos);return this.pos+=4,r},readFixed64:function(){var r=Ud(this.buf,this.pos)+Ud(this.buf,this.pos+4)*If;return this.pos+=8,r},readSFixed64:function(){var r=Ud(this.buf,this.pos)+V_(this.buf,this.pos+4)*If;return this.pos+=8,r},readFloat:function(){var r=B_(this.buf,this.pos,!0,23,4);return this.pos+=4,r},readDouble:function(){var r=B_(this.buf,this.pos,!0,52,8);return this.pos+=8,r},readVarint:function(r){var e,n,o=this.buf;return e=127&(n=o[this.pos++]),n<128?e:(e|=(127&(n=o[this.pos++]))<<7,n<128?e:(e|=(127&(n=o[this.pos++]))<<14,n<128?e:(e|=(127&(n=o[this.pos++]))<<21,n<128?e:function(c,f,g){var y,x,k=g.buf;if(y=(112&(x=k[g.pos++]))>>4,x<128||(y|=(127&(x=k[g.pos++]))<<3,x<128)||(y|=(127&(x=k[g.pos++]))<<10,x<128)||(y|=(127&(x=k[g.pos++]))<<17,x<128)||(y|=(127&(x=k[g.pos++]))<<24,x<128)||(y|=(1&(x=k[g.pos++]))<<31,x<128))return Du(c,y,f);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=o[this.pos]))<<28,r,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var r=this.readVarint();return r%2==1?(r+1)/-2:r/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var r=this.readVarint()+this.pos,e=this.pos;return this.pos=r,r-e>=12&&$_?function(n,o,c){return $_.decode(n.subarray(o,c))}(this.buf,e,r):function(n,o,c){for(var f="",g=o;g<c;){var y,x,k,E=n[g],P=null,L=E>239?4:E>223?3:E>191?2:1;if(g+L>c)break;L===1?E<128&&(P=E):L===2?(192&(y=n[g+1]))==128&&(P=(31&E)<<6|63&y)<=127&&(P=null):L===3?(x=n[g+2],(192&(y=n[g+1]))==128&&(192&x)==128&&((P=(15&E)<<12|(63&y)<<6|63&x)<=2047||P>=55296&&P<=57343)&&(P=null)):L===4&&(x=n[g+2],k=n[g+3],(192&(y=n[g+1]))==128&&(192&x)==128&&(192&k)==128&&((P=(15&E)<<18|(63&y)<<12|(63&x)<<6|63&k)<=65535||P>=1114112)&&(P=null)),P===null?(P=65533,L=1):P>65535&&(P-=65536,f+=String.fromCharCode(P>>>10&1023|55296),P=56320|1023&P),f+=String.fromCharCode(P),g+=L}return f}(this.buf,e,r)},readBytes:function(){var r=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,r);return this.pos=r,e},readPackedVarint:function(r,e){if(this.type!==Br.Bytes)return r.push(this.readVarint(e));var n=ko(this);for(r=r||[];this.pos<n;)r.push(this.readVarint(e));return r},readPackedSVarint:function(r){if(this.type!==Br.Bytes)return r.push(this.readSVarint());var e=ko(this);for(r=r||[];this.pos<e;)r.push(this.readSVarint());return r},readPackedBoolean:function(r){if(this.type!==Br.Bytes)return r.push(this.readBoolean());var e=ko(this);for(r=r||[];this.pos<e;)r.push(this.readBoolean());return r},readPackedFloat:function(r){if(this.type!==Br.Bytes)return r.push(this.readFloat());var e=ko(this);for(r=r||[];this.pos<e;)r.push(this.readFloat());return r},readPackedDouble:function(r){if(this.type!==Br.Bytes)return r.push(this.readDouble());var e=ko(this);for(r=r||[];this.pos<e;)r.push(this.readDouble());return r},readPackedFixed32:function(r){if(this.type!==Br.Bytes)return r.push(this.readFixed32());var e=ko(this);for(r=r||[];this.pos<e;)r.push(this.readFixed32());return r},readPackedSFixed32:function(r){if(this.type!==Br.Bytes)return r.push(this.readSFixed32());var e=ko(this);for(r=r||[];this.pos<e;)r.push(this.readSFixed32());return r},readPackedFixed64:function(r){if(this.type!==Br.Bytes)return r.push(this.readFixed64());var e=ko(this);for(r=r||[];this.pos<e;)r.push(this.readFixed64());return r},readPackedSFixed64:function(r){if(this.type!==Br.Bytes)return r.push(this.readSFixed64());var e=ko(this);for(r=r||[];this.pos<e;)r.push(this.readSFixed64());return r},skip:function(r){var e=7&r;if(e===Br.Varint)for(;this.buf[this.pos++]>127;);else if(e===Br.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Br.Fixed32)this.pos+=4;else{if(e!==Br.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(r,e){this.writeVarint(r<<3|e)},realloc:function(r){for(var e=this.length||16;e<this.pos+r;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(r){this.realloc(4),zu(this.buf,r,this.pos),this.pos+=4},writeSFixed32:function(r){this.realloc(4),zu(this.buf,r,this.pos),this.pos+=4},writeFixed64:function(r){this.realloc(8),zu(this.buf,-1&r,this.pos),zu(this.buf,Math.floor(r*N_),this.pos+4),this.pos+=8},writeSFixed64:function(r){this.realloc(8),zu(this.buf,-1&r,this.pos),zu(this.buf,Math.floor(r*N_),this.pos+4),this.pos+=8},writeVarint:function(r){(r=+r||0)>268435455||r<0?function(e,n){var o,c;if(e>=0?(o=e%4294967296|0,c=e/4294967296|0):(c=~(-e/4294967296),4294967295^(o=~(-e%4294967296))?o=o+1|0:(o=0,c=c+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),function(f,g,y){y.buf[y.pos++]=127&f|128,f>>>=7,y.buf[y.pos++]=127&f|128,f>>>=7,y.buf[y.pos++]=127&f|128,f>>>=7,y.buf[y.pos++]=127&f|128,y.buf[y.pos]=127&(f>>>=7)}(o,0,n),function(f,g){var y=(7&f)<<4;g.buf[g.pos++]|=y|((f>>>=3)?128:0),f&&(g.buf[g.pos++]=127&f|((f>>>=7)?128:0),f&&(g.buf[g.pos++]=127&f|((f>>>=7)?128:0),f&&(g.buf[g.pos++]=127&f|((f>>>=7)?128:0),f&&(g.buf[g.pos++]=127&f|((f>>>=7)?128:0),f&&(g.buf[g.pos++]=127&f)))))}(c,n)}(r,this):(this.realloc(4),this.buf[this.pos++]=127&r|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=r>>>7&127))))},writeSVarint:function(r){this.writeVarint(r<0?2*-r-1:2*r)},writeBoolean:function(r){this.writeVarint(!!r)},writeString:function(r){r=String(r),this.realloc(4*r.length),this.pos++;var e=this.pos;this.pos=function(o,c,f){for(var g,y,x=0;x<c.length;x++){if((g=c.charCodeAt(x))>55295&&g<57344){if(!y){g>56319||x+1===c.length?(o[f++]=239,o[f++]=191,o[f++]=189):y=g;continue}if(g<56320){o[f++]=239,o[f++]=191,o[f++]=189,y=g;continue}g=y-55296<<10|g-56320|65536,y=null}else y&&(o[f++]=239,o[f++]=191,o[f++]=189,y=null);g<128?o[f++]=g:(g<2048?o[f++]=g>>6|192:(g<65536?o[f++]=g>>12|224:(o[f++]=g>>18|240,o[f++]=g>>12&63|128),o[f++]=g>>6&63|128),o[f++]=63&g|128)}return f}(this.buf,r,this.pos);var n=this.pos-e;n>=128&&j_(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(r){this.realloc(4),O_(this.buf,r,this.pos,!0,23,4),this.pos+=4},writeDouble:function(r){this.realloc(8),O_(this.buf,r,this.pos,!0,52,8),this.pos+=8},writeBytes:function(r){var e=r.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=r[n]},writeRawMessage:function(r,e){this.pos++;var n=this.pos;r(e,this);var o=this.pos-n;o>=128&&j_(n,o,this),this.pos=n-1,this.writeVarint(o),this.pos+=o},writeMessage:function(r,e,n){this.writeTag(r,Br.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(r,e){e.length&&this.writeMessage(r,nb,e)},writePackedSVarint:function(r,e){e.length&&this.writeMessage(r,sb,e)},writePackedBoolean:function(r,e){e.length&&this.writeMessage(r,lb,e)},writePackedFloat:function(r,e){e.length&&this.writeMessage(r,ab,e)},writePackedDouble:function(r,e){e.length&&this.writeMessage(r,ob,e)},writePackedFixed32:function(r,e){e.length&&this.writeMessage(r,cb,e)},writePackedSFixed32:function(r,e){e.length&&this.writeMessage(r,ub,e)},writePackedFixed64:function(r,e){e.length&&this.writeMessage(r,hb,e)},writePackedSFixed64:function(r,e){e.length&&this.writeMessage(r,db,e)},writeBytesField:function(r,e){this.writeTag(r,Br.Bytes),this.writeBytes(e)},writeFixed32Field:function(r,e){this.writeTag(r,Br.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(r,e){this.writeTag(r,Br.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(r,e){this.writeTag(r,Br.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(r,e){this.writeTag(r,Br.Fixed64),this.writeSFixed64(e)},writeVarintField:function(r,e){this.writeTag(r,Br.Varint),this.writeVarint(e)},writeSVarintField:function(r,e){this.writeTag(r,Br.Varint),this.writeSVarint(e)},writeStringField:function(r,e){this.writeTag(r,Br.Bytes),this.writeString(e)},writeFloatField:function(r,e){this.writeTag(r,Br.Fixed32),this.writeFloat(e)},writeDoubleField:function(r,e){this.writeTag(r,Br.Fixed64),this.writeDouble(e)},writeBooleanField:function(r,e){this.writeVarintField(r,!!e)}};var Ef=q(F_);const Pf=3;function pb(r,e,n){r===1&&n.readMessage(fb,e)}function fb(r,e,n){if(r===3){const{id:o,bitmap:c,width:f,height:g,left:y,top:x,advance:k}=n.readMessage(mb,{});e.push({id:o,bitmap:new zh({width:f+2*Pf,height:g+2*Pf},c),metrics:{width:f,height:g,left:y,top:x,advance:k}})}}function mb(r,e,n){r===1?e.id=n.readVarint():r===2?e.bitmap=n.readBytes():r===3?e.width=n.readVarint():r===4?e.height=n.readVarint():r===5?e.left=n.readSVarint():r===6?e.top=n.readSVarint():r===7&&(e.advance=n.readVarint())}const U_=Pf;function q_(r){let e=0,n=0;for(const g of r)e+=g.w*g.h,n=Math.max(n,g.w);r.sort((g,y)=>y.h-g.h);const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}];let c=0,f=0;for(const g of r)for(let y=o.length-1;y>=0;y--){const x=o[y];if(!(g.w>x.w||g.h>x.h)){if(g.x=x.x,g.y=x.y,f=Math.max(f,g.y+g.h),c=Math.max(c,g.x+g.w),g.w===x.w&&g.h===x.h){const k=o.pop();y<o.length&&(o[y]=k)}else g.h===x.h?(x.x+=g.w,x.w-=g.w):g.w===x.w?(x.y+=g.h,x.h-=g.h):(o.push({x:x.x+g.w,y:x.y,w:x.w-g.w,h:g.h}),x.y+=g.h,x.h-=g.h);break}}return{w:c,h:f,fill:e/(c*f)||0}}const $n=1;class Af{constructor(e,{pixelRatio:n,version:o,stretchX:c,stretchY:f,content:g,textFitWidth:y,textFitHeight:x}){this.paddedRect=e,this.pixelRatio=n,this.stretchX=c,this.stretchY=f,this.content=g,this.version=o,this.textFitWidth=y,this.textFitHeight=x}get tl(){return[this.paddedRect.x+$n,this.paddedRect.y+$n]}get br(){return[this.paddedRect.x+this.paddedRect.w-$n,this.paddedRect.y+this.paddedRect.h-$n]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*$n)/this.pixelRatio,(this.paddedRect.h-2*$n)/this.pixelRatio]}}class G_{constructor(e,n){const o={},c={};this.haveRenderCallbacks=[];const f=[];this.addImages(e,o,f),this.addImages(n,c,f);const{w:g,h:y}=q_(f),x=new ms({width:g||1,height:y||1});for(const k in e){const E=e[k],P=o[k].paddedRect;ms.copy(E.data,x,{x:0,y:0},{x:P.x+$n,y:P.y+$n},E.data)}for(const k in n){const E=n[k],P=c[k].paddedRect,L=P.x+$n,F=P.y+$n,$=E.data.width,U=E.data.height;ms.copy(E.data,x,{x:0,y:0},{x:L,y:F},E.data),ms.copy(E.data,x,{x:0,y:U-1},{x:L,y:F-1},{width:$,height:1}),ms.copy(E.data,x,{x:0,y:0},{x:L,y:F+U},{width:$,height:1}),ms.copy(E.data,x,{x:$-1,y:0},{x:L-1,y:F},{width:1,height:U}),ms.copy(E.data,x,{x:0,y:0},{x:L+$,y:F},{width:1,height:U})}this.image=x,this.iconPositions=o,this.patternPositions=c}addImages(e,n,o){for(const c in e){const f=e[c],g={x:0,y:0,w:f.data.width+2*$n,h:f.data.height+2*$n};o.push(g),n[c]=new Af(g,f),f.hasRenderCallback&&this.haveRenderCallbacks.push(c)}}patchUpdatedImages(e,n){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const o in e.updatedImages)this.patchUpdatedImage(this.iconPositions[o],e.getImage(o),n),this.patchUpdatedImage(this.patternPositions[o],e.getImage(o),n)}patchUpdatedImage(e,n,o){if(!e||!n||e.version===n.version)return;e.version=n.version;const[c,f]=e.tl;o.update(n.data,void 0,{x:c,y:f})}}var Tl;_t("ImagePosition",Af),_t("ImageAtlas",G_),S.ah=void 0,(Tl=S.ah||(S.ah={}))[Tl.none=0]="none",Tl[Tl.horizontal=1]="horizontal",Tl[Tl.vertical=2]="vertical",Tl[Tl.horizontalOnly=3]="horizontalOnly";const $h=-17;class jh{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,n){const o=new jh;return o.scale=e||1,o.fontStack=n,o}static forImage(e){const n=new jh;return n.imageName=e,n}}class Lu{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,n){const o=new Lu;for(let c=0;c<e.sections.length;c++){const f=e.sections[c];f.image?o.addImageSection(f):o.addTextSection(f,n)}return o}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(){this.text=function(e){let n="";for(let o=0;o<e.length;o++){const c=e.charCodeAt(o+1)||null,f=e.charCodeAt(o-1)||null;n+=c&&Cc(c)&&!Nh[e[o+1]]||f&&Cc(f)&&!Nh[e[o-1]]||!Nh[e[o]]?e[o]:Nh[e[o]]}return n}(this.text)}trim(){let e=0;for(let o=0;o<this.text.length&&Gd[this.text.charCodeAt(o)];o++)e++;let n=this.text.length;for(let o=this.text.length-1;o>=0&&o>=e&&Gd[this.text.charCodeAt(o)];o--)n--;this.text=this.text.substring(e,n),this.sectionIndex=this.sectionIndex.slice(e,n)}substring(e,n){const o=new Lu;return o.text=this.text.substring(e,n),o.sectionIndex=this.sectionIndex.slice(e,n),o.sections=this.sections,o}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,n)=>Math.max(e,this.sections[n].scale),0)}addTextSection(e,n){this.text+=e.text,this.sections.push(jh.forText(e.scale,e.fontStack||n));const o=this.sections.length-1;for(let c=0;c<e.text.length;++c)this.sectionIndex.push(o)}addImageSection(e){const n=e.image?e.image.name:"";if(n.length===0)return void bt("Can't add FormattedSection with an empty image.");const o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCharCode(o),this.sections.push(jh.forImage(n)),this.sectionIndex.push(this.sections.length-1)):bt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function qd(r,e,n,o,c,f,g,y,x,k,E,P,L,F,$,U){const W=Lu.fromFeature(r,c);let re;P===S.ah.vertical&&W.verticalizePunctuation();const{processBidirectionalText:we,processStyledBidirectionalText:oe}=Fs;if(we&&W.sections.length===1){re=[];const Oe=we(W.toString(),Df(W,k,f,e,o,F,$));for(const ft of Oe){const kt=new Lu;kt.text=ft,kt.sections=W.sections;for(let ct=0;ct<ft.length;ct++)kt.sectionIndex.push(0);re.push(kt)}}else if(oe){re=[];const Oe=oe(W.text,W.sectionIndex,Df(W,k,f,e,o,F,$));for(const ft of Oe){const kt=new Lu;kt.text=ft[0],kt.sectionIndex=ft[1],kt.sections=W.sections,re.push(kt)}}else re=function(Oe,ft){const kt=[],ct=Oe.text;let at=0;for(const xt of ft)kt.push(Oe.substring(at,xt)),at=xt;return at<ct.length&&kt.push(Oe.substring(at,ct.length)),kt}(W,Df(W,k,f,e,o,F,$));const ve=[],Be={positionedLines:ve,text:W.toString(),top:E[1],bottom:E[1],left:E[0],right:E[0],writingMode:P,iconsInText:!1,verticalizable:!1};return function(Oe,ft,kt,ct,at,xt,At,ut,$e,Mt,wt,Zt){let Or=0,Nr=$h,Ti=0,_s=0;const wn=ut==="right"?1:ut==="left"?0:.5;let Li=0;for(const Ci of at){Ci.trim();const Gi=Ci.getMaxScale(),Dn=(Gi-1)*zi,jn={positionedGlyphs:[],lineOffset:0};Oe.positionedLines[Li]=jn;const hn=jn.positionedGlyphs;let Vn=0;if(!Ci.length()){Nr+=xt,++Li;continue}for(let pi=0;pi<Ci.length();pi++){const ir=Ci.getSection(pi),Ii=Ci.getSectionIndex(pi),dn=Ci.getCharCode(pi);let Ri=0,Ns=null,ca=null,ua=null,To=zi;const $s=!($e===S.ah.horizontal||!wt&&!Tc(dn)||wt&&(Gd[dn]||(en=dn,ot.Arabic(en)||ot["Arabic Supplement"](en)||ot["Arabic Extended-A"](en)||ot["Arabic Presentation Forms-A"](en)||ot["Arabic Presentation Forms-B"](en))));if(ir.imageName){const vs=ct[ir.imageName];if(!vs)continue;ua=ir.imageName,Oe.iconsInText=Oe.iconsInText||!0,ca=vs.paddedRect;const Un=vs.displaySize;ir.scale=ir.scale*zi/Zt,Ns={width:Un[0],height:Un[1],left:$n,top:-U_,advance:$s?Un[1]:Un[0]},Ri=Dn+(zi-Un[1]*ir.scale),To=Ns.advance;const Co=$s?Un[0]*ir.scale-zi*Gi:Un[1]*ir.scale-zi*Gi;Co>0&&Co>Vn&&(Vn=Co)}else{const vs=kt[ir.fontStack],Un=vs&&vs[dn];if(Un&&Un.rect)ca=Un.rect,Ns=Un.metrics;else{const Co=ft[ir.fontStack],Zh=Co&&Co[dn];if(!Zh)continue;Ns=Zh.metrics}Ri=(Gi-ir.scale)*zi}$s?(Oe.verticalizable=!0,hn.push({glyph:dn,imageName:ua,x:Or,y:Nr+Ri,vertical:$s,scale:ir.scale,fontStack:ir.fontStack,sectionIndex:Ii,metrics:Ns,rect:ca}),Or+=To*ir.scale+Mt):(hn.push({glyph:dn,imageName:ua,x:Or,y:Nr+Ri,vertical:$s,scale:ir.scale,fontStack:ir.fontStack,sectionIndex:Ii,metrics:Ns,rect:ca}),Or+=Ns.advance*ir.scale+Mt)}hn.length!==0&&(Ti=Math.max(Or-Mt,Ti),yb(hn,0,hn.length-1,wn,Vn)),Or=0;const ys=xt*Gi+Vn;jn.lineOffset=Math.max(Vn,Dn),Nr+=ys,_s=Math.max(ys,_s),++Li}var en;const Sn=Nr-$h,{horizontalAlign:An,verticalAlign:Mn}=zf(At);(function(Ci,Gi,Dn,jn,hn,Vn,ys,pi,ir){const Ii=(Gi-Dn)*hn;let dn=0;dn=Vn!==ys?-pi*jn-$h:(-jn*ir+.5)*ys;for(const Ri of Ci)for(const Ns of Ri.positionedGlyphs)Ns.x+=Ii,Ns.y+=dn})(Oe.positionedLines,wn,An,Mn,Ti,_s,xt,Sn,at.length),Oe.top+=-Mn*Sn,Oe.bottom=Oe.top+Sn,Oe.left+=-An*Ti,Oe.right=Oe.left+Ti}(Be,e,n,o,re,g,y,x,P,k,L,U),!function(Oe){for(const ft of Oe)if(ft.positionedGlyphs.length!==0)return!1;return!0}(ve)&&Be}const Gd={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},gb={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Z_(r,e,n,o,c,f){if(e.imageName){const g=o[e.imageName];return g?g.displaySize[0]*e.scale*zi/f+c:0}{const g=n[e.fontStack],y=g&&g[r];return y?y.metrics.advance*e.scale+c:0}}function H_(r,e,n,o){const c=Math.pow(r-e,2);return o?r<e?c/2:2*c:c+Math.abs(n)*n}function _b(r,e,n){let o=0;return r===10&&(o-=1e4),n&&(o+=150),r!==40&&r!==65288||(o+=50),e!==41&&e!==65289||(o+=50),o}function W_(r,e,n,o,c,f){let g=null,y=H_(e,n,c,f);for(const x of o){const k=H_(e-x.x,n,c,f)+x.badness;k<=y&&(g=x,y=k)}return{index:r,x:e,priorBreak:g,badness:y}}function X_(r){return r?X_(r.priorBreak).concat(r.index):[]}function Df(r,e,n,o,c,f,g){if(f!=="point")return[];if(!r)return[];const y=[],x=function(L,F,$,U,W,re){let we=0;for(let oe=0;oe<L.length();oe++){const ve=L.getSection(oe);we+=Z_(L.getCharCode(oe),ve,U,W,F,re)}return we/Math.max(1,Math.ceil(we/$))}(r,e,n,o,c,g),k=r.text.indexOf("")>=0;let E=0;for(let L=0;L<r.length();L++){const F=r.getSection(L),$=r.getCharCode(L);if(Gd[$]||(E+=Z_($,F,o,c,e,g)),L<r.length()-1){const U=!((P=$)<11904||!(ot["Bopomofo Extended"](P)||ot.Bopomofo(P)||ot["CJK Compatibility Forms"](P)||ot["CJK Compatibility Ideographs"](P)||ot["CJK Compatibility"](P)||ot["CJK Radicals Supplement"](P)||ot["CJK Strokes"](P)||ot["CJK Symbols and Punctuation"](P)||ot["CJK Unified Ideographs Extension A"](P)||ot["CJK Unified Ideographs"](P)||ot["Enclosed CJK Letters and Months"](P)||ot["Halfwidth and Fullwidth Forms"](P)||ot.Hiragana(P)||ot["Ideographic Description Characters"](P)||ot["Kangxi Radicals"](P)||ot["Katakana Phonetic Extensions"](P)||ot.Katakana(P)||ot["Vertical Forms"](P)||ot["Yi Radicals"](P)||ot["Yi Syllables"](P)));(gb[$]||U||F.imageName)&&y.push(W_(L+1,E,x,y,_b($,r.getCharCode(L+1),U&&k),!1))}}var P;return X_(W_(r.length(),E,x,y,0,!0))}function zf(r){let e=.5,n=.5;switch(r){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(r){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function yb(r,e,n,o,c){if(!o&&!c)return;const f=r[n],g=(r[n].x+f.metrics.advance*f.scale)*o;for(let y=e;y<=n;y++)r[y].x-=g,r[y].y+=c}function vb(r,e,n){const{horizontalAlign:o,verticalAlign:c}=zf(n),f=e[0]-r.displaySize[0]*o,g=e[1]-r.displaySize[1]*c;return{image:r,top:g,bottom:g+r.displaySize[1],left:f,right:f+r.displaySize[0]}}function K_(r){var e,n;let o=r.left,c=r.top,f=r.right-o,g=r.bottom-c;const y=(e=r.image.textFitWidth)!==null&&e!==void 0?e:"stretchOrShrink",x=(n=r.image.textFitHeight)!==null&&n!==void 0?n:"stretchOrShrink",k=(r.image.content[2]-r.image.content[0])/(r.image.content[3]-r.image.content[1]);if(x==="proportional"){if(y==="stretchOnly"&&f/g<k||y==="proportional"){const E=Math.ceil(g*k);o*=E/f,f=E}}else if(y==="proportional"&&x==="stretchOnly"&&k!==0&&f/g>k){const E=Math.ceil(f/k);c*=E/g,g=E}return{x1:o,y1:c,x2:o+f,y2:c+g}}function J_(r,e,n,o,c,f){const g=r.image;let y;if(g.content){const W=g.content,re=g.pixelRatio||1;y=[W[0]/re,W[1]/re,g.displaySize[0]-W[2]/re,g.displaySize[1]-W[3]/re]}const x=e.left*f,k=e.right*f;let E,P,L,F;n==="width"||n==="both"?(F=c[0]+x-o[3],P=c[0]+k+o[1]):(F=c[0]+(x+k-g.displaySize[0])/2,P=F+g.displaySize[0]);const $=e.top*f,U=e.bottom*f;return n==="height"||n==="both"?(E=c[1]+$-o[0],L=c[1]+U+o[2]):(E=c[1]+($+U-g.displaySize[1])/2,L=E+g.displaySize[1]),{image:g,top:E,right:P,bottom:L,left:F,collisionPadding:y}}const Vh=255,Za=128,Cl=Vh*Za;function Y_(r,e){const{expression:n}=e;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new Fr(r+1))};if(n.kind==="source")return{kind:"source"};{const{zoomStops:o,interpolationType:c}=n;let f=0;for(;f<o.length&&o[f]<=r;)f++;f=Math.max(0,f-1);let g=f;for(;g<o.length&&o[g]<r+1;)g++;g=Math.min(o.length-1,g);const y=o[f],x=o[g];return n.kind==="composite"?{kind:"composite",minZoom:y,maxZoom:x,interpolationType:c}:{kind:"camera",minZoom:y,maxZoom:x,minSize:n.evaluate(new Fr(y)),maxSize:n.evaluate(new Fr(x)),interpolationType:c}}}function Lf(r,e,n){let o="never";const c=r.get(e);return c?o=c:r.get(n)&&(o="always"),o}const xb=kl.VectorTileFeature.types,bb=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Zd(r,e,n,o,c,f,g,y,x,k,E,P,L){const F=y?Math.min(Cl,Math.round(y[0])):0,$=y?Math.min(Cl,Math.round(y[1])):0;r.emplaceBack(e,n,Math.round(32*o),Math.round(32*c),f,g,(F<<1)+(x?1:0),$,16*k,16*E,256*P,256*L)}function Rf(r,e,n){r.emplaceBack(e.x,e.y,n),r.emplaceBack(e.x,e.y,n),r.emplaceBack(e.x,e.y,n),r.emplaceBack(e.x,e.y,n)}function wb(r){for(const e of r.sections)if(fl(e.text))return!0;return!1}class Ff{constructor(e){this.layoutVertexArray=new Pn,this.indexArray=new _i,this.programConfigurations=e,this.segments=new yi,this.dynamicLayoutVertexArray=new ps,this.opacityVertexArray=new na,this.hasVisibleVertices=!1,this.placedSymbolArray=new Vr}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,n,o,c){this.isEmpty()||(o&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Qx.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,eb.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,bb,!0),this.opacityVertexBuffer.itemSize=1),(o||c)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}_t("SymbolBuffers",Ff);class Bf{constructor(e,n,o){this.layoutVertexArray=new e,this.layoutAttributes=n,this.indexArray=new o,this.segments=new yi,this.collisionVertexArray=new qi}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,tb.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}_t("CollisionBuffers",Bf);class Ru{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(g=>g.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Nn([]),this.placementViewportMatrix=Nn([]);const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Y_(this.zoom,n["text-size"]),this.iconSizeData=Y_(this.zoom,n["icon-size"]);const o=this.layers[0].layout,c=o.get("symbol-sort-key"),f=o.get("symbol-z-order");this.canOverlap=Lf(o,"text-overlap","text-allow-overlap")!=="never"||Lf(o,"icon-overlap","icon-allow-overlap")!=="never"||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=f!=="viewport-y"&&!c.isConstant(),this.sortFeaturesByY=(f==="viewport-y"||f==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,o.get("symbol-placement")==="point"&&(this.writingModes=o.get("text-writing-mode").map(g=>S.ah[g])),this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.sourceID=e.sourceID}createArrays(){this.text=new Ff(new ue(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Ff(new ue(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new Ur,this.lineVertexArray=new Ji,this.symbolInstances=new Bn,this.textAnchorOffsets=new Vi}calculateGlyphDependencies(e,n,o,c,f){for(let g=0;g<e.length;g++)if(n[e.charCodeAt(g)]=!0,(o||c)&&f){const y=Nh[e.charAt(g)];y&&(n[y.charCodeAt(0)]=!0)}}populate(e,n,o){const c=this.layers[0],f=c.layout,g=f.get("text-font"),y=f.get("text-field"),x=f.get("icon-image"),k=(y.value.kind!=="constant"||y.value.value instanceof mn&&!y.value.value.isEmpty()||y.value.value.toString().length>0)&&(g.value.kind!=="constant"||g.value.value.length>0),E=x.value.kind!=="constant"||!!x.value.value||Object.keys(x.parameters).length>0,P=f.get("symbol-sort-key");if(this.features=[],!k&&!E)return;const L=n.iconDependencies,F=n.glyphDependencies,$=n.availableImages,U=new Fr(this.zoom);for(const{feature:W,id:re,index:we,sourceLayerIndex:oe}of e){const ve=c._featureFilter.needGeometry,Be=mt(W,ve);if(!c._featureFilter.filter(U,Be,o))continue;let Oe,ft;if(ve||(Be.geometry=He(W)),k){const ct=c.getValueAndResolveTokens("text-field",Be,o,$),at=mn.factory(ct),xt=this.hasRTLText=this.hasRTLText||wb(at);(!xt||Fs.getRTLTextPluginStatus()==="unavailable"||xt&&Fs.isParsed())&&(Oe=ib(at,c,Be))}if(E){const ct=c.getValueAndResolveTokens("icon-image",Be,o,$);ft=ct instanceof Pi?ct:Pi.fromString(ct)}if(!Oe&&!ft)continue;const kt=this.sortFeaturesByKey?P.evaluate(Be,{},o):void 0;if(this.features.push({id:re,text:Oe,icon:ft,index:we,sourceLayerIndex:oe,geometry:Be.geometry,properties:W.properties,type:xb[W.type],sortKey:kt}),ft&&(L[ft.name]=!0),Oe){const ct=g.evaluate(Be,{},o).join(","),at=f.get("text-rotation-alignment")!=="viewport"&&f.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(S.ah.vertical)>=0;for(const xt of Oe.sections)if(xt.image)L[xt.image.name]=!0;else{const At=Rs(Oe.toString()),ut=xt.fontStack||ct,$e=F[ut]=F[ut]||{};this.calculateGlyphDependencies(xt.text,$e,at,this.allowVerticalPlacement,At)}}}f.get("symbol-placement")==="line"&&(this.features=function(W){const re={},we={},oe=[];let ve=0;function Be(ct){oe.push(W[ct]),ve++}function Oe(ct,at,xt){const At=we[ct];return delete we[ct],we[at]=At,oe[At].geometry[0].pop(),oe[At].geometry[0]=oe[At].geometry[0].concat(xt[0]),At}function ft(ct,at,xt){const At=re[at];return delete re[at],re[ct]=At,oe[At].geometry[0].shift(),oe[At].geometry[0]=xt[0].concat(oe[At].geometry[0]),At}function kt(ct,at,xt){const At=xt?at[0][at[0].length-1]:at[0][0];return`${ct}:${At.x}:${At.y}`}for(let ct=0;ct<W.length;ct++){const at=W[ct],xt=at.geometry,At=at.text?at.text.toString():null;if(!At){Be(ct);continue}const ut=kt(At,xt),$e=kt(At,xt,!0);if(ut in we&&$e in re&&we[ut]!==re[$e]){const Mt=ft(ut,$e,xt),wt=Oe(ut,$e,oe[Mt].geometry);delete re[ut],delete we[$e],we[kt(At,oe[wt].geometry,!0)]=wt,oe[Mt].geometry=null}else ut in we?Oe(ut,$e,xt):$e in re?ft(ut,$e,xt):(Be(ct),re[ut]=ve-1,we[$e]=ve-1)}return oe.filter(ct=>ct.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((W,re)=>W.sortKey-re.sortKey)}update(e,n,o){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,n,this.layers,o),this.icon.programConfigurations.updatePaintArrays(e,n,this.layers,o))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,n){const o=this.lineVertexArray.length;if(e.segment!==void 0){let c=e.dist(n[e.segment+1]),f=e.dist(n[e.segment]);const g={};for(let y=e.segment+1;y<n.length;y++)g[y]={x:n[y].x,y:n[y].y,tileUnitDistanceFromAnchor:c},y<n.length-1&&(c+=n[y+1].dist(n[y]));for(let y=e.segment||0;y>=0;y--)g[y]={x:n[y].x,y:n[y].y,tileUnitDistanceFromAnchor:f},y>0&&(f+=n[y-1].dist(n[y]));for(let y=0;y<n.length;y++){const x=g[y];this.lineVertexArray.emplaceBack(x.x,x.y,x.tileUnitDistanceFromAnchor)}}return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(e,n,o,c,f,g,y,x,k,E,P,L){const F=e.indexArray,$=e.layoutVertexArray,U=e.segments.prepareSegment(4*n.length,$,F,this.canOverlap?g.sortKey:void 0),W=this.glyphOffsetArray.length,re=U.vertexLength,we=this.allowVerticalPlacement&&y===S.ah.vertical?Math.PI/2:0,oe=g.text&&g.text.sections;for(let ve=0;ve<n.length;ve++){const{tl:Be,tr:Oe,bl:ft,br:kt,tex:ct,pixelOffsetTL:at,pixelOffsetBR:xt,minFontScaleX:At,minFontScaleY:ut,glyphOffset:$e,isSDF:Mt,sectionIndex:wt}=n[ve],Zt=U.vertexLength,Or=$e[1];Zd($,x.x,x.y,Be.x,Or+Be.y,ct.x,ct.y,o,Mt,at.x,at.y,At,ut),Zd($,x.x,x.y,Oe.x,Or+Oe.y,ct.x+ct.w,ct.y,o,Mt,xt.x,at.y,At,ut),Zd($,x.x,x.y,ft.x,Or+ft.y,ct.x,ct.y+ct.h,o,Mt,at.x,xt.y,At,ut),Zd($,x.x,x.y,kt.x,Or+kt.y,ct.x+ct.w,ct.y+ct.h,o,Mt,xt.x,xt.y,At,ut),Rf(e.dynamicLayoutVertexArray,x,we),F.emplaceBack(Zt,Zt+1,Zt+2),F.emplaceBack(Zt+1,Zt+2,Zt+3),U.vertexLength+=4,U.primitiveLength+=2,this.glyphOffsetArray.emplaceBack($e[0]),ve!==n.length-1&&wt===n[ve+1].sectionIndex||e.programConfigurations.populatePaintArrays($.length,g,g.index,{},L,oe&&oe[wt])}e.placedSymbolArray.emplaceBack(x.x,x.y,W,this.glyphOffsetArray.length-W,re,k,E,x.segment,o?o[0]:0,o?o[1]:0,c[0],c[1],y,0,!1,0,P)}_addCollisionDebugVertex(e,n,o,c,f,g){return n.emplaceBack(0,0),e.emplaceBack(o.x,o.y,c,f,Math.round(g.x),Math.round(g.y))}addCollisionDebugVertices(e,n,o,c,f,g,y){const x=f.segments.prepareSegment(4,f.layoutVertexArray,f.indexArray),k=x.vertexLength,E=f.layoutVertexArray,P=f.collisionVertexArray,L=y.anchorX,F=y.anchorY;this._addCollisionDebugVertex(E,P,g,L,F,new le(e,n)),this._addCollisionDebugVertex(E,P,g,L,F,new le(o,n)),this._addCollisionDebugVertex(E,P,g,L,F,new le(o,c)),this._addCollisionDebugVertex(E,P,g,L,F,new le(e,c)),x.vertexLength+=4;const $=f.indexArray;$.emplaceBack(k,k+1),$.emplaceBack(k+1,k+2),$.emplaceBack(k+2,k+3),$.emplaceBack(k+3,k),x.primitiveLength+=4}addDebugCollisionBoxes(e,n,o,c){for(let f=e;f<n;f++){const g=this.collisionBoxArray.get(f);this.addCollisionDebugVertices(g.x1,g.y1,g.x2,g.y2,c?this.textCollisionBox:this.iconCollisionBox,g.anchorPoint,o)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Bf(Di,R_.members,Sr),this.iconCollisionBox=new Bf(Di,R_.members,Sr);for(let e=0;e<this.symbolInstances.length;e++){const n=this.symbolInstances.get(e);this.addDebugCollisionBoxes(n.textBoxStartIndex,n.textBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.iconBoxStartIndex,n.iconBoxEndIndex,n,!1),this.addDebugCollisionBoxes(n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex,n,!1)}}_deserializeCollisionBoxesForSymbol(e,n,o,c,f,g,y,x,k){const E={};for(let P=n;P<o;P++){const L=e.get(P);E.textBox={x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2,anchorPointX:L.anchorPointX,anchorPointY:L.anchorPointY},E.textFeatureIndex=L.featureIndex;break}for(let P=c;P<f;P++){const L=e.get(P);E.verticalTextBox={x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2,anchorPointX:L.anchorPointX,anchorPointY:L.anchorPointY},E.verticalTextFeatureIndex=L.featureIndex;break}for(let P=g;P<y;P++){const L=e.get(P);E.iconBox={x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2,anchorPointX:L.anchorPointX,anchorPointY:L.anchorPointY},E.iconFeatureIndex=L.featureIndex;break}for(let P=x;P<k;P++){const L=e.get(P);E.verticalIconBox={x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2,anchorPointX:L.anchorPointX,anchorPointY:L.anchorPointY},E.verticalIconFeatureIndex=L.featureIndex;break}return E}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const o=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,n){const o=e.placedSymbolArray.get(n),c=o.vertexStartIndex+4*o.numGlyphs;for(let f=o.vertexStartIndex;f<c;f+=4)e.indexArray.emplaceBack(f,f+1,f+2),e.indexArray.emplaceBack(f+1,f+2,f+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const n=Math.sin(e),o=Math.cos(e),c=[],f=[],g=[];for(let y=0;y<this.symbolInstances.length;++y){g.push(y);const x=this.symbolInstances.get(y);c.push(0|Math.round(n*x.anchorX+o*x.anchorY)),f.push(x.featureIndex)}return g.sort((y,x)=>c[y]-c[x]||f[x]-f[y]),g}addToSortKeyRanges(e,n){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===n?o.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const o=this.symbolInstances.get(n);this.featureSortOrder.push(o.featureIndex),[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach((c,f,g)=>{c>=0&&g.indexOf(c)===f&&this.addIndicesForPlacedSymbol(this.text,c)}),o.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,o.verticalPlacedTextSymbolIndex),o.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.placedIconSymbolIndex),o.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Q_,ey;_t("SymbolBucket",Ru,{omit:["layers","collisionBoxArray","features","compareText"]}),Ru.MAX_GLYPHS=65535,Ru.addDynamicAttributes=Rf;var Of={get paint(){return ey=ey||new l({"icon-opacity":new Ft(Ce.paint_symbol["icon-opacity"]),"icon-color":new Ft(Ce.paint_symbol["icon-color"]),"icon-halo-color":new Ft(Ce.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ft(Ce.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ft(Ce.paint_symbol["icon-halo-blur"]),"icon-translate":new Tt(Ce.paint_symbol["icon-translate"]),"icon-translate-anchor":new Tt(Ce.paint_symbol["icon-translate-anchor"]),"text-opacity":new Ft(Ce.paint_symbol["text-opacity"]),"text-color":new Ft(Ce.paint_symbol["text-color"],{runtimeType:mi,getOverride:r=>r.textColor,hasOverride:r=>!!r.textColor}),"text-halo-color":new Ft(Ce.paint_symbol["text-halo-color"]),"text-halo-width":new Ft(Ce.paint_symbol["text-halo-width"]),"text-halo-blur":new Ft(Ce.paint_symbol["text-halo-blur"]),"text-translate":new Tt(Ce.paint_symbol["text-translate"]),"text-translate-anchor":new Tt(Ce.paint_symbol["text-translate-anchor"])})},get layout(){return Q_=Q_||new l({"symbol-placement":new Tt(Ce.layout_symbol["symbol-placement"]),"symbol-spacing":new Tt(Ce.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Tt(Ce.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ft(Ce.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Tt(Ce.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Tt(Ce.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Tt(Ce.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Tt(Ce.layout_symbol["icon-ignore-placement"]),"icon-optional":new Tt(Ce.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Tt(Ce.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ft(Ce.layout_symbol["icon-size"]),"icon-text-fit":new Tt(Ce.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Tt(Ce.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ft(Ce.layout_symbol["icon-image"]),"icon-rotate":new Ft(Ce.layout_symbol["icon-rotate"]),"icon-padding":new Ft(Ce.layout_symbol["icon-padding"]),"icon-keep-upright":new Tt(Ce.layout_symbol["icon-keep-upright"]),"icon-offset":new Ft(Ce.layout_symbol["icon-offset"]),"icon-anchor":new Ft(Ce.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Tt(Ce.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Tt(Ce.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Tt(Ce.layout_symbol["text-rotation-alignment"]),"text-field":new Ft(Ce.layout_symbol["text-field"]),"text-font":new Ft(Ce.layout_symbol["text-font"]),"text-size":new Ft(Ce.layout_symbol["text-size"]),"text-max-width":new Ft(Ce.layout_symbol["text-max-width"]),"text-line-height":new Tt(Ce.layout_symbol["text-line-height"]),"text-letter-spacing":new Ft(Ce.layout_symbol["text-letter-spacing"]),"text-justify":new Ft(Ce.layout_symbol["text-justify"]),"text-radial-offset":new Ft(Ce.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Tt(Ce.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Ft(Ce.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Ft(Ce.layout_symbol["text-anchor"]),"text-max-angle":new Tt(Ce.layout_symbol["text-max-angle"]),"text-writing-mode":new Tt(Ce.layout_symbol["text-writing-mode"]),"text-rotate":new Ft(Ce.layout_symbol["text-rotate"]),"text-padding":new Tt(Ce.layout_symbol["text-padding"]),"text-keep-upright":new Tt(Ce.layout_symbol["text-keep-upright"]),"text-transform":new Ft(Ce.layout_symbol["text-transform"]),"text-offset":new Ft(Ce.layout_symbol["text-offset"]),"text-allow-overlap":new Tt(Ce.layout_symbol["text-allow-overlap"]),"text-overlap":new Tt(Ce.layout_symbol["text-overlap"]),"text-ignore-placement":new Tt(Ce.layout_symbol["text-ignore-placement"]),"text-optional":new Tt(Ce.layout_symbol["text-optional"])})}};class ty{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:li,this.defaultValue=e}evaluate(e){if(e.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(e.formattedSection))return n.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}_t("FormatSectionOverride",ty,{omit:["defaultValue"]});class Hd extends m{constructor(e){super(e,Of)}recalculate(e,n){if(super.recalculate(e,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const o=this.layout.get("text-writing-mode");if(o){const c=[];for(const f of o)c.indexOf(f)<0&&c.push(f);this.layout._values["text-writing-mode"]=c}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,n,o,c){const f=this.layout.get(e).evaluate(n,{},o,c),g=this._unevaluatedLayout._values[e];return g.isDataDriven()||el(g.value)||!f?f:function(y,x){return x.replace(/{([^{}]+)}/g,(k,E)=>y&&E in y?String(y[E]):"")}(n.properties,f)}createBucket(e){return new Ru(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of Of.paint.overridableProperties){if(!Hd.hasPaintOverride(this.layout,e))continue;const n=this.paint.get(e),o=new ty(n),c=new mc(o,n.property.specification);let f=null;f=n.value.kind==="constant"||n.value.kind==="source"?new rl("source",c):new go("composite",c,n.value.zoomStops),this.paint._values[e]=new Yn(n.property,f,n.parameters)}}_handleOverridablePaintPropertyUpdate(e,n,o){return!(!this.layout||n.isDataDriven()||o.isDataDriven())&&Hd.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,n){const o=e.get("text-field"),c=Of.paint.properties[n];let f=!1;const g=y=>{for(const x of y)if(c.overrides&&c.overrides.hasOverride(x))return void(f=!0)};if(o.value.kind==="constant"&&o.value.value instanceof mn)g(o.value.value.sections);else if(o.value.kind==="source"){const y=k=>{f||(k instanceof Hs&&hi(k.value)===as?g(k.value.sections):k instanceof ka?g(k.sections):k.eachChild(y))},x=o.value;x._styleExpression&&y(x._styleExpression.expression)}return f}}let ry;var Sb={get paint(){return ry=ry||new l({"background-color":new Tt(Ce.paint_background["background-color"]),"background-pattern":new t(Ce.paint_background["background-pattern"]),"background-opacity":new Tt(Ce.paint_background["background-opacity"])})}};class Mb extends m{constructor(e){super(e,Sb)}}let iy;var kb={get paint(){return iy=iy||new l({"raster-opacity":new Tt(Ce.paint_raster["raster-opacity"]),"raster-hue-rotate":new Tt(Ce.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Tt(Ce.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Tt(Ce.paint_raster["raster-brightness-max"]),"raster-saturation":new Tt(Ce.paint_raster["raster-saturation"]),"raster-contrast":new Tt(Ce.paint_raster["raster-contrast"]),"raster-resampling":new Tt(Ce.paint_raster["raster-resampling"]),"raster-fade-duration":new Tt(Ce.paint_raster["raster-fade-duration"])})}};class Tb extends m{constructor(e){super(e,kb)}}class Cb extends m{constructor(e){super(e,{}),this.onAdd=n=>{this.implementation.onAdd&&this.implementation.onAdd(n,n.painter.context.gl)},this.onRemove=n=>{this.implementation.onRemove&&this.implementation.onRemove(n,n.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Ib{constructor(e){this._methodToThrottle=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const Nf=63710088e-1;class Il{constructor(e,n){if(isNaN(e)||isNaN(n))throw new Error(`Invalid LngLat object: (${e}, ${n})`);if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Il(te(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const n=Math.PI/180,o=this.lat*n,c=e.lat*n,f=Math.sin(o)*Math.sin(c)+Math.cos(o)*Math.cos(c)*Math.cos((e.lng-this.lng)*n);return Nf*Math.acos(Math.min(f,1))}static convert(e){if(e instanceof Il)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Il(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Il(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const ny=2*Math.PI*Nf;function sy(r){return ny*Math.cos(r*Math.PI/180)}function ay(r){return(180+r)/360}function oy(r){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360}function ly(r,e){return r/sy(e)}function $f(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}class Wd{constructor(e,n,o=0){this.x=+e,this.y=+n,this.z=+o}static fromLngLat(e,n=0){const o=Il.convert(e);return new Wd(ay(o.lng),oy(o.lat),ly(n,o.lat))}toLngLat(){return new Il(360*this.x-180,$f(this.y))}toAltitude(){return this.z*sy($f(this.y))}meterInMercatorCoordinateUnits(){return 1/ny*(e=$f(this.y),1/Math.cos(e*Math.PI/180));var e}}function cy(r,e,n){var o=2*Math.PI*6378137/256/Math.pow(2,n);return[r*o-2*Math.PI*6378137/2,e*o-2*Math.PI*6378137/2]}class jf{constructor(e,n,o){if(e<0||e>25||o<0||o>=Math.pow(2,e)||n<0||n>=Math.pow(2,e))throw new Error(`x=${n}, y=${o}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=n,this.y=o,this.key=Uh(0,e,e,n,o)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,n,o){const c=(g=this.y,y=this.z,x=cy(256*(f=this.x),256*(g=Math.pow(2,y)-g-1),y),k=cy(256*(f+1),256*(g+1),y),x[0]+","+x[1]+","+k[0]+","+k[1]);var f,g,y,x,k;const E=function(P,L,F){let $,U="";for(let W=P;W>0;W--)$=1<<W-1,U+=(L&$?1:0)+(F&$?2:0);return U}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,n>1?"@2x":"").replace(/{quadkey}/g,E).replace(/{bbox-epsg-3857}/g,c)}isChildOf(e){const n=this.z-e.z;return n>0&&e.x===this.x>>n&&e.y===this.y>>n}getTilePoint(e){const n=Math.pow(2,this.z);return new le((e.x*n-this.x)*be,(e.y*n-this.y)*be)}toString(){return`${this.z}/${this.x}/${this.y}`}}class uy{constructor(e,n){this.wrap=e,this.canonical=n,this.key=Uh(e,n.z,n.z,n.x,n.y)}}class gs{constructor(e,n,o,c,f){if(e<o)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${o}`);this.overscaledZ=e,this.wrap=n,this.canonical=new jf(o,+c,+f),this.key=Uh(n,e,o,c,f)}clone(){return new gs(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const n=this.canonical.z-e;return e>this.canonical.z?new gs(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new gs(e,this.wrap,e,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(e,n){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const o=this.canonical.z-e;return e>this.canonical.z?Uh(this.wrap*+n,e,this.canonical.z,this.canonical.x,this.canonical.y):Uh(this.wrap*+n,e,e,this.canonical.x>>o,this.canonical.y>>o)}isChildOf(e){if(e.wrap!==this.wrap)return!1;const n=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>n&&e.canonical.y===this.canonical.y>>n}children(e){if(this.overscaledZ>=e)return[new gs(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,o=2*this.canonical.x,c=2*this.canonical.y;return[new gs(n,this.wrap,n,o,c),new gs(n,this.wrap,n,o+1,c),new gs(n,this.wrap,n,o,c+1),new gs(n,this.wrap,n,o+1,c+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new gs(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new gs(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new uy(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new Wd(e.x-this.wrap,e.y))}}function Uh(r,e,n,o,c){(r*=2)<0&&(r=-1*r-1);const f=1<<n;return(f*f*r+f*c+o).toString(36)+n.toString(36)+e.toString(36)}_t("CanonicalTileID",jf),_t("OverscaledTileID",gs,{omit:["posMatrix"]});class hy{constructor(e,n,o,c=1,f=1,g=1,y=0){if(this.uid=e,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(o&&!["mapbox","terrarium","custom"].includes(o))return void bt(`"${o}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=n.height;const x=this.dim=n.height-2;switch(this.data=new Uint32Array(n.data.buffer),o){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=c,this.greenFactor=f,this.blueFactor=g,this.baseShift=y;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let k=0;k<x;k++)this.data[this._idx(-1,k)]=this.data[this._idx(0,k)],this.data[this._idx(x,k)]=this.data[this._idx(x-1,k)],this.data[this._idx(k,-1)]=this.data[this._idx(k,0)],this.data[this._idx(k,x)]=this.data[this._idx(k,x-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(x,-1)]=this.data[this._idx(x-1,0)],this.data[this._idx(-1,x)]=this.data[this._idx(0,x-1)],this.data[this._idx(x,x)]=this.data[this._idx(x-1,x-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let k=0;k<x;k++)for(let E=0;E<x;E++){const P=this.get(k,E);P>this.max&&(this.max=P),P<this.min&&(this.min=P)}}get(e,n){const o=new Uint8Array(this.data.buffer),c=4*this._idx(e,n);return this.unpack(o[c],o[c+1],o[c+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(e,n){if(e<-1||e>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(e+1)}unpack(e,n,o){return e*this.redFactor+n*this.greenFactor+o*this.blueFactor-this.baseShift}getPixels(){return new ms({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,n,o){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let c=n*this.dim,f=n*this.dim+this.dim,g=o*this.dim,y=o*this.dim+this.dim;switch(n){case-1:c=f-1;break;case 1:f=c+1}switch(o){case-1:g=y-1;break;case 1:y=g+1}const x=-n*this.dim,k=-o*this.dim;for(let E=g;E<y;E++)for(let P=c;P<f;P++)this.data[this._idx(P,E)]=e.data[this._idx(P+x,E+k)]}}_t("DEMData",hy);class dy{constructor(e){this._stringToNumber={},this._numberToString=[];for(let n=0;n<e.length;n++){const o=e[n];this._stringToNumber[o]=n,this._numberToString[n]=o}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class py{constructor(e,n,o,c,f){this.type="Feature",this._vectorTileFeature=e,e._z=n,e._x=o,e._y=c,this.properties=e.properties,this.id=f}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const n in this)n!=="_geometry"&&n!=="_vectorTileFeature"&&(e[n]=this[n]);return e}}class fy{constructor(e,n){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new ra(be,16,0),this.grid3D=new ra(be,16,0),this.featureIndexArray=new On,this.promoteId=n}insert(e,n,o,c,f,g){const y=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,c,f);const x=g?this.grid3D:this.grid;for(let k=0;k<n.length;k++){const E=n[k],P=[1/0,1/0,-1/0,-1/0];for(let L=0;L<E.length;L++){const F=E[L];P[0]=Math.min(P[0],F.x),P[1]=Math.min(P[1],F.y),P[2]=Math.max(P[2],F.x),P[3]=Math.max(P[3],F.y)}P[0]<be&&P[1]<be&&P[2]>=0&&P[3]>=0&&x.insert(y,P[0],P[1],P[2],P[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new kl.VectorTile(new Ef(this.rawTileData)).layers,this.sourceLayerCoder=new dy(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(e,n,o,c){this.loadVTLayers();const f=e.params||{},g=be/e.tileSize/e.scale,y=yo(f.filter),x=e.queryGeometry,k=e.queryPadding*g,E=gy(x),P=this.grid.query(E.minX-k,E.minY-k,E.maxX+k,E.maxY+k),L=gy(e.cameraQueryGeometry),F=this.grid3D.query(L.minX-k,L.minY-k,L.maxX+k,L.maxY+k,(W,re,we,oe)=>function(ve,Be,Oe,ft,kt){for(const at of ve)if(Be<=at.x&&Oe<=at.y&&ft>=at.x&&kt>=at.y)return!0;const ct=[new le(Be,Oe),new le(Be,kt),new le(ft,kt),new le(ft,Oe)];if(ve.length>2){for(const at of ct)if(Qe(ve,at))return!0}for(let at=0;at<ve.length-1;at++)if(Vt(ve[at],ve[at+1],ct))return!0;return!1}(e.cameraQueryGeometry,W-k,re-k,we+k,oe+k));for(const W of F)P.push(W);P.sort(Eb);const $={};let U;for(let W=0;W<P.length;W++){const re=P[W];if(re===U)continue;U=re;const we=this.featureIndexArray.get(re);let oe=null;this.loadMatchingFeature($,we.bucketIndex,we.sourceLayerIndex,we.featureIndex,y,f.layers,f.availableImages,n,o,c,(ve,Be,Oe)=>(oe||(oe=He(ve)),Be.queryIntersectsFeature(x,ve,Oe,oe,this.z,e.transform,g,e.pixelPosMatrix)))}return $}loadMatchingFeature(e,n,o,c,f,g,y,x,k,E,P){const L=this.bucketLayerIDs[n];if(g&&!function(W,re){for(let we=0;we<W.length;we++)if(re.indexOf(W[we])>=0)return!0;return!1}(g,L))return;const F=this.sourceLayerCoder.decode(o),$=this.vtLayers[F].feature(c);if(f.needGeometry){const W=mt($,!0);if(!f.filter(new Fr(this.tileID.overscaledZ),W,this.tileID.canonical))return}else if(!f.filter(new Fr(this.tileID.overscaledZ),$))return;const U=this.getId($,F);for(let W=0;W<L.length;W++){const re=L[W];if(g&&g.indexOf(re)<0)continue;const we=x[re];if(!we)continue;let oe={};U&&E&&(oe=E.getState(we.sourceLayer||"_geojsonTileLayer",U));const ve=Ae({},k[re]);ve.paint=my(ve.paint,we.paint,$,oe,y),ve.layout=my(ve.layout,we.layout,$,oe,y);const Be=!P||P($,we,oe);if(!Be)continue;const Oe=new py($,this.z,this.x,this.y,U);Oe.layer=ve;let ft=e[re];ft===void 0&&(ft=e[re]=[]),ft.push({featureIndex:c,feature:Oe,intersectionZ:Be})}}lookupSymbolFeatures(e,n,o,c,f,g,y,x){const k={};this.loadVTLayers();const E=yo(f);for(const P of e)this.loadMatchingFeature(k,o,c,P,E,g,y,x,n);return k}hasLayer(e){for(const n of this.bucketLayerIDs)for(const o of n)if(e===o)return!0;return!1}getId(e,n){let o=e.id;return this.promoteId&&(o=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[n]],typeof o=="boolean"&&(o=Number(o))),o}}function my(r,e,n,o,c){return de(r,(f,g)=>{const y=e instanceof gl?e.get(g):null;return y&&y.evaluate?y.evaluate(n,o,c):y})}function gy(r){let e=1/0,n=1/0,o=-1/0,c=-1/0;for(const f of r)e=Math.min(e,f.x),n=Math.min(n,f.y),o=Math.max(o,f.x),c=Math.max(c,f.y);return{minX:e,minY:n,maxX:o,maxY:c}}function Eb(r,e){return e-r}function _y(r,e,n,o,c){const f=[];for(let g=0;g<r.length;g++){const y=r[g];let x;for(let k=0;k<y.length-1;k++){let E=y[k],P=y[k+1];E.x<e&&P.x<e||(E.x<e?E=new le(e,E.y+(e-E.x)/(P.x-E.x)*(P.y-E.y))._round():P.x<e&&(P=new le(e,E.y+(e-E.x)/(P.x-E.x)*(P.y-E.y))._round()),E.y<n&&P.y<n||(E.y<n?E=new le(E.x+(n-E.y)/(P.y-E.y)*(P.x-E.x),n)._round():P.y<n&&(P=new le(E.x+(n-E.y)/(P.y-E.y)*(P.x-E.x),n)._round()),E.x>=o&&P.x>=o||(E.x>=o?E=new le(o,E.y+(o-E.x)/(P.x-E.x)*(P.y-E.y))._round():P.x>=o&&(P=new le(o,E.y+(o-E.x)/(P.x-E.x)*(P.y-E.y))._round()),E.y>=c&&P.y>=c||(E.y>=c?E=new le(E.x+(c-E.y)/(P.y-E.y)*(P.x-E.x),c)._round():P.y>=c&&(P=new le(E.x+(c-E.y)/(P.y-E.y)*(P.x-E.x),c)._round()),x&&E.equals(x[x.length-1])||(x=[E],f.push(x)),x.push(P)))))}}return f}_t("FeatureIndex",fy,{omit:["rawTileData","sourceLayerCoder"]});class El extends le{constructor(e,n,o,c){super(e,n),this.angle=o,c!==void 0&&(this.segment=c)}clone(){return new El(this.x,this.y,this.angle,this.segment)}}function yy(r,e,n,o,c){if(e.segment===void 0||n===0)return!0;let f=e,g=e.segment+1,y=0;for(;y>-n/2;){if(g--,g<0)return!1;y-=r[g].dist(f),f=r[g]}y+=r[g].dist(r[g+1]),g++;const x=[];let k=0;for(;y<n/2;){const E=r[g],P=r[g+1];if(!P)return!1;let L=r[g-1].angleTo(E)-E.angleTo(P);for(L=Math.abs((L+3*Math.PI)%(2*Math.PI)-Math.PI),x.push({distance:y,angleDelta:L}),k+=L;y-x[0].distance>o;)k-=x.shift().angleDelta;if(k>c)return!1;g++,y+=E.dist(P)}return!0}function vy(r){let e=0;for(let n=0;n<r.length-1;n++)e+=r[n].dist(r[n+1]);return e}function xy(r,e,n){return r?.6*e*n:0}function by(r,e){return Math.max(r?r.right-r.left:0,e?e.right-e.left:0)}function Pb(r,e,n,o,c,f){const g=xy(n,c,f),y=by(n,o)*f;let x=0;const k=vy(r)/2;for(let E=0;E<r.length-1;E++){const P=r[E],L=r[E+1],F=P.dist(L);if(x+F>k){const $=(k-x)/F,U=Ni.number(P.x,L.x,$),W=Ni.number(P.y,L.y,$),re=new El(U,W,L.angleTo(P),E);return re._round(),!g||yy(r,re,y,g,e)?re:void 0}x+=F}}function Ab(r,e,n,o,c,f,g,y,x){const k=xy(o,f,g),E=by(o,c),P=E*g,L=r[0].x===0||r[0].x===x||r[0].y===0||r[0].y===x;return e-P<e/4&&(e=P+e/4),wy(r,L?e/2*y%e:(E/2+2*f)*g*y%e,e,k,n,P,L,!1,x)}function wy(r,e,n,o,c,f,g,y,x){const k=f/2,E=vy(r);let P=0,L=e-n,F=[];for(let $=0;$<r.length-1;$++){const U=r[$],W=r[$+1],re=U.dist(W),we=W.angleTo(U);for(;L+n<P+re;){L+=n;const oe=(L-P)/re,ve=Ni.number(U.x,W.x,oe),Be=Ni.number(U.y,W.y,oe);if(ve>=0&&ve<x&&Be>=0&&Be<x&&L-k>=0&&L+k<=E){const Oe=new El(ve,Be,we,$);Oe._round(),o&&!yy(r,Oe,f,o,c)||F.push(Oe)}}P+=re}return y||F.length||g||(F=wy(r,P/2,n,o,c,f,g,!0,x)),F}_t("Anchor",El);const Fu=$n;function Sy(r,e,n,o){const c=[],f=r.image,g=f.pixelRatio,y=f.paddedRect.w-2*Fu,x=f.paddedRect.h-2*Fu;let k={x1:r.left,y1:r.top,x2:r.right,y2:r.bottom};const E=f.stretchX||[[0,y]],P=f.stretchY||[[0,x]],L=($e,Mt)=>$e+Mt[1]-Mt[0],F=E.reduce(L,0),$=P.reduce(L,0),U=y-F,W=x-$;let re=0,we=F,oe=0,ve=$,Be=0,Oe=U,ft=0,kt=W;if(f.content&&o){const $e=f.content,Mt=$e[2]-$e[0],wt=$e[3]-$e[1];(f.textFitWidth||f.textFitHeight)&&(k=K_(r)),re=Xd(E,0,$e[0]),oe=Xd(P,0,$e[1]),we=Xd(E,$e[0],$e[2]),ve=Xd(P,$e[1],$e[3]),Be=$e[0]-re,ft=$e[1]-oe,Oe=Mt-we,kt=wt-ve}const ct=k.x1,at=k.y1,xt=k.x2-ct,At=k.y2-at,ut=($e,Mt,wt,Zt)=>{const Or=Kd($e.stretch-re,we,xt,ct),Nr=Jd($e.fixed-Be,Oe,$e.stretch,F),Ti=Kd(Mt.stretch-oe,ve,At,at),_s=Jd(Mt.fixed-ft,kt,Mt.stretch,$),wn=Kd(wt.stretch-re,we,xt,ct),Li=Jd(wt.fixed-Be,Oe,wt.stretch,F),en=Kd(Zt.stretch-oe,ve,At,at),Sn=Jd(Zt.fixed-ft,kt,Zt.stretch,$),An=new le(Or,Ti),Mn=new le(wn,Ti),Ci=new le(wn,en),Gi=new le(Or,en),Dn=new le(Nr/g,_s/g),jn=new le(Li/g,Sn/g),hn=e*Math.PI/180;if(hn){const pi=Math.sin(hn),ir=Math.cos(hn),Ii=[ir,-pi,pi,ir];An._matMult(Ii),Mn._matMult(Ii),Gi._matMult(Ii),Ci._matMult(Ii)}const Vn=$e.stretch+$e.fixed,ys=Mt.stretch+Mt.fixed;return{tl:An,tr:Mn,bl:Gi,br:Ci,tex:{x:f.paddedRect.x+Fu+Vn,y:f.paddedRect.y+Fu+ys,w:wt.stretch+wt.fixed-Vn,h:Zt.stretch+Zt.fixed-ys},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Dn,pixelOffsetBR:jn,minFontScaleX:Oe/g/xt,minFontScaleY:kt/g/At,isSDF:n}};if(o&&(f.stretchX||f.stretchY)){const $e=My(E,U,F),Mt=My(P,W,$);for(let wt=0;wt<$e.length-1;wt++){const Zt=$e[wt],Or=$e[wt+1];for(let Nr=0;Nr<Mt.length-1;Nr++)c.push(ut(Zt,Mt[Nr],Or,Mt[Nr+1]))}}else c.push(ut({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:y+1},{fixed:0,stretch:x+1}));return c}function Xd(r,e,n){let o=0;for(const c of r)o+=Math.max(e,Math.min(n,c[1]))-Math.max(e,Math.min(n,c[0]));return o}function My(r,e,n){const o=[{fixed:-Fu,stretch:0}];for(const[c,f]of r){const g=o[o.length-1];o.push({fixed:c-g.stretch,stretch:g.stretch}),o.push({fixed:c-g.stretch,stretch:g.stretch+(f-c)})}return o.push({fixed:e+Fu,stretch:n}),o}function Kd(r,e,n,o){return r/e*n+o}function Jd(r,e,n,o){return r-e*n/o}class Yd{constructor(e,n,o,c,f,g,y,x,k,E){var P;if(this.boxStartIndex=e.length,k){let L=g.top,F=g.bottom;const $=g.collisionPadding;$&&(L-=$[1],F+=$[3]);let U=F-L;U>0&&(U=Math.max(10,U),this.circleDiameter=U)}else{const L=!((P=g.image)===null||P===void 0)&&P.content&&(g.image.textFitWidth||g.image.textFitHeight)?K_(g):{x1:g.left,y1:g.top,x2:g.right,y2:g.bottom};L.y1=L.y1*y-x[0],L.y2=L.y2*y+x[2],L.x1=L.x1*y-x[3],L.x2=L.x2*y+x[1];const F=g.collisionPadding;if(F&&(L.x1-=F[0]*y,L.y1-=F[1]*y,L.x2+=F[2]*y,L.y2+=F[3]*y),E){const $=new le(L.x1,L.y1),U=new le(L.x2,L.y1),W=new le(L.x1,L.y2),re=new le(L.x2,L.y2),we=E*Math.PI/180;$._rotate(we),U._rotate(we),W._rotate(we),re._rotate(we),L.x1=Math.min($.x,U.x,W.x,re.x),L.x2=Math.max($.x,U.x,W.x,re.x),L.y1=Math.min($.y,U.y,W.y,re.y),L.y2=Math.max($.y,U.y,W.y,re.y)}e.emplaceBack(n.x,n.y,L.x1,L.y1,L.x2,L.y2,o,c,f)}this.boxEndIndex=e.length}}class Db{constructor(e=[],n=zb){if(this.data=e,this.length=this.data.length,this.compare=n,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],n=this.data.pop();return this.length--,this.length>0&&(this.data[0]=n,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:n,compare:o}=this,c=n[e];for(;e>0;){const f=e-1>>1,g=n[f];if(o(c,g)>=0)break;n[e]=g,e=f}n[e]=c}_down(e){const{data:n,compare:o}=this,c=this.length>>1,f=n[e];for(;e<c;){let g=1+(e<<1),y=n[g];const x=g+1;if(x<this.length&&o(n[x],y)<0&&(g=x,y=n[x]),o(y,f)>=0)break;n[e]=y,e=g}n[e]=f}}function zb(r,e){return r<e?-1:r>e?1:0}function Lb(r,e=1,n=!1){let o=1/0,c=1/0,f=-1/0,g=-1/0;const y=r[0];for(let F=0;F<y.length;F++){const $=y[F];(!F||$.x<o)&&(o=$.x),(!F||$.y<c)&&(c=$.y),(!F||$.x>f)&&(f=$.x),(!F||$.y>g)&&(g=$.y)}const x=Math.min(f-o,g-c);let k=x/2;const E=new Db([],Rb);if(x===0)return new le(o,c);for(let F=o;F<f;F+=x)for(let $=c;$<g;$+=x)E.push(new Bu(F+k,$+k,k,r));let P=function(F){let $=0,U=0,W=0;const re=F[0];for(let we=0,oe=re.length,ve=oe-1;we<oe;ve=we++){const Be=re[we],Oe=re[ve],ft=Be.x*Oe.y-Oe.x*Be.y;U+=(Be.x+Oe.x)*ft,W+=(Be.y+Oe.y)*ft,$+=3*ft}return new Bu(U/$,W/$,0,F)}(r),L=E.length;for(;E.length;){const F=E.pop();(F.d>P.d||!P.d)&&(P=F,n&&console.log("found best %d after %d probes",Math.round(1e4*F.d)/1e4,L)),F.max-P.d<=e||(k=F.h/2,E.push(new Bu(F.p.x-k,F.p.y-k,k,r)),E.push(new Bu(F.p.x+k,F.p.y-k,k,r)),E.push(new Bu(F.p.x-k,F.p.y+k,k,r)),E.push(new Bu(F.p.x+k,F.p.y+k,k,r)),L+=4)}return n&&(console.log(`num probes: ${L}`),console.log(`best distance: ${P.d}`)),P.p}function Rb(r,e){return e.max-r.max}function Bu(r,e,n,o){this.p=new le(r,e),this.h=n,this.d=function(c,f){let g=!1,y=1/0;for(let x=0;x<f.length;x++){const k=f[x];for(let E=0,P=k.length,L=P-1;E<P;L=E++){const F=k[E],$=k[L];F.y>c.y!=$.y>c.y&&c.x<($.x-F.x)*(c.y-F.y)/($.y-F.y)+F.x&&(g=!g),y=Math.min(y,bn(c,F,$))}}return(g?1:-1)*Math.sqrt(y)}(this.p,o),this.max=this.d+this.h*Math.SQRT2}var un;S.aq=void 0,(un=S.aq||(S.aq={}))[un.center=1]="center",un[un.left=2]="left",un[un.right=3]="right",un[un.top=4]="top",un[un.bottom=5]="bottom",un[un["top-left"]=6]="top-left",un[un["top-right"]=7]="top-right",un[un["bottom-left"]=8]="bottom-left",un[un["bottom-right"]=9]="bottom-right";const Pl=7,Vf=Number.POSITIVE_INFINITY;function ky(r,e){return e[1]!==Vf?function(n,o,c){let f=0,g=0;switch(o=Math.abs(o),c=Math.abs(c),n){case"top-right":case"top-left":case"top":g=c-Pl;break;case"bottom-right":case"bottom-left":case"bottom":g=-c+Pl}switch(n){case"top-right":case"bottom-right":case"right":f=-o;break;case"top-left":case"bottom-left":case"left":f=o}return[f,g]}(r,e[0],e[1]):function(n,o){let c=0,f=0;o<0&&(o=0);const g=o/Math.SQRT2;switch(n){case"top-right":case"top-left":f=g-Pl;break;case"bottom-right":case"bottom-left":f=-g+Pl;break;case"bottom":f=-o+Pl;break;case"top":f=o-Pl}switch(n){case"top-right":case"bottom-right":c=-g;break;case"top-left":case"bottom-left":c=g;break;case"left":c=o;break;case"right":c=-o}return[c,f]}(r,e[0])}function Ty(r,e,n){var o;const c=r.layout,f=(o=c.get("text-variable-anchor-offset"))===null||o===void 0?void 0:o.evaluate(e,{},n);if(f){const y=f.values,x=[];for(let k=0;k<y.length;k+=2){const E=x[k]=y[k],P=y[k+1].map(L=>L*zi);E.startsWith("top")?P[1]-=Pl:E.startsWith("bottom")&&(P[1]+=Pl),x[k+1]=P}return new Oi(x)}const g=c.get("text-variable-anchor");if(g){let y;y=r._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[c.get("text-radial-offset").evaluate(e,{},n)*zi,Vf]:c.get("text-offset").evaluate(e,{},n).map(k=>k*zi);const x=[];for(const k of g)x.push(k,ky(k,y));return new Oi(x)}return null}function Uf(r){switch(r){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Fb(r,e,n,o,c,f,g,y,x,k,E){let P=f.textMaxSize.evaluate(e,{});P===void 0&&(P=g);const L=r.layers[0].layout,F=L.get("icon-offset").evaluate(e,{},E),$=Iy(n.horizontal),U=g/24,W=r.tilePixelRatio*U,re=r.tilePixelRatio*P/24,we=r.tilePixelRatio*y,oe=r.tilePixelRatio*L.get("symbol-spacing"),ve=L.get("text-padding")*r.tilePixelRatio,Be=function($e,Mt,wt,Zt=1){const Or=$e.get("icon-padding").evaluate(Mt,{},wt),Nr=Or&&Or.values;return[Nr[0]*Zt,Nr[1]*Zt,Nr[2]*Zt,Nr[3]*Zt]}(L,e,E,r.tilePixelRatio),Oe=L.get("text-max-angle")/180*Math.PI,ft=L.get("text-rotation-alignment")!=="viewport"&&L.get("symbol-placement")!=="point",kt=L.get("icon-rotation-alignment")==="map"&&L.get("symbol-placement")!=="point",ct=L.get("symbol-placement"),at=oe/2,xt=L.get("icon-text-fit");let At;o&&xt!=="none"&&(r.allowVerticalPlacement&&n.vertical&&(At=J_(o,n.vertical,xt,L.get("icon-text-fit-padding"),F,U)),$&&(o=J_(o,$,xt,L.get("icon-text-fit-padding"),F,U)));const ut=($e,Mt)=>{Mt.x<0||Mt.x>=be||Mt.y<0||Mt.y>=be||function(wt,Zt,Or,Nr,Ti,_s,wn,Li,en,Sn,An,Mn,Ci,Gi,Dn,jn,hn,Vn,ys,pi,ir,Ii,dn,Ri,Ns){const ca=wt.addToLineVertexArray(Zt,Or);let ua,To,$s,vs,Un=0,Co=0,Zh=0,Dy=0,Jf=-1,Yf=-1;const Io={};let zy=bl("");if(wt.allowVerticalPlacement&&Nr.vertical){const kn=Li.layout.get("text-rotate").evaluate(ir,{},Ri)+90;$s=new Yd(en,Zt,Sn,An,Mn,Nr.vertical,Ci,Gi,Dn,kn),wn&&(vs=new Yd(en,Zt,Sn,An,Mn,wn,hn,Vn,Dn,kn))}if(Ti){const kn=Li.layout.get("icon-rotate").evaluate(ir,{}),xs=Li.layout.get("icon-text-fit")!=="none",Fc=Sy(Ti,kn,dn,xs),da=wn?Sy(wn,kn,dn,xs):void 0;To=new Yd(en,Zt,Sn,An,Mn,Ti,hn,Vn,!1,kn),Un=4*Fc.length;const Bc=wt.iconSizeData;let Ha=null;Bc.kind==="source"?(Ha=[Za*Li.layout.get("icon-size").evaluate(ir,{})],Ha[0]>Cl&&bt(`${wt.layerIds[0]}: Value for "icon-size" is >= ${Vh}. Reduce your "icon-size".`)):Bc.kind==="composite"&&(Ha=[Za*Ii.compositeIconSizes[0].evaluate(ir,{},Ri),Za*Ii.compositeIconSizes[1].evaluate(ir,{},Ri)],(Ha[0]>Cl||Ha[1]>Cl)&&bt(`${wt.layerIds[0]}: Value for "icon-size" is >= ${Vh}. Reduce your "icon-size".`)),wt.addSymbols(wt.icon,Fc,Ha,pi,ys,ir,S.ah.none,Zt,ca.lineStartIndex,ca.lineLength,-1,Ri),Jf=wt.icon.placedSymbolArray.length-1,da&&(Co=4*da.length,wt.addSymbols(wt.icon,da,Ha,pi,ys,ir,S.ah.vertical,Zt,ca.lineStartIndex,ca.lineLength,-1,Ri),Yf=wt.icon.placedSymbolArray.length-1)}const Ly=Object.keys(Nr.horizontal);for(const kn of Ly){const xs=Nr.horizontal[kn];if(!ua){zy=bl(xs.text);const da=Li.layout.get("text-rotate").evaluate(ir,{},Ri);ua=new Yd(en,Zt,Sn,An,Mn,xs,Ci,Gi,Dn,da)}const Fc=xs.positionedLines.length===1;if(Zh+=Cy(wt,Zt,xs,_s,Li,Dn,ir,jn,ca,Nr.vertical?S.ah.horizontal:S.ah.horizontalOnly,Fc?Ly:[kn],Io,Jf,Ii,Ri),Fc)break}Nr.vertical&&(Dy+=Cy(wt,Zt,Nr.vertical,_s,Li,Dn,ir,jn,ca,S.ah.vertical,["vertical"],Io,Yf,Ii,Ri));const Nb=ua?ua.boxStartIndex:wt.collisionBoxArray.length,$b=ua?ua.boxEndIndex:wt.collisionBoxArray.length,jb=$s?$s.boxStartIndex:wt.collisionBoxArray.length,Vb=$s?$s.boxEndIndex:wt.collisionBoxArray.length,Ub=To?To.boxStartIndex:wt.collisionBoxArray.length,qb=To?To.boxEndIndex:wt.collisionBoxArray.length,Gb=vs?vs.boxStartIndex:wt.collisionBoxArray.length,Zb=vs?vs.boxEndIndex:wt.collisionBoxArray.length;let ha=-1;const ep=(kn,xs)=>kn&&kn.circleDiameter?Math.max(kn.circleDiameter,xs):xs;ha=ep(ua,ha),ha=ep($s,ha),ha=ep(To,ha),ha=ep(vs,ha);const Ry=ha>-1?1:0;Ry&&(ha*=Ns/zi),wt.glyphOffsetArray.length>=Ru.MAX_GLYPHS&&bt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),ir.sortKey!==void 0&&wt.addToSortKeyRanges(wt.symbolInstances.length,ir.sortKey);const Hb=Ty(Li,ir,Ri),[Wb,Xb]=function(kn,xs){const Fc=kn.length,da=xs==null?void 0:xs.values;if((da==null?void 0:da.length)>0)for(let Bc=0;Bc<da.length;Bc+=2){const Ha=da[Bc+1];kn.emplaceBack(S.aq[da[Bc]],Ha[0],Ha[1])}return[Fc,kn.length]}(wt.textAnchorOffsets,Hb);wt.symbolInstances.emplaceBack(Zt.x,Zt.y,Io.right>=0?Io.right:-1,Io.center>=0?Io.center:-1,Io.left>=0?Io.left:-1,Io.vertical||-1,Jf,Yf,zy,Nb,$b,jb,Vb,Ub,qb,Gb,Zb,Sn,Zh,Dy,Un,Co,Ry,0,Ci,ha,Wb,Xb)}(r,Mt,$e,n,o,c,At,r.layers[0],r.collisionBoxArray,e.index,e.sourceLayerIndex,r.index,W,[ve,ve,ve,ve],ft,x,we,Be,kt,F,e,f,k,E,g)};if(ct==="line")for(const $e of _y(e.geometry,0,0,be,be)){const Mt=Ab($e,oe,Oe,n.vertical||$,o,24,re,r.overscaling,be);for(const wt of Mt)$&&Bb(r,$.text,at,wt)||ut($e,wt)}else if(ct==="line-center"){for(const $e of e.geometry)if($e.length>1){const Mt=Pb($e,Oe,n.vertical||$,o,24,re);Mt&&ut($e,Mt)}}else if(e.type==="Polygon")for(const $e of Ho(e.geometry,0)){const Mt=Lb($e,16);ut($e[0],new El(Mt.x,Mt.y,0))}else if(e.type==="LineString")for(const $e of e.geometry)ut($e,new El($e[0].x,$e[0].y,0));else if(e.type==="Point")for(const $e of e.geometry)for(const Mt of $e)ut([Mt],new El(Mt.x,Mt.y,0))}function Cy(r,e,n,o,c,f,g,y,x,k,E,P,L,F,$){const U=function(we,oe,ve,Be,Oe,ft,kt,ct){const at=Be.layout.get("text-rotate").evaluate(ft,{})*Math.PI/180,xt=[];for(const At of oe.positionedLines)for(const ut of At.positionedGlyphs){if(!ut.rect)continue;const $e=ut.rect||{};let Mt=U_+1,wt=!0,Zt=1,Or=0;const Nr=(Oe||ct)&&ut.vertical,Ti=ut.metrics.advance*ut.scale/2;if(ct&&oe.verticalizable&&(Or=At.lineOffset/2-(ut.imageName?-(zi-ut.metrics.width*ut.scale)/2:(ut.scale-1)*zi)),ut.imageName){const pi=kt[ut.imageName];wt=pi.sdf,Zt=pi.pixelRatio,Mt=$n/Zt}const _s=Oe?[ut.x+Ti,ut.y]:[0,0];let wn=Oe?[0,0]:[ut.x+Ti+ve[0],ut.y+ve[1]-Or],Li=[0,0];Nr&&(Li=wn,wn=[0,0]);const en=ut.metrics.isDoubleResolution?2:1,Sn=(ut.metrics.left-Mt)*ut.scale-Ti+wn[0],An=(-ut.metrics.top-Mt)*ut.scale+wn[1],Mn=Sn+$e.w/en*ut.scale/Zt,Ci=An+$e.h/en*ut.scale/Zt,Gi=new le(Sn,An),Dn=new le(Mn,An),jn=new le(Sn,Ci),hn=new le(Mn,Ci);if(Nr){const pi=new le(-Ti,Ti-$h),ir=-Math.PI/2,Ii=zi/2-Ti,dn=new le(5-$h-Ii,-(ut.imageName?Ii:0)),Ri=new le(...Li);Gi._rotateAround(ir,pi)._add(dn)._add(Ri),Dn._rotateAround(ir,pi)._add(dn)._add(Ri),jn._rotateAround(ir,pi)._add(dn)._add(Ri),hn._rotateAround(ir,pi)._add(dn)._add(Ri)}if(at){const pi=Math.sin(at),ir=Math.cos(at),Ii=[ir,-pi,pi,ir];Gi._matMult(Ii),Dn._matMult(Ii),jn._matMult(Ii),hn._matMult(Ii)}const Vn=new le(0,0),ys=new le(0,0);xt.push({tl:Gi,tr:Dn,bl:jn,br:hn,tex:$e,writingMode:oe.writingMode,glyphOffset:_s,sectionIndex:ut.sectionIndex,isSDF:wt,pixelOffsetTL:Vn,pixelOffsetBR:ys,minFontScaleX:0,minFontScaleY:0})}return xt}(0,n,y,c,f,g,o,r.allowVerticalPlacement),W=r.textSizeData;let re=null;W.kind==="source"?(re=[Za*c.layout.get("text-size").evaluate(g,{})],re[0]>Cl&&bt(`${r.layerIds[0]}: Value for "text-size" is >= ${Vh}. Reduce your "text-size".`)):W.kind==="composite"&&(re=[Za*F.compositeTextSizes[0].evaluate(g,{},$),Za*F.compositeTextSizes[1].evaluate(g,{},$)],(re[0]>Cl||re[1]>Cl)&&bt(`${r.layerIds[0]}: Value for "text-size" is >= ${Vh}. Reduce your "text-size".`)),r.addSymbols(r.text,U,re,y,f,g,k,e,x.lineStartIndex,x.lineLength,L,$);for(const we of E)P[we]=r.text.placedSymbolArray.length-1;return 4*U.length}function Iy(r){for(const e in r)return r[e];return null}function Bb(r,e,n,o){const c=r.compareText;if(e in c){const f=c[e];for(let g=f.length-1;g>=0;g--)if(o.dist(f[g])<n)return!0}else c[e]=[];return c[e].push(o),!1}const Ey=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class qf{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[n,o]=new Uint8Array(e,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");const c=o>>4;if(c!==1)throw new Error(`Got v${c} data when expected v1.`);const f=Ey[15&o];if(!f)throw new Error("Unrecognized array type.");const[g]=new Uint16Array(e,2,1),[y]=new Uint32Array(e,4,1);return new qf(y,g,f,e)}constructor(e,n=64,o=Float64Array,c){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=o,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const f=Ey.indexOf(this.ArrayType),g=2*e*this.ArrayType.BYTES_PER_ELEMENT,y=e*this.IndexArrayType.BYTES_PER_ELEMENT,x=(8-y%8)%8;if(f<0)throw new Error(`Unexpected typed array class: ${o}.`);c&&c instanceof ArrayBuffer?(this.data=c,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+y+x,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+g+y+x),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+y+x,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+f]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=e)}add(e,n){const o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=e,this.coords[this._pos++]=n,o}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Gf(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,n,o,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:f,coords:g,nodeSize:y}=this,x=[0,f.length-1,0],k=[];for(;x.length;){const E=x.pop()||0,P=x.pop()||0,L=x.pop()||0;if(P-L<=y){for(let W=L;W<=P;W++){const re=g[2*W],we=g[2*W+1];re>=e&&re<=o&&we>=n&&we<=c&&k.push(f[W])}continue}const F=L+P>>1,$=g[2*F],U=g[2*F+1];$>=e&&$<=o&&U>=n&&U<=c&&k.push(f[F]),(E===0?e<=$:n<=U)&&(x.push(L),x.push(F-1),x.push(1-E)),(E===0?o>=$:c>=U)&&(x.push(F+1),x.push(P),x.push(1-E))}return k}within(e,n,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:c,coords:f,nodeSize:g}=this,y=[0,c.length-1,0],x=[],k=o*o;for(;y.length;){const E=y.pop()||0,P=y.pop()||0,L=y.pop()||0;if(P-L<=g){for(let W=L;W<=P;W++)Ay(f[2*W],f[2*W+1],e,n)<=k&&x.push(c[W]);continue}const F=L+P>>1,$=f[2*F],U=f[2*F+1];Ay($,U,e,n)<=k&&x.push(c[F]),(E===0?e-o<=$:n-o<=U)&&(y.push(L),y.push(F-1),y.push(1-E)),(E===0?e+o>=$:n+o>=U)&&(y.push(F+1),y.push(P),y.push(1-E))}return x}}function Gf(r,e,n,o,c,f){if(c-o<=n)return;const g=o+c>>1;Py(r,e,g,o,c,f),Gf(r,e,n,o,g-1,1-f),Gf(r,e,n,g+1,c,1-f)}function Py(r,e,n,o,c,f){for(;c>o;){if(c-o>600){const k=c-o+1,E=n-o+1,P=Math.log(k),L=.5*Math.exp(2*P/3),F=.5*Math.sqrt(P*L*(k-L)/k)*(E-k/2<0?-1:1);Py(r,e,n,Math.max(o,Math.floor(n-E*L/k+F)),Math.min(c,Math.floor(n+(k-E)*L/k+F)),f)}const g=e[2*n+f];let y=o,x=c;for(qh(r,e,o,n),e[2*c+f]>g&&qh(r,e,o,c);y<x;){for(qh(r,e,y,x),y++,x--;e[2*y+f]<g;)y++;for(;e[2*x+f]>g;)x--}e[2*o+f]===g?qh(r,e,o,x):(x++,qh(r,e,x,c)),x<=n&&(o=x+1),n<=x&&(c=x-1)}}function qh(r,e,n,o){Zf(r,n,o),Zf(e,2*n,2*o),Zf(e,2*n+1,2*o+1)}function Zf(r,e,n){const o=r[e];r[e]=r[n],r[n]=o}function Ay(r,e,n,o){const c=r-n,f=e-o;return c*c+f*f}var Hf;S.be=void 0,(Hf=S.be||(S.be={})).create="create",Hf.load="load",Hf.fullLoad="fullLoad";let Qd=null,Gh=[];const Wf=1e3/60,Xf="loadTime",Kf="fullLoadTime",Ob={mark(r){performance.mark(r)},frame(r){const e=r;Qd!=null&&Gh.push(e-Qd),Qd=e},clearMetrics(){Qd=null,Gh=[],performance.clearMeasures(Xf),performance.clearMeasures(Kf);for(const r in S.be)performance.clearMarks(S.be[r])},getPerformanceMetrics(){performance.measure(Xf,S.be.create,S.be.load),performance.measure(Kf,S.be.create,S.be.fullLoad);const r=performance.getEntriesByName(Xf)[0].duration,e=performance.getEntriesByName(Kf)[0].duration,n=Gh.length,o=1/(Gh.reduce((f,g)=>f+g,0)/n/1e3),c=Gh.filter(f=>f>Wf).reduce((f,g)=>f+(g-Wf)/Wf,0);return{loadTime:r,fullLoadTime:e,fps:o,percentDroppedFrames:c/(n+c)*100,totalFrames:n}}};S.$=yi,S.A=kr,S.B=function(r){if(hr==null){const e=r.navigator?r.navigator.userAgent:null;hr=!!r.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return hr},S.C=class{constructor(r,e){this.target=r,this.mapId=e,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new Ib(()=>this.process()),this.subscription=function(n,o,c,f){return n.addEventListener(o,c,!1),{unsubscribe:()=>{n.removeEventListener(o,c,!1)}}}(this.target,"message",n=>this.receive(n)),this.globalScope=or(self)?r:window}registerMessageHandler(r,e){this.messageHandlers[r]=e}sendAsync(r,e){return new Promise((n,o)=>{const c=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[c]={resolve:n,reject:o},e&&e.signal.addEventListener("abort",()=>{delete this.resolveRejects[c];const y={id:c,type:"<cancel>",origin:location.origin,targetMapId:r.targetMapId,sourceMapId:this.mapId};this.target.postMessage(y)},{once:!0});const f=[],g=Object.assign(Object.assign({},r),{id:c,sourceMapId:this.mapId,origin:location.origin,data:xo(r.data,f)});this.target.postMessage(g,{transfer:f})})}receive(r){const e=r.data,n=e.id;if(!(e.origin!=="file://"&&location.origin!=="file://"&&e.origin!==location.origin||e.targetMapId&&this.mapId!==e.targetMapId)){if(e.type==="<cancel>"){delete this.tasks[n];const o=this.abortControllers[n];return delete this.abortControllers[n],void(o&&o.abort())}if(or(self)||e.mustQueue)return this.tasks[n]=e,this.taskQueue.push(n),void this.invoker.trigger();this.processTask(n,e)}}process(){if(this.taskQueue.length===0)return;const r=this.taskQueue.shift(),e=this.tasks[r];delete this.tasks[r],this.taskQueue.length>0&&this.invoker.trigger(),e&&this.processTask(r,e)}processTask(r,e){return d(this,void 0,void 0,function*(){if(e.type==="<response>"){const c=this.resolveRejects[r];return delete this.resolveRejects[r],c?void(e.error?c.reject(Jn(e.error)):c.resolve(Jn(e.data))):void 0}if(!this.messageHandlers[e.type])return void this.completeTask(r,new Error(`Could not find a registered handler for ${e.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const n=Jn(e.data),o=new AbortController;this.abortControllers[r]=o;try{const c=yield this.messageHandlers[e.type](e.sourceMapId,n,o);this.completeTask(r,null,c)}catch(c){this.completeTask(r,c)}})}completeTask(r,e,n){const o=[];delete this.abortControllers[r];const c={id:r,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:e?xo(e):null,data:xo(n,o)};this.target.postMessage(c,{transfer:o})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},S.D=Tt,S.E=zr,S.F=function(){var r=new kr(16);return kr!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r},S.G=nr,S.H=function(r,e,n){var o,c,f,g,y,x,k,E,P,L,F,$,U=n[0],W=n[1],re=n[2];return e===r?(r[12]=e[0]*U+e[4]*W+e[8]*re+e[12],r[13]=e[1]*U+e[5]*W+e[9]*re+e[13],r[14]=e[2]*U+e[6]*W+e[10]*re+e[14],r[15]=e[3]*U+e[7]*W+e[11]*re+e[15]):(c=e[1],f=e[2],g=e[3],y=e[4],x=e[5],k=e[6],E=e[7],P=e[8],L=e[9],F=e[10],$=e[11],r[0]=o=e[0],r[1]=c,r[2]=f,r[3]=g,r[4]=y,r[5]=x,r[6]=k,r[7]=E,r[8]=P,r[9]=L,r[10]=F,r[11]=$,r[12]=o*U+y*W+P*re+e[12],r[13]=c*U+x*W+L*re+e[13],r[14]=f*U+k*W+F*re+e[14],r[15]=g*U+E*W+$*re+e[15]),r},S.I=Af,S.J=function(r,e,n){var o=n[0],c=n[1],f=n[2];return r[0]=e[0]*o,r[1]=e[1]*o,r[2]=e[2]*o,r[3]=e[3]*o,r[4]=e[4]*c,r[5]=e[5]*c,r[6]=e[6]*c,r[7]=e[7]*c,r[8]=e[8]*f,r[9]=e[9]*f,r[10]=e[10]*f,r[11]=e[11]*f,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r},S.K=aa,S.L=function(r,e){const n={};for(let o=0;o<e.length;o++){const c=e[o];c in r&&(n[c]=r[c])}return n},S.M=Il,S.N=ay,S.O=oy,S.P=le,S.Q=gs,S.R=ms,S.S=he,S.T=Va,S.U=ne,S.V=Fe,S.W=be,S.X=I,S.Y=Wd,S.Z=class extends V{},S._=d,S.a=Yt,S.a$=function(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r},S.a0=jf,S.a1=Je,S.a2=r=>{const e=window.document.createElement("video");return e.muted=!0,new Promise(n=>{e.onloadstart=()=>{n(e)};for(const o of r){const c=window.document.createElement("source");lr(o)||(e.crossOrigin="Anonymous"),c.src=o,e.appendChild(c)}})},S.a3=function(){return ee++},S.a4=Gt,S.a5=Ru,S.a6=yo,S.a7=mt,S.a8=Fr,S.a9=py,S.aA=function(r){if(r.type==="custom")return new Cb(r);switch(r.type){case"background":return new Mb(r);case"circle":return new la(r);case"fill":return new Ex(r);case"fill-extrusion":return new qx(r);case"heatmap":return new fx(r);case"hillshade":return new gx(r);case"line":return new Yx(r);case"raster":return new Tb(r);case"symbol":return new Hd(r)}},S.aB=qe,S.aC=function(r,e){if(!r)return[{command:"setStyle",args:[e]}];let n=[];try{if(!er(r.version,e.version))return[{command:"setStyle",args:[e]}];er(r.center,e.center)||n.push({command:"setCenter",args:[e.center]}),er(r.zoom,e.zoom)||n.push({command:"setZoom",args:[e.zoom]}),er(r.bearing,e.bearing)||n.push({command:"setBearing",args:[e.bearing]}),er(r.pitch,e.pitch)||n.push({command:"setPitch",args:[e.pitch]}),er(r.sprite,e.sprite)||n.push({command:"setSprite",args:[e.sprite]}),er(r.glyphs,e.glyphs)||n.push({command:"setGlyphs",args:[e.glyphs]}),er(r.transition,e.transition)||n.push({command:"setTransition",args:[e.transition]}),er(r.light,e.light)||n.push({command:"setLight",args:[e.light]}),er(r.terrain,e.terrain)||n.push({command:"setTerrain",args:[e.terrain]}),er(r.sky,e.sky)||n.push({command:"setSky",args:[e.sky]});const o={},c=[];(function(g,y,x,k){let E;for(E in y=y||{},g=g||{})Object.prototype.hasOwnProperty.call(g,E)&&(Object.prototype.hasOwnProperty.call(y,E)||Tr(E,x,k));for(E in y)Object.prototype.hasOwnProperty.call(y,E)&&(Object.prototype.hasOwnProperty.call(g,E)?er(g[E],y[E])||(g[E].type==="geojson"&&y[E].type==="geojson"&&Hi(g,y,E)?fr(x,{command:"setGeoJSONSourceData",args:[E,y[E].data]}):Rr(E,y,x,k)):Qr(E,y,x))})(r.sources,e.sources,c,o);const f=[];r.layers&&r.layers.forEach(g=>{"source"in g&&o[g.source]?n.push({command:"removeLayer",args:[g.id]}):f.push(g)}),n=n.concat(c),function(g,y,x){y=y||[];const k=(g=g||[]).map(nn),E=y.map(nn),P=g.reduce(Wi,{}),L=y.reduce(Wi,{}),F=k.slice(),$=Object.create(null);let U,W,re,we,oe;for(let ve=0,Be=0;ve<k.length;ve++)U=k[ve],Object.prototype.hasOwnProperty.call(L,U)?Be++:(fr(x,{command:"removeLayer",args:[U]}),F.splice(F.indexOf(U,Be),1));for(let ve=0,Be=0;ve<E.length;ve++)U=E[E.length-1-ve],F[F.length-1-ve]!==U&&(Object.prototype.hasOwnProperty.call(P,U)?(fr(x,{command:"removeLayer",args:[U]}),F.splice(F.lastIndexOf(U,F.length-Be),1)):Be++,we=F[F.length-ve],fr(x,{command:"addLayer",args:[L[U],we]}),F.splice(F.length-ve,0,U),$[U]=!0);for(let ve=0;ve<E.length;ve++)if(U=E[ve],W=P[U],re=L[U],!$[U]&&!er(W,re))if(er(W.source,re.source)&&er(W["source-layer"],re["source-layer"])&&er(W.type,re.type)){for(oe in cr(W.layout,re.layout,x,U,null,"setLayoutProperty"),cr(W.paint,re.paint,x,U,null,"setPaintProperty"),er(W.filter,re.filter)||fr(x,{command:"setFilter",args:[U,re.filter]}),er(W.minzoom,re.minzoom)&&er(W.maxzoom,re.maxzoom)||fr(x,{command:"setLayerZoomRange",args:[U,re.minzoom,re.maxzoom]}),W)Object.prototype.hasOwnProperty.call(W,oe)&&oe!=="layout"&&oe!=="paint"&&oe!=="filter"&&oe!=="metadata"&&oe!=="minzoom"&&oe!=="maxzoom"&&(oe.indexOf("paint.")===0?cr(W[oe],re[oe],x,U,oe.slice(6),"setPaintProperty"):er(W[oe],re[oe])||fr(x,{command:"setLayerProperty",args:[U,oe,re[oe]]}));for(oe in re)Object.prototype.hasOwnProperty.call(re,oe)&&!Object.prototype.hasOwnProperty.call(W,oe)&&oe!=="layout"&&oe!=="paint"&&oe!=="filter"&&oe!=="metadata"&&oe!=="minzoom"&&oe!=="maxzoom"&&(oe.indexOf("paint.")===0?cr(W[oe],re[oe],x,U,oe.slice(6),"setPaintProperty"):er(W[oe],re[oe])||fr(x,{command:"setLayerProperty",args:[U,oe,re[oe]]}))}else fr(x,{command:"removeLayer",args:[U]}),we=F[F.lastIndexOf(U)+1],fr(x,{command:"addLayer",args:[re,we]})}(f,e.layers,n)}catch(o){console.warn("Unable to compute style diff:",o),n=[{command:"setStyle",args:[e]}]}return n},S.aD=function(r){const e=[],n=r.id;return n===void 0&&e.push({message:`layers.${n}: missing required property "id"`}),r.render===void 0&&e.push({message:`layers.${n}: missing required method "render"`}),r.renderingMode&&r.renderingMode!=="2d"&&r.renderingMode!=="3d"&&e.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),e},S.aE=function r(e,n){if(Array.isArray(e)){if(!Array.isArray(n)||e.length!==n.length)return!1;for(let o=0;o<e.length;o++)if(!r(e[o],n[o]))return!1;return!0}if(typeof e=="object"&&e!==null&&n!==null){if(typeof n!="object"||Object.keys(e).length!==Object.keys(n).length)return!1;for(const o in e)if(!r(e[o],n[o]))return!1;return!0}return e===n},S.aF=de,S.aG=De,S.aH=class extends So{constructor(r,e){super(r,e),this.current=0}set(r){this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))}},S.aI=Mo,S.aJ=class extends So{constructor(r,e){super(r,e),this.current=Bd}set(r){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(let e=1;e<16;e++)if(r[e]!==this.current[e]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}}},S.aK=Eu,S.aL=class extends So{constructor(r,e){super(r,e),this.current=[0,0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2]))}},S.aM=class extends So{constructor(r,e){super(r,e),this.current=[0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1]))}},S.aN=Ph,S.aO=function(r,e,n,o,c,f,g){var y=1/(e-n),x=1/(o-c),k=1/(f-g);return r[0]=-2*y,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*x,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*k,r[11]=0,r[12]=(e+n)*y,r[13]=(c+o)*x,r[14]=(g+f)*k,r[15]=1,r},S.aP=Pr,S.aQ=Sl,S.aR=class extends Le{},S.aS=rb,S.aT=class extends st{},S.aU=function(r){return r<=1?1:Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))},S.aV=g_,S.aW=ia,S.aX=class extends lt{},S.aY=_i,S.aZ=function(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]&&r[3]===e[3]&&r[4]===e[4]&&r[5]===e[5]&&r[6]===e[6]&&r[7]===e[7]&&r[8]===e[8]&&r[9]===e[9]&&r[10]===e[10]&&r[11]===e[11]&&r[12]===e[12]&&r[13]===e[13]&&r[14]===e[14]&&r[15]===e[15]},S.a_=function(r,e){var n=r[0],o=r[1],c=r[2],f=r[3],g=r[4],y=r[5],x=r[6],k=r[7],E=r[8],P=r[9],L=r[10],F=r[11],$=r[12],U=r[13],W=r[14],re=r[15],we=e[0],oe=e[1],ve=e[2],Be=e[3],Oe=e[4],ft=e[5],kt=e[6],ct=e[7],at=e[8],xt=e[9],At=e[10],ut=e[11],$e=e[12],Mt=e[13],wt=e[14],Zt=e[15];return Math.abs(n-we)<=Kt*Math.max(1,Math.abs(n),Math.abs(we))&&Math.abs(o-oe)<=Kt*Math.max(1,Math.abs(o),Math.abs(oe))&&Math.abs(c-ve)<=Kt*Math.max(1,Math.abs(c),Math.abs(ve))&&Math.abs(f-Be)<=Kt*Math.max(1,Math.abs(f),Math.abs(Be))&&Math.abs(g-Oe)<=Kt*Math.max(1,Math.abs(g),Math.abs(Oe))&&Math.abs(y-ft)<=Kt*Math.max(1,Math.abs(y),Math.abs(ft))&&Math.abs(x-kt)<=Kt*Math.max(1,Math.abs(x),Math.abs(kt))&&Math.abs(k-ct)<=Kt*Math.max(1,Math.abs(k),Math.abs(ct))&&Math.abs(E-at)<=Kt*Math.max(1,Math.abs(E),Math.abs(at))&&Math.abs(P-xt)<=Kt*Math.max(1,Math.abs(P),Math.abs(xt))&&Math.abs(L-At)<=Kt*Math.max(1,Math.abs(L),Math.abs(At))&&Math.abs(F-ut)<=Kt*Math.max(1,Math.abs(F),Math.abs(ut))&&Math.abs($-$e)<=Kt*Math.max(1,Math.abs($),Math.abs($e))&&Math.abs(U-Mt)<=Kt*Math.max(1,Math.abs(U),Math.abs(Mt))&&Math.abs(W-wt)<=Kt*Math.max(1,Math.abs(W),Math.abs(wt))&&Math.abs(re-Zt)<=Kt*Math.max(1,Math.abs(re),Math.abs(Zt))},S.aa=function(r){const e={};if(r.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,o,c,f)=>{const g=c||f;return e[o]=!g||g.toLowerCase(),""}),e["max-age"]){const n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e},S.ab=function(r,e){const n=[];for(const o in r)o in e||n.push(o);return n},S.ac=rt,S.ad=function(r,e,n){var o=Math.sin(n),c=Math.cos(n),f=e[0],g=e[1],y=e[2],x=e[3],k=e[4],E=e[5],P=e[6],L=e[7];return e!==r&&(r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=f*c+k*o,r[1]=g*c+E*o,r[2]=y*c+P*o,r[3]=x*c+L*o,r[4]=k*c-f*o,r[5]=E*c-g*o,r[6]=P*c-y*o,r[7]=L*c-x*o,r},S.ae=function(r){var e=new kr(16);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e},S.af=oa,S.ag=function(r,e){let n=0,o=0;if(r.kind==="constant")o=r.layoutSize;else if(r.kind!=="source"){const{interpolationType:c,minZoom:f,maxZoom:g}=r,y=c?rt(gn.interpolationFactor(c,e,f,g),0,1):0;r.kind==="camera"?o=Ni.number(r.minSize,r.maxSize,y):n=y}return{uSizeT:n,uSize:o}},S.ai=function(r,{uSize:e,uSizeT:n},{lowerSize:o,upperSize:c}){return r.kind==="source"?o/Za:r.kind==="composite"?Ni.number(o/Za,c/Za,n):e},S.aj=Rf,S.ak=function(r,e,n,o){const c=e.y-r.y,f=e.x-r.x,g=o.y-n.y,y=o.x-n.x,x=g*f-y*c;if(x===0)return null;const k=(y*(r.y-n.y)-g*(r.x-n.x))/x;return new le(r.x+k*f,r.y+k*c)},S.al=_y,S.am=It,S.an=Nn,S.ao=function(r){let e=1/0,n=1/0,o=-1/0,c=-1/0;for(const f of r)e=Math.min(e,f.x),n=Math.min(n,f.y),o=Math.max(o,f.x),c=Math.max(c,f.y);return[e,n,o,c]},S.ap=zi,S.ar=Lf,S.as=function(r,e){var n=e[0],o=e[1],c=e[2],f=e[3],g=e[4],y=e[5],x=e[6],k=e[7],E=e[8],P=e[9],L=e[10],F=e[11],$=e[12],U=e[13],W=e[14],re=e[15],we=n*y-o*g,oe=n*x-c*g,ve=n*k-f*g,Be=o*x-c*y,Oe=o*k-f*y,ft=c*k-f*x,kt=E*U-P*$,ct=E*W-L*$,at=E*re-F*$,xt=P*W-L*U,At=P*re-F*U,ut=L*re-F*W,$e=we*ut-oe*At+ve*xt+Be*at-Oe*ct+ft*kt;return $e?(r[0]=(y*ut-x*At+k*xt)*($e=1/$e),r[1]=(c*At-o*ut-f*xt)*$e,r[2]=(U*ft-W*Oe+re*Be)*$e,r[3]=(L*Oe-P*ft-F*Be)*$e,r[4]=(x*at-g*ut-k*ct)*$e,r[5]=(n*ut-c*at+f*ct)*$e,r[6]=(W*ve-$*ft-re*oe)*$e,r[7]=(E*ft-L*ve+F*oe)*$e,r[8]=(g*At-y*at+k*kt)*$e,r[9]=(o*at-n*At-f*kt)*$e,r[10]=($*Oe-U*ve+re*we)*$e,r[11]=(P*ve-E*Oe-F*we)*$e,r[12]=(y*ct-g*xt-x*kt)*$e,r[13]=(n*xt-o*ct+c*kt)*$e,r[14]=(U*oe-$*Be-W*we)*$e,r[15]=(E*Be-P*oe+L*we)*$e,r):null},S.at=Uf,S.au=zf,S.av=qf,S.aw=function(){const r={},e=Ce.$version;for(const n in Ce.$root){const o=Ce.$root[n];if(o.required){let c=null;c=n==="version"?e:o.type==="array"?[]:{},c!=null&&(r[n]=c)}}return r},S.ax=Su,S.ay=Ir,S.az=function(r){r=r.slice();const e=Object.create(null);for(let n=0;n<r.length;n++)e[r[n].id]=r[n];for(let n=0;n<r.length;n++)"ref"in r[n]&&(r[n]=oi(r[n],e[r[n].ref]));return r},S.b=ht,S.b0=function(r,e,n){return r[0]=e[0]*n[0],r[1]=e[1]*n[1],r[2]=e[2]*n[2],r[3]=e[3]*n[3],r},S.b1=function(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]+r[3]*e[3]},S.b2=te,S.b3=uy,S.b4=ly,S.b5=function(r,e,n,o,c){var f,g=1/Math.tan(e/2);return r[0]=g/n,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=g,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,c!=null&&c!==1/0?(r[10]=(c+o)*(f=1/(o-c)),r[14]=2*c*o*f):(r[10]=-1,r[14]=-2*o),r},S.b6=function(r,e,n){var o=Math.sin(n),c=Math.cos(n),f=e[4],g=e[5],y=e[6],x=e[7],k=e[8],E=e[9],P=e[10],L=e[11];return e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[4]=f*c+k*o,r[5]=g*c+E*o,r[6]=y*c+P*o,r[7]=x*c+L*o,r[8]=k*c-f*o,r[9]=E*c-g*o,r[10]=P*c-y*o,r[11]=L*c-x*o,r},S.b7=_e,S.b8=je,S.b9=function(r){return r*Math.PI/180},S.bA=tl,S.bB=Fs,S.ba=function(r,e){return r[0]=e[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=e[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=e[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},S.bb=class extends O{},S.bc=Nf,S.bd=Ob,S.bf=Qt,S.bg=function(r,e){Yt.REGISTERED_PROTOCOLS[r]=e},S.bh=function(r){delete Yt.REGISTERED_PROTOCOLS[r]},S.bi=function(r,e){const n={};for(let c=0;c<r.length;c++){const f=e&&e[r[c].id]||Ih(r[c]);e&&(e[r[c].id]=f);let g=n[f];g||(g=n[f]=[]),g.push(r[c])}const o=[];for(const c in n)o.push(n[c]);return o},S.bj=_t,S.bk=dy,S.bl=fy,S.bm=G_,S.bn=function(r){r.bucket.createArrays(),r.bucket.tilePixelRatio=be/(512*r.bucket.overscaling),r.bucket.compareText={},r.bucket.iconsNeedLinear=!1;const e=r.bucket.layers[0],n=e.layout,o=e._unevaluatedLayout._values,c={layoutIconSize:o["icon-size"].possiblyEvaluate(new Fr(r.bucket.zoom+1),r.canonical),layoutTextSize:o["text-size"].possiblyEvaluate(new Fr(r.bucket.zoom+1),r.canonical),textMaxSize:o["text-size"].possiblyEvaluate(new Fr(18))};if(r.bucket.textSizeData.kind==="composite"){const{minZoom:k,maxZoom:E}=r.bucket.textSizeData;c.compositeTextSizes=[o["text-size"].possiblyEvaluate(new Fr(k),r.canonical),o["text-size"].possiblyEvaluate(new Fr(E),r.canonical)]}if(r.bucket.iconSizeData.kind==="composite"){const{minZoom:k,maxZoom:E}=r.bucket.iconSizeData;c.compositeIconSizes=[o["icon-size"].possiblyEvaluate(new Fr(k),r.canonical),o["icon-size"].possiblyEvaluate(new Fr(E),r.canonical)]}const f=n.get("text-line-height")*zi,g=n.get("text-rotation-alignment")!=="viewport"&&n.get("symbol-placement")!=="point",y=n.get("text-keep-upright"),x=n.get("text-size");for(const k of r.bucket.features){const E=n.get("text-font").evaluate(k,{},r.canonical).join(","),P=x.evaluate(k,{},r.canonical),L=c.layoutTextSize.evaluate(k,{},r.canonical),F=c.layoutIconSize.evaluate(k,{},r.canonical),$={horizontal:{},vertical:void 0},U=k.text;let W,re=[0,0];if(U){const ve=U.toString(),Be=n.get("text-letter-spacing").evaluate(k,{},r.canonical)*zi,Oe=Eh(ve)?Be:0,ft=n.get("text-anchor").evaluate(k,{},r.canonical),kt=Ty(e,k,r.canonical);if(!kt){const ut=n.get("text-radial-offset").evaluate(k,{},r.canonical);re=ut?ky(ft,[ut*zi,Vf]):n.get("text-offset").evaluate(k,{},r.canonical).map($e=>$e*zi)}let ct=g?"center":n.get("text-justify").evaluate(k,{},r.canonical);const at=n.get("symbol-placement"),xt=at==="point"?n.get("text-max-width").evaluate(k,{},r.canonical)*zi:0,At=()=>{r.bucket.allowVerticalPlacement&&Rs(ve)&&($.vertical=qd(U,r.glyphMap,r.glyphPositions,r.imagePositions,E,xt,f,ft,"left",Oe,re,S.ah.vertical,!0,at,L,P))};if(!g&&kt){const ut=new Set;if(ct==="auto")for(let Mt=0;Mt<kt.values.length;Mt+=2)ut.add(Uf(kt.values[Mt]));else ut.add(ct);let $e=!1;for(const Mt of ut)if(!$.horizontal[Mt])if($e)$.horizontal[Mt]=$.horizontal[0];else{const wt=qd(U,r.glyphMap,r.glyphPositions,r.imagePositions,E,xt,f,"center",Mt,Oe,re,S.ah.horizontal,!1,at,L,P);wt&&($.horizontal[Mt]=wt,$e=wt.positionedLines.length===1)}At()}else{ct==="auto"&&(ct=Uf(ft));const ut=qd(U,r.glyphMap,r.glyphPositions,r.imagePositions,E,xt,f,ft,ct,Oe,re,S.ah.horizontal,!1,at,L,P);ut&&($.horizontal[ct]=ut),At(),Rs(ve)&&g&&y&&($.vertical=qd(U,r.glyphMap,r.glyphPositions,r.imagePositions,E,xt,f,ft,ct,Oe,re,S.ah.vertical,!1,at,L,P))}}let we=!1;if(k.icon&&k.icon.name){const ve=r.imageMap[k.icon.name];ve&&(W=vb(r.imagePositions[k.icon.name],n.get("icon-offset").evaluate(k,{},r.canonical),n.get("icon-anchor").evaluate(k,{},r.canonical)),we=!!ve.sdf,r.bucket.sdfIcons===void 0?r.bucket.sdfIcons=we:r.bucket.sdfIcons!==we&&bt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ve.pixelRatio!==r.bucket.pixelRatio||n.get("icon-rotate").constantOr(1)!==0)&&(r.bucket.iconsNeedLinear=!0))}const oe=Iy($.horizontal)||$.vertical;r.bucket.iconsInText=!!oe&&oe.iconsInText,(oe||W)&&Fb(r.bucket,k,$,W,r.imageMap,c,L,F,re,we,r.canonical)}r.showCollisionBoxes&&r.bucket.generateCollisionDebugBuffers()},S.bo=Cf,S.bp=Mf,S.bq=Tf,S.br=kl,S.bs=Ef,S.bt=class{constructor(r){this._marks={start:[r.url,"start"].join("#"),end:[r.url,"end"].join("#"),measure:r.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let r=performance.getEntriesByName(this._marks.measure);return r.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),r=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),r}},S.bu=function(r,e,n,o,c){return d(this,void 0,void 0,function*(){if(ne())try{return yield Fe(r,e,n,o,c)}catch{}return function(f,g,y,x,k){const E=f.width,P=f.height;dt&&St||(dt=new OffscreenCanvas(E,P),St=dt.getContext("2d",{willReadFrequently:!0})),dt.width=E,dt.height=P,St.drawImage(f,0,0,E,P);const L=St.getImageData(g,y,x,k);return St.clearRect(0,0,E,P),L.data}(r,e,n,o,c)})},S.bv=hy,S.bw=q,S.bx=me,S.by=F_,S.bz=function(r){return r.message===Ze},S.c=Ot,S.d=r=>d(void 0,void 0,void 0,function*(){if(r.byteLength===0)return createImageBitmap(new ImageData(1,1));const e=new Blob([new Uint8Array(r)],{type:"image/png"});try{return createImageBitmap(e)}catch(n){throw new Error(`Could not load image because of ${n.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),S.e=Ae,S.f=r=>new Promise((e,n)=>{const o=new Image;o.onload=()=>{e(o),URL.revokeObjectURL(o.src),o.onload=null,window.requestAnimationFrame(()=>{o.src=Ye})},o.onerror=()=>n(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const c=new Blob([new Uint8Array(r)],{type:"image/png"});o.src=r.byteLength?URL.createObjectURL(c):Ye}),S.g=Ht,S.h=(r,e)=>Lt(Ae(r,{type:"json"}),e),S.i=or,S.j=sr,S.k=dr,S.l=(r,e)=>Lt(Ae(r,{type:"arrayBuffer"}),e),S.m=Lt,S.n=function(r){return new Ef(r).readFields(pb,[])},S.o=zh,S.p=q_,S.q=l,S.r=bu,S.s=lr,S.t=pl,S.u=ot,S.v=Ce,S.w=bt,S.x=zs,S.y=function([r,e,n]){return e+=90,e*=Math.PI/180,n*=Math.PI/180,{x:r*Math.cos(e)*Math.sin(n),y:r*Math.sin(e)*Math.sin(n),z:r*Math.cos(n)}},S.z=Ni}),w("worker",["./shared"],function(S){class d{constructor(R){this.keyCache={},R&&this.replace(R)}replace(R){this._layerConfigs={},this._layers={},this.update(R,[])}update(R,B){for(const Y of R){this._layerConfigs[Y.id]=Y;const ce=this._layers[Y.id]=S.aA(Y);ce._featureFilter=S.a6(ce.filter),this.keyCache[Y.id]&&delete this.keyCache[Y.id]}for(const Y of B)delete this.keyCache[Y],delete this._layerConfigs[Y],delete this._layers[Y];this.familiesBySource={};const j=S.bi(Object.values(this._layerConfigs),this.keyCache);for(const Y of j){const ce=Y.map(Re=>this._layers[Re.id]),fe=ce[0];if(fe.visibility==="none")continue;const xe=fe.source||"";let se=this.familiesBySource[xe];se||(se=this.familiesBySource[xe]={});const Me=fe.sourceLayer||"_geojsonTileLayer";let Ne=se[Me];Ne||(Ne=se[Me]=[]),Ne.push(ce)}}}class q{constructor(R){const B={},j=[];for(const xe in R){const se=R[xe],Me=B[xe]={};for(const Ne in se){const Re=se[+Ne];if(!Re||Re.bitmap.width===0||Re.bitmap.height===0)continue;const ze={x:0,y:0,w:Re.bitmap.width+2,h:Re.bitmap.height+2};j.push(ze),Me[Ne]={rect:ze,metrics:Re.metrics}}}const{w:Y,h:ce}=S.p(j),fe=new S.o({width:Y||1,height:ce||1});for(const xe in R){const se=R[xe];for(const Me in se){const Ne=se[+Me];if(!Ne||Ne.bitmap.width===0||Ne.bitmap.height===0)continue;const Re=B[xe][Me].rect;S.o.copy(Ne.bitmap,fe,{x:0,y:0},{x:Re.x+1,y:Re.y+1},Ne.bitmap)}}this.image=fe,this.positions=B}}S.bj("GlyphAtlas",q);class me{constructor(R){this.tileID=new S.Q(R.tileID.overscaledZ,R.tileID.wrap,R.tileID.canonical.z,R.tileID.canonical.x,R.tileID.canonical.y),this.uid=R.uid,this.zoom=R.zoom,this.pixelRatio=R.pixelRatio,this.tileSize=R.tileSize,this.source=R.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=R.showCollisionBoxes,this.collectResourceTiming=!!R.collectResourceTiming,this.returnDependencies=!!R.returnDependencies,this.promoteId=R.promoteId,this.inFlightDependencies=[]}parse(R,B,j,Y){return S._(this,void 0,void 0,function*(){this.status="parsing",this.data=R,this.collisionBoxArray=new S.a4;const ce=new S.bk(Object.keys(R.layers).sort()),fe=new S.bl(this.tileID,this.promoteId);fe.bucketLayerIDs=[];const xe={},se={featureIndex:fe,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:j},Me=B.familiesBySource[this.source];for(const qt in Me){const Yr=R.layers[qt];if(!Yr)continue;Yr.version===1&&S.w(`Vector tile source "${this.source}" layer "${qt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ui=ce.encode(qt),sn=[];for(let an=0;an<Yr.length;an++){const gi=Yr.feature(an),xa=fe.getId(gi,qt);sn.push({feature:gi,id:xa,index:an,sourceLayerIndex:ui})}for(const an of Me[qt]){const gi=an[0];gi.source!==this.source&&S.w(`layer.source = ${gi.source} does not equal this.source = ${this.source}`),gi.minzoom&&this.zoom<Math.floor(gi.minzoom)||gi.maxzoom&&this.zoom>=gi.maxzoom||gi.visibility!=="none"&&(Pe(an,this.zoom,j),(xe[gi.id]=gi.createBucket({index:fe.bucketLayerIDs.length,layers:an,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ui,sourceID:this.source})).populate(sn,se,this.tileID.canonical),fe.bucketLayerIDs.push(an.map(xa=>xa.id)))}}const Ne=S.aF(se.glyphDependencies,qt=>Object.keys(qt).map(Number));this.inFlightDependencies.forEach(qt=>qt==null?void 0:qt.abort()),this.inFlightDependencies=[];let Re=Promise.resolve({});if(Object.keys(Ne).length){const qt=new AbortController;this.inFlightDependencies.push(qt),Re=Y.sendAsync({type:"GG",data:{stacks:Ne,source:this.source,tileID:this.tileID,type:"glyphs"}},qt)}const ze=Object.keys(se.iconDependencies);let Dt=Promise.resolve({});if(ze.length){const qt=new AbortController;this.inFlightDependencies.push(qt),Dt=Y.sendAsync({type:"GI",data:{icons:ze,source:this.source,tileID:this.tileID,type:"icons"}},qt)}const Pt=Object.keys(se.patternDependencies);let Xt=Promise.resolve({});if(Pt.length){const qt=new AbortController;this.inFlightDependencies.push(qt),Xt=Y.sendAsync({type:"GI",data:{icons:Pt,source:this.source,tileID:this.tileID,type:"patterns"}},qt)}const[$t,ur,Ar]=yield Promise.all([Re,Dt,Xt]),$r=new q($t),ci=new S.bm(ur,Ar);for(const qt in xe){const Yr=xe[qt];Yr instanceof S.a5?(Pe(Yr.layers,this.zoom,j),S.bn({bucket:Yr,glyphMap:$t,glyphPositions:$r.positions,imageMap:ur,imagePositions:ci.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Yr.hasPattern&&(Yr instanceof S.bo||Yr instanceof S.bp||Yr instanceof S.bq)&&(Pe(Yr.layers,this.zoom,j),Yr.addFeatures(se,this.tileID.canonical,ci.patternPositions))}return this.status="done",{buckets:Object.values(xe).filter(qt=>!qt.isEmpty()),featureIndex:fe,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:$r.image,imageAtlas:ci,glyphMap:this.returnDependencies?$t:null,iconMap:this.returnDependencies?ur:null,glyphPositions:this.returnDependencies?$r.positions:null}})}}function Pe(X,R,B){const j=new S.a8(R);for(const Y of X)Y.recalculate(j,B)}class le{constructor(R,B,j){this.actor=R,this.layerIndex=B,this.availableImages=j,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(R,B){return S._(this,void 0,void 0,function*(){const j=yield S.l(R.request,B);try{return{vectorTile:new S.br.VectorTile(new S.bs(j.data)),rawData:j.data,cacheControl:j.cacheControl,expires:j.expires}}catch(Y){const ce=new Uint8Array(j.data);let fe=`Unable to parse the tile at ${R.request.url}, `;throw fe+=ce[0]===31&&ce[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${Y.messge}`,new Error(fe)}})}loadTile(R){return S._(this,void 0,void 0,function*(){const B=R.uid,j=!!(R&&R.request&&R.request.collectResourceTiming)&&new S.bt(R.request),Y=new me(R);this.loading[B]=Y;const ce=new AbortController;Y.abort=ce;try{const fe=yield this.loadVectorTile(R,ce);if(delete this.loading[B],!fe)return null;const xe=fe.rawData,se={};fe.expires&&(se.expires=fe.expires),fe.cacheControl&&(se.cacheControl=fe.cacheControl);const Me={};if(j){const Re=j.finish();Re&&(Me.resourceTiming=JSON.parse(JSON.stringify(Re)))}Y.vectorTile=fe.vectorTile;const Ne=Y.parse(fe.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[B]=Y,this.fetching[B]={rawTileData:xe,cacheControl:se,resourceTiming:Me};try{const Re=yield Ne;return S.e({rawTileData:xe.slice(0)},Re,se,Me)}finally{delete this.fetching[B]}}catch(fe){throw delete this.loading[B],Y.status="done",this.loaded[B]=Y,fe}})}reloadTile(R){return S._(this,void 0,void 0,function*(){const B=R.uid;if(!this.loaded||!this.loaded[B])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const j=this.loaded[B];if(j.showCollisionBoxes=R.showCollisionBoxes,j.status==="parsing"){const Y=yield j.parse(j.vectorTile,this.layerIndex,this.availableImages,this.actor);let ce;if(this.fetching[B]){const{rawTileData:fe,cacheControl:xe,resourceTiming:se}=this.fetching[B];delete this.fetching[B],ce=S.e({rawTileData:fe.slice(0)},Y,xe,se)}else ce=Y;return ce}if(j.status==="done"&&j.vectorTile)return j.parse(j.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(R){return S._(this,void 0,void 0,function*(){const B=this.loading,j=R.uid;B&&B[j]&&B[j].abort&&(B[j].abort.abort(),delete B[j])})}removeTile(R){return S._(this,void 0,void 0,function*(){this.loaded&&this.loaded[R.uid]&&delete this.loaded[R.uid]})}}class H{constructor(){this.loaded={}}loadTile(R){return S._(this,void 0,void 0,function*(){const{uid:B,encoding:j,rawImageData:Y,redFactor:ce,greenFactor:fe,blueFactor:xe,baseShift:se}=R,Me=Y.width+2,Ne=Y.height+2,Re=S.b(Y)?new S.R({width:Me,height:Ne},yield S.bu(Y,-1,-1,Me,Ne)):Y,ze=new S.bv(B,Re,j,ce,fe,xe,se);return this.loaded=this.loaded||{},this.loaded[B]=ze,ze})}removeTile(R){const B=this.loaded,j=R.uid;B&&B[j]&&delete B[j]}}function Ge(X,R){if(X.length!==0){We(X[0],R);for(var B=1;B<X.length;B++)We(X[B],!R)}}function We(X,R){for(var B=0,j=0,Y=0,ce=X.length,fe=ce-1;Y<ce;fe=Y++){var xe=(X[Y][0]-X[fe][0])*(X[fe][1]+X[Y][1]),se=B+xe;j+=Math.abs(B)>=Math.abs(xe)?B-se+xe:xe-se+B,B=se}B+j>=0!=!!R&&X.reverse()}var ke=S.bw(function X(R,B){var j,Y=R&&R.type;if(Y==="FeatureCollection")for(j=0;j<R.features.length;j++)X(R.features[j],B);else if(Y==="GeometryCollection")for(j=0;j<R.geometries.length;j++)X(R.geometries[j],B);else if(Y==="Feature")X(R.geometry,B);else if(Y==="Polygon")Ge(R.coordinates,B);else if(Y==="MultiPolygon")for(j=0;j<R.coordinates.length;j++)Ge(R.coordinates[j],B);return R});const gt=S.br.VectorTileFeature.prototype.toGeoJSON;var he={exports:{}},ne=S.bx,_e=S.br.VectorTileFeature,je=rt;function rt(X,R){this.options=R||{},this.features=X,this.length=X.length}function te(X,R){this.id=typeof X.id=="number"?X.id:void 0,this.type=X.type,this.rawGeometry=X.type===1?[X.geometry]:X.geometry,this.properties=X.tags,this.extent=R||4096}rt.prototype.feature=function(X){return new te(this.features[X],this.options.extent)},te.prototype.loadGeometry=function(){var X=this.rawGeometry;this.geometry=[];for(var R=0;R<X.length;R++){for(var B=X[R],j=[],Y=0;Y<B.length;Y++)j.push(new ne(B[Y][0],B[Y][1]));this.geometry.push(j)}return this.geometry},te.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var X=this.geometry,R=1/0,B=-1/0,j=1/0,Y=-1/0,ce=0;ce<X.length;ce++)for(var fe=X[ce],xe=0;xe<fe.length;xe++){var se=fe[xe];R=Math.min(R,se.x),B=Math.max(B,se.x),j=Math.min(j,se.y),Y=Math.max(Y,se.y)}return[R,j,B,Y]},te.prototype.toGeoJSON=_e.prototype.toGeoJSON;var Ae=S.by,ee=je;function de(X){var R=new Ae;return function(B,j){for(var Y in B.layers)j.writeMessage(3,De,B.layers[Y])}(X,R),R.finish()}function De(X,R){var B;R.writeVarintField(15,X.version||1),R.writeStringField(1,X.name||""),R.writeVarintField(5,X.extent||4096);var j={keys:[],values:[],keycache:{},valuecache:{}};for(B=0;B<X.length;B++)j.feature=X.feature(B),R.writeMessage(2,qe,j);var Y=j.keys;for(B=0;B<Y.length;B++)R.writeStringField(3,Y[B]);var ce=j.values;for(B=0;B<ce.length;B++)R.writeMessage(4,hr,ce[B])}function qe(X,R){var B=X.feature;B.id!==void 0&&R.writeVarintField(1,B.id),R.writeMessage(2,yt,X),R.writeVarintField(3,B.type),R.writeMessage(4,or,B)}function yt(X,R){var B=X.feature,j=X.keys,Y=X.values,ce=X.keycache,fe=X.valuecache;for(var xe in B.properties){var se=B.properties[xe],Me=ce[xe];if(se!==null){Me===void 0&&(j.push(xe),ce[xe]=Me=j.length-1),R.writeVarint(Me);var Ne=typeof se;Ne!=="string"&&Ne!=="boolean"&&Ne!=="number"&&(se=JSON.stringify(se));var Re=Ne+":"+se,ze=fe[Re];ze===void 0&&(Y.push(se),fe[Re]=ze=Y.length-1),R.writeVarint(ze)}}}function bt(X,R){return(R<<3)+(7&X)}function Et(X){return X<<1^X>>31}function or(X,R){for(var B=X.loadGeometry(),j=X.type,Y=0,ce=0,fe=B.length,xe=0;xe<fe;xe++){var se=B[xe],Me=1;j===1&&(Me=se.length),R.writeVarint(bt(1,Me));for(var Ne=j===3?se.length-1:se.length,Re=0;Re<Ne;Re++){Re===1&&j!==1&&R.writeVarint(bt(2,Ne-1));var ze=se[Re].x-Y,Dt=se[Re].y-ce;R.writeVarint(Et(ze)),R.writeVarint(Et(Dt)),Y+=ze,ce+=Dt}j===3&&R.writeVarint(bt(7,1))}}function hr(X,R){var B=typeof X;B==="string"?R.writeStringField(1,X):B==="boolean"?R.writeBooleanField(7,X):B==="number"&&(X%1!=0?R.writeDoubleField(3,X):X<0?R.writeSVarintField(6,X):R.writeVarintField(5,X))}he.exports=de,he.exports.fromVectorTileJs=de,he.exports.fromGeojsonVt=function(X,R){R=R||{};var B={};for(var j in X)B[j]=new ee(X[j].features,R),B[j].name=j,B[j].version=R.version,B[j].extent=R.extent;return de({layers:B})},he.exports.GeoJSONWrapper=ee;var ht=S.bw(he.exports);const Ye={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:X=>X},Fe=Math.fround||(dt=new Float32Array(1),X=>(dt[0]=+X,dt[0]));var dt;const St=3,Ze=5,Ot=6;class Yt{constructor(R){this.options=Object.assign(Object.create(Ye),R),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(R){const{log:B,minZoom:j,maxZoom:Y}=this.options;B&&console.time("total time");const ce=`prepare ${R.length} points`;B&&console.time(ce),this.points=R;const fe=[];for(let se=0;se<R.length;se++){const Me=R[se];if(!Me.geometry)continue;const[Ne,Re]=Me.geometry.coordinates,ze=Fe(Qt(Ne)),Dt=Fe(Ir(Re));fe.push(ze,Dt,1/0,se,-1,1),this.options.reduce&&fe.push(0)}let xe=this.trees[Y+1]=this._createTree(fe);B&&console.timeEnd(ce);for(let se=Y;se>=j;se--){const Me=+Date.now();xe=this.trees[se]=this._createTree(this._cluster(xe,se)),B&&console.log("z%d: %d clusters in %dms",se,xe.numItems,+Date.now()-Me)}return B&&console.timeEnd("total time"),this}getClusters(R,B){let j=((R[0]+180)%360+360)%360-180;const Y=Math.max(-90,Math.min(90,R[1]));let ce=R[2]===180?180:((R[2]+180)%360+360)%360-180;const fe=Math.max(-90,Math.min(90,R[3]));if(R[2]-R[0]>=360)j=-180,ce=180;else if(j>ce){const Re=this.getClusters([j,Y,180,fe],B),ze=this.getClusters([-180,Y,ce,fe],B);return Re.concat(ze)}const xe=this.trees[this._limitZoom(B)],se=xe.range(Qt(j),Ir(fe),Qt(ce),Ir(Y)),Me=xe.data,Ne=[];for(const Re of se){const ze=this.stride*Re;Ne.push(Me[ze+Ze]>1?Ht(Me,ze,this.clusterProps):this.points[Me[ze+St]])}return Ne}getChildren(R){const B=this._getOriginId(R),j=this._getOriginZoom(R),Y="No cluster with the specified id.",ce=this.trees[j];if(!ce)throw new Error(Y);const fe=ce.data;if(B*this.stride>=fe.length)throw new Error(Y);const xe=this.options.radius/(this.options.extent*Math.pow(2,j-1)),se=ce.within(fe[B*this.stride],fe[B*this.stride+1],xe),Me=[];for(const Ne of se){const Re=Ne*this.stride;fe[Re+4]===R&&Me.push(fe[Re+Ze]>1?Ht(fe,Re,this.clusterProps):this.points[fe[Re+St]])}if(Me.length===0)throw new Error(Y);return Me}getLeaves(R,B,j){const Y=[];return this._appendLeaves(Y,R,B=B||10,j=j||0,0),Y}getTile(R,B,j){const Y=this.trees[this._limitZoom(R)],ce=Math.pow(2,R),{extent:fe,radius:xe}=this.options,se=xe/fe,Me=(j-se)/ce,Ne=(j+1+se)/ce,Re={features:[]};return this._addTileFeatures(Y.range((B-se)/ce,Me,(B+1+se)/ce,Ne),Y.data,B,j,ce,Re),B===0&&this._addTileFeatures(Y.range(1-se/ce,Me,1,Ne),Y.data,ce,j,ce,Re),B===ce-1&&this._addTileFeatures(Y.range(0,Me,se/ce,Ne),Y.data,-1,j,ce,Re),Re.features.length?Re:null}getClusterExpansionZoom(R){let B=this._getOriginZoom(R)-1;for(;B<=this.options.maxZoom;){const j=this.getChildren(R);if(B++,j.length!==1)break;R=j[0].properties.cluster_id}return B}_appendLeaves(R,B,j,Y,ce){const fe=this.getChildren(B);for(const xe of fe){const se=xe.properties;if(se&&se.cluster?ce+se.point_count<=Y?ce+=se.point_count:ce=this._appendLeaves(R,se.cluster_id,j,Y,ce):ce<Y?ce++:R.push(xe),R.length===j)break}return ce}_createTree(R){const B=new S.av(R.length/this.stride|0,this.options.nodeSize,Float32Array);for(let j=0;j<R.length;j+=this.stride)B.add(R[j],R[j+1]);return B.finish(),B.data=R,B}_addTileFeatures(R,B,j,Y,ce,fe){for(const xe of R){const se=xe*this.stride,Me=B[se+Ze]>1;let Ne,Re,ze;if(Me)Ne=nr(B,se,this.clusterProps),Re=B[se],ze=B[se+1];else{const Xt=this.points[B[se+St]];Ne=Xt.properties;const[$t,ur]=Xt.geometry.coordinates;Re=Qt($t),ze=Ir(ur)}const Dt={type:1,geometry:[[Math.round(this.options.extent*(Re*ce-j)),Math.round(this.options.extent*(ze*ce-Y))]],tags:Ne};let Pt;Pt=Me||this.options.generateId?B[se+St]:this.points[B[se+St]].id,Pt!==void 0&&(Dt.id=Pt),fe.features.push(Dt)}}_limitZoom(R){return Math.max(this.options.minZoom,Math.min(Math.floor(+R),this.options.maxZoom+1))}_cluster(R,B){const{radius:j,extent:Y,reduce:ce,minPoints:fe}=this.options,xe=j/(Y*Math.pow(2,B)),se=R.data,Me=[],Ne=this.stride;for(let Re=0;Re<se.length;Re+=Ne){if(se[Re+2]<=B)continue;se[Re+2]=B;const ze=se[Re],Dt=se[Re+1],Pt=R.within(se[Re],se[Re+1],xe),Xt=se[Re+Ze];let $t=Xt;for(const ur of Pt){const Ar=ur*Ne;se[Ar+2]>B&&($t+=se[Ar+Ze])}if($t>Xt&&$t>=fe){let ur,Ar=ze*Xt,$r=Dt*Xt,ci=-1;const qt=((Re/Ne|0)<<5)+(B+1)+this.points.length;for(const Yr of Pt){const ui=Yr*Ne;if(se[ui+2]<=B)continue;se[ui+2]=B;const sn=se[ui+Ze];Ar+=se[ui]*sn,$r+=se[ui+1]*sn,se[ui+4]=qt,ce&&(ur||(ur=this._map(se,Re,!0),ci=this.clusterProps.length,this.clusterProps.push(ur)),ce(ur,this._map(se,ui)))}se[Re+4]=qt,Me.push(Ar/$t,$r/$t,1/0,qt,-1,$t),ce&&Me.push(ci)}else{for(let ur=0;ur<Ne;ur++)Me.push(se[Re+ur]);if($t>1)for(const ur of Pt){const Ar=ur*Ne;if(!(se[Ar+2]<=B)){se[Ar+2]=B;for(let $r=0;$r<Ne;$r++)Me.push(se[Ar+$r])}}}}return Me}_getOriginId(R){return R-this.points.length>>5}_getOriginZoom(R){return(R-this.points.length)%32}_map(R,B,j){if(R[B+Ze]>1){const fe=this.clusterProps[R[B+Ot]];return j?Object.assign({},fe):fe}const Y=this.points[R[B+St]].properties,ce=this.options.map(Y);return j&&ce===Y?Object.assign({},ce):ce}}function Ht(X,R,B){return{type:"Feature",id:X[R+St],properties:nr(X,R,B),geometry:{type:"Point",coordinates:[(j=X[R],360*(j-.5)),Lt(X[R+1])]}};var j}function nr(X,R,B){const j=X[R+Ze],Y=j>=1e4?`${Math.round(j/1e3)}k`:j>=1e3?Math.round(j/100)/10+"k":j,ce=X[R+Ot],fe=ce===-1?{}:Object.assign({},B[ce]);return Object.assign(fe,{cluster:!0,cluster_id:X[R+St],point_count:j,point_count_abbreviated:Y})}function Qt(X){return X/360+.5}function Ir(X){const R=Math.sin(X*Math.PI/180),B=.5-.25*Math.log((1+R)/(1-R))/Math.PI;return B<0?0:B>1?1:B}function Lt(X){const R=(180-360*X)*Math.PI/180;return 360*Math.atan(Math.exp(R))/Math.PI-90}function lr(X,R,B,j){for(var Y,ce=j,fe=B-R>>1,xe=B-R,se=X[R],Me=X[R+1],Ne=X[B],Re=X[B+1],ze=R+3;ze<B;ze+=3){var Dt=Er(X[ze],X[ze+1],se,Me,Ne,Re);if(Dt>ce)Y=ze,ce=Dt;else if(Dt===ce){var Pt=Math.abs(ze-fe);Pt<xe&&(Y=ze,xe=Pt)}}ce>j&&(Y-R>3&&lr(X,R,Y,j),X[Y+2]=ce,B-Y>3&&lr(X,Y,B,j))}function Er(X,R,B,j,Y,ce){var fe=Y-B,xe=ce-j;if(fe!==0||xe!==0){var se=((X-B)*fe+(R-j)*xe)/(fe*fe+xe*xe);se>1?(B=Y,j=ce):se>0&&(B+=fe*se,j+=xe*se)}return(fe=X-B)*fe+(xe=R-j)*xe}function _r(X,R,B,j){var Y={id:X===void 0?null:X,type:R,geometry:B,tags:j,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ce){var fe=ce.geometry,xe=ce.type;if(xe==="Point"||xe==="MultiPoint"||xe==="LineString")dr(ce,fe);else if(xe==="Polygon"||xe==="MultiLineString")for(var se=0;se<fe.length;se++)dr(ce,fe[se]);else if(xe==="MultiPolygon")for(se=0;se<fe.length;se++)for(var Me=0;Me<fe[se].length;Me++)dr(ce,fe[se][Me])}(Y),Y}function dr(X,R){for(var B=0;B<R.length;B+=3)X.minX=Math.min(X.minX,R[B]),X.minY=Math.min(X.minY,R[B+1]),X.maxX=Math.max(X.maxX,R[B]),X.maxY=Math.max(X.maxY,R[B+1])}function sr(X,R,B,j){if(R.geometry){var Y=R.geometry.coordinates,ce=R.geometry.type,fe=Math.pow(B.tolerance/((1<<B.maxZoom)*B.extent),2),xe=[],se=R.id;if(B.promoteId?se=R.properties[B.promoteId]:B.generateId&&(se=j||0),ce==="Point")zr(Y,xe);else if(ce==="MultiPoint")for(var Me=0;Me<Y.length;Me++)zr(Y[Me],xe);else if(ce==="LineString")Ce(Y,xe,fe,!1);else if(ce==="MultiLineString"){if(B.lineMetrics){for(Me=0;Me<Y.length;Me++)Ce(Y[Me],xe=[],fe,!1),X.push(_r(se,"LineString",xe,R.properties));return}ai(Y,xe,fe,!1)}else if(ce==="Polygon")ai(Y,xe,fe,!0);else{if(ce!=="MultiPolygon"){if(ce==="GeometryCollection"){for(Me=0;Me<R.geometry.geometries.length;Me++)sr(X,{id:se,geometry:R.geometry.geometries[Me],properties:R.properties},B,j);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Me=0;Me<Y.length;Me++){var Ne=[];ai(Y[Me],Ne,fe,!0),xe.push(Ne)}}X.push(_r(se,ce,xe,R.properties))}}function zr(X,R){R.push(oi(X[0])),R.push(er(X[1])),R.push(0)}function Ce(X,R,B,j){for(var Y,ce,fe=0,xe=0;xe<X.length;xe++){var se=oi(X[xe][0]),Me=er(X[xe][1]);R.push(se),R.push(Me),R.push(0),xe>0&&(fe+=j?(Y*Me-se*ce)/2:Math.sqrt(Math.pow(se-Y,2)+Math.pow(Me-ce,2))),Y=se,ce=Me}var Ne=R.length-3;R[2]=1,lr(R,0,Ne,B),R[Ne+2]=1,R.size=Math.abs(fe),R.start=0,R.end=R.size}function ai(X,R,B,j){for(var Y=0;Y<X.length;Y++){var ce=[];Ce(X[Y],ce,B,j),R.push(ce)}}function oi(X){return X/360+.5}function er(X){var R=Math.sin(X*Math.PI/180),B=.5-.25*Math.log((1+R)/(1-R))/Math.PI;return B<0?0:B>1?1:B}function fr(X,R,B,j,Y,ce,fe,xe){if(j/=R,ce>=(B/=R)&&fe<j)return X;if(fe<B||ce>=j)return null;for(var se=[],Me=0;Me<X.length;Me++){var Ne=X[Me],Re=Ne.geometry,ze=Ne.type,Dt=Y===0?Ne.minX:Ne.minY,Pt=Y===0?Ne.maxX:Ne.maxY;if(Dt>=B&&Pt<j)se.push(Ne);else if(!(Pt<B||Dt>=j)){var Xt=[];if(ze==="Point"||ze==="MultiPoint")Qr(Re,Xt,B,j,Y);else if(ze==="LineString")Tr(Re,Xt,B,j,Y,!1,xe.lineMetrics);else if(ze==="MultiLineString")Hi(Re,Xt,B,j,Y,!1);else if(ze==="Polygon")Hi(Re,Xt,B,j,Y,!0);else if(ze==="MultiPolygon")for(var $t=0;$t<Re.length;$t++){var ur=[];Hi(Re[$t],ur,B,j,Y,!0),ur.length&&Xt.push(ur)}if(Xt.length){if(xe.lineMetrics&&ze==="LineString"){for($t=0;$t<Xt.length;$t++)se.push(_r(Ne.id,ze,Xt[$t],Ne.tags));continue}ze!=="LineString"&&ze!=="MultiLineString"||(Xt.length===1?(ze="LineString",Xt=Xt[0]):ze="MultiLineString"),ze!=="Point"&&ze!=="MultiPoint"||(ze=Xt.length===3?"Point":"MultiPoint"),se.push(_r(Ne.id,ze,Xt,Ne.tags))}}}return se.length?se:null}function Qr(X,R,B,j,Y){for(var ce=0;ce<X.length;ce+=3){var fe=X[ce+Y];fe>=B&&fe<=j&&(R.push(X[ce]),R.push(X[ce+1]),R.push(X[ce+2]))}}function Tr(X,R,B,j,Y,ce,fe){for(var xe,se,Me=Rr(X),Ne=Y===0?nn:Wi,Re=X.start,ze=0;ze<X.length-3;ze+=3){var Dt=X[ze],Pt=X[ze+1],Xt=X[ze+2],$t=X[ze+3],ur=X[ze+4],Ar=Y===0?Dt:Pt,$r=Y===0?$t:ur,ci=!1;fe&&(xe=Math.sqrt(Math.pow(Dt-$t,2)+Math.pow(Pt-ur,2))),Ar<B?$r>B&&(se=Ne(Me,Dt,Pt,$t,ur,B),fe&&(Me.start=Re+xe*se)):Ar>j?$r<j&&(se=Ne(Me,Dt,Pt,$t,ur,j),fe&&(Me.start=Re+xe*se)):cr(Me,Dt,Pt,Xt),$r<B&&Ar>=B&&(se=Ne(Me,Dt,Pt,$t,ur,B),ci=!0),$r>j&&Ar<=j&&(se=Ne(Me,Dt,Pt,$t,ur,j),ci=!0),!ce&&ci&&(fe&&(Me.end=Re+xe*se),R.push(Me),Me=Rr(X)),fe&&(Re+=xe)}var qt=X.length-3;Dt=X[qt],Pt=X[qt+1],Xt=X[qt+2],(Ar=Y===0?Dt:Pt)>=B&&Ar<=j&&cr(Me,Dt,Pt,Xt),qt=Me.length-3,ce&&qt>=3&&(Me[qt]!==Me[0]||Me[qt+1]!==Me[1])&&cr(Me,Me[0],Me[1],Me[2]),Me.length&&R.push(Me)}function Rr(X){var R=[];return R.size=X.size,R.start=X.start,R.end=X.end,R}function Hi(X,R,B,j,Y,ce){for(var fe=0;fe<X.length;fe++)Tr(X[fe],R,B,j,Y,ce,!1)}function cr(X,R,B,j){X.push(R),X.push(B),X.push(j)}function nn(X,R,B,j,Y,ce){var fe=(ce-R)/(j-R);return X.push(ce),X.push(B+(Y-B)*fe),X.push(1),fe}function Wi(X,R,B,j,Y,ce){var fe=(ce-B)/(Y-B);return X.push(R+(j-R)*fe),X.push(ce),X.push(1),fe}function Je(X,R){for(var B=[],j=0;j<X.length;j++){var Y,ce=X[j],fe=ce.type;if(fe==="Point"||fe==="MultiPoint"||fe==="LineString")Y=Kr(ce.geometry,R);else if(fe==="MultiLineString"||fe==="Polygon"){Y=[];for(var xe=0;xe<ce.geometry.length;xe++)Y.push(Kr(ce.geometry[xe],R))}else if(fe==="MultiPolygon")for(Y=[],xe=0;xe<ce.geometry.length;xe++){for(var se=[],Me=0;Me<ce.geometry[xe].length;Me++)se.push(Kr(ce.geometry[xe][Me],R));Y.push(se)}B.push(_r(ce.id,fe,Y,ce.tags))}return B}function Kr(X,R){var B=[];B.size=X.size,X.start!==void 0&&(B.start=X.start,B.end=X.end);for(var j=0;j<X.length;j+=3)B.push(X[j]+R,X[j+1],X[j+2]);return B}function Jr(X,R){if(X.transformed)return X;var B,j,Y,ce=1<<X.z,fe=X.x,xe=X.y;for(B=0;B<X.features.length;B++){var se=X.features[B],Me=se.geometry,Ne=se.type;if(se.geometry=[],Ne===1)for(j=0;j<Me.length;j+=2)se.geometry.push(Xi(Me[j],Me[j+1],R,ce,fe,xe));else for(j=0;j<Me.length;j++){var Re=[];for(Y=0;Y<Me[j].length;Y+=2)Re.push(Xi(Me[j][Y],Me[j][Y+1],R,ce,fe,xe));se.geometry.push(Re)}}return X.transformed=!0,X}function Xi(X,R,B,j,Y,ce){return[Math.round(B*(X*j-Y)),Math.round(B*(R*j-ce))]}function li(X,R,B,j,Y){for(var ce=R===Y.maxZoom?0:Y.tolerance/((1<<R)*Y.extent),fe={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:B,y:j,z:R,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},xe=0;xe<X.length;xe++){fe.numFeatures++,Xe(fe,X[xe],ce,Y);var se=X[xe].minX,Me=X[xe].minY,Ne=X[xe].maxX,Re=X[xe].maxY;se<fe.minX&&(fe.minX=se),Me<fe.minY&&(fe.minY=Me),Ne>fe.maxX&&(fe.maxX=Ne),Re>fe.maxY&&(fe.maxY=Re)}return fe}function Xe(X,R,B,j){var Y=R.geometry,ce=R.type,fe=[];if(ce==="Point"||ce==="MultiPoint")for(var xe=0;xe<Y.length;xe+=3)fe.push(Y[xe]),fe.push(Y[xe+1]),X.numPoints++,X.numSimplified++;else if(ce==="LineString")Rt(fe,Y,X,B,!1,!1);else if(ce==="MultiLineString"||ce==="Polygon")for(xe=0;xe<Y.length;xe++)Rt(fe,Y[xe],X,B,ce==="Polygon",xe===0);else if(ce==="MultiPolygon")for(var se=0;se<Y.length;se++){var Me=Y[se];for(xe=0;xe<Me.length;xe++)Rt(fe,Me[xe],X,B,!0,xe===0)}if(fe.length){var Ne=R.tags||null;if(ce==="LineString"&&j.lineMetrics){for(var Re in Ne={},R.tags)Ne[Re]=R.tags[Re];Ne.mapbox_clip_start=Y.start/Y.size,Ne.mapbox_clip_end=Y.end/Y.size}var ze={geometry:fe,type:ce==="Polygon"||ce==="MultiPolygon"?3:ce==="LineString"||ce==="MultiLineString"?2:1,tags:Ne};R.id!==null&&(ze.id=R.id),X.features.push(ze)}}function Rt(X,R,B,j,Y,ce){var fe=j*j;if(j>0&&R.size<(Y?fe:j))B.numPoints+=R.length/3;else{for(var xe=[],se=0;se<R.length;se+=3)(j===0||R[se+2]>fe)&&(B.numSimplified++,xe.push(R[se]),xe.push(R[se+1])),B.numPoints++;Y&&function(Me,Ne){for(var Re=0,ze=0,Dt=Me.length,Pt=Dt-2;ze<Dt;Pt=ze,ze+=2)Re+=(Me[ze]-Me[Pt])*(Me[ze+1]+Me[Pt+1]);if(Re>0===Ne)for(ze=0,Dt=Me.length;ze<Dt/2;ze+=2){var Xt=Me[ze],$t=Me[ze+1];Me[ze]=Me[Dt-2-ze],Me[ze+1]=Me[Dt-1-ze],Me[Dt-2-ze]=Xt,Me[Dt-1-ze]=$t}}(xe,ce),X.push(xe)}}function Nt(X,R){var B=(R=this.options=function(Y,ce){for(var fe in ce)Y[fe]=ce[fe];return Y}(Object.create(this.options),R)).debug;if(B&&console.time("preprocess data"),R.maxZoom<0||R.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(R.promoteId&&R.generateId)throw new Error("promoteId and generateId cannot be used together.");var j=function(Y,ce){var fe=[];if(Y.type==="FeatureCollection")for(var xe=0;xe<Y.features.length;xe++)sr(fe,Y.features[xe],ce,xe);else sr(fe,Y.type==="Feature"?Y:{geometry:Y},ce);return fe}(X,R);this.tiles={},this.tileCoords=[],B&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",R.indexMaxZoom,R.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),j=function(Y,ce){var fe=ce.buffer/ce.extent,xe=Y,se=fr(Y,1,-1-fe,fe,0,-1,2,ce),Me=fr(Y,1,1-fe,2+fe,0,-1,2,ce);return(se||Me)&&(xe=fr(Y,1,-fe,1+fe,0,-1,2,ce)||[],se&&(xe=Je(se,1).concat(xe)),Me&&(xe=xe.concat(Je(Me,-1)))),xe}(j,R),j.length&&this.splitTile(j,0,0,0),B&&(j.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function mi(X,R,B){return 32*((1<<X)*B+R)+X}function Bi(X,R){return R?X.properties[R]:X.id}function Ut(X,R){if(X==null)return!0;if(X.type==="Feature")return Bi(X,R)!=null;if(X.type==="FeatureCollection"){const B=new Set;for(const j of X.features){const Y=Bi(j,R);if(Y==null||B.has(Y))return!1;B.add(Y)}return!0}return!1}function ss(X,R){const B=new Map;if(X!=null)if(X.type==="Feature")B.set(Bi(X,R),X);else for(const j of X.features)B.set(Bi(j,R),j);return B}Nt.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Nt.prototype.splitTile=function(X,R,B,j,Y,ce,fe){for(var xe=[X,R,B,j],se=this.options,Me=se.debug;xe.length;){j=xe.pop(),B=xe.pop(),R=xe.pop(),X=xe.pop();var Ne=1<<R,Re=mi(R,B,j),ze=this.tiles[Re];if(!ze&&(Me>1&&console.time("creation"),ze=this.tiles[Re]=li(X,R,B,j,se),this.tileCoords.push({z:R,x:B,y:j}),Me)){Me>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",R,B,j,ze.numFeatures,ze.numPoints,ze.numSimplified),console.timeEnd("creation"));var Dt="z"+R;this.stats[Dt]=(this.stats[Dt]||0)+1,this.total++}if(ze.source=X,Y){if(R===se.maxZoom||R===Y)continue;var Pt=1<<Y-R;if(B!==Math.floor(ce/Pt)||j!==Math.floor(fe/Pt))continue}else if(R===se.indexMaxZoom||ze.numPoints<=se.indexMaxPoints)continue;if(ze.source=null,X.length!==0){Me>1&&console.time("clipping");var Xt,$t,ur,Ar,$r,ci,qt=.5*se.buffer/se.extent,Yr=.5-qt,ui=.5+qt,sn=1+qt;Xt=$t=ur=Ar=null,$r=fr(X,Ne,B-qt,B+ui,0,ze.minX,ze.maxX,se),ci=fr(X,Ne,B+Yr,B+sn,0,ze.minX,ze.maxX,se),X=null,$r&&(Xt=fr($r,Ne,j-qt,j+ui,1,ze.minY,ze.maxY,se),$t=fr($r,Ne,j+Yr,j+sn,1,ze.minY,ze.maxY,se),$r=null),ci&&(ur=fr(ci,Ne,j-qt,j+ui,1,ze.minY,ze.maxY,se),Ar=fr(ci,Ne,j+Yr,j+sn,1,ze.minY,ze.maxY,se),ci=null),Me>1&&console.timeEnd("clipping"),xe.push(Xt||[],R+1,2*B,2*j),xe.push($t||[],R+1,2*B,2*j+1),xe.push(ur||[],R+1,2*B+1,2*j),xe.push(Ar||[],R+1,2*B+1,2*j+1)}}},Nt.prototype.getTile=function(X,R,B){var j=this.options,Y=j.extent,ce=j.debug;if(X<0||X>24)return null;var fe=1<<X,xe=mi(X,R=(R%fe+fe)%fe,B);if(this.tiles[xe])return Jr(this.tiles[xe],Y);ce>1&&console.log("drilling down to z%d-%d-%d",X,R,B);for(var se,Me=X,Ne=R,Re=B;!se&&Me>0;)Me--,Ne=Math.floor(Ne/2),Re=Math.floor(Re/2),se=this.tiles[mi(Me,Ne,Re)];return se&&se.source?(ce>1&&console.log("found parent tile z%d-%d-%d",Me,Ne,Re),ce>1&&console.time("drilling down"),this.splitTile(se.source,Me,Ne,Re,X,R,B),ce>1&&console.timeEnd("drilling down"),this.tiles[xe]?Jr(this.tiles[xe],Y):null):null};class as extends le{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(R,B){return S._(this,void 0,void 0,function*(){const j=R.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const Y=this._geoJSONIndex.getTile(j.z,j.x,j.y);if(!Y)return null;const ce=new class{constructor(xe){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=S.W,this.length=xe.length,this._features=xe}feature(xe){return new class{constructor(se){this._feature=se,this.extent=S.W,this.type=se.type,this.properties=se.tags,"id"in se&&!isNaN(se.id)&&(this.id=parseInt(se.id,10))}loadGeometry(){if(this._feature.type===1){const se=[];for(const Me of this._feature.geometry)se.push([new S.P(Me[0],Me[1])]);return se}{const se=[];for(const Me of this._feature.geometry){const Ne=[];for(const Re of Me)Ne.push(new S.P(Re[0],Re[1]));se.push(Ne)}return se}}toGeoJSON(se,Me,Ne){return gt.call(this,se,Me,Ne)}}(this._features[xe])}}(Y.features);let fe=ht(ce);return fe.byteOffset===0&&fe.byteLength===fe.buffer.byteLength||(fe=new Uint8Array(fe)),{vectorTile:ce,rawData:fe.buffer}})}loadData(R){return S._(this,void 0,void 0,function*(){var B;(B=this._pendingRequest)===null||B===void 0||B.abort();const j=!!(R&&R.request&&R.request.collectResourceTiming)&&new S.bt(R.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(R,this._pendingRequest),this._geoJSONIndex=R.cluster?new Yt(function({superclusterOptions:ce,clusterProperties:fe}){if(!fe||!ce)return ce;const xe={},se={},Me={accumulated:null,zoom:0},Ne={properties:null},Re=Object.keys(fe);for(const ze of Re){const[Dt,Pt]=fe[ze],Xt=S.bA(Pt),$t=S.bA(typeof Dt=="string"?[Dt,["accumulated"],["get",ze]]:Dt);xe[ze]=Xt.value,se[ze]=$t.value}return ce.map=ze=>{Ne.properties=ze;const Dt={};for(const Pt of Re)Dt[Pt]=xe[Pt].evaluate(Me,Ne);return Dt},ce.reduce=(ze,Dt)=>{Ne.properties=Dt;for(const Pt of Re)Me.accumulated=ze[Pt],ze[Pt]=se[Pt].evaluate(Me,Ne)},ce}(R)).load((yield this._pendingData).features):new Nt(yield this._pendingData,R.geojsonVtOptions),this.loaded={};const Y={};if(j){const ce=j.finish();ce&&(Y.resourceTiming={},Y.resourceTiming[R.source]=JSON.parse(JSON.stringify(ce)))}return Y}catch(Y){if(delete this._pendingRequest,S.bz(Y))return{abandoned:!0};throw Y}})}getData(){return S._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(R){const B=this.loaded;return B&&B[R.uid]?super.reloadTile(R):this.loadTile(R)}loadAndProcessGeoJSON(R,B){return S._(this,void 0,void 0,function*(){let j=yield this.loadGeoJSON(R,B);if(delete this._pendingRequest,typeof j!="object")throw new Error(`Input data given to '${R.source}' is not a valid GeoJSON object.`);if(ke(j,!0),R.filter){const Y=S.bA(R.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Y.result==="error")throw new Error(Y.value.map(fe=>`${fe.key}: ${fe.message}`).join(", "));j={type:"FeatureCollection",features:j.features.filter(fe=>Y.value.evaluate({zoom:0},fe))}}return j})}loadGeoJSON(R,B){return S._(this,void 0,void 0,function*(){const{promoteId:j}=R;if(R.request){const Y=yield S.h(R.request,B);return this._dataUpdateable=Ut(Y.data,j)?ss(Y.data,j):void 0,Y.data}if(typeof R.data=="string")try{const Y=JSON.parse(R.data);return this._dataUpdateable=Ut(Y,j)?ss(Y,j):void 0,Y}catch{throw new Error(`Input data given to '${R.source}' is not a valid GeoJSON object.`)}if(!R.dataDiff)throw new Error(`Input data given to '${R.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${R.source}`);return function(Y,ce,fe){var xe,se,Me,Ne;if(ce.removeAll&&Y.clear(),ce.remove)for(const Re of ce.remove)Y.delete(Re);if(ce.add)for(const Re of ce.add){const ze=Bi(Re,fe);ze!=null&&Y.set(ze,Re)}if(ce.update)for(const Re of ce.update){let ze=Y.get(Re.id);if(ze==null)continue;const Dt=!Re.removeAllProperties&&(((xe=Re.removeProperties)===null||xe===void 0?void 0:xe.length)>0||((se=Re.addOrUpdateProperties)===null||se===void 0?void 0:se.length)>0);if((Re.newGeometry||Re.removeAllProperties||Dt)&&(ze=Object.assign({},ze),Y.set(Re.id,ze),Dt&&(ze.properties=Object.assign({},ze.properties))),Re.newGeometry&&(ze.geometry=Re.newGeometry),Re.removeAllProperties)ze.properties={};else if(((Me=Re.removeProperties)===null||Me===void 0?void 0:Me.length)>0)for(const Pt of Re.removeProperties)Object.prototype.hasOwnProperty.call(ze.properties,Pt)&&delete ze.properties[Pt];if(((Ne=Re.addOrUpdateProperties)===null||Ne===void 0?void 0:Ne.length)>0)for(const{key:Pt,value:Xt}of Re.addOrUpdateProperties)ze.properties[Pt]=Xt}}(this._dataUpdateable,R.dataDiff,j),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(R){return S._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(R){return this._geoJSONIndex.getClusterExpansionZoom(R.clusterId)}getClusterChildren(R){return this._geoJSONIndex.getChildren(R.clusterId)}getClusterLeaves(R){return this._geoJSONIndex.getLeaves(R.clusterId,R.limit,R.offset)}}class Si{constructor(R){this.self=R,this.actor=new S.C(R),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(B,j)=>{if(this.externalWorkerSourceTypes[B])throw new Error(`Worker source with name "${B}" already registered.`);this.externalWorkerSourceTypes[B]=j},this.self.addProtocol=S.bg,this.self.removeProtocol=S.bh,this.self.registerRTLTextPlugin=B=>{if(S.bB.isParsed())throw new Error("RTL text plugin already registered.");S.bB.setMethods(B)},this.actor.registerMessageHandler("LDT",(B,j)=>this._getDEMWorkerSource(B,j.source).loadTile(j)),this.actor.registerMessageHandler("RDT",(B,j)=>S._(this,void 0,void 0,function*(){this._getDEMWorkerSource(B,j.source).removeTile(j)})),this.actor.registerMessageHandler("GCEZ",(B,j)=>S._(this,void 0,void 0,function*(){return this._getWorkerSource(B,j.type,j.source).getClusterExpansionZoom(j)})),this.actor.registerMessageHandler("GCC",(B,j)=>S._(this,void 0,void 0,function*(){return this._getWorkerSource(B,j.type,j.source).getClusterChildren(j)})),this.actor.registerMessageHandler("GCL",(B,j)=>S._(this,void 0,void 0,function*(){return this._getWorkerSource(B,j.type,j.source).getClusterLeaves(j)})),this.actor.registerMessageHandler("LD",(B,j)=>this._getWorkerSource(B,j.type,j.source).loadData(j)),this.actor.registerMessageHandler("GD",(B,j)=>this._getWorkerSource(B,j.type,j.source).getData()),this.actor.registerMessageHandler("LT",(B,j)=>this._getWorkerSource(B,j.type,j.source).loadTile(j)),this.actor.registerMessageHandler("RT",(B,j)=>this._getWorkerSource(B,j.type,j.source).reloadTile(j)),this.actor.registerMessageHandler("AT",(B,j)=>this._getWorkerSource(B,j.type,j.source).abortTile(j)),this.actor.registerMessageHandler("RMT",(B,j)=>this._getWorkerSource(B,j.type,j.source).removeTile(j)),this.actor.registerMessageHandler("RS",(B,j)=>S._(this,void 0,void 0,function*(){if(!this.workerSources[B]||!this.workerSources[B][j.type]||!this.workerSources[B][j.type][j.source])return;const Y=this.workerSources[B][j.type][j.source];delete this.workerSources[B][j.type][j.source],Y.removeSource!==void 0&&Y.removeSource(j)})),this.actor.registerMessageHandler("RM",B=>S._(this,void 0,void 0,function*(){delete this.layerIndexes[B],delete this.availableImages[B],delete this.workerSources[B],delete this.demWorkerSources[B]})),this.actor.registerMessageHandler("SR",(B,j)=>S._(this,void 0,void 0,function*(){this.referrer=j})),this.actor.registerMessageHandler("SRPS",(B,j)=>this._syncRTLPluginState(B,j)),this.actor.registerMessageHandler("IS",(B,j)=>S._(this,void 0,void 0,function*(){this.self.importScripts(j)})),this.actor.registerMessageHandler("SI",(B,j)=>this._setImages(B,j)),this.actor.registerMessageHandler("UL",(B,j)=>S._(this,void 0,void 0,function*(){this._getLayerIndex(B).update(j.layers,j.removedIds)})),this.actor.registerMessageHandler("SL",(B,j)=>S._(this,void 0,void 0,function*(){this._getLayerIndex(B).replace(j)}))}_setImages(R,B){return S._(this,void 0,void 0,function*(){this.availableImages[R]=B;for(const j in this.workerSources[R]){const Y=this.workerSources[R][j];for(const ce in Y)Y[ce].availableImages=B}})}_syncRTLPluginState(R,B){return S._(this,void 0,void 0,function*(){if(S.bB.isParsed())return S.bB.getState();if(B.pluginStatus!=="loading")return S.bB.setState(B),B;const j=B.pluginURL;if(this.self.importScripts(j),S.bB.isParsed()){const Y={pluginStatus:"loaded",pluginURL:j};return S.bB.setState(Y),Y}throw S.bB.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${j}`)})}_getAvailableImages(R){let B=this.availableImages[R];return B||(B=[]),B}_getLayerIndex(R){let B=this.layerIndexes[R];return B||(B=this.layerIndexes[R]=new d),B}_getWorkerSource(R,B,j){if(this.workerSources[R]||(this.workerSources[R]={}),this.workerSources[R][B]||(this.workerSources[R][B]={}),!this.workerSources[R][B][j]){const Y={sendAsync:(ce,fe)=>(ce.targetMapId=R,this.actor.sendAsync(ce,fe))};switch(B){case"vector":this.workerSources[R][B][j]=new le(Y,this._getLayerIndex(R),this._getAvailableImages(R));break;case"geojson":this.workerSources[R][B][j]=new as(Y,this._getLayerIndex(R),this._getAvailableImages(R));break;default:this.workerSources[R][B][j]=new this.externalWorkerSourceTypes[B](Y,this._getLayerIndex(R),this._getAvailableImages(R))}}return this.workerSources[R][B][j]}_getDEMWorkerSource(R,B){return this.demWorkerSources[R]||(this.demWorkerSources[R]={}),this.demWorkerSources[R][B]||(this.demWorkerSources[R][B]=new H),this.demWorkerSources[R][B]}}return S.i(self)&&(self.worker=new Si(self)),Si}),w("index",["exports","./shared"],function(S,d){var q="4.3.2";let me,Pe;const le={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:p=>new Promise((t,s)=>{const l=requestAnimationFrame(t);p.signal.addEventListener("abort",()=>{cancelAnimationFrame(l),s(d.c())})}),getImageData(p,t=0){return this.getImageCanvasContext(p).getImageData(-t,-t,p.width+2*t,p.height+2*t)},getImageCanvasContext(p){const t=window.document.createElement("canvas"),s=t.getContext("2d",{willReadFrequently:!0});if(!s)throw new Error("failed to create canvas 2d context");return t.width=p.width,t.height=p.height,s.drawImage(p,0,0,p.width,p.height),s},resolveURL:p=>(me||(me=document.createElement("a")),me.href=p,me.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(Pe==null&&(Pe=matchMedia("(prefers-reduced-motion: reduce)")),Pe.matches)}};class H{static testProp(t){if(!H.docStyle)return t[0];for(let s=0;s<t.length;s++)if(t[s]in H.docStyle)return t[s];return t[0]}static create(t,s,l){const u=window.document.createElement(t);return s!==void 0&&(u.className=s),l&&l.appendChild(u),u}static createNS(t,s){return window.document.createElementNS(t,s)}static disableDrag(){H.docStyle&&H.selectProp&&(H.userSelect=H.docStyle[H.selectProp],H.docStyle[H.selectProp]="none")}static enableDrag(){H.docStyle&&H.selectProp&&(H.docStyle[H.selectProp]=H.userSelect)}static setTransform(t,s){t.style[H.transformProp]=s}static addEventListener(t,s,l,u={}){t.addEventListener(s,l,"passive"in u?u:u.capture)}static removeEventListener(t,s,l,u={}){t.removeEventListener(s,l,"passive"in u?u:u.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",H.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",H.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",H.suppressClickInternal,!0)},0)}static getScale(t){const s=t.getBoundingClientRect();return{x:s.width/t.offsetWidth||1,y:s.height/t.offsetHeight||1,boundingClientRect:s}}static getPoint(t,s,l){const u=s.boundingClientRect;return new d.P((l.clientX-u.left)/s.x-t.clientLeft,(l.clientY-u.top)/s.y-t.clientTop)}static mousePos(t,s){const l=H.getScale(t);return H.getPoint(t,l,s)}static touchPos(t,s){const l=[],u=H.getScale(t);for(let m=0;m<s.length;m++)l.push(H.getPoint(t,u,s[m]));return l}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}}H.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,H.selectProp=H.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),H.transformProp=H.testProp(["transform","WebkitTransform"]);const Ge={supported:!1,testSupport:function(p){!gt&&ke&&(he?ne(p):We=p)}};let We,ke,gt=!1,he=!1;function ne(p){const t=p.createTexture();p.bindTexture(p.TEXTURE_2D,t);try{if(p.texImage2D(p.TEXTURE_2D,0,p.RGBA,p.RGBA,p.UNSIGNED_BYTE,ke),p.isContextLost())return;Ge.supported=!0}catch{}p.deleteTexture(t),gt=!0}var _e;typeof document<"u"&&(ke=document.createElement("img"),ke.onload=()=>{We&&ne(We),We=null,he=!0},ke.onerror=()=>{gt=!0,We=null},ke.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(p){let t,s,l,u;p.resetRequestQueue=()=>{t=[],s=0,l=0,u={}},p.addThrottleControl=M=>{const I=l++;return u[I]=M,I},p.removeThrottleControl=M=>{delete u[M],v()},p.getImage=(M,I,z=!0)=>new Promise((D,O)=>{Ge.supported&&(M.headers||(M.headers={}),M.headers.accept="image/webp,*/*"),d.e(M,{type:"image"}),t.push({abortController:I,requestParameters:M,supportImageRefresh:z,state:"queued",onError:V=>{O(V)},onSuccess:V=>{D(V)}}),v()});const m=M=>d._(this,void 0,void 0,function*(){M.state="running";const{requestParameters:I,supportImageRefresh:z,onError:D,onSuccess:O,abortController:V}=M,G=z===!1&&!d.i(self)&&!d.g(I.url)&&(!I.headers||Object.keys(I.headers).reduce((ie,pe)=>ie&&pe==="accept",!0));s++;const Q=G?b(I,V):d.m(I,V);try{const ie=yield Q;delete M.abortController,M.state="completed",ie.data instanceof HTMLImageElement||d.b(ie.data)?O(ie):ie.data&&O({data:yield(Z=ie.data,typeof createImageBitmap=="function"?d.d(Z):d.f(Z)),cacheControl:ie.cacheControl,expires:ie.expires})}catch(ie){delete M.abortController,D(ie)}finally{s--,v()}var Z}),v=()=>{const M=(()=>{for(const I of Object.keys(u))if(u[I]())return!0;return!1})()?d.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:d.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let I=s;I<M&&t.length>0;I++){const z=t.shift();z.abortController.signal.aborted?I--:m(z)}},b=(M,I)=>new Promise((z,D)=>{const O=new Image,V=M.url,G=M.credentials;G&&G==="include"?O.crossOrigin="use-credentials":(G&&G==="same-origin"||!d.s(V))&&(O.crossOrigin="anonymous"),I.signal.addEventListener("abort",()=>{O.src="",D(d.c())}),O.fetchPriority="high",O.onload=()=>{O.onerror=O.onload=null,z({data:O})},O.onerror=()=>{O.onerror=O.onload=null,I.signal.aborted||D(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},O.src=V})}(_e||(_e={})),_e.resetRequestQueue();class je{constructor(t){this._transformRequestFn=t}transformRequest(t,s){return this._transformRequestFn&&this._transformRequestFn(t,s)||{url:t}}setTransformRequest(t){this._transformRequestFn=t}}function rt(p){var t=new d.A(3);return t[0]=p[0],t[1]=p[1],t[2]=p[2],t}var te,Ae=function(p,t,s){return p[0]=t[0]-s[0],p[1]=t[1]-s[1],p[2]=t[2]-s[2],p};te=new d.A(3),d.A!=Float32Array&&(te[0]=0,te[1]=0,te[2]=0);var ee=function(p){var t=p[0],s=p[1];return t*t+s*s};function de(p){const t=[];if(typeof p=="string")t.push({id:"default",url:p});else if(p&&p.length>0){const s=[];for(const{id:l,url:u}of p){const m=`${l}${u}`;s.indexOf(m)===-1&&(s.push(m),t.push({id:l,url:u}))}}return t}function De(p,t,s){const l=p.split("?");return l[0]+=`${t}${s}`,l.join("?")}(function(){var p=new d.A(2);d.A!=Float32Array&&(p[0]=0,p[1]=0)})();class qe{constructor(t,s,l,u){this.context=t,this.format=l,this.texture=t.gl.createTexture(),this.update(s,u)}update(t,s,l){const{width:u,height:m}=t,v=!(this.size&&this.size[0]===u&&this.size[1]===m||l),{context:b}=this,{gl:M}=b;if(this.useMipmap=!!(s&&s.useMipmap),M.bindTexture(M.TEXTURE_2D,this.texture),b.pixelStoreUnpackFlipY.set(!1),b.pixelStoreUnpack.set(1),b.pixelStoreUnpackPremultiplyAlpha.set(this.format===M.RGBA&&(!s||s.premultiply!==!1)),v)this.size=[u,m],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||d.b(t)?M.texImage2D(M.TEXTURE_2D,0,this.format,this.format,M.UNSIGNED_BYTE,t):M.texImage2D(M.TEXTURE_2D,0,this.format,u,m,0,this.format,M.UNSIGNED_BYTE,t.data);else{const{x:I,y:z}=l||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||d.b(t)?M.texSubImage2D(M.TEXTURE_2D,0,I,z,M.RGBA,M.UNSIGNED_BYTE,t):M.texSubImage2D(M.TEXTURE_2D,0,I,z,u,m,M.RGBA,M.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&M.generateMipmap(M.TEXTURE_2D)}bind(t,s,l){const{context:u}=this,{gl:m}=u;m.bindTexture(m.TEXTURE_2D,this.texture),l!==m.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(l=m.LINEAR),t!==this.filter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,t),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,l||t),this.filter=t),s!==this.wrap&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,s),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,s),this.wrap=s)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}function yt(p){const{userImage:t}=p;return!!(t&&t.render&&t.render())&&(p.data.replace(new Uint8Array(t.data.buffer)),!0)}class bt extends d.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new d.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:s,promiseResolve:l}of this.requestors)l(this._getImagesForIds(s));this.requestors=[]}}getImage(t){const s=this.images[t];if(s&&!s.data&&s.spriteData){const l=s.spriteData;s.data=new d.R({width:l.width,height:l.height},l.context.getImageData(l.x,l.y,l.width,l.height).data),s.spriteData=null}return s}addImage(t,s){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,s)&&(this.images[t]=s)}_validate(t,s){let l=!0;const u=s.data||s.spriteData;return this._validateStretch(s.stretchX,u&&u.width)||(this.fire(new d.j(new Error(`Image "${t}" has invalid "stretchX" value`))),l=!1),this._validateStretch(s.stretchY,u&&u.height)||(this.fire(new d.j(new Error(`Image "${t}" has invalid "stretchY" value`))),l=!1),this._validateContent(s.content,s)||(this.fire(new d.j(new Error(`Image "${t}" has invalid "content" value`))),l=!1),l}_validateStretch(t,s){if(!t)return!0;let l=0;for(const u of t){if(u[0]<l||u[1]<u[0]||s<u[1])return!1;l=u[1]}return!0}_validateContent(t,s){if(!t)return!0;if(t.length!==4)return!1;const l=s.spriteData,u=l&&l.width||s.data.width,m=l&&l.height||s.data.height;return!(t[0]<0||u<t[0]||t[1]<0||m<t[1]||t[2]<0||u<t[2]||t[3]<0||m<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,s,l=!0){const u=this.getImage(t);if(l&&(u.data.width!==s.data.width||u.data.height!==s.data.height))throw new Error(`size mismatch between old image (${u.data.width}x${u.data.height}) and new image (${s.data.width}x${s.data.height}).`);s.version=u.version+1,this.images[t]=s,this.updatedImages[t]=!0}removeImage(t){const s=this.images[t];delete this.images[t],delete this.patterns[t],s.userImage&&s.userImage.onRemove&&s.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t){return new Promise((s,l)=>{let u=!0;if(!this.isLoaded())for(const m of t)this.images[m]||(u=!1);this.isLoaded()||u?s(this._getImagesForIds(t)):this.requestors.push({ids:t,promiseResolve:s})})}_getImagesForIds(t){const s={};for(const l of t){let u=this.getImage(l);u||(this.fire(new d.k("styleimagemissing",{id:l})),u=this.getImage(l)),u?s[l]={data:u.data.clone(),pixelRatio:u.pixelRatio,sdf:u.sdf,version:u.version,stretchX:u.stretchX,stretchY:u.stretchY,content:u.content,textFitWidth:u.textFitWidth,textFitHeight:u.textFitHeight,hasRenderCallback:!!(u.userImage&&u.userImage.render)}:d.w(`Image "${l}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return s}getPixelSize(){const{width:t,height:s}=this.atlasImage;return{width:t,height:s}}getPattern(t){const s=this.patterns[t],l=this.getImage(t);if(!l)return null;if(s&&s.position.version===l.version)return s.position;if(s)s.position.version=l.version;else{const u={w:l.data.width+2,h:l.data.height+2,x:0,y:0},m=new d.I(u,l);this.patterns[t]={bin:u,position:m}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const s=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new qe(t,this.atlasImage,s.RGBA),this.atlasTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const m in this.patterns)t.push(this.patterns[m].bin);const{w:s,h:l}=d.p(t),u=this.atlasImage;u.resize({width:s||1,height:l||1});for(const m in this.patterns){const{bin:v}=this.patterns[m],b=v.x+1,M=v.y+1,I=this.getImage(m).data,z=I.width,D=I.height;d.R.copy(I,u,{x:0,y:0},{x:b,y:M},{width:z,height:D}),d.R.copy(I,u,{x:0,y:D-1},{x:b,y:M-1},{width:z,height:1}),d.R.copy(I,u,{x:0,y:0},{x:b,y:M+D},{width:z,height:1}),d.R.copy(I,u,{x:z-1,y:0},{x:b-1,y:M},{width:1,height:D}),d.R.copy(I,u,{x:0,y:0},{x:b+z,y:M},{width:1,height:D})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const s of t){if(this.callbackDispatchedThisFrame[s])continue;this.callbackDispatchedThisFrame[s]=!0;const l=this.getImage(s);l||d.w(`Image with ID: "${s}" was not found`),yt(l)&&this.updateImage(s,l)}}}const Et=1e20;function or(p,t,s,l,u,m,v,b,M){for(let I=t;I<t+l;I++)hr(p,s*m+I,m,u,v,b,M);for(let I=s;I<s+u;I++)hr(p,I*m+t,1,l,v,b,M)}function hr(p,t,s,l,u,m,v){m[0]=0,v[0]=-Et,v[1]=Et,u[0]=p[t];for(let b=1,M=0,I=0;b<l;b++){u[b]=p[t+b*s];const z=b*b;do{const D=m[M];I=(u[b]-u[D]+z-D*D)/(b-D)/2}while(I<=v[M]&&--M>-1);M++,m[M]=b,v[M]=I,v[M+1]=Et}for(let b=0,M=0;b<l;b++){for(;v[M+1]<b;)M++;const I=m[M],z=b-I;p[t+b*s]=u[I]+z*z}}class ht{constructor(t,s){this.requestManager=t,this.localIdeographFontFamily=s,this.entries={}}setURL(t){this.url=t}getGlyphs(t){return d._(this,void 0,void 0,function*(){const s=[];for(const m in t)for(const v of t[m])s.push(this._getAndCacheGlyphsPromise(m,v));const l=yield Promise.all(s),u={};for(const{stack:m,id:v,glyph:b}of l)u[m]||(u[m]={}),u[m][v]=b&&{id:b.id,bitmap:b.bitmap.clone(),metrics:b.metrics};return u})}_getAndCacheGlyphsPromise(t,s){return d._(this,void 0,void 0,function*(){let l=this.entries[t];l||(l=this.entries[t]={glyphs:{},requests:{},ranges:{}});let u=l.glyphs[s];if(u!==void 0)return{stack:t,id:s,glyph:u};if(u=this._tinySDF(l,t,s),u)return l.glyphs[s]=u,{stack:t,id:s,glyph:u};const m=Math.floor(s/256);if(256*m>65535)throw new Error("glyphs > 65535 not supported");if(l.ranges[m])return{stack:t,id:s,glyph:u};if(!this.url)throw new Error("glyphsUrl is not set");if(!l.requests[m]){const b=ht.loadGlyphRange(t,m,this.url,this.requestManager);l.requests[m]=b}const v=yield l.requests[m];for(const b in v)this._doesCharSupportLocalGlyph(+b)||(l.glyphs[+b]=v[+b]);return l.ranges[m]=!0,{stack:t,id:s,glyph:v[s]||null}})}_doesCharSupportLocalGlyph(t){return!!this.localIdeographFontFamily&&(d.u["CJK Unified Ideographs"](t)||d.u["Hangul Syllables"](t)||d.u.Hiragana(t)||d.u.Katakana(t))}_tinySDF(t,s,l){const u=this.localIdeographFontFamily;if(!u||!this._doesCharSupportLocalGlyph(l))return;let m=t.tinySDF;if(!m){let b="400";/bold/i.test(s)?b="900":/medium/i.test(s)?b="500":/light/i.test(s)&&(b="200"),m=t.tinySDF=new ht.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:u,fontWeight:b})}const v=m.draw(String.fromCharCode(l));return{id:l,bitmap:new d.o({width:v.width||60,height:v.height||60},v.data),metrics:{width:v.glyphWidth/2||24,height:v.glyphHeight/2||24,left:v.glyphLeft/2+.5||0,top:v.glyphTop/2-27.5||-8,advance:v.glyphAdvance/2||24,isDoubleResolution:!0}}}}ht.loadGlyphRange=function(p,t,s,l){return d._(this,void 0,void 0,function*(){const u=256*t,m=u+255,v=l.transformRequest(s.replace("{fontstack}",p).replace("{range}",`${u}-${m}`),"Glyphs"),b=yield d.l(v,new AbortController);if(!b||!b.data)throw new Error(`Could not load glyph range. range: ${t}, ${u}-${m}`);const M={};for(const I of d.n(b.data))M[I.id]=I;return M})},ht.TinySDF=class{constructor({fontSize:p=24,buffer:t=3,radius:s=8,cutoff:l=.25,fontFamily:u="sans-serif",fontWeight:m="normal",fontStyle:v="normal"}={}){this.buffer=t,this.cutoff=l,this.radius=s;const b=this.size=p+4*t,M=this._createCanvas(b),I=this.ctx=M.getContext("2d",{willReadFrequently:!0});I.font=`${v} ${m} ${p}px ${u}`,I.textBaseline="alphabetic",I.textAlign="left",I.fillStyle="black",this.gridOuter=new Float64Array(b*b),this.gridInner=new Float64Array(b*b),this.f=new Float64Array(b),this.z=new Float64Array(b+1),this.v=new Uint16Array(b)}_createCanvas(p){const t=document.createElement("canvas");return t.width=t.height=p,t}draw(p){const{width:t,actualBoundingBoxAscent:s,actualBoundingBoxDescent:l,actualBoundingBoxLeft:u,actualBoundingBoxRight:m}=this.ctx.measureText(p),v=Math.ceil(s),b=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(m-u))),M=Math.min(this.size-this.buffer,v+Math.ceil(l)),I=b+2*this.buffer,z=M+2*this.buffer,D=Math.max(I*z,0),O=new Uint8ClampedArray(D),V={data:O,width:I,height:z,glyphWidth:b,glyphHeight:M,glyphTop:v,glyphLeft:0,glyphAdvance:t};if(b===0||M===0)return V;const{ctx:G,buffer:Q,gridInner:Z,gridOuter:ie}=this;G.clearRect(Q,Q,b,M),G.fillText(p,Q,Q+v);const pe=G.getImageData(Q,Q,b,M);ie.fill(Et,0,D),Z.fill(0,0,D);for(let J=0;J<M;J++)for(let ge=0;ge<b;ge++){const Se=pe.data[4*(J*b+ge)+3]/255;if(Se===0)continue;const Te=(J+Q)*I+ge+Q;if(Se===1)ie[Te]=0,Z[Te]=Et;else{const Le=.5-Se;ie[Te]=Le>0?Le*Le:0,Z[Te]=Le<0?Le*Le:0}}or(ie,0,0,I,z,I,this.f,this.v,this.z),or(Z,Q,Q,b,M,I,this.f,this.v,this.z);for(let J=0;J<D;J++){const ge=Math.sqrt(ie[J])-Math.sqrt(Z[J]);O[J]=Math.round(255-255*(ge/this.radius+this.cutoff))}return V}};class Ye{constructor(){this.specification=d.v.light.position}possiblyEvaluate(t,s){return d.y(t.expression.evaluate(s))}interpolate(t,s,l){return{x:d.z.number(t.x,s.x,l),y:d.z.number(t.y,s.y,l),z:d.z.number(t.z,s.z,l)}}}let Fe;class dt extends d.E{constructor(t){super(),Fe=Fe||new d.q({anchor:new d.D(d.v.light.anchor),position:new Ye,color:new d.D(d.v.light.color),intensity:new d.D(d.v.light.intensity)}),this._transitionable=new d.T(Fe),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,s={}){if(!this._validate(d.r,t,s))for(const l in t){const u=t[l];l.endsWith("-transition")?this._transitionable.setTransition(l.slice(0,-11),u):this._transitionable.setValue(l,u)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,s,l){return(!l||l.validate!==!1)&&d.t(this,t.call(d.x,{value:s,style:{glyphs:!0,sprite:!0},styleSpec:d.v}))}}class St{constructor(t,s){this.width=t,this.height=s,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,s){const l=t.join(",")+String(s);return this.dashEntry[l]||(this.dashEntry[l]=this.addDash(t,s)),this.dashEntry[l]}getDashRanges(t,s,l){const u=[];let m=t.length%2==1?-t[t.length-1]*l:0,v=t[0]*l,b=!0;u.push({left:m,right:v,isDash:b,zeroLength:t[0]===0});let M=t[0];for(let I=1;I<t.length;I++){b=!b;const z=t[I];m=M*l,M+=z,v=M*l,u.push({left:m,right:v,isDash:b,zeroLength:z===0})}return u}addRoundDash(t,s,l){const u=s/2;for(let m=-l;m<=l;m++){const v=this.width*(this.nextRow+l+m);let b=0,M=t[b];for(let I=0;I<this.width;I++){I/M.right>1&&(M=t[++b]);const z=Math.abs(I-M.left),D=Math.abs(I-M.right),O=Math.min(z,D);let V;const G=m/l*(u+1);if(M.isDash){const Q=u-Math.abs(G);V=Math.sqrt(O*O+Q*Q)}else V=u-Math.sqrt(O*O+G*G);this.data[v+I]=Math.max(0,Math.min(255,V+128))}}}addRegularDash(t){for(let b=t.length-1;b>=0;--b){const M=t[b],I=t[b+1];M.zeroLength?t.splice(b,1):I&&I.isDash===M.isDash&&(I.left=M.left,t.splice(b,1))}const s=t[0],l=t[t.length-1];s.isDash===l.isDash&&(s.left=l.left-this.width,l.right=s.right+this.width);const u=this.width*this.nextRow;let m=0,v=t[m];for(let b=0;b<this.width;b++){b/v.right>1&&(v=t[++m]);const M=Math.abs(b-v.left),I=Math.abs(b-v.right),z=Math.min(M,I);this.data[u+b]=Math.max(0,Math.min(255,(v.isDash?z:-z)+128))}}addDash(t,s){const l=s?7:0,u=2*l+1;if(this.nextRow+u>this.height)return d.w("LineAtlas out of space"),null;let m=0;for(let b=0;b<t.length;b++)m+=t[b];if(m!==0){const b=this.width/m,M=this.getDashRanges(t,this.width,b);s?this.addRoundDash(M,b,l):this.addRegularDash(M)}const v={y:(this.nextRow+l+.5)/this.height,height:2*l/this.height,width:m};return this.nextRow+=u,this.dirty=!0,v}bind(t){const s=t.gl;this.texture?(s.bindTexture(s.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,s.texSubImage2D(s.TEXTURE_2D,0,0,0,this.width,this.height,s.ALPHA,s.UNSIGNED_BYTE,this.data))):(this.texture=s.createTexture(),s.bindTexture(s.TEXTURE_2D,this.texture),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texImage2D(s.TEXTURE_2D,0,s.ALPHA,this.width,this.height,0,s.ALPHA,s.UNSIGNED_BYTE,this.data))}}const Ze="maplibre_preloaded_worker_pool";class Ot{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<Ot.workerCount;)this.workers.push(new Worker(d.a.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach(s=>{s.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Ze]}numActive(){return Object.keys(this.active).length}}const Yt=Math.floor(le.hardwareConcurrency/2);let Ht,nr;function Qt(){return Ht||(Ht=new Ot),Ht}Ot.workerCount=d.B(globalThis)?Math.max(Math.min(Yt,3),1):1;class Ir{constructor(t,s){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=s;const l=this.workerPool.acquire(s);for(let u=0;u<l.length;u++){const m=new d.C(l[u],s);m.name=`Worker ${u}`,this.actors.push(m)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,s){const l=[];for(const u of this.actors)l.push(u.sendAsync({type:t,data:s}));return Promise.all(l)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach(s=>{s.remove()}),this.actors=[],t&&this.workerPool.release(this.id)}registerMessageHandler(t,s){for(const l of this.actors)l.registerMessageHandler(t,s)}}function Lt(){return nr||(nr=new Ir(Qt(),d.G),nr.registerMessageHandler("GR",(p,t,s)=>d.m(t,s))),nr}function lr(p,t){const s=d.F();return d.H(s,s,[1,1,0]),d.J(s,s,[.5*p.width,.5*p.height,1]),d.K(s,s,p.calculatePosMatrix(t.toUnwrapped()))}function Er(p,t,s,l,u,m){const v=function(D,O,V){if(D)for(const G of D){const Q=O[G];if(Q&&Q.source===V&&Q.type==="fill-extrusion")return!0}else for(const G in O){const Q=O[G];if(Q.source===V&&Q.type==="fill-extrusion")return!0}return!1}(u&&u.layers,t,p.id),b=m.maxPitchScaleFactor(),M=p.tilesIn(l,b,v);M.sort(_r);const I=[];for(const D of M)I.push({wrappedTileID:D.tileID.wrapped().key,queryResults:D.tile.queryRenderedFeatures(t,s,p._state,D.queryGeometry,D.cameraQueryGeometry,D.scale,u,m,b,lr(p.transform,D.tileID))});const z=function(D){const O={},V={};for(const G of D){const Q=G.queryResults,Z=G.wrappedTileID,ie=V[Z]=V[Z]||{};for(const pe in Q){const J=Q[pe],ge=ie[pe]=ie[pe]||{},Se=O[pe]=O[pe]||[];for(const Te of J)ge[Te.featureIndex]||(ge[Te.featureIndex]=!0,Se.push(Te))}}return O}(I);for(const D in z)z[D].forEach(O=>{const V=O.feature,G=p.getFeatureState(V.layer["source-layer"],V.id);V.source=V.layer.source,V.layer["source-layer"]&&(V.sourceLayer=V.layer["source-layer"]),V.state=G});return z}function _r(p,t){const s=p.tileID,l=t.tileID;return s.overscaledZ-l.overscaledZ||s.canonical.y-l.canonical.y||s.wrap-l.wrap||s.canonical.x-l.canonical.x}function dr(p,t,s){return d._(this,void 0,void 0,function*(){let l=p;if(p.url?l=(yield d.h(t.transformRequest(p.url,"Source"),s)).data:yield le.frameAsync(s),!l)return null;const u=d.L(d.e(l,p),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in l&&l.vector_layers&&(u.vectorLayerIds=l.vector_layers.map(m=>m.id)),u})}class sr{constructor(t,s){t&&(s?this.setSouthWest(t).setNorthEast(s):Array.isArray(t)&&(t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof d.M?new d.M(t.lng,t.lat):d.M.convert(t),this}setSouthWest(t){return this._sw=t instanceof d.M?new d.M(t.lng,t.lat):d.M.convert(t),this}extend(t){const s=this._sw,l=this._ne;let u,m;if(t instanceof d.M)u=t,m=t;else{if(!(t instanceof sr))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(sr.convert(t)):this.extend(d.M.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(d.M.convert(t)):this;if(u=t._sw,m=t._ne,!u||!m)return this}return s||l?(s.lng=Math.min(u.lng,s.lng),s.lat=Math.min(u.lat,s.lat),l.lng=Math.max(m.lng,l.lng),l.lat=Math.max(m.lat,l.lat)):(this._sw=new d.M(u.lng,u.lat),this._ne=new d.M(m.lng,m.lat)),this}getCenter(){return new d.M((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new d.M(this.getWest(),this.getNorth())}getSouthEast(){return new d.M(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:s,lat:l}=d.M.convert(t);let u=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(u=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&u}static convert(t){return t instanceof sr?t:t&&new sr(t)}static fromLngLat(t,s=0){const l=360*s/40075017,u=l/Math.cos(Math.PI/180*t.lat);return new sr(new d.M(t.lng-u,t.lat-l),new d.M(t.lng+u,t.lat+l))}}class zr{constructor(t,s,l){this.bounds=sr.convert(this.validateBounds(t)),this.minzoom=s||0,this.maxzoom=l||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const s=Math.pow(2,t.z),l=Math.floor(d.N(this.bounds.getWest())*s),u=Math.floor(d.O(this.bounds.getNorth())*s),m=Math.ceil(d.N(this.bounds.getEast())*s),v=Math.ceil(d.O(this.bounds.getSouth())*s);return t.x>=l&&t.x<m&&t.y>=u&&t.y<v}}class Ce extends d.E{constructor(t,s,l,u){if(super(),this.id=t,this.dispatcher=l,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,d.e(this,d.L(s,["url","scheme","tileSize","promoteId"])),this._options=d.e({type:"vector"},s),this._collectResourceTiming=s.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(u)}load(){return d._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new d.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const t=yield dr(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),t&&(d.e(this,t),t.bounds&&(this.tileBounds=new zr(t.bounds,this.minzoom,this.maxzoom)),this.fire(new d.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.k("data",{dataType:"source",sourceDataType:"content"})))}catch(t){this._tileJSONRequest=null,this.fire(new d.j(t))}})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.abort(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return d.e({},this._options)}loadTile(t){return d._(this,void 0,void 0,function*(){const s=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l={request:this.map._requestManager.transformRequest(s,"Tile"),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};l.request.collectResourceTiming=this._collectResourceTiming;let u="RT";if(t.actor&&t.state!=="expired"){if(t.state==="loading")return new Promise((m,v)=>{t.reloadPromise={resolve:m,reject:v}})}else t.actor=this.dispatcher.getActor(),u="LT";t.abortController=new AbortController;try{const m=yield t.actor.sendAsync({type:u,data:l},t.abortController);if(delete t.abortController,t.aborted)return;this._afterTileLoadWorkerResponse(t,m)}catch(m){if(delete t.abortController,t.aborted)return;if(m&&m.status!==404)throw m;this._afterTileLoadWorkerResponse(t,null)}})}_afterTileLoadWorkerResponse(t,s){if(s&&s.resourceTiming&&(t.resourceTiming=s.resourceTiming),s&&this.map._refreshExpiredTiles&&t.setExpiryData(s),t.loadVectorData(s,this.map.painter),t.reloadPromise){const l=t.reloadPromise;t.reloadPromise=null,this.loadTile(t).then(l.resolve).catch(l.reject)}}abortTile(t){return d._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.actor&&(yield t.actor.sendAsync({type:"AT",data:{uid:t.uid,type:this.type,source:this.id}}))})}unloadTile(t){return d._(this,void 0,void 0,function*(){t.unloadVectorData(),t.actor&&(yield t.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class ai extends d.E{constructor(t,s,l,u){super(),this.id=t,this.dispatcher=l,this.setEventedParent(u),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=d.e({type:"raster"},s),d.e(this,d.L(s,["url","scheme","tileSize"]))}load(){return d._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new d.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const t=yield dr(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,t&&(d.e(this,t),t.bounds&&(this.tileBounds=new zr(t.bounds,this.minzoom,this.maxzoom)),this.fire(new d.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.k("data",{dataType:"source",sourceDataType:"content"})))}catch(t){this._tileJSONRequest=null,this.fire(new d.j(t))}})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(t){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}serialize(){return d.e({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t){return d._(this,void 0,void 0,function*(){const s=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.abortController=new AbortController;try{const l=yield _e.getImage(this.map._requestManager.transformRequest(s,"Tile"),t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(l&&l.data){this.map._refreshExpiredTiles&&l.cacheControl&&l.expires&&t.setExpiryData({cacheControl:l.cacheControl,expires:l.expires});const u=this.map.painter.context,m=u.gl,v=l.data;t.texture=this.map.painter.getTileTexture(v.width),t.texture?t.texture.update(v,{useMipmap:!0}):(t.texture=new qe(u,v,m.RGBA,{useMipmap:!0}),t.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE,m.LINEAR_MIPMAP_NEAREST),u.extTextureFilterAnisotropic&&m.texParameterf(m.TEXTURE_2D,u.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,u.extTextureFilterAnisotropicMax)),t.state="loaded"}}catch(l){if(delete t.abortController,t.aborted)t.state="unloaded";else if(l)throw t.state="errored",l}})}abortTile(t){return d._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController)})}unloadTile(t){return d._(this,void 0,void 0,function*(){t.texture&&this.map.painter.saveTileTexture(t.texture)})}hasTransition(){return!1}}class oi extends ai{constructor(t,s,l,u){super(t,s,l,u),this.type="raster-dem",this.maxzoom=22,this._options=d.e({type:"raster-dem"},s),this.encoding=s.encoding||"mapbox",this.redFactor=s.redFactor,this.greenFactor=s.greenFactor,this.blueFactor=s.blueFactor,this.baseShift=s.baseShift}loadTile(t){return d._(this,void 0,void 0,function*(){const s=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l=this.map._requestManager.transformRequest(s,"Tile");t.neighboringTiles=this._getNeighboringTiles(t.tileID),t.abortController=new AbortController;try{const u=yield _e.getImage(l,t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(u&&u.data){const m=u.data;this.map._refreshExpiredTiles&&u.cacheControl&&u.expires&&t.setExpiryData({cacheControl:u.cacheControl,expires:u.expires});const v=d.b(m)&&d.S()?m:yield this.readImageNow(m),b={type:this.type,uid:t.uid,source:this.id,rawImageData:v,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!t.actor||t.state==="expired"){t.actor=this.dispatcher.getActor();const M=yield t.actor.sendAsync({type:"LDT",data:b});t.dem=M,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded"}}}catch(u){if(delete t.abortController,t.aborted)t.state="unloaded";else if(u)throw t.state="errored",u}})}readImageNow(t){return d._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&d.U()){const s=t.width+2,l=t.height+2;try{return new d.R({width:s,height:l},yield d.V(t,-1,-1,s,l))}catch{}}return le.getImageData(t,1)})}_getNeighboringTiles(t){const s=t.canonical,l=Math.pow(2,s.z),u=(s.x-1+l)%l,m=s.x===0?t.wrap-1:t.wrap,v=(s.x+1+l)%l,b=s.x+1===l?t.wrap+1:t.wrap,M={};return M[new d.Q(t.overscaledZ,m,s.z,u,s.y).key]={backfilled:!1},M[new d.Q(t.overscaledZ,b,s.z,v,s.y).key]={backfilled:!1},s.y>0&&(M[new d.Q(t.overscaledZ,m,s.z,u,s.y-1).key]={backfilled:!1},M[new d.Q(t.overscaledZ,t.wrap,s.z,s.x,s.y-1).key]={backfilled:!1},M[new d.Q(t.overscaledZ,b,s.z,v,s.y-1).key]={backfilled:!1}),s.y+1<l&&(M[new d.Q(t.overscaledZ,m,s.z,u,s.y+1).key]={backfilled:!1},M[new d.Q(t.overscaledZ,t.wrap,s.z,s.x,s.y+1).key]={backfilled:!1},M[new d.Q(t.overscaledZ,b,s.z,v,s.y+1).key]={backfilled:!1}),M}unloadTile(t){return d._(this,void 0,void 0,function*(){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&(yield t.actor.sendAsync({type:"RDT",data:{type:this.type,uid:t.uid,source:this.id}}))})}}class er extends d.E{constructor(t,s,l,u){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=l.getActor(),this.setEventedParent(u),this._data=s.data,this._options=d.e({},s),this._collectResourceTiming=s.collectResourceTiming,s.maxzoom!==void 0&&(this.maxzoom=s.maxzoom),s.type&&(this.type=s.type),s.attribution&&(this.attribution=s.attribution),this.promoteId=s.promoteId;const m=d.W/this.tileSize;this.workerOptions=d.e({source:this.id,cluster:s.cluster||!1,geojsonVtOptions:{buffer:(s.buffer!==void 0?s.buffer:128)*m,tolerance:(s.tolerance!==void 0?s.tolerance:.375)*m,extent:d.W,maxZoom:this.maxzoom,lineMetrics:s.lineMetrics||!1,generateId:s.generateId||!1},superclusterOptions:{maxZoom:s.clusterMaxZoom!==void 0?s.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,s.clusterMinPoints||2),extent:d.W,radius:(s.clusterRadius||50)*m,log:!1,generateId:s.generateId||!1},clusterProperties:s.clusterProperties,filter:s.filter},s.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return d._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(t){this.map=t,this.load()}setData(t){return this._data=t,this._updateWorkerData(),this}updateData(t){return this._updateWorkerData(t),this}getData(){return d._(this,void 0,void 0,function*(){const t=d.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:t})})}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t&&(t.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=t.clusterRadius),t.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=t.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(t){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:t,source:this.id}})}getClusterChildren(t){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:t,source:this.id}})}getClusterLeaves(t,s,l){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:t,limit:s,offset:l}})}_updateWorkerData(t){return d._(this,void 0,void 0,function*(){const s=d.e({type:this.type},this.workerOptions);t?s.dataDiff=t:typeof this._data=="string"?(s.request=this.map._requestManager.transformRequest(le.resolveURL(this._data),"Source"),s.request.collectResourceTiming=this._collectResourceTiming):s.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new d.k("dataloading",{dataType:"source"}));try{const l=yield this.actor.sendAsync({type:"LD",data:s});if(this._pendingLoads--,this._removed||l.abandoned)return void this.fire(new d.k("dataabort",{dataType:"source"}));let u=null;l.resourceTiming&&l.resourceTiming[this.id]&&(u=l.resourceTiming[this.id].slice(0));const m={dataType:"source"};this._collectResourceTiming&&u&&u.length>0&&d.e(m,{resourceTiming:u}),this.fire(new d.k("data",Object.assign(Object.assign({},m),{sourceDataType:"metadata"}))),this.fire(new d.k("data",Object.assign(Object.assign({},m),{sourceDataType:"content"})))}catch(l){if(this._pendingLoads--,this._removed)return void this.fire(new d.k("dataabort",{dataType:"source"}));this.fire(new d.j(l))}})}loaded(){return this._pendingLoads===0}loadTile(t){return d._(this,void 0,void 0,function*(){const s=t.actor?"RT":"LT";t.actor=this.actor;const l={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};t.abortController=new AbortController;const u=yield this.actor.sendAsync({type:s,data:l},t.abortController);delete t.abortController,t.unloadVectorData(),t.aborted||t.loadVectorData(u,this.map.painter,s==="RT")})}abortTile(t){return d._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.aborted=!0})}unloadTile(t){return d._(this,void 0,void 0,function*(){t.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return d.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var fr=d.X([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Qr extends d.E{constructor(t,s,l,u){super(),this.id=t,this.dispatcher=l,this.coordinates=s.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(u),this.options=s}load(t){return d._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new d.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const s=yield _e.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,s&&s.data&&(this.image=s.data,t&&(this.coordinates=t),this._finishLoading())}catch(s){this._request=null,this._loaded=!0,this.fire(new d.j(s))}})}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=t.url,this.load(t.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new d.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(t){this.coordinates=t;const s=t.map(d.Y.fromLngLat);this.tileID=function(u){let m=1/0,v=1/0,b=-1/0,M=-1/0;for(const O of u)m=Math.min(m,O.x),v=Math.min(v,O.y),b=Math.max(b,O.x),M=Math.max(M,O.y);const I=Math.max(b-m,M-v),z=Math.max(0,Math.floor(-Math.log(I)/Math.LN2)),D=Math.pow(2,z);return new d.a0(z,Math.floor((m+b)/2*D),Math.floor((v+M)/2*D))}(s),this.minzoom=this.maxzoom=this.tileID.z;const l=s.map(u=>this.tileID.getTilePoint(u)._round());return this._boundsArray=new d.Z,this._boundsArray.emplaceBack(l[0].x,l[0].y,0,0),this._boundsArray.emplaceBack(l[1].x,l[1].y,d.W,0),this._boundsArray.emplaceBack(l[3].x,l[3].y,0,d.W),this._boundsArray.emplaceBack(l[2].x,l[2].y,d.W,d.W),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new d.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,s=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,fr.members)),this.boundsSegments||(this.boundsSegments=d.$.simpleSegment(0,0,4,2)),this.texture||(this.texture=new qe(t,this.image,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));let l=!1;for(const u in this.tiles){const m=this.tiles[u];m.state!=="loaded"&&(m.state="loaded",m.texture=this.texture,l=!0)}l&&this.fire(new d.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(t){return d._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={}):t.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Tr extends Qr{constructor(t,s,l,u){super(t,s,l,u),this.roundZoom=!0,this.type="video",this.options=s}load(){return d._(this,void 0,void 0,function*(){this._loaded=!1;const t=this.options;this.urls=[];for(const s of t.urls)this.urls.push(this.map._requestManager.transformRequest(s,"Source").url);try{const s=yield d.a2(this.urls);if(this._loaded=!0,!s)return;this.video=s,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(s){this.fire(new d.j(s))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const s=this.video.seekable;t<s.start(0)||t>s.end(0)?this.fire(new d.j(new d.a1(`sources.${this.id}`,null,`Playback for this video can be set only between the ${s.start(0)} and ${s.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const t=this.map.painter.context,s=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,fr.members)),this.boundsSegments||(this.boundsSegments=d.$.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.video)):(this.texture=new qe(t,this.video,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));let l=!1;for(const u in this.tiles){const m=this.tiles[u];m.state!=="loaded"&&(m.state="loaded",m.texture=this.texture,l=!0)}l&&this.fire(new d.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Rr extends Qr{constructor(t,s,l,u){super(t,s,l,u),s.coordinates?Array.isArray(s.coordinates)&&s.coordinates.length===4&&!s.coordinates.some(m=>!Array.isArray(m)||m.length!==2||m.some(v=>typeof v!="number"))||this.fire(new d.j(new d.a1(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new d.j(new d.a1(`sources.${t}`,null,'missing required property "coordinates"'))),s.animate&&typeof s.animate!="boolean"&&this.fire(new d.j(new d.a1(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),s.canvas?typeof s.canvas=="string"||s.canvas instanceof HTMLCanvasElement||this.fire(new d.j(new d.a1(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new d.j(new d.a1(`sources.${t}`,null,'missing required property "canvas"'))),this.options=s,this.animate=s.animate===void 0||s.animate}load(){return d._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new d.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const s=this.map.painter.context,l=s.gl;this.boundsBuffer||(this.boundsBuffer=s.createVertexBuffer(this._boundsArray,fr.members)),this.boundsSegments||(this.boundsSegments=d.$.simpleSegment(0,0,4,2)),this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new qe(s,this.canvas,l.RGBA,{premultiply:!0});let u=!1;for(const m in this.tiles){const v=this.tiles[m];v.state!=="loaded"&&(v.state="loaded",v.texture=this.texture,u=!0)}u&&this.fire(new d.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const Hi={},cr=p=>{switch(p){case"geojson":return er;case"image":return Qr;case"raster":return ai;case"raster-dem":return oi;case"vector":return Ce;case"video":return Tr;case"canvas":return Rr}return Hi[p]},nn="RTLPluginLoaded";class Wi extends d.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Lt()}_syncState(t){return this.status=t,this.dispatcher.broadcast("SRPS",{pluginStatus:t,pluginURL:this.url}).catch(s=>{throw this.status="error",s})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(t){return d._(this,arguments,void 0,function*(s,l=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=le.resolveURL(s),!this.url)throw new Error(`requested url ${s} is invalid`);if(this.status==="unavailable"){if(!l)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return d._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new d.k(nn))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Je=null;function Kr(){return Je||(Je=new Wi),Je}class Jr{constructor(t,s){this.timeAdded=0,this.fadeEndTime=0,this.tileID=t,this.uid=d.a3(),this.uses=0,this.tileSize=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(t){const s=t+this.timeAdded;s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,s,l){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(u,m){const v={};if(!m)return v;for(const b of u){const M=b.layerIds.map(I=>m.getLayer(I)).filter(Boolean);if(M.length!==0){b.layers=M,b.stateDependentLayerIds&&(b.stateDependentLayers=b.stateDependentLayerIds.map(I=>M.filter(z=>z.id===I)[0]));for(const I of M)v[I.id]=b}}return v}(t.buckets,s.style),this.hasSymbolBuckets=!1;for(const u in this.buckets){const m=this.buckets[u];if(m instanceof d.a5){if(this.hasSymbolBuckets=!0,!l)break;m.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const u in this.buckets){const m=this.buckets[u];if(m instanceof d.a5&&m.hasRTLText){this.hasRTLText=!0,Kr().lazyLoad();break}}this.queryPadding=0;for(const u in this.buckets){const m=this.buckets[u];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(u).queryRadius(m))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new d.a4}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const l in this.buckets){const u=this.buckets[l];u.uploadPending()&&u.upload(t)}const s=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new qe(t,this.imageAtlas.image,s.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new qe(t,this.glyphAtlasImage,s.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,s,l,u,m,v,b,M,I,z){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:u,cameraQueryGeometry:m,scale:v,tileSize:this.tileSize,pixelPosMatrix:z,transform:M,params:b,queryPadding:this.queryPadding*I},t,s,l):{}}querySourceFeatures(t,s){const l=this.latestFeatureIndex;if(!l||!l.rawTileData)return;const u=l.loadVTLayers(),m=s&&s.sourceLayer?s.sourceLayer:"",v=u._geojsonTileLayer||u[m];if(!v)return;const b=d.a6(s&&s.filter),{z:M,x:I,y:z}=this.tileID.canonical,D={z:M,x:I,y:z};for(let O=0;O<v.length;O++){const V=v.feature(O);if(b.needGeometry){const Z=d.a7(V,!0);if(!b.filter(new d.a8(this.tileID.overscaledZ),Z,this.tileID.canonical))continue}else if(!b.filter(new d.a8(this.tileID.overscaledZ),V))continue;const G=l.getId(V,m),Q=new d.a9(V,M,I,z,G);Q.tile=D,t.push(Q)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const s=this.expirationTime;if(t.cacheControl){const l=d.aa(t.cacheControl);l["max-age"]&&(this.expirationTime=Date.now()+1e3*l["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const l=Date.now();let u=!1;if(this.expirationTime>l)u=!1;else if(s)if(this.expirationTime<s)u=!0;else{const m=this.expirationTime-s;m?this.expirationTime=l+Math.max(m,3e4):u=!0}else u=!0;u?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,s){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const l=this.latestFeatureIndex.loadVTLayers();for(const u in this.buckets){if(!s.style.hasLayer(u))continue;const m=this.buckets[u],v=m.layers[0].sourceLayer||"_geojsonTileLayer",b=l[v],M=t[v];if(!b||!M||Object.keys(M).length===0)continue;m.update(M,b,this.imageAtlas&&this.imageAtlas.patternPositions||{});const I=s&&s.style&&s.style.getLayer(u);I&&(this.queryPadding=Math.max(this.queryPadding,I.queryRadius(m)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<le.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=le.now()+t}setDependencies(t,s){const l={};for(const u of s)l[u]=!0;this.dependencies[t]=l}hasDependency(t,s){for(const l of t){const u=this.dependencies[l];if(u){for(const m of s)if(u[m])return!0}}return!1}}class Xi{constructor(t,s){this.max=t,this.onRemove=s,this.reset()}reset(){for(const t in this.data)for(const s of this.data[t])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(t,s,l){const u=t.wrapped().key;this.data[u]===void 0&&(this.data[u]=[]);const m={value:s,timeout:void 0};if(l!==void 0&&(m.timeout=setTimeout(()=>{this.remove(t,m)},l)),this.data[u].push(m),this.order.push(u),this.order.length>this.max){const v=this._getAndRemoveByKey(this.order[0]);v&&this.onRemove(v)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const s=this.data[t].shift();return s.timeout&&clearTimeout(s.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),s.value}getByKey(t){const s=this.data[t];return s?s[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,s){if(!this.has(t))return this;const l=t.wrapped().key,u=s===void 0?0:this.data[l].indexOf(s),m=this.data[l][u];return this.data[l].splice(u,1),m.timeout&&clearTimeout(m.timeout),this.data[l].length===0&&delete this.data[l],this.onRemove(m.value),this.order.splice(this.order.indexOf(l),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(t){const s=[];for(const l in this.data)for(const u of this.data[l])t(u.value)||s.push(u);for(const l of s)this.remove(l.value.tileID,l)}}class li{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,s,l){const u=String(s);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][u]=this.stateChanges[t][u]||{},d.e(this.stateChanges[t][u],l),this.deletedStates[t]===null){this.deletedStates[t]={};for(const m in this.state[t])m!==u&&(this.deletedStates[t][m]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][u]===null){this.deletedStates[t][u]={};for(const m in this.state[t][u])l[m]||(this.deletedStates[t][u][m]=null)}else for(const m in l)this.deletedStates[t]&&this.deletedStates[t][u]&&this.deletedStates[t][u][m]===null&&delete this.deletedStates[t][u][m]}removeFeatureState(t,s,l){if(this.deletedStates[t]===null)return;const u=String(s);if(this.deletedStates[t]=this.deletedStates[t]||{},l&&s!==void 0)this.deletedStates[t][u]!==null&&(this.deletedStates[t][u]=this.deletedStates[t][u]||{},this.deletedStates[t][u][l]=null);else if(s!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][u])for(l in this.deletedStates[t][u]={},this.stateChanges[t][u])this.deletedStates[t][u][l]=null;else this.deletedStates[t][u]=null;else this.deletedStates[t]=null}getState(t,s){const l=String(s),u=d.e({},(this.state[t]||{})[l],(this.stateChanges[t]||{})[l]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const m=this.deletedStates[t][s];if(m===null)return{};for(const v in m)delete u[v]}return u}initializeTileState(t,s){t.setFeatureState(this.state,s)}coalesceChanges(t,s){const l={};for(const u in this.stateChanges){this.state[u]=this.state[u]||{};const m={};for(const v in this.stateChanges[u])this.state[u][v]||(this.state[u][v]={}),d.e(this.state[u][v],this.stateChanges[u][v]),m[v]=this.state[u][v];l[u]=m}for(const u in this.deletedStates){this.state[u]=this.state[u]||{};const m={};if(this.deletedStates[u]===null)for(const v in this.state[u])m[v]={},this.state[u][v]={};else for(const v in this.deletedStates[u]){if(this.deletedStates[u][v]===null)this.state[u][v]={};else for(const b of Object.keys(this.deletedStates[u][v]))delete this.state[u][v][b];m[v]=this.state[u][v]}l[u]=l[u]||{},d.e(l[u],m)}if(this.stateChanges={},this.deletedStates={},Object.keys(l).length!==0)for(const u in t)t[u].setFeatureState(l,s)}}class Xe extends d.E{constructor(t,s,l){super(),this.id=t,this.dispatcher=l,this.on("data",u=>this._dataHandler(u)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((u,m,v,b)=>{const M=new(cr(m.type))(u,m,v,b);if(M.id!==u)throw new Error(`Expected Source id to be ${u} instead of ${M.id}`);return M})(t,s,l,this),this._tiles={},this._cache=new Xi(0,u=>this._unloadTile(u)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new li,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t in this._tiles){const s=this._tiles[t];if(s.state!=="loaded"&&s.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,s,l){return d._(this,void 0,void 0,function*(){try{yield this._source.loadTile(t),this._tileLoaded(t,s,l)}catch(u){t.state="errored",u.status!==404?this._source.fire(new d.j(u,{tile:t})):this.update(this.transform,this.terrain)}})}_unloadTile(t){this._source.unloadTile&&this._source.unloadTile(t)}_abortTile(t){this._source.abortTile&&this._source.abortTile(t),this._source.fire(new d.k("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const s in this._tiles){const l=this._tiles[s];l.upload(t),l.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(Rt).map(t=>t.key)}getRenderableIds(t){const s=[];for(const l in this._tiles)this._isIdRenderable(l,t)&&s.push(this._tiles[l]);return t?s.sort((l,u)=>{const m=l.tileID,v=u.tileID,b=new d.P(m.canonical.x,m.canonical.y)._rotate(this.transform.angle),M=new d.P(v.canonical.x,v.canonical.y)._rotate(this.transform.angle);return m.overscaledZ-v.overscaledZ||M.y-b.y||M.x-b.x}).map(l=>l.tileID.key):s.map(l=>l.tileID).sort(Rt).map(l=>l.key)}hasRenderableParent(t){const s=this.findLoadedParent(t,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(t,s){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(s||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(t,"reloading")}}_reloadTile(t,s){return d._(this,void 0,void 0,function*(){const l=this._tiles[t];l&&(l.state!=="loading"&&(l.state=s),yield this._loadTile(l,t,s))})}_tileLoaded(t,s,l){t.timeAdded=le.now(),l==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(s,t),this.getSource().type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new d.k("data",{dataType:"source",tile:t,coord:t.tileID}))}_backfillDEM(t){const s=this.getRenderableIds();for(let u=0;u<s.length;u++){const m=s[u];if(t.neighboringTiles&&t.neighboringTiles[m]){const v=this.getTileByID(m);l(t,v),l(v,t)}}function l(u,m){u.needsHillshadePrepare=!0,u.needsTerrainPrepare=!0;let v=m.tileID.canonical.x-u.tileID.canonical.x;const b=m.tileID.canonical.y-u.tileID.canonical.y,M=Math.pow(2,u.tileID.canonical.z),I=m.tileID.key;v===0&&b===0||Math.abs(b)>1||(Math.abs(v)>1&&(Math.abs(v+M)===1?v+=M:Math.abs(v-M)===1&&(v-=M)),m.dem&&u.dem&&(u.dem.backfillBorder(m.dem,v,b),u.neighboringTiles&&u.neighboringTiles[I]&&(u.neighboringTiles[I].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,s,l,u){for(const m in this._tiles){let v=this._tiles[m];if(u[m]||!v.hasData()||v.tileID.overscaledZ<=s||v.tileID.overscaledZ>l)continue;let b=v.tileID;for(;v&&v.tileID.overscaledZ>s+1;){const I=v.tileID.scaledTo(v.tileID.overscaledZ-1);v=this._tiles[I.key],v&&v.hasData()&&(b=I)}let M=b;for(;M.overscaledZ>s;)if(M=M.scaledTo(M.overscaledZ-1),t[M.key]){u[b.key]=b;break}}}findLoadedParent(t,s){if(t.key in this._loadedParentTiles){const l=this._loadedParentTiles[t.key];return l&&l.tileID.overscaledZ>=s?l:null}for(let l=t.overscaledZ-1;l>=s;l--){const u=t.scaledTo(l),m=this._getLoadedTile(u);if(m)return m}}findLoadedSibling(t){return this._getLoadedTile(t)}_getLoadedTile(t){const s=this._tiles[t.key];return s&&s.hasData()?s:this._cache.getByKey(t.wrapped().key)}updateCacheSize(t){const s=Math.ceil(t.width/this._source.tileSize)+1,l=Math.ceil(t.height/this._source.tileSize)+1,u=Math.floor(s*l*(this._maxTileCacheZoomLevels===null?d.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),m=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,u):u;this._cache.setMaxSize(m)}handleWrapJump(t){const s=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,s){const l={};for(const u in this._tiles){const m=this._tiles[u];m.tileID=m.tileID.unwrapTo(m.tileID.wrap+s),l[m.tileID.key]=m}this._tiles=l;for(const u in this._timers)clearTimeout(this._timers[u]),delete this._timers[u];for(const u in this._tiles)this._setTileReloadTimer(u,this._tiles[u])}}_updateCoveredAndRetainedTiles(t,s,l,u,m,v){const b={},M={},I=Object.keys(t),z=le.now();for(const D of I){const O=t[D],V=this._tiles[D];if(!V||V.fadeEndTime!==0&&V.fadeEndTime<=z)continue;const G=this.findLoadedParent(O,s),Q=this.findLoadedSibling(O),Z=G||Q||null;Z&&(this._addTile(Z.tileID),b[Z.tileID.key]=Z.tileID),M[D]=O}this._retainLoadedChildren(M,u,l,t);for(const D in b)t[D]||(this._coveredTiles[D]=!0,t[D]=b[D]);if(v){const D={},O={};for(const V of m)this._tiles[V.key].hasData()?D[V.key]=V:O[V.key]=V;for(const V in O){const G=O[V].children(this._source.maxzoom);this._tiles[G[0].key]&&this._tiles[G[1].key]&&this._tiles[G[2].key]&&this._tiles[G[3].key]&&(D[G[0].key]=t[G[0].key]=G[0],D[G[1].key]=t[G[1].key]=G[1],D[G[2].key]=t[G[2].key]=G[2],D[G[3].key]=t[G[3].key]=G[3],delete O[V])}for(const V in O){const G=O[V],Q=this.findLoadedParent(G,this._source.minzoom),Z=this.findLoadedSibling(G),ie=Q||Z||null;if(ie){D[ie.tileID.key]=t[ie.tileID.key]=ie.tileID;for(const pe in D)D[pe].isChildOf(ie.tileID)&&delete D[pe]}}for(const V in this._tiles)D[V]||(this._coveredTiles[V]=!0)}}update(t,s){if(!this._sourceLoaded||this._paused)return;let l;this.transform=t,this.terrain=s,this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?l=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(z=>new d.Q(z.canonical.z,z.wrap,z.canonical.z,z.canonical.x,z.canonical.y)):(l=t.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:s}),this._source.hasTile&&(l=l.filter(z=>this._source.hasTile(z)))):l=[];const u=t.coveringZoomLevel(this._source),m=Math.max(u-Xe.maxOverzooming,this._source.minzoom),v=Math.max(u+Xe.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const z={};for(const D of l)if(D.canonical.z>this._source.minzoom){const O=D.scaledTo(D.canonical.z-1);z[O.key]=O;const V=D.scaledTo(Math.max(this._source.minzoom,Math.min(D.canonical.z,5)));z[V.key]=V}l=l.concat(Object.values(z))}const b=l.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,b&&this.fire(new d.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const M=this._updateRetainedTiles(l,u);Nt(this._source.type)&&this._updateCoveredAndRetainedTiles(M,m,v,u,l,s);for(const z in M)this._tiles[z].clearFadeHold();const I=d.ab(this._tiles,M);for(const z of I){const D=this._tiles[z];D.hasSymbolBuckets&&!D.holdingForFade()?D.setHoldDuration(this.map._fadeDuration):D.hasSymbolBuckets&&!D.symbolFadeFinished()||this._removeTile(z)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)}_updateRetainedTiles(t,s){var l;const u={},m={},v=Math.max(s-Xe.maxOverzooming,this._source.minzoom),b=Math.max(s+Xe.maxUnderzooming,this._source.minzoom),M={};for(const I of t){const z=this._addTile(I);u[I.key]=I,z.hasData()||s<this._source.maxzoom&&(M[I.key]=I)}this._retainLoadedChildren(M,s,b,u);for(const I of t){let z=this._tiles[I.key];if(z.hasData())continue;if(s+1>this._source.maxzoom){const O=I.children(this._source.maxzoom)[0],V=this.getTile(O);if(V&&V.hasData()){u[O.key]=O;continue}}else{const O=I.children(this._source.maxzoom);if(u[O[0].key]&&u[O[1].key]&&u[O[2].key]&&u[O[3].key])continue}let D=z.wasRequested();for(let O=I.overscaledZ-1;O>=v;--O){const V=I.scaledTo(O);if(m[V.key])break;if(m[V.key]=!0,z=this.getTile(V),!z&&D&&(z=this._addTile(V)),z){const G=z.hasData();if((G||!(!((l=this.map)===null||l===void 0)&&l.cancelPendingTileRequestsWhileZooming)||D)&&(u[V.key]=V),D=z.wasRequested(),G)break}}}return u}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const s=[];let l,u=this._tiles[t].tileID;for(;u.overscaledZ>0;){if(u.key in this._loadedParentTiles){l=this._loadedParentTiles[u.key];break}s.push(u.key);const m=u.scaledTo(u.overscaledZ-1);if(l=this._getLoadedTile(m),l)break;u=m}for(const m of s)this._loadedParentTiles[m]=l}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const t in this._tiles){const s=this._tiles[t].tileID,l=this._getLoadedTile(s);this._loadedSiblingTiles[s.key]=l}}_addTile(t){let s=this._tiles[t.key];if(s)return s;s=this._cache.getAndRemove(t),s&&(this._setTileReloadTimer(t.key,s),s.tileID=t,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,s)));const l=s;return s||(s=new Jr(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(s,t.key,s.state)),s.uses++,this._tiles[t.key]=s,l||this._source.fire(new d.k("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s}_setTileReloadTimer(t,s){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const l=s.getExpiryTimeout();l&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},l))}_removeTile(t){const s=this._tiles[t];s&&(s.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),s.uses>0||(s.hasData()&&s.state!=="reloading"?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}_dataHandler(t){const s=t.sourceDataType;t.dataType==="source"&&s==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&t.dataType==="source"&&s==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(t);this._cache.reset()}tilesIn(t,s,l){const u=[],m=this.transform;if(!m)return u;const v=l?m.getCameraQueryGeometry(t):t,b=t.map(G=>m.pointCoordinate(G,this.terrain)),M=v.map(G=>m.pointCoordinate(G,this.terrain)),I=this.getIds();let z=1/0,D=1/0,O=-1/0,V=-1/0;for(const G of M)z=Math.min(z,G.x),D=Math.min(D,G.y),O=Math.max(O,G.x),V=Math.max(V,G.y);for(let G=0;G<I.length;G++){const Q=this._tiles[I[G]];if(Q.holdingForFade())continue;const Z=Q.tileID,ie=Math.pow(2,m.zoom-Q.tileID.overscaledZ),pe=s*Q.queryPadding*d.W/Q.tileSize/ie,J=[Z.getTilePoint(new d.Y(z,D)),Z.getTilePoint(new d.Y(O,V))];if(J[0].x-pe<d.W&&J[0].y-pe<d.W&&J[1].x+pe>=0&&J[1].y+pe>=0){const ge=b.map(Te=>Z.getTilePoint(Te)),Se=M.map(Te=>Z.getTilePoint(Te));u.push({tile:Q,tileID:Z,queryGeometry:ge,cameraQueryGeometry:Se,scale:ie})}}return u}getVisibleCoordinates(t){const s=this.getRenderableIds(t).map(l=>this._tiles[l].tileID);for(const l of s)l.posMatrix=this.transform.calculatePosMatrix(l.toUnwrapped());return s}hasTransition(){if(this._source.hasTransition())return!0;if(Nt(this._source.type)){const t=le.now();for(const s in this._tiles)if(this._tiles[s].fadeEndTime>=t)return!0}return!1}setFeatureState(t,s,l){this._state.updateState(t=t||"_geojsonTileLayer",s,l)}removeFeatureState(t,s,l){this._state.removeFeatureState(t=t||"_geojsonTileLayer",s,l)}getFeatureState(t,s){return this._state.getState(t=t||"_geojsonTileLayer",s)}setDependencies(t,s,l){const u=this._tiles[t];u&&u.setDependencies(s,l)}reloadTilesForDependencies(t,s){for(const l in this._tiles)this._tiles[l].hasDependency(t,s)&&this._reloadTile(l,"reloading");this._cache.filter(l=>!l.hasDependency(t,s))}}function Rt(p,t){const s=Math.abs(2*p.wrap)-+(p.wrap<0),l=Math.abs(2*t.wrap)-+(t.wrap<0);return p.overscaledZ-t.overscaledZ||l-s||t.canonical.y-p.canonical.y||t.canonical.x-p.canonical.x}function Nt(p){return p==="raster"||p==="image"||p==="video"}Xe.maxOverzooming=10,Xe.maxUnderzooming=3;class mi{constructor(t,s){this.reset(t,s)}reset(t,s){this.points=t||[],this._distances=[0];for(let l=1;l<this.points.length;l++)this._distances[l]=this._distances[l-1]+this.points[l].dist(this.points[l-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(s||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=d.ac(t,0,1);let s=1,l=this._distances[s];const u=t*this.paddedLength+this.padding;for(;l<u&&s<this._distances.length;)l=this._distances[++s];const m=s-1,v=this._distances[m],b=l-v,M=b>0?(u-v)/b:0;return this.points[m].mult(1-M).add(this.points[s].mult(M))}}function Bi(p,t){let s=!0;return p==="always"||p!=="never"&&t!=="never"||(s=!1),s}class Ut{constructor(t,s,l){const u=this.boxCells=[],m=this.circleCells=[];this.xCellCount=Math.ceil(t/l),this.yCellCount=Math.ceil(s/l);for(let v=0;v<this.xCellCount*this.yCellCount;v++)u.push([]),m.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=s,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/s,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,s,l,u,m){this._forEachCell(s,l,u,m,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(s),this.bboxes.push(l),this.bboxes.push(u),this.bboxes.push(m)}insertCircle(t,s,l,u){this._forEachCell(s-u,l-u,s+u,l+u,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(s),this.circles.push(l),this.circles.push(u)}_insertBoxCell(t,s,l,u,m,v){this.boxCells[m].push(v)}_insertCircleCell(t,s,l,u,m,v){this.circleCells[m].push(v)}_query(t,s,l,u,m,v,b){if(l<0||t>this.width||u<0||s>this.height)return[];const M=[];if(t<=0&&s<=0&&this.width<=l&&this.height<=u){if(m)return[{key:null,x1:t,y1:s,x2:l,y2:u}];for(let I=0;I<this.boxKeys.length;I++)M.push({key:this.boxKeys[I],x1:this.bboxes[4*I],y1:this.bboxes[4*I+1],x2:this.bboxes[4*I+2],y2:this.bboxes[4*I+3]});for(let I=0;I<this.circleKeys.length;I++){const z=this.circles[3*I],D=this.circles[3*I+1],O=this.circles[3*I+2];M.push({key:this.circleKeys[I],x1:z-O,y1:D-O,x2:z+O,y2:D+O})}}else this._forEachCell(t,s,l,u,this._queryCell,M,{hitTest:m,overlapMode:v,seenUids:{box:{},circle:{}}},b);return M}query(t,s,l,u){return this._query(t,s,l,u,!1,null)}hitTest(t,s,l,u,m,v){return this._query(t,s,l,u,!0,m,v).length>0}hitTestCircle(t,s,l,u,m){const v=t-l,b=t+l,M=s-l,I=s+l;if(b<0||v>this.width||I<0||M>this.height)return!1;const z=[];return this._forEachCell(v,M,b,I,this._queryCellCircle,z,{hitTest:!0,overlapMode:u,circle:{x:t,y:s,radius:l},seenUids:{box:{},circle:{}}},m),z.length>0}_queryCell(t,s,l,u,m,v,b,M){const{seenUids:I,hitTest:z,overlapMode:D}=b,O=this.boxCells[m];if(O!==null){const G=this.bboxes;for(const Q of O)if(!I.box[Q]){I.box[Q]=!0;const Z=4*Q,ie=this.boxKeys[Q];if(t<=G[Z+2]&&s<=G[Z+3]&&l>=G[Z+0]&&u>=G[Z+1]&&(!M||M(ie))&&(!z||!Bi(D,ie.overlapMode))&&(v.push({key:ie,x1:G[Z],y1:G[Z+1],x2:G[Z+2],y2:G[Z+3]}),z))return!0}}const V=this.circleCells[m];if(V!==null){const G=this.circles;for(const Q of V)if(!I.circle[Q]){I.circle[Q]=!0;const Z=3*Q,ie=this.circleKeys[Q];if(this._circleAndRectCollide(G[Z],G[Z+1],G[Z+2],t,s,l,u)&&(!M||M(ie))&&(!z||!Bi(D,ie.overlapMode))){const pe=G[Z],J=G[Z+1],ge=G[Z+2];if(v.push({key:ie,x1:pe-ge,y1:J-ge,x2:pe+ge,y2:J+ge}),z)return!0}}}return!1}_queryCellCircle(t,s,l,u,m,v,b,M){const{circle:I,seenUids:z,overlapMode:D}=b,O=this.boxCells[m];if(O!==null){const G=this.bboxes;for(const Q of O)if(!z.box[Q]){z.box[Q]=!0;const Z=4*Q,ie=this.boxKeys[Q];if(this._circleAndRectCollide(I.x,I.y,I.radius,G[Z+0],G[Z+1],G[Z+2],G[Z+3])&&(!M||M(ie))&&!Bi(D,ie.overlapMode))return v.push(!0),!0}}const V=this.circleCells[m];if(V!==null){const G=this.circles;for(const Q of V)if(!z.circle[Q]){z.circle[Q]=!0;const Z=3*Q,ie=this.circleKeys[Q];if(this._circlesCollide(G[Z],G[Z+1],G[Z+2],I.x,I.y,I.radius)&&(!M||M(ie))&&!Bi(D,ie.overlapMode))return v.push(!0),!0}}}_forEachCell(t,s,l,u,m,v,b,M){const I=this._convertToXCellCoord(t),z=this._convertToYCellCoord(s),D=this._convertToXCellCoord(l),O=this._convertToYCellCoord(u);for(let V=I;V<=D;V++)for(let G=z;G<=O;G++)if(m.call(this,t,s,l,u,this.xCellCount*G+V,v,b,M))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,s,l,u,m,v){const b=u-t,M=m-s,I=l+v;return I*I>b*b+M*M}_circleAndRectCollide(t,s,l,u,m,v,b){const M=(v-u)/2,I=Math.abs(t-(u+M));if(I>M+l)return!1;const z=(b-m)/2,D=Math.abs(s-(m+z));if(D>z+l)return!1;if(I<=M||D<=z)return!0;const O=I-M,V=D-z;return O*O+V*V<=l*l}}function ss(p,t,s,l,u){const m=d.F();return t?(d.J(m,m,[1/u,1/u,1]),s||d.ad(m,m,l.angle)):d.K(m,l.labelPlaneMatrix,p),m}function as(p,t,s,l,u){if(t){const m=d.ae(p);return d.J(m,m,[u,u,1]),s||d.ad(m,m,-l.angle),m}return l.glCoordMatrix}function Si(p,t,s){let l;s?(l=[p.x,p.y,s(p.x,p.y),1],d.af(l,l,t)):(l=[p.x,p.y,0,1],function(m,v,b){const M=v[0],I=v[1];m[0]=b[0]*M+b[4]*I+b[12],m[1]=b[1]*M+b[5]*I+b[13],m[3]=b[3]*M+b[7]*I+b[15]}(l,l,t));const u=l[3];return{point:new d.P(l[0]/u,l[1]/u),signedDistanceFromCamera:u,isOccluded:!1}}function X(p,t){return .5+p/t*.5}function R(p,t){return p.x>=-t[0]&&p.x<=t[0]&&p.y>=-t[1]&&p.y<=t[1]}function B(p,t,s,l,u,m,v,b,M,I,z,D,O,V,G){const Q=l?p.textSizeData:p.iconSizeData,Z=d.ag(Q,s.transform.zoom),ie=[256/s.width*2+1,256/s.height*2+1],pe=l?p.text.dynamicLayoutVertexArray:p.icon.dynamicLayoutVertexArray;pe.clear();const J=p.lineVertexArray,ge=l?p.text.placedSymbolArray:p.icon.placedSymbolArray,Se=s.transform.width/s.transform.height;let Te=!1;for(let Le=0;Le<ge.length;Le++){const Ue=ge.get(Le);if(Ue.hidden||Ue.writingMode===d.ah.vertical&&!Te){Dt(Ue.numGlyphs,pe);continue}Te=!1;const st=Si(new d.P(Ue.anchorX,Ue.anchorY),t,G);if(!R(st.point,ie)){Dt(Ue.numGlyphs,pe);continue}const pt=X(s.transform.cameraToCenterDistance,st.signedDistanceFromCamera),Ke=d.ai(Q,Z,Ue),tt=v?Ke/pt:Ke*pt,vt={getElevation:G,labelPlaneMatrix:u,lineVertexArray:J,pitchWithMap:v,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:I,tileAnchorPoint:new d.P(Ue.anchorX,Ue.anchorY),unwrappedTileID:z,width:D,height:O,translation:V},jt=ce(vt,Ue,tt,!1,b,t,m,p.glyphOffsetArray,pe,Se,M);Te=jt.useVertical,(jt.notEnoughRoom||Te||jt.needsFlipping&&ce(vt,Ue,tt,!0,b,t,m,p.glyphOffsetArray,pe,Se,M).notEnoughRoom)&&Dt(Ue.numGlyphs,pe)}l?p.text.dynamicLayoutVertexBuffer.updateData(pe):p.icon.dynamicLayoutVertexBuffer.updateData(pe)}function j(p,t,s,l,u,m,v,b){const M=m.glyphStartIndex+m.numGlyphs,I=m.lineStartIndex,z=m.lineStartIndex+m.lineLength,D=t.getoffsetX(m.glyphStartIndex),O=t.getoffsetX(M-1),V=Re(p*D,s,l,u,m.segment,I,z,b,v);if(!V)return null;const G=Re(p*O,s,l,u,m.segment,I,z,b,v);return G?b.projectionCache.anyProjectionOccluded?null:{first:V,last:G}:null}function Y(p,t,s,l){return p===d.ah.horizontal&&Math.abs(s.y-t.y)>Math.abs(s.x-t.x)*l?{useVertical:!0}:(p===d.ah.vertical?t.y<s.y:t.x>s.x)?{needsFlipping:!0}:null}function ce(p,t,s,l,u,m,v,b,M,I,z){const D=s/24,O=t.lineOffsetX*D,V=t.lineOffsetY*D;let G;if(t.numGlyphs>1){const Q=t.glyphStartIndex+t.numGlyphs,Z=t.lineStartIndex,ie=t.lineStartIndex+t.lineLength,pe=j(D,b,O,V,l,t,z,p);if(!pe)return{notEnoughRoom:!0};const J=Si(pe.first.point,v,p.getElevation).point,ge=Si(pe.last.point,v,p.getElevation).point;if(u&&!l){const Se=Y(t.writingMode,J,ge,I);if(Se)return Se}G=[pe.first];for(let Se=t.glyphStartIndex+1;Se<Q-1;Se++)G.push(Re(D*b.getoffsetX(Se),O,V,l,t.segment,Z,ie,p,z));G.push(pe.last)}else{if(u&&!l){const Z=Si(p.tileAnchorPoint,m,p.getElevation).point,ie=t.lineStartIndex+t.segment+1,pe=new d.P(p.lineVertexArray.getx(ie),p.lineVertexArray.gety(ie)),J=Si(pe,m,p.getElevation),ge=J.signedDistanceFromCamera>0?J.point:function(Te,Le,Ue,st,pt,Ke){return fe(Te,Le,Ue,1,pt,Ke)}(p.tileAnchorPoint,pe,Z,0,m,p),Se=Y(t.writingMode,Z,ge,I);if(Se)return Se}const Q=Re(D*b.getoffsetX(t.glyphStartIndex),O,V,l,t.segment,t.lineStartIndex,t.lineStartIndex+t.lineLength,p,z);if(!Q||p.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};G=[Q]}for(const Q of G)d.aj(M,Q.point,Q.angle);return{}}function fe(p,t,s,l,u,m){const v=p.add(p.sub(t)._unit()),b=u!==void 0?Si(v,u,m.getElevation).point:se(v.x,v.y,m).point,M=s.sub(b);return s.add(M._mult(l/M.mag()))}function xe(p,t,s){const l=t.projectionCache;if(l.projections[p])return l.projections[p];const u=new d.P(t.lineVertexArray.getx(p),t.lineVertexArray.gety(p)),m=se(u.x,u.y,t);if(m.signedDistanceFromCamera>0)return l.projections[p]=m.point,l.anyProjectionOccluded=l.anyProjectionOccluded||m.isOccluded,m.point;const v=p-s.direction;return function(b,M,I,z,D){return fe(b,M,I,z,void 0,D)}(s.distanceFromAnchor===0?t.tileAnchorPoint:new d.P(t.lineVertexArray.getx(v),t.lineVertexArray.gety(v)),u,s.previousVertex,s.absOffsetX-s.distanceFromAnchor+1,t)}function se(p,t,s){const l=p+s.translation[0],u=t+s.translation[1];let m;return!s.pitchWithMap&&s.projection.useSpecialProjectionForSymbols?(m=s.projection.projectTileCoordinates(l,u,s.unwrappedTileID,s.getElevation),m.point.x=(.5*m.point.x+.5)*s.width,m.point.y=(.5*-m.point.y+.5)*s.height):(m=Si(new d.P(l,u),s.labelPlaneMatrix,s.getElevation),m.isOccluded=!1),m}function Me(p,t,s){return p._unit()._perp()._mult(t*s)}function Ne(p,t,s,l,u,m,v,b,M){if(b.projectionCache.offsets[p])return b.projectionCache.offsets[p];const I=s.add(t);if(p+M.direction<l||p+M.direction>=u)return b.projectionCache.offsets[p]=I,I;const z=xe(p+M.direction,b,M),D=Me(z.sub(s),v,M.direction),O=s.add(D),V=z.add(D);return b.projectionCache.offsets[p]=d.ak(m,I,O,V)||I,b.projectionCache.offsets[p]}function Re(p,t,s,l,u,m,v,b,M){const I=l?p-t:p+t;let z=I>0?1:-1,D=0;l&&(z*=-1,D=Math.PI),z<0&&(D+=Math.PI);let O,V=z>0?m+u:m+u+1;b.projectionCache.cachedAnchorPoint?O=b.projectionCache.cachedAnchorPoint:(O=se(b.tileAnchorPoint.x,b.tileAnchorPoint.y,b).point,b.projectionCache.cachedAnchorPoint=O);let G,Q,Z=O,ie=O,pe=0,J=0;const ge=Math.abs(I),Se=[];let Te;for(;pe+J<=ge;){if(V+=z,V<m||V>=v)return null;pe+=J,ie=Z,Q=G;const st={absOffsetX:ge,direction:z,distanceFromAnchor:pe,previousVertex:ie};if(Z=xe(V,b,st),s===0)Se.push(ie),Te=Z.sub(ie);else{let pt;const Ke=Z.sub(ie);pt=Ke.mag()===0?Me(xe(V+z,b,st).sub(Z),s,z):Me(Ke,s,z),Q||(Q=ie.add(pt)),G=Ne(V,pt,Z,m,v,Q,s,b,st),Se.push(Q),Te=G.sub(Q)}J=Te.mag()}const Le=Te._mult((ge-pe)/J)._add(Q||ie),Ue=D+Math.atan2(Z.y-ie.y,Z.x-ie.x);return Se.push(Le),{point:Le,angle:M?Ue:0,path:Se}}const ze=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Dt(p,t){for(let s=0;s<p;s++){const l=t.length;t.resize(l+4),t.float32.set(ze,3*l)}}const Pt=100;class Xt{constructor(t,s,l=new Ut(t.width+200,t.height+200,25),u=new Ut(t.width+200,t.height+200,25)){this.transform=t,this.mapProjection=s,this.grid=l,this.ignoredGrid=u,this.pitchFactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+Pt,this.screenBottomBoundary=t.height+Pt,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,s,l,u,m,v,b,M,I,z,D){const O=t.anchorPointX+M[0],V=t.anchorPointY+M[1],G=this.projectAndGetPerspectiveRatio(u,O,V,m,z),Q=this._projectCollisionBox(t,l,u,m,v,b,M,G,z,D),[Z,ie,pe,J]=Q.box;return this.mapProjection.useSpecialProjectionForSymbols&&(v?Q.allPointsOccluded:this.mapProjection.isOccluded(O,V,m))||G.perspectiveRatio<this.perspectiveRatioCutoff||!this.isInsideGrid(Z,ie,pe,J)||s!=="always"&&this.grid.hitTest(Z,ie,pe,J,s,I)?{box:[Z,ie,pe,J],placeable:!1,offscreen:!1}:{box:[Z,ie,pe,J],placeable:!0,offscreen:this.isOffscreen(Z,ie,pe,J)}}placeCollisionCircles(t,s,l,u,m,v,b,M,I,z,D,O,V,G,Q,Z){const ie=[],pe=new d.P(s.anchorX,s.anchorY),J=this.getPerspectiveRatio(v,pe.x,pe.y,b,Z),ge=(D?m/J:m*J)/d.ap,Se={getElevation:Z,labelPlaneMatrix:M,lineVertexArray:l,pitchWithMap:D,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:this.mapProjection,tileAnchorPoint:pe,unwrappedTileID:b,width:this.transform.width,height:this.transform.height,translation:Q},Te=j(ge,u,s.lineOffsetX*ge,s.lineOffsetY*ge,!1,s,!1,Se);let Le=!1,Ue=!1,st=!0;if(Te){const pt=.5*V*J+G,Ke=new d.P(-100,-100),tt=new d.P(this.screenRightBoundary,this.screenBottomBoundary),vt=new mi,jt=Te.first,nt=Te.last;let lt=[];for(let Gt=jt.path.length-1;Gt>=1;Gt--)lt.push(jt.path[Gt]);for(let Gt=1;Gt<nt.path.length;Gt++)lt.push(nt.path[Gt]);const Bt=2.5*pt;if(I){const Gt=this.projectPathToScreenSpace(lt,Se,I);lt=Gt.some(ar=>ar.signedDistanceFromCamera<=0)?[]:Gt.map(ar=>ar.point)}let jr=[];if(lt.length>0){const Gt=lt[0].clone(),ar=lt[0].clone();for(let Vr=1;Vr<lt.length;Vr++)Gt.x=Math.min(Gt.x,lt[Vr].x),Gt.y=Math.min(Gt.y,lt[Vr].y),ar.x=Math.max(ar.x,lt[Vr].x),ar.y=Math.max(ar.y,lt[Vr].y);jr=Gt.x>=Ke.x&&ar.x<=tt.x&&Gt.y>=Ke.y&&ar.y<=tt.y?[lt]:ar.x<Ke.x||Gt.x>tt.x||ar.y<Ke.y||Gt.y>tt.y?[]:d.al([lt],Ke.x,Ke.y,tt.x,tt.y)}for(const Gt of jr){vt.reset(Gt,.25*pt);let ar=0;ar=vt.length<=.5*pt?1:Math.ceil(vt.paddedLength/Bt)+1;for(let Vr=0;Vr<ar;Vr++){const ji=Vr/Math.max(ar-1,1),Bn=vt.lerp(ji),Ur=Bn.x+Pt,Ji=Bn.y+Pt;ie.push(Ur,Ji,pt,0);const Yi=Ur-pt,Vi=Ji-pt,Ui=Ur+pt,On=Ji+pt;if(st=st&&this.isOffscreen(Yi,Vi,Ui,On),Ue=Ue||this.isInsideGrid(Yi,Vi,Ui,On),t!=="always"&&this.grid.hitTestCircle(Ur,Ji,pt,t,O)&&(Le=!0,!z))return{circles:[],offscreen:!1,collisionDetected:Le}}}}return{circles:!z&&Le||!Ue||J<this.perspectiveRatioCutoff?[]:ie,offscreen:st,collisionDetected:Le}}projectPathToScreenSpace(t,s,l){return t.map(u=>Si(u,l,s.getElevation))}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const s=[];let l=1/0,u=1/0,m=-1/0,v=-1/0;for(const z of t){const D=new d.P(z.x+Pt,z.y+Pt);l=Math.min(l,D.x),u=Math.min(u,D.y),m=Math.max(m,D.x),v=Math.max(v,D.y),s.push(D)}const b=this.grid.query(l,u,m,v).concat(this.ignoredGrid.query(l,u,m,v)),M={},I={};for(const z of b){const D=z.key;if(M[D.bucketInstanceId]===void 0&&(M[D.bucketInstanceId]={}),M[D.bucketInstanceId][D.featureIndex])continue;const O=[new d.P(z.x1,z.y1),new d.P(z.x2,z.y1),new d.P(z.x2,z.y2),new d.P(z.x1,z.y2)];d.am(s,O)&&(M[D.bucketInstanceId][D.featureIndex]=!0,I[D.bucketInstanceId]===void 0&&(I[D.bucketInstanceId]=[]),I[D.bucketInstanceId].push(D.featureIndex))}return I}insertCollisionBox(t,s,l,u,m,v){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:u,featureIndex:m,collisionGroupID:v,overlapMode:s},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,s,l,u,m,v){const b=l?this.ignoredGrid:this.grid,M={bucketInstanceId:u,featureIndex:m,collisionGroupID:v,overlapMode:s};for(let I=0;I<t.length;I+=4)b.insertCircle(M,t[I],t[I+1],t[I+2])}projectAndGetPerspectiveRatio(t,s,l,u,m){const v=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(s,l,u,m):Si(new d.P(s,l),t,m);return{point:new d.P((v.point.x+1)/2*this.transform.width+Pt,(1-v.point.y)/2*this.transform.height+Pt),perspectiveRatio:.5+this.transform.cameraToCenterDistance/v.signedDistanceFromCamera*.5,isOccluded:v.isOccluded,signedDistanceFromCamera:v.signedDistanceFromCamera}}getPerspectiveRatio(t,s,l,u,m){const v=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(s,l,u,m):Si(new d.P(s,l),t,m);return .5+this.transform.cameraToCenterDistance/v.signedDistanceFromCamera*.5}isOffscreen(t,s,l,u){return l<Pt||t>=this.screenRightBoundary||u<Pt||s>this.screenBottomBoundary}isInsideGrid(t,s,l,u){return l>=0&&t<this.gridRightBoundary&&u>=0&&s<this.gridBottomBoundary}getViewportMatrix(){const t=d.an([]);return d.H(t,t,[-100,-100,0]),t}_projectCollisionBox(t,s,l,u,m,v,b,M,I,z){const D=s*M.perspectiveRatio;let O=new d.P(1,0),V=new d.P(0,1);const G=new d.P(t.anchorPointX+b[0],t.anchorPointY+b[1]);if(v&&!m){const pt=this.projectAndGetPerspectiveRatio(l,G.x+1,G.y,u,I).point.sub(M.point).unit(),Ke=Math.atan(pt.y/pt.x)+(pt.x<0?Math.PI:0),tt=Math.sin(Ke),vt=Math.cos(Ke);O=new d.P(vt,tt),V=new d.P(-tt,vt)}else if(!v&&m){const pt=-this.transform.angle,Ke=Math.sin(pt),tt=Math.cos(pt);O=new d.P(tt,Ke),V=new d.P(-Ke,tt)}let Q=M.point,Z=D;if(m){Q=G;const pt=this.transform.zoom-Math.floor(this.transform.zoom);Z=Math.pow(2,-pt),Z*=this.mapProjection.getPitchedTextCorrection(this.transform,G,u),z||(Z*=d.ac(.5+M.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))}z&&(Q=Q.add(O.mult(z.x*Z)).add(V.mult(z.y*Z)));const ie=t.x1*Z,pe=t.x2*Z,J=(ie+pe)/2,ge=t.y1*Z,Se=t.y2*Z,Te=(ge+Se)/2,Le=[{offsetX:ie,offsetY:ge},{offsetX:J,offsetY:ge},{offsetX:pe,offsetY:ge},{offsetX:pe,offsetY:Te},{offsetX:pe,offsetY:Se},{offsetX:J,offsetY:Se},{offsetX:ie,offsetY:Se},{offsetX:ie,offsetY:Te}];let Ue=[];for(const{offsetX:pt,offsetY:Ke}of Le)Ue.push(new d.P(Q.x+O.x*pt+V.x*Ke,Q.y+O.y*pt+V.y*Ke));let st=!1;if(m){const pt=Ue.map(Ke=>this.projectAndGetPerspectiveRatio(l,Ke.x,Ke.y,u,I));st=pt.some(Ke=>!Ke.isOccluded),Ue=pt.map(Ke=>Ke.point)}else st=!0;return{box:d.ao(Ue),allPointsOccluded:!st}}}function $t(p,t,s){return t*(d.W/(p.tileSize*Math.pow(2,s-p.tileID.overscaledZ)))}class ur{constructor(t,s,l,u){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?s:-s))):u&&l?1:0,this.placed=l}isHidden(){return this.opacity===0&&!this.placed}}class Ar{constructor(t,s,l,u,m){this.text=new ur(t?t.text:null,s,l,m),this.icon=new ur(t?t.icon:null,s,u,m)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class $r{constructor(t,s,l){this.text=t,this.icon=s,this.skipFade=l}}class ci{constructor(){this.invProjMatrix=d.F(),this.viewportMatrix=d.F(),this.circles=[]}}class qt{constructor(t,s,l,u,m){this.bucketInstanceId=t,this.featureIndex=s,this.sourceLayerIndex=l,this.bucketIndex=u,this.tileID=m}}class Yr{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const s=++this.maxGroupID;this.collisionGroups[t]={ID:s,predicate:l=>l.collisionGroupID===s}}return this.collisionGroups[t]}}function ui(p,t,s,l,u){const{horizontalAlign:m,verticalAlign:v}=d.au(p);return new d.P(-(m-.5)*t+l[0]*u,-(v-.5)*s+l[1]*u)}class sn{constructor(t,s,l,u,m,v){this.transform=t.clone(),this.terrain=l,this.collisionIndex=new Xt(this.transform,s),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new Yr(m),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=v,v&&(v.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(t){const s=this.terrain;return s?(l,u)=>s.getElevation(t,l,u):null}getBucketParts(t,s,l,u){const m=l.getBucket(s),v=l.latestFeatureIndex;if(!m||!v||s.id!==m.layerIds[0])return;const b=l.collisionBoxArray,M=m.layers[0].layout,I=m.layers[0].paint,z=Math.pow(2,this.transform.zoom-l.tileID.overscaledZ),D=l.tileSize/d.W,O=l.tileID.toUnwrapped(),V=this.transform.calculatePosMatrix(O),G=M.get("text-pitch-alignment")==="map",Q=M.get("text-rotation-alignment")==="map",Z=$t(l,1,this.transform.zoom),ie=this.collisionIndex.mapProjection.translatePosition(this.transform,l,I.get("text-translate"),I.get("text-translate-anchor")),pe=this.collisionIndex.mapProjection.translatePosition(this.transform,l,I.get("icon-translate"),I.get("icon-translate-anchor")),J=ss(V,G,Q,this.transform,Z);let ge=null;if(G){const Te=as(V,G,Q,this.transform,Z);ge=d.K([],this.transform.labelPlaneMatrix,Te)}this.retainedQueryData[m.bucketInstanceId]=new qt(m.bucketInstanceId,v,m.sourceLayerIndex,m.index,l.tileID);const Se={bucket:m,layout:M,translationText:ie,translationIcon:pe,posMatrix:V,unwrappedTileID:O,textLabelPlaneMatrix:J,labelToScreenMatrix:ge,scale:z,textPixelRatio:D,holdingForFade:l.holdingForFade(),collisionBoxArray:b,partiallyEvaluatedTextSize:d.ag(m.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(m.sourceID)};if(u)for(const Te of m.sortKeyRanges){const{sortKey:Le,symbolInstanceStart:Ue,symbolInstanceEnd:st}=Te;t.push({sortKey:Le,symbolInstanceStart:Ue,symbolInstanceEnd:st,parameters:Se})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:m.symbolInstances.length,parameters:Se})}attemptAnchorPlacement(t,s,l,u,m,v,b,M,I,z,D,O,V,G,Q,Z,ie,pe,J){const ge=d.aq[t.textAnchor],Se=[t.textOffset0,t.textOffset1],Te=ui(ge,l,u,Se,m),Le=this.collisionIndex.placeCollisionBox(s,O,M,I,z,b,v,Z,D.predicate,J,Te);if((!pe||this.collisionIndex.placeCollisionBox(pe,O,M,I,z,b,v,ie,D.predicate,J,Te).placeable)&&Le.placeable){let Ue;if(this.prevPlacement&&this.prevPlacement.variableOffsets[V.crossTileID]&&this.prevPlacement.placements[V.crossTileID]&&this.prevPlacement.placements[V.crossTileID].text&&(Ue=this.prevPlacement.variableOffsets[V.crossTileID].anchor),V.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[V.crossTileID]={textOffset:Se,width:l,height:u,anchor:ge,textBoxScale:m,prevAnchor:Ue},this.markUsedJustification(G,ge,V,Q),G.allowVerticalPlacement&&(this.markUsedOrientation(G,Q,V),this.placedOrientations[V.crossTileID]=Q),{shift:Te,placedGlyphBoxes:Le}}}placeLayerBucketPart(t,s,l){const{bucket:u,layout:m,translationText:v,translationIcon:b,posMatrix:M,unwrappedTileID:I,textLabelPlaneMatrix:z,labelToScreenMatrix:D,textPixelRatio:O,holdingForFade:V,collisionBoxArray:G,partiallyEvaluatedTextSize:Q,collisionGroup:Z}=t.parameters,ie=m.get("text-optional"),pe=m.get("icon-optional"),J=d.ar(m,"text-overlap","text-allow-overlap"),ge=J==="always",Se=d.ar(m,"icon-overlap","icon-allow-overlap"),Te=Se==="always",Le=m.get("text-rotation-alignment")==="map",Ue=m.get("text-pitch-alignment")==="map",st=m.get("icon-text-fit")!=="none",pt=m.get("symbol-z-order")==="viewport-y",Ke=ge&&(Te||!u.hasIconData()||pe),tt=Te&&(ge||!u.hasTextData()||ie);!u.collisionArrays&&G&&u.deserializeCollisionBoxes(G);const vt=this._getTerrainElevationFunc(this.retainedQueryData[u.bucketInstanceId].tileID),jt=(nt,lt,Bt)=>{var jr,Gt;if(s[nt.crossTileID])return;if(V)return void(this.placements[nt.crossTileID]=new $r(!1,!1,!1));let ar=!1,Vr=!1,ji=!0,Bn=null,Ur={box:null,placeable:!1,offscreen:null},Ji={box:null,placeable:!1,offscreen:null},Yi=null,Vi=null,Ui=null,On=0,ia=0,_l=0;lt.textFeatureIndex?On=lt.textFeatureIndex:nt.useRuntimeCollisionCircles&&(On=nt.featureIndex),lt.verticalTextFeatureIndex&&(ia=lt.verticalTextFeatureIndex);const Bs=lt.textBox;if(Bs){const Ai=Di=>{let qi=d.ah.horizontal;if(u.allowVerticalPlacement&&!Di&&this.prevPlacement){const _i=this.prevPlacement.placedOrientations[nt.crossTileID];_i&&(this.placedOrientations[nt.crossTileID]=_i,qi=_i,this.markUsedOrientation(u,qi,nt))}return qi},Pn=(Di,qi)=>{if(u.allowVerticalPlacement&&nt.numVerticalGlyphVertices>0&&lt.verticalTextBox){for(const _i of u.writingModes)if(_i===d.ah.vertical?(Ur=qi(),Ji=Ur):Ur=Di(),Ur&&Ur.placeable)break}else Ur=Di()},ps=nt.textAnchorOffsetStartIndex,na=nt.textAnchorOffsetEndIndex;if(na===ps){const Di=(qi,_i)=>{const Sr=this.collisionIndex.placeCollisionBox(qi,J,O,M,I,Ue,Le,v,Z.predicate,vt);return Sr&&Sr.placeable&&(this.markUsedOrientation(u,_i,nt),this.placedOrientations[nt.crossTileID]=_i),Sr};Pn(()=>Di(Bs,d.ah.horizontal),()=>{const qi=lt.verticalTextBox;return u.allowVerticalPlacement&&nt.numVerticalGlyphVertices>0&&qi?Di(qi,d.ah.vertical):{box:null,offscreen:null}}),Ai(Ur&&Ur.placeable)}else{let Di=d.aq[(Gt=(jr=this.prevPlacement)===null||jr===void 0?void 0:jr.variableOffsets[nt.crossTileID])===null||Gt===void 0?void 0:Gt.anchor];const qi=(Sr,Hr,Pc)=>{const yi=Sr.x2-Sr.x1,Ac=Sr.y2-Sr.y1,wo=nt.textBoxScale,sa=st&&Se==="never"?Hr:null;let fs=null,Cu=J==="never"?1:2,vl="never";Di&&Cu++;for(let Dc=0;Dc<Cu;Dc++){for(let xl=ps;xl<na;xl++){const bl=u.textAnchorOffsets.get(xl);if(Di&&bl.textAnchor!==Di)continue;const Ua=this.attemptAnchorPlacement(bl,Sr,yi,Ac,wo,Le,Ue,O,M,I,Z,vl,nt,u,Pc,v,b,sa,vt);if(Ua&&(fs=Ua.placedGlyphBoxes,fs&&fs.placeable))return ar=!0,Bn=Ua.shift,fs}Di?Di=null:vl=J}return l&&!fs&&(fs={box:this.collisionIndex.placeCollisionBox(Bs,"always",O,M,I,Ue,Le,v,Z.predicate,vt,new d.P(0,0)).box,offscreen:!1,placeable:!1}),fs};Pn(()=>qi(Bs,lt.iconBox,d.ah.horizontal),()=>{const Sr=lt.verticalTextBox;return u.allowVerticalPlacement&&(!Ur||!Ur.placeable)&&nt.numVerticalGlyphVertices>0&&Sr?qi(Sr,lt.verticalIconBox,d.ah.vertical):{box:null,occluded:!0,offscreen:null}}),Ur&&(ar=Ur.placeable,ji=Ur.offscreen);const _i=Ai(Ur&&Ur.placeable);if(!ar&&this.prevPlacement){const Sr=this.prevPlacement.variableOffsets[nt.crossTileID];Sr&&(this.variableOffsets[nt.crossTileID]=Sr,this.markUsedJustification(u,Sr.anchor,nt,_i))}}}if(Yi=Ur,ar=Yi&&Yi.placeable,ji=Yi&&Yi.offscreen,nt.useRuntimeCollisionCircles){const Ai=u.text.placedSymbolArray.get(nt.centerJustifiedTextSymbolIndex),Pn=d.ai(u.textSizeData,Q,Ai),ps=m.get("text-padding");Vi=this.collisionIndex.placeCollisionCircles(J,Ai,u.lineVertexArray,u.glyphOffsetArray,Pn,M,I,z,D,l,Ue,Z.predicate,nt.collisionCircleDiameter,ps,v,vt),Vi.circles.length&&Vi.collisionDetected&&!l&&d.w("Collisions detected, but collision boxes are not shown"),ar=ge||Vi.circles.length>0&&!Vi.collisionDetected,ji=ji&&Vi.offscreen}if(lt.iconFeatureIndex&&(_l=lt.iconFeatureIndex),lt.iconBox){const Ai=Pn=>this.collisionIndex.placeCollisionBox(Pn,Se,O,M,I,Ue,Le,b,Z.predicate,vt,st&&Bn?Bn:void 0);Ji&&Ji.placeable&&lt.verticalIconBox?(Ui=Ai(lt.verticalIconBox),Vr=Ui.placeable):(Ui=Ai(lt.iconBox),Vr=Ui.placeable),ji=ji&&Ui.offscreen}const Os=ie||nt.numHorizontalGlyphVertices===0&&nt.numVerticalGlyphVertices===0,yl=pe||nt.numIconVertices===0;Os||yl?yl?Os||(Vr=Vr&&ar):ar=Vr&&ar:Vr=ar=Vr&&ar;const Ec=Vr&&Ui.placeable;if(ar&&Yi.placeable&&this.collisionIndex.insertCollisionBox(Yi.box,J,m.get("text-ignore-placement"),u.bucketInstanceId,Ji&&Ji.placeable&&ia?ia:On,Z.ID),Ec&&this.collisionIndex.insertCollisionBox(Ui.box,Se,m.get("icon-ignore-placement"),u.bucketInstanceId,_l,Z.ID),Vi&&ar&&this.collisionIndex.insertCollisionCircles(Vi.circles,J,m.get("text-ignore-placement"),u.bucketInstanceId,On,Z.ID),l&&this.storeCollisionData(u.bucketInstanceId,Bt,lt,Yi,Ui,Vi),nt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(u.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[nt.crossTileID]=new $r(ar||Ke,Vr||tt,ji||u.justReloaded),s[nt.crossTileID]=!0};if(pt){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const nt=u.getSortedSymbolIndexes(this.transform.angle);for(let lt=nt.length-1;lt>=0;--lt){const Bt=nt[lt];jt(u.symbolInstances.get(Bt),u.collisionArrays[Bt],Bt)}}else for(let nt=t.symbolInstanceStart;nt<t.symbolInstanceEnd;nt++)jt(u.symbolInstances.get(nt),u.collisionArrays[nt],nt);if(l&&u.bucketInstanceId in this.collisionCircleArrays){const nt=this.collisionCircleArrays[u.bucketInstanceId];d.as(nt.invProjMatrix,M),nt.viewportMatrix=this.collisionIndex.getViewportMatrix()}u.justReloaded=!1}storeCollisionData(t,s,l,u,m,v){if(l.textBox||l.iconBox){let b,M;this.collisionBoxArrays.has(t)?b=this.collisionBoxArrays.get(t):(b=new Map,this.collisionBoxArrays.set(t,b)),b.has(s)?M=b.get(s):(M={text:null,icon:null},b.set(s,M)),l.textBox&&(M.text=u.box),l.iconBox&&(M.icon=m.box)}if(v){let b=this.collisionCircleArrays[t];b===void 0&&(b=this.collisionCircleArrays[t]=new ci);for(let M=0;M<v.circles.length;M+=4)b.circles.push(v.circles[M+0]),b.circles.push(v.circles[M+1]),b.circles.push(v.circles[M+2]),b.circles.push(v.collisionDetected?1:0)}}markUsedJustification(t,s,l,u){let m;m=u===d.ah.vertical?l.verticalPlacedTextSymbolIndex:{left:l.leftJustifiedTextSymbolIndex,center:l.centerJustifiedTextSymbolIndex,right:l.rightJustifiedTextSymbolIndex}[d.at(s)];const v=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex,l.verticalPlacedTextSymbolIndex];for(const b of v)b>=0&&(t.text.placedSymbolArray.get(b).crossTileID=m>=0&&b!==m?0:l.crossTileID)}markUsedOrientation(t,s,l){const u=s===d.ah.horizontal||s===d.ah.horizontalOnly?s:0,m=s===d.ah.vertical?s:0,v=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex];for(const b of v)t.text.placedSymbolArray.get(b).placedOrientation=u;l.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(l.verticalPlacedTextSymbolIndex).placedOrientation=m)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const s=this.prevPlacement;let l=!1;this.prevZoomAdjustment=s?s.zoomAdjustment(this.transform.zoom):0;const u=s?s.symbolFadeChange(t):1,m=s?s.opacities:{},v=s?s.variableOffsets:{},b=s?s.placedOrientations:{};for(const M in this.placements){const I=this.placements[M],z=m[M];z?(this.opacities[M]=new Ar(z,u,I.text,I.icon),l=l||I.text!==z.text.placed||I.icon!==z.icon.placed):(this.opacities[M]=new Ar(null,u,I.text,I.icon,I.skipFade),l=l||I.text||I.icon)}for(const M in m){const I=m[M];if(!this.opacities[M]){const z=new Ar(I,u,!1,!1);z.isHidden()||(this.opacities[M]=z,l=l||I.text.placed||I.icon.placed)}}for(const M in v)this.variableOffsets[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.variableOffsets[M]=v[M]);for(const M in b)this.placedOrientations[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.placedOrientations[M]=b[M]);if(s&&s.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");l?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=s?s.lastPlacementChangeTime:t)}updateLayerOpacities(t,s){const l={};for(const u of s){const m=u.getBucket(t);m&&u.latestFeatureIndex&&t.id===m.layerIds[0]&&this.updateBucketOpacities(m,u.tileID,l,u.collisionBoxArray)}}updateBucketOpacities(t,s,l,u){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const m=t.layers[0],v=m.layout,b=new Ar(null,0,!1,!1,!0),M=v.get("text-allow-overlap"),I=v.get("icon-allow-overlap"),z=m._unevaluatedLayout.hasValue("text-variable-anchor")||m._unevaluatedLayout.hasValue("text-variable-anchor-offset"),D=v.get("text-rotation-alignment")==="map",O=v.get("text-pitch-alignment")==="map",V=v.get("icon-text-fit")!=="none",G=new Ar(null,0,M&&(I||!t.hasIconData()||v.get("icon-optional")),I&&(M||!t.hasTextData()||v.get("text-optional")),!0);!t.collisionArrays&&u&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(u);const Q=(ie,pe,J)=>{for(let ge=0;ge<pe/4;ge++)ie.opacityVertexArray.emplaceBack(J);ie.hasVisibleVertices=ie.hasVisibleVertices||J!==Qa},Z=this.collisionBoxArrays.get(t.bucketInstanceId);for(let ie=0;ie<t.symbolInstances.length;ie++){const pe=t.symbolInstances.get(ie),{numHorizontalGlyphVertices:J,numVerticalGlyphVertices:ge,crossTileID:Se}=pe;let Te=this.opacities[Se];l[Se]?Te=b:Te||(Te=G,this.opacities[Se]=Te),l[Se]=!0;const Le=pe.numIconVertices>0,Ue=this.placedOrientations[pe.crossTileID],st=Ue===d.ah.vertical,pt=Ue===d.ah.horizontal||Ue===d.ah.horizontalOnly;if(J>0||ge>0){const tt=on(Te.text);Q(t.text,J,st?Qa:tt),Q(t.text,ge,pt?Qa:tt);const vt=Te.text.isHidden();[pe.rightJustifiedTextSymbolIndex,pe.centerJustifiedTextSymbolIndex,pe.leftJustifiedTextSymbolIndex].forEach(lt=>{lt>=0&&(t.text.placedSymbolArray.get(lt).hidden=vt||st?1:0)}),pe.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(pe.verticalPlacedTextSymbolIndex).hidden=vt||pt?1:0);const jt=this.variableOffsets[pe.crossTileID];jt&&this.markUsedJustification(t,jt.anchor,pe,Ue);const nt=this.placedOrientations[pe.crossTileID];nt&&(this.markUsedJustification(t,"left",pe,nt),this.markUsedOrientation(t,nt,pe))}if(Le){const tt=on(Te.icon),vt=!(V&&pe.verticalPlacedIconSymbolIndex&&st);pe.placedIconSymbolIndex>=0&&(Q(t.icon,pe.numIconVertices,vt?tt:Qa),t.icon.placedSymbolArray.get(pe.placedIconSymbolIndex).hidden=Te.icon.isHidden()),pe.verticalPlacedIconSymbolIndex>=0&&(Q(t.icon,pe.numVerticalIconVertices,vt?Qa:tt),t.icon.placedSymbolArray.get(pe.verticalPlacedIconSymbolIndex).hidden=Te.icon.isHidden())}const Ke=Z&&Z.has(ie)?Z.get(ie):{text:null,icon:null};if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const tt=t.collisionArrays[ie];if(tt){let vt=new d.P(0,0);if(tt.textBox||tt.verticalTextBox){let jt=!0;if(z){const nt=this.variableOffsets[Se];nt?(vt=ui(nt.anchor,nt.width,nt.height,nt.textOffset,nt.textBoxScale),D&&vt._rotate(O?this.transform.angle:-this.transform.angle)):jt=!1}if(tt.textBox||tt.verticalTextBox){let nt;tt.textBox&&(nt=st),tt.verticalTextBox&&(nt=pt),an(t.textCollisionBox.collisionVertexArray,Te.text.placed,!jt||nt,Ke.text,vt.x,vt.y)}}if(tt.iconBox||tt.verticalIconBox){const jt=!!(!pt&&tt.verticalIconBox);let nt;tt.iconBox&&(nt=jt),tt.verticalIconBox&&(nt=!jt),an(t.iconCollisionBox.collisionVertexArray,Te.icon.placed,nt,Ke.icon,V?vt.x:0,V?vt.y:0)}}}}if(t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);if(t.bucketInstanceId in this.collisionCircleArrays){const ie=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=ie.invProjMatrix,t.placementViewportMatrix=ie.viewportMatrix,t.collisionCircleArray=ie.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,s){const l=this.zoomAtLastRecencyCheck===s?1-this.zoomAdjustment(s):1;return this.zoomAtLastRecencyCheck=s,this.commitTime+this.fadeDuration*l>t}setStale(){this.stale=!0}}function an(p,t,s,l,u,m){l&&l.length!==0||(l=[0,0,0,0]);const v=l[0]-Pt,b=l[1]-Pt,M=l[2]-Pt,I=l[3]-Pt;p.emplaceBack(t?1:0,s?1:0,u||0,m||0,v,b),p.emplaceBack(t?1:0,s?1:0,u||0,m||0,M,b),p.emplaceBack(t?1:0,s?1:0,u||0,m||0,M,I),p.emplaceBack(t?1:0,s?1:0,u||0,m||0,v,I)}const gi=Math.pow(2,25),xa=Math.pow(2,24),Yc=Math.pow(2,17),Pr=Math.pow(2,16),Jl=Math.pow(2,9),Yl=Math.pow(2,8),mn=Math.pow(2,1);function on(p){if(p.opacity===0&&!p.placed)return 0;if(p.opacity===1&&p.placed)return 4294967295;const t=p.placed?1:0,s=Math.floor(127*p.opacity);return s*gi+t*xa+s*Yc+t*Pr+s*Jl+t*Yl+s*mn+t}const Qa=0;function Oi(){return{isOccluded:(p,t,s)=>!1,getPitchedTextCorrection:(p,t,s)=>1,get useSpecialProjectionForSymbols(){return!1},projectTileCoordinates(p,t,s,l){throw new Error("Not implemented.")},translatePosition:(p,t,s,l)=>function(u,m,v,b,M=!1){if(!v[0]&&!v[1])return[0,0];const I=M?b==="map"?u.angle:0:b==="viewport"?-u.angle:0;if(I){const z=Math.sin(I),D=Math.cos(I);v=[v[0]*D-v[1]*z,v[0]*z+v[1]*D]}return[M?v[0]:$t(m,v[0],u.zoom),M?v[1]:$t(m,v[1],u.zoom)]}(p,t,s,l),getCircleRadiusCorrection:p=>1}}class Pi{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,s,l,u,m){const v=this._bucketParts;for(;this._currentTileIndex<t.length;)if(s.getBucketParts(v,u,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,m())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,v.sort((b,M)=>b.sortKey-M.sortKey));this._currentPartIndex<v.length;)if(s.placeLayerBucketPart(v[this._currentPartIndex],this._seenCrossTileIDs,l),this._currentPartIndex++,m())return!0;return!1}}class No{constructor(t,s,l,u,m,v,b,M){this.placement=new sn(t,Oi(),s,v,b,M),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=u,this._showCollisionBoxes=m,this._done=!1}isDone(){return this._done}continuePlacement(t,s,l){const u=le.now(),m=()=>!this._forceFullPlacement&&le.now()-u>2;for(;this._currentPlacementIndex>=0;){const v=s[t[this._currentPlacementIndex]],b=this.placement.collisionIndex.transform.zoom;if(v.type==="symbol"&&(!v.minzoom||v.minzoom<=b)&&(!v.maxzoom||v.maxzoom>b)){if(this._inProgressLayer||(this._inProgressLayer=new Pi(v)),this._inProgressLayer.continuePlacement(l[v.source],this.placement,this._showCollisionBoxes,v,m))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const ln=512/d.W/2;class hi{constructor(t,s,l){this.tileID=t,this.bucketInstanceId=l,this._symbolsByKey={};const u=new Map;for(let m=0;m<s.length;m++){const v=s.get(m),b=v.key,M=u.get(b);M?M.push(v):u.set(b,[v])}for(const[m,v]of u){const b={positions:v.map(M=>({x:Math.floor(M.anchorX*ln),y:Math.floor(M.anchorY*ln)})),crossTileIDs:v.map(M=>M.crossTileID)};if(b.positions.length>128){const M=new d.av(b.positions.length,16,Uint16Array);for(const{x:I,y:z}of b.positions)M.add(I,z);M.finish(),delete b.positions,b.index=M}this._symbolsByKey[m]=b}}getScaledCoordinates(t,s){const{x:l,y:u,z:m}=this.tileID.canonical,{x:v,y:b,z:M}=s.canonical,I=ln/Math.pow(2,M-m),z=(b*d.W+t.anchorY)*I,D=u*d.W*ln;return{x:Math.floor((v*d.W+t.anchorX)*I-l*d.W*ln),y:Math.floor(z-D)}}findMatches(t,s,l){const u=this.tileID.canonical.z<s.canonical.z?1:Math.pow(2,this.tileID.canonical.z-s.canonical.z);for(let m=0;m<t.length;m++){const v=t.get(m);if(v.crossTileID)continue;const b=this._symbolsByKey[v.key];if(!b)continue;const M=this.getScaledCoordinates(v,s);if(b.index){const I=b.index.range(M.x-u,M.y-u,M.x+u,M.y+u).sort();for(const z of I){const D=b.crossTileIDs[z];if(!l[D]){l[D]=!0,v.crossTileID=D;break}}}else if(b.positions)for(let I=0;I<b.positions.length;I++){const z=b.positions[I],D=b.crossTileIDs[I];if(Math.abs(z.x-M.x)<=u&&Math.abs(z.y-M.y)<=u&&!l[D]){l[D]=!0,v.crossTileID=D;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:t})=>t)}}class eo{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Hs{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const s=Math.round((t-this.lng)/360);if(s!==0)for(const l in this.indexes){const u=this.indexes[l],m={};for(const v in u){const b=u[v];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+s),m[b.tileID.key]=b}this.indexes[l]=m}this.lng=t}addBucket(t,s,l){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===s.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let m=0;m<s.symbolInstances.length;m++)s.symbolInstances.get(m).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const u=this.usedCrossTileIDs[t.overscaledZ];for(const m in this.indexes){const v=this.indexes[m];if(Number(m)>t.overscaledZ)for(const b in v){const M=v[b];M.tileID.isChildOf(t)&&M.findMatches(s.symbolInstances,t,u)}else{const b=v[t.scaledTo(Number(m)).key];b&&b.findMatches(s.symbolInstances,t,u)}}for(let m=0;m<s.symbolInstances.length;m++){const v=s.symbolInstances.get(m);v.crossTileID||(v.crossTileID=l.generate(),u[v.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new hi(t,s.symbolInstances,s.bucketInstanceId),!0}removeBucketCrossTileIDs(t,s){for(const l of s.getCrossTileIDsLists())for(const u of l)delete this.usedCrossTileIDs[t][u]}removeStaleBuckets(t){let s=!1;for(const l in this.indexes){const u=this.indexes[l];for(const m in u)t[u[m].bucketInstanceId]||(this.removeBucketCrossTileIDs(l,u[m]),delete u[m],s=!0)}return s}}class ri{constructor(){this.layerIndexes={},this.crossTileIDs=new eo,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,s,l){let u=this.layerIndexes[t.id];u===void 0&&(u=this.layerIndexes[t.id]=new Hs);let m=!1;const v={};u.handleWrapJump(l);for(const b of s){const M=b.getBucket(t);M&&t.id===M.layerIds[0]&&(M.bucketInstanceId||(M.bucketInstanceId=++this.maxBucketInstanceId),u.addBucket(b.tileID,M,this.crossTileIDs)&&(m=!0),v[M.bucketInstanceId]=!0)}return u.removeStaleBuckets(v)&&(m=!0),m}pruneUnusedLayers(t){const s={};t.forEach(l=>{s[l]=!0});for(const l in this.layerIndexes)s[l]||delete this.layerIndexes[l]}}const Ws=(p,t)=>d.t(p,t&&t.filter(s=>s.identifier!=="source.canvas")),En=d.aw();class to extends d.E{constructor(t,s={}){super(),this._rtlPluginLoaded=()=>{for(const l in this.sourceCaches){const u=this.sourceCaches[l].getSource().type;u!=="vector"&&u!=="geojson"||this.sourceCaches[l].reload()}},this.map=t,this.dispatcher=new Ir(Qt(),t._getMapId()),this.dispatcher.registerMessageHandler("GG",(l,u)=>this.getGlyphs(l,u)),this.dispatcher.registerMessageHandler("GI",(l,u)=>this.getImages(l,u)),this.imageManager=new bt,this.imageManager.setEventedParent(this),this.glyphManager=new ht(t._requestManager,s.localIdeographFontFamily),this.lineAtlas=new St(256,512),this.crossTileSymbolIndex=new ri,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new d.ax,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",d.ay()),Kr().on(nn,this._rtlPluginLoaded),this.on("data",l=>{if(l.dataType!=="source"||l.sourceDataType!=="metadata")return;const u=this.sourceCaches[l.sourceId];if(!u)return;const m=u.getSource();if(m&&m.vectorLayerIds)for(const v in this._layers){const b=this._layers[v];b.source===m.id&&this._validateLayer(b)}})}loadURL(t,s={},l){this.fire(new d.k("dataloading",{dataType:"style"})),s.validate=typeof s.validate!="boolean"||s.validate;const u=this.map._requestManager.transformRequest(t,"Style");this._loadStyleRequest=new AbortController,d.h(u,this._loadStyleRequest).then(m=>{this._loadStyleRequest=null,this._load(m.data,s,l)}).catch(m=>{this._loadStyleRequest=null,m&&this.fire(new d.j(m))})}loadJSON(t,s={},l){this.fire(new d.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,le.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,s.validate=s.validate!==!1,this._load(t,s,l)}).catch(()=>{})}loadEmpty(){this.fire(new d.k("dataloading",{dataType:"style"})),this._load(En,{validate:!1})}_load(t,s,l){var u;const m=s.transformStyle?s.transformStyle(l,t):t;if(!s.validate||!Ws(this,d.x(m))){this._loaded=!0,this.stylesheet=m;for(const v in m.sources)this.addSource(v,m.sources[v],{validate:!1});m.sprite?this._loadSprite(m.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(m.glyphs),this._createLayers(),this.light=new dt(this.stylesheet.light),this.map.setTerrain((u=this.stylesheet.terrain)!==null&&u!==void 0?u:null),this.fire(new d.k("data",{dataType:"style"})),this.fire(new d.k("style.load"))}}_createLayers(){const t=d.az(this.stylesheet.layers);this.dispatcher.broadcast("SL",t),this._order=t.map(s=>s.id),this._layers={},this._serializedLayers=null;for(const s of t){const l=d.aA(s);l.setEventedParent(this,{layer:{id:s.id}}),this._layers[s.id]=l}}_loadSprite(t,s=!1,l=void 0){let u;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(m,v,b,M){return d._(this,void 0,void 0,function*(){const I=de(m),z=b>1?"@2x":"",D={},O={};for(const{id:V,url:G}of I){const Q=v.transformRequest(De(G,z,".json"),"SpriteJSON");D[V]=d.h(Q,M);const Z=v.transformRequest(De(G,z,".png"),"SpriteImage");O[V]=_e.getImage(Z,M)}return yield Promise.all([...Object.values(D),...Object.values(O)]),function(V,G){return d._(this,void 0,void 0,function*(){const Q={};for(const Z in V){Q[Z]={};const ie=le.getImageCanvasContext((yield G[Z]).data),pe=(yield V[Z]).data;for(const J in pe){const{width:ge,height:Se,x:Te,y:Le,sdf:Ue,pixelRatio:st,stretchX:pt,stretchY:Ke,content:tt,textFitWidth:vt,textFitHeight:jt}=pe[J];Q[Z][J]={data:null,pixelRatio:st,sdf:Ue,stretchX:pt,stretchY:Ke,content:tt,textFitWidth:vt,textFitHeight:jt,spriteData:{width:ge,height:Se,x:Te,y:Le,context:ie}}}}return Q})}(D,O)})}(t,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(m=>{if(this._spriteRequest=null,m)for(const v in m){this._spritesImagesIds[v]=[];const b=this._spritesImagesIds[v]?this._spritesImagesIds[v].filter(M=>!(M in m)):[];for(const M of b)this.imageManager.removeImage(M),this._changedImages[M]=!0;for(const M in m[v]){const I=v==="default"?M:`${v}:${M}`;this._spritesImagesIds[v].push(I),I in this.imageManager.images?this.imageManager.updateImage(I,m[v][M],!1):this.imageManager.addImage(I,m[v][M]),s&&(this._changedImages[I]=!0)}}}).catch(m=>{this._spriteRequest=null,u=m,this.fire(new d.j(u))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),s&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.k("data",{dataType:"style"})),l&&l(u)})}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.k("data",{dataType:"style"}))}_validateLayer(t){const s=this.sourceCaches[t.source];if(!s)return;const l=t.sourceLayer;if(!l)return;const u=s.getSource();(u.type==="geojson"||u.vectorLayerIds&&u.vectorLayerIds.indexOf(l)===-1)&&this.fire(new d.j(new Error(`Source layer "${l}" does not exist on source "${u.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t){const s=this._serializedAllLayers();if(!t||t.length===0)return Object.values(s);const l=[];for(const u of t)s[u]&&l.push(s[u]);return l}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const s=Object.keys(this._layers);for(const l of s){const u=this._layers[l];u.type!=="custom"&&(t[l]=u.serialize())}return t}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const s=this._changed;if(s){const u=Object.keys(this._updatedLayers),m=Object.keys(this._removedLayers);(u.length||m.length)&&this._updateWorkerLayers(u,m);for(const v in this._updatedSources){const b=this._updatedSources[v];if(b==="reload")this._reloadSource(v);else{if(b!=="clear")throw new Error(`Invalid action ${b}`);this._clearSource(v)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const v in this._updatedPaintProps)this._layers[v].updateTransitions(t);this.light.updateTransitions(t),this._resetUpdates()}const l={};for(const u in this.sourceCaches){const m=this.sourceCaches[u];l[u]=m.used,m.used=!1}for(const u of this._order){const m=this._layers[u];m.recalculate(t,this._availableImages),!m.isHidden(t.zoom)&&m.source&&(this.sourceCaches[m.source].used=!0)}for(const u in l){const m=this.sourceCaches[u];!!l[u]!=!!m.used&&m.fire(new d.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:u}))}this.light.recalculate(t),this.z=t.zoom,s&&this.fire(new d.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const s in this.sourceCaches)this.sourceCaches[s].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.sourceCaches)this.sourceCaches[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,s){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(t),removedIds:s})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,s={}){var l;this._checkLoaded();const u=this.serialize();if(t=s.transformStyle?s.transformStyle(u,t):t,((l=s.validate)===null||l===void 0||l)&&Ws(this,d.x(t)))return!1;(t=d.aB(t)).layers=d.az(t.layers);const m=d.aC(u,t),v=this._getOperationsToPerform(m);if(v.unimplemented.length>0)throw new Error(`Unimplemented: ${v.unimplemented.join(", ")}.`);if(v.operations.length===0)return!1;for(const b of v.operations)b();return this.stylesheet=t,this._serializedLayers=null,!0}_getOperationsToPerform(t){const s=[],l=[];for(const u of t)switch(u.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":s.push(()=>this.addLayer.apply(this,u.args));break;case"removeLayer":s.push(()=>this.removeLayer.apply(this,u.args));break;case"setPaintProperty":s.push(()=>this.setPaintProperty.apply(this,u.args));break;case"setLayoutProperty":s.push(()=>this.setLayoutProperty.apply(this,u.args));break;case"setFilter":s.push(()=>this.setFilter.apply(this,u.args));break;case"addSource":s.push(()=>this.addSource.apply(this,u.args));break;case"removeSource":s.push(()=>this.removeSource.apply(this,u.args));break;case"setLayerZoomRange":s.push(()=>this.setLayerZoomRange.apply(this,u.args));break;case"setLight":s.push(()=>this.setLight.apply(this,u.args));break;case"setGeoJSONSourceData":s.push(()=>this.setGeoJSONSourceData.apply(this,u.args));break;case"setGlyphs":s.push(()=>this.setGlyphs.apply(this,u.args));break;case"setSprite":s.push(()=>this.setSprite.apply(this,u.args));break;case"setTerrain":s.push(()=>this.map.setTerrain.apply(this,u.args));break;case"setTransition":s.push(()=>{});break;default:l.push(u.command)}return{operations:s,unimplemented:l}}addImage(t,s){if(this.getImage(t))return this.fire(new d.j(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,s),this._afterImageUpdated(t)}updateImage(t,s){this.imageManager.updateImage(t,s)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new d.j(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,s,l={}){if(this._checkLoaded(),this.sourceCaches[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!s.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(s).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(s.type)>=0&&this._validate(d.x.source,`sources.${t}`,s,null,l))return;this.map&&this.map._collectResourceTiming&&(s.collectResourceTiming=!0);const u=this.sourceCaches[t]=new Xe(t,s,this.dispatcher);u.style=this,u.setEventedParent(this,()=>({isSourceLoaded:u.loaded(),source:u.serialize(),sourceId:t})),u.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error("There is no source with this ID");for(const l in this._layers)if(this._layers[l].source===t)return this.fire(new d.j(new Error(`Source "${t}" cannot be removed while layer "${l}" is using it.`)));const s=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],s.fire(new d.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),s.setEventedParent(null),s.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,s){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const l=this.sourceCaches[t].getSource();if(l.type!=="geojson")throw new Error(`geojsonSource.type is ${l.type}, which is !== 'geojson`);l.setData(s),this._changed=!0}getSource(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()}addLayer(t,s,l={}){this._checkLoaded();const u=t.id;if(this.getLayer(u))return void this.fire(new d.j(new Error(`Layer "${u}" already exists on this map.`)));let m;if(t.type==="custom"){if(Ws(this,d.aD(t)))return;m=d.aA(t)}else{if("source"in t&&typeof t.source=="object"&&(this.addSource(u,t.source),t=d.aB(t),t=d.e(t,{source:u})),this._validate(d.x.layer,`layers.${u}`,t,{arrayIndex:-1},l))return;m=d.aA(t),this._validateLayer(m),m.setEventedParent(this,{layer:{id:u}})}const v=s?this._order.indexOf(s):this._order.length;if(s&&v===-1)this.fire(new d.j(new Error(`Cannot add layer "${u}" before non-existing layer "${s}".`)));else{if(this._order.splice(v,0,u),this._layerOrderChanged=!0,this._layers[u]=m,this._removedLayers[u]&&m.source&&m.type!=="custom"){const b=this._removedLayers[u];delete this._removedLayers[u],b.type!==m.type?this._updatedSources[m.source]="clear":(this._updatedSources[m.source]="reload",this.sourceCaches[m.source].pause())}this._updateLayer(m),m.onAdd&&m.onAdd(this.map)}}moveLayer(t,s){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new d.j(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===s)return;const l=this._order.indexOf(t);this._order.splice(l,1);const u=s?this._order.indexOf(s):this._order.length;s&&u===-1?this.fire(new d.j(new Error(`Cannot move layer "${t}" before non-existing layer "${s}".`))):(this._order.splice(u,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const s=this._layers[t];if(!s)return void this.fire(new d.j(new Error(`Cannot remove non-existing layer "${t}".`)));s.setEventedParent(null);const l=this._order.indexOf(t);this._order.splice(l,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=s,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],s.onRemove&&s.onRemove(this.map)}getLayer(t){return this._layers[t]}getLayersOrder(){return[...this._order]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,s,l){this._checkLoaded();const u=this.getLayer(t);u?u.minzoom===s&&u.maxzoom===l||(s!=null&&(u.minzoom=s),l!=null&&(u.maxzoom=l),this._updateLayer(u)):this.fire(new d.j(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,s,l={}){this._checkLoaded();const u=this.getLayer(t);if(u){if(!d.aE(u.filter,s))return s==null?(u.filter=void 0,void this._updateLayer(u)):void(this._validate(d.x.filter,`layers.${u.id}.filter`,s,null,l)||(u.filter=d.aB(s),this._updateLayer(u)))}else this.fire(new d.j(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return d.aB(this.getLayer(t).filter)}setLayoutProperty(t,s,l,u={}){this._checkLoaded();const m=this.getLayer(t);m?d.aE(m.getLayoutProperty(s),l)||(m.setLayoutProperty(s,l,u),this._updateLayer(m)):this.fire(new d.j(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,s){const l=this.getLayer(t);if(l)return l.getLayoutProperty(s);this.fire(new d.j(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,s,l,u={}){this._checkLoaded();const m=this.getLayer(t);m?d.aE(m.getPaintProperty(s),l)||(m.setPaintProperty(s,l,u)&&this._updateLayer(m),this._changed=!0,this._updatedPaintProps[t]=!0,this._serializedLayers=null):this.fire(new d.j(new Error(`Cannot style non-existing layer "${t}".`)))}getPaintProperty(t,s){return this.getLayer(t).getPaintProperty(s)}setFeatureState(t,s){this._checkLoaded();const l=t.source,u=t.sourceLayer,m=this.sourceCaches[l];if(m===void 0)return void this.fire(new d.j(new Error(`The source '${l}' does not exist in the map's style.`)));const v=m.getSource().type;v==="geojson"&&u?this.fire(new d.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):v!=="vector"||u?(t.id===void 0&&this.fire(new d.j(new Error("The feature id parameter must be provided."))),m.setFeatureState(u,t.id,s)):this.fire(new d.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,s){this._checkLoaded();const l=t.source,u=this.sourceCaches[l];if(u===void 0)return void this.fire(new d.j(new Error(`The source '${l}' does not exist in the map's style.`)));const m=u.getSource().type,v=m==="vector"?t.sourceLayer:void 0;m!=="vector"||v?s&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new d.j(new Error("A feature id is required to remove its specific state property."))):u.removeFeatureState(v,t.id,s):this.fire(new d.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const s=t.source,l=t.sourceLayer,u=this.sourceCaches[s];if(u!==void 0)return u.getSource().type!=="vector"||l?(t.id===void 0&&this.fire(new d.j(new Error("The feature id parameter must be provided."))),u.getFeatureState(l,t.id)):void this.fire(new d.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new d.j(new Error(`The source '${s}' does not exist in the map's style.`)))}getTransition(){return d.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const t=d.aF(this.sourceCaches,m=>m.serialize()),s=this._serializeByIds(this._order),l=this.map.getTerrain()||void 0,u=this.stylesheet;return d.aG({version:u.version,name:u.name,metadata:u.metadata,light:u.light,center:u.center,zoom:u.zoom,bearing:u.bearing,pitch:u.pitch,sprite:u.sprite,glyphs:u.glyphs,transition:u.transition,sources:t,layers:s,terrain:l},m=>m!==void 0)}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.sourceCaches[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const s=v=>this._layers[v].type==="fill-extrusion",l={},u=[];for(let v=this._order.length-1;v>=0;v--){const b=this._order[v];if(s(b)){l[b]=v;for(const M of t){const I=M[b];if(I)for(const z of I)u.push(z)}}}u.sort((v,b)=>b.intersectionZ-v.intersectionZ);const m=[];for(let v=this._order.length-1;v>=0;v--){const b=this._order[v];if(s(b))for(let M=u.length-1;M>=0;M--){const I=u[M].feature;if(l[I.layer.id]<v)break;m.push(I),u.pop()}else for(const M of t){const I=M[b];if(I)for(const z of I)m.push(z.feature)}}return m}queryRenderedFeatures(t,s,l){s&&s.filter&&this._validate(d.x.filter,"queryRenderedFeatures.filter",s.filter,null,s);const u={};if(s&&s.layers){if(!Array.isArray(s.layers))return this.fire(new d.j(new Error("parameters.layers must be an Array."))),[];for(const b of s.layers){const M=this._layers[b];if(!M)return this.fire(new d.j(new Error(`The layer '${b}' does not exist in the map's style and cannot be queried for features.`))),[];u[M.source]=!0}}const m=[];s.availableImages=this._availableImages;const v=this._serializedAllLayers();for(const b in this.sourceCaches)s.layers&&!u[b]||m.push(Er(this.sourceCaches[b],this._layers,v,t,s,l));return this.placement&&m.push(function(b,M,I,z,D,O,V){const G={},Q=O.queryRenderedSymbols(z),Z=[];for(const ie of Object.keys(Q).map(Number))Z.push(V[ie]);Z.sort(_r);for(const ie of Z){const pe=ie.featureIndex.lookupSymbolFeatures(Q[ie.bucketInstanceId],M,ie.bucketIndex,ie.sourceLayerIndex,D.filter,D.layers,D.availableImages,b);for(const J in pe){const ge=G[J]=G[J]||[],Se=pe[J];Se.sort((Te,Le)=>{const Ue=ie.featureSortOrder;if(Ue){const st=Ue.indexOf(Te.featureIndex);return Ue.indexOf(Le.featureIndex)-st}return Le.featureIndex-Te.featureIndex});for(const Te of Se)ge.push(Te)}}for(const ie in G)G[ie].forEach(pe=>{const J=pe.feature,ge=I[b[ie].source].getFeatureState(J.layer["source-layer"],J.id);J.source=J.layer.source,J.layer["source-layer"]&&(J.sourceLayer=J.layer["source-layer"]),J.state=ge});return G}(this._layers,v,this.sourceCaches,t,s,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(m)}querySourceFeatures(t,s){s&&s.filter&&this._validate(d.x.filter,"querySourceFeatures.filter",s.filter,null,s);const l=this.sourceCaches[t];return l?function(u,m){const v=u.getRenderableIds().map(I=>u.getTileByID(I)),b=[],M={};for(let I=0;I<v.length;I++){const z=v[I],D=z.tileID.canonical.key;M[D]||(M[D]=!0,z.querySourceFeatures(b,m))}return b}(l,s):[]}getLight(){return this.light.getLight()}setLight(t,s={}){this._checkLoaded();const l=this.light.getLight();let u=!1;for(const v in t)if(!d.aE(t[v],l[v])){u=!0;break}if(!u)return;const m={now:le.now(),transition:d.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,s),this.light.updateTransitions(m)}_validate(t,s,l,u,m={}){return(!m||m.validate!==!1)&&Ws(this,t.call(d.x,d.e({key:s,style:this.serialize(),value:l,styleSpec:d.v},u)))}_remove(t=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Kr().off(nn,this._rtlPluginLoaded);for(const s in this._layers)this._layers[s].setEventedParent(null);for(const s in this.sourceCaches){const l=this.sourceCaches[s];l.setEventedParent(null),l.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),t&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(t)}_clearSource(t){this.sourceCaches[t].clearTiles()}_reloadSource(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()}_updateSources(t){for(const s in this.sourceCaches)this.sourceCaches[s].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.sourceCaches)this._reloadSource(t)}_updatePlacement(t,s,l,u,m=!1){let v=!1,b=!1;const M={};for(const I of this._order){const z=this._layers[I];if(z.type!=="symbol")continue;if(!M[z.source]){const O=this.sourceCaches[z.source];M[z.source]=O.getRenderableIds(!0).map(V=>O.getTileByID(V)).sort((V,G)=>G.tileID.overscaledZ-V.tileID.overscaledZ||(V.tileID.isLessThan(G.tileID)?-1:1))}const D=this.crossTileSymbolIndex.addLayer(z,M[z.source],t.center.lng);v=v||D}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((m=m||this._layerOrderChanged||l===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(le.now(),t.zoom))&&(this.pauseablePlacement=new No(t,this.map.terrain,this._order,m,s,l,u,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,M),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(le.now()),b=!0),v&&this.pauseablePlacement.placement.setStale()),b||v)for(const I of this._order){const z=this._layers[I];z.type==="symbol"&&this.placement.updateLayerOpacities(z,M[z.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(le.now())}_releaseSymbolFadeTiles(){for(const t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,s){return d._(this,void 0,void 0,function*(){const l=yield this.imageManager.getImages(s.icons);this._updateTilesForChangedImages();const u=this.sourceCaches[s.source];return u&&u.setDependencies(s.tileID.key,s.type,s.icons),l})}getGlyphs(t,s){return d._(this,void 0,void 0,function*(){const l=yield this.glyphManager.getGlyphs(s.stacks),u=this.sourceCaches[s.source];return u&&u.setDependencies(s.tileID.key,s.type,[""]),l})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,s={}){this._checkLoaded(),t&&this._validate(d.x.glyphs,"glyphs",t,null,s)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}addSprite(t,s,l={},u){this._checkLoaded();const m=[{id:t,url:s}],v=[...de(this.stylesheet.sprite),...m];this._validate(d.x.sprite,"sprite",v,null,l)||(this.stylesheet.sprite=v,this._loadSprite(m,!0,u))}removeSprite(t){this._checkLoaded();const s=de(this.stylesheet.sprite);if(s.find(l=>l.id===t)){if(this._spritesImagesIds[t])for(const l of this._spritesImagesIds[t])this.imageManager.removeImage(l),this._changedImages[l]=!0;s.splice(s.findIndex(l=>l.id===t),1),this.stylesheet.sprite=s.length>0?s:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.k("data",{dataType:"style"}))}else this.fire(new d.j(new Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return de(this.stylesheet.sprite)}setSprite(t,s={},l){this._checkLoaded(),t&&this._validate(d.x.sprite,"sprite",t,null,s)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,l):(this._unloadSprite(),l&&l(null)))}}var Wn=d.X([{name:"a_pos",type:"Int16",components:2}]),Ql="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const ba={prelude:br(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:br(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:br(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:br(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:br("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:br(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:br(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:br("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_anchor_pos;attribute vec2 a_placed;attribute vec2 a_box_real;uniform mat4 u_matrix;uniform vec2 u_pixel_extrude_scale;varying float v_placed;varying float v_notUsed;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:br("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:br("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:br(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:br(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:br(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:br(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:br(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:br(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:br(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:br(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:br(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:br(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:br(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:br(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:br(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:br(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_tex;varying float v_fade_opacity;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:br(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_data0;varying vec3 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:br(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec4 v_data0;varying vec4 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:br("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",Ql),terrainDepth:br("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",Ql),terrainCoords:br("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",Ql)};function br(p,t){const s=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,l=t.match(/attribute ([\w]+) ([\w]+)/g),u=p.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),m=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),v=m?m.concat(u):u,b={};return{fragmentSource:p=p.replace(s,(M,I,z,D,O)=>(b[O]=!0,I==="define"?`
#ifndef HAS_UNIFORM_u_${O}
varying ${z} ${D} ${O};
#else
uniform ${z} ${D} u_${O};
#endif
`:`
#ifdef HAS_UNIFORM_u_${O}
    ${z} ${D} ${O} = u_${O};
#endif
`)),vertexSource:t=t.replace(s,(M,I,z,D,O)=>{const V=D==="float"?"vec2":"vec4",G=O.match(/color/)?"color":V;return b[O]?I==="define"?`
#ifndef HAS_UNIFORM_u_${O}
uniform lowp float u_${O}_t;
attribute ${z} ${V} a_${O};
varying ${z} ${D} ${O};
#else
uniform ${z} ${D} u_${O};
#endif
`:G==="vec4"?`
#ifndef HAS_UNIFORM_u_${O}
    ${O} = a_${O};
#else
    ${z} ${D} ${O} = u_${O};
#endif
`:`
#ifndef HAS_UNIFORM_u_${O}
    ${O} = unpack_mix_${G}(a_${O}, u_${O}_t);
#else
    ${z} ${D} ${O} = u_${O};
#endif
`:I==="define"?`
#ifndef HAS_UNIFORM_u_${O}
uniform lowp float u_${O}_t;
attribute ${z} ${V} a_${O};
#else
uniform ${z} ${D} u_${O};
#endif
`:G==="vec4"?`
#ifndef HAS_UNIFORM_u_${O}
    ${z} ${D} ${O} = a_${O};
#else
    ${z} ${D} ${O} = u_${O};
#endif
`:`
#ifndef HAS_UNIFORM_u_${O}
    ${z} ${D} ${O} = unpack_mix_${G}(a_${O}, u_${O}_t);
#else
    ${z} ${D} ${O} = u_${O};
#endif
`}),staticAttributes:l,staticUniforms:v}}class ro{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,s,l,u,m,v,b,M,I){this.context=t;let z=this.boundPaintVertexBuffers.length!==u.length;for(let D=0;!z&&D<u.length;D++)this.boundPaintVertexBuffers[D]!==u[D]&&(z=!0);!this.vao||this.boundProgram!==s||this.boundLayoutVertexBuffer!==l||z||this.boundIndexBuffer!==m||this.boundVertexOffset!==v||this.boundDynamicVertexBuffer!==b||this.boundDynamicVertexBuffer2!==M||this.boundDynamicVertexBuffer3!==I?this.freshBind(s,l,u,m,v,b,M,I):(t.bindVertexArray.set(this.vao),b&&b.bind(),m&&m.dynamicDraw&&m.bind(),M&&M.bind(),I&&I.bind())}freshBind(t,s,l,u,m,v,b,M){const I=t.numAttributes,z=this.context,D=z.gl;this.vao&&this.destroy(),this.vao=z.createVertexArray(),z.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=s,this.boundPaintVertexBuffers=l,this.boundIndexBuffer=u,this.boundVertexOffset=m,this.boundDynamicVertexBuffer=v,this.boundDynamicVertexBuffer2=b,this.boundDynamicVertexBuffer3=M,s.enableAttributes(D,t);for(const O of l)O.enableAttributes(D,t);v&&v.enableAttributes(D,t),b&&b.enableAttributes(D,t),M&&M.enableAttributes(D,t),s.bind(),s.setVertexAttribPointers(D,t,m);for(const O of l)O.bind(),O.setVertexAttribPointers(D,t,m);v&&(v.bind(),v.setVertexAttribPointers(D,t,m)),u&&u.bind(),b&&(b.bind(),b.setVertexAttribPointers(D,t,m)),M&&(M.bind(),M.setVertexAttribPointers(D,t,m)),z.currentNumAttributes=I}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function Xs(p){const t=[];for(let s=0;s<p.length;s++){if(p[s]===null)continue;const l=p[s].split(" ");t.push(l.pop())}return t}class ec{constructor(t,s,l,u,m,v){const b=t.gl;this.program=b.createProgram();const M=Xs(s.staticAttributes),I=l?l.getBinderAttributes():[],z=M.concat(I),D=ba.prelude.staticUniforms?Xs(ba.prelude.staticUniforms):[],O=s.staticUniforms?Xs(s.staticUniforms):[],V=l?l.getBinderUniforms():[],G=D.concat(O).concat(V),Q=[];for(const Te of G)Q.indexOf(Te)<0&&Q.push(Te);const Z=l?l.defines():[];m&&Z.push("#define OVERDRAW_INSPECTOR;"),v&&Z.push("#define TERRAIN3D;");const ie=Z.concat(ba.prelude.fragmentSource,s.fragmentSource).join(`
`),pe=Z.concat(ba.prelude.vertexSource,s.vertexSource).join(`
`),J=b.createShader(b.FRAGMENT_SHADER);if(b.isContextLost())return void(this.failedToCreate=!0);if(b.shaderSource(J,ie),b.compileShader(J),!b.getShaderParameter(J,b.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${b.getShaderInfoLog(J)}`);b.attachShader(this.program,J);const ge=b.createShader(b.VERTEX_SHADER);if(b.isContextLost())return void(this.failedToCreate=!0);if(b.shaderSource(ge,pe),b.compileShader(ge),!b.getShaderParameter(ge,b.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${b.getShaderInfoLog(ge)}`);b.attachShader(this.program,ge),this.attributes={};const Se={};this.numAttributes=z.length;for(let Te=0;Te<this.numAttributes;Te++)z[Te]&&(b.bindAttribLocation(this.program,Te,z[Te]),this.attributes[z[Te]]=Te);if(b.linkProgram(this.program),!b.getProgramParameter(this.program,b.LINK_STATUS))throw new Error(`Program failed to link: ${b.getProgramInfoLog(this.program)}`);b.deleteShader(ge),b.deleteShader(J);for(let Te=0;Te<Q.length;Te++){const Le=Q[Te];if(Le&&!Se[Le]){const Ue=b.getUniformLocation(this.program,Le);Ue&&(Se[Le]=Ue)}}this.fixedUniforms=u(t,Se),this.terrainUniforms=((Te,Le)=>({u_depth:new d.aH(Te,Le.u_depth),u_terrain:new d.aH(Te,Le.u_terrain),u_terrain_dim:new d.aI(Te,Le.u_terrain_dim),u_terrain_matrix:new d.aJ(Te,Le.u_terrain_matrix),u_terrain_unpack:new d.aK(Te,Le.u_terrain_unpack),u_terrain_exaggeration:new d.aI(Te,Le.u_terrain_exaggeration)}))(t,Se),this.binderUniforms=l?l.getUniforms(t,Se):[]}draw(t,s,l,u,m,v,b,M,I,z,D,O,V,G,Q,Z,ie,pe){const J=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(l),t.setStencilMode(u),t.setColorMode(m),t.setCullFace(v),M){t.activeTexture.set(J.TEXTURE2),J.bindTexture(J.TEXTURE_2D,M.depthTexture),t.activeTexture.set(J.TEXTURE3),J.bindTexture(J.TEXTURE_2D,M.texture);for(const Se in this.terrainUniforms)this.terrainUniforms[Se].set(M[Se])}for(const Se in this.fixedUniforms)this.fixedUniforms[Se].set(b[Se]);Q&&Q.setUniforms(t,this.binderUniforms,V,{zoom:G});let ge=0;switch(s){case J.LINES:ge=2;break;case J.TRIANGLES:ge=3;break;case J.LINE_STRIP:ge=1}for(const Se of O.get()){const Te=Se.vaos||(Se.vaos={});(Te[I]||(Te[I]=new ro)).bind(t,this,z,Q?Q.getPaintVertexBuffers():[],D,Se.vertexOffset,Z,ie,pe),J.drawElements(s,Se.primitiveLength*ge,J.UNSIGNED_SHORT,Se.primitiveOffset*ge*2)}}}function $o(p,t,s){const l=1/$t(s,1,t.transform.tileZoom),u=Math.pow(2,s.tileID.overscaledZ),m=s.tileSize*Math.pow(2,t.transform.tileZoom)/u,v=m*(s.tileID.canonical.x+s.tileID.wrap*u),b=m*s.tileID.canonical.y;return{u_image:0,u_texsize:s.imageAtlasTexture.size,u_scale:[l,p.fromScale,p.toScale],u_fade:p.t,u_pixel_coord_upper:[v>>16,b>>16],u_pixel_coord_lower:[65535&v,65535&b]}}const io=(p,t,s,l)=>{const u=t.style.light,m=u.properties.get("position"),v=[m.x,m.y,m.z],b=function(){var I=new d.A(9);return d.A!=Float32Array&&(I[1]=0,I[2]=0,I[3]=0,I[5]=0,I[6]=0,I[7]=0),I[0]=1,I[4]=1,I[8]=1,I}();u.properties.get("anchor")==="viewport"&&function(I,z){var D=Math.sin(z),O=Math.cos(z);I[0]=O,I[1]=D,I[2]=0,I[3]=-D,I[4]=O,I[5]=0,I[6]=0,I[7]=0,I[8]=1}(b,-t.transform.angle),function(I,z,D){var O=z[0],V=z[1],G=z[2];I[0]=O*D[0]+V*D[3]+G*D[6],I[1]=O*D[1]+V*D[4]+G*D[7],I[2]=O*D[2]+V*D[5]+G*D[8]}(v,v,b);const M=u.properties.get("color");return{u_matrix:p,u_lightpos:v,u_lightintensity:u.properties.get("intensity"),u_lightcolor:[M.r,M.g,M.b],u_vertical_gradient:+s,u_opacity:l}},tc=(p,t,s,l,u,m,v)=>d.e(io(p,t,s,l),$o(m,t,v),{u_height_factor:-Math.pow(2,u.overscaledZ)/v.tileSize/8}),jo=p=>({u_matrix:p}),no=(p,t,s,l)=>d.e(jo(p),$o(s,t,l)),Vo=(p,t)=>({u_matrix:p,u_world:t}),so=(p,t,s,l,u)=>d.e(no(p,t,s,l),{u_world:u}),fh=(p,t,s,l)=>{const u=p.transform;let m,v;if(l.paint.get("circle-pitch-alignment")==="map"){const b=$t(s,1,u.zoom);m=!0,v=[b,b]}else m=!1,v=u.pixelsToGLUnits;return{u_camera_to_center_distance:u.cameraToCenterDistance,u_scale_with_map:+(l.paint.get("circle-pitch-scale")==="map"),u_matrix:p.translatePosMatrix(t.posMatrix,s,l.paint.get("circle-translate"),l.paint.get("circle-translate-anchor")),u_pitch_with_map:+m,u_device_pixel_ratio:p.pixelRatio,u_extrude_scale:v}},mh=(p,t,s)=>({u_matrix:p,u_inv_matrix:t,u_camera_to_center_distance:s.cameraToCenterDistance,u_viewport_size:[s.width,s.height]}),rc=(p,t,s=1)=>({u_matrix:p,u_color:t,u_overlay:0,u_overlay_scale:s}),Qc=p=>({u_matrix:p}),Ks=(p,t,s,l)=>({u_matrix:p,u_extrude_scale:$t(t,1,s),u_intensity:l});function ao(p,t){const s=Math.pow(2,t.canonical.z),l=t.canonical.y;return[new d.Y(0,l/s).toLngLat().lat,new d.Y(0,(l+1)/s).toLngLat().lat]}const Ni=(p,t,s,l)=>{const u=p.transform;return{u_matrix:Uo(p,t,s,l),u_ratio:1/$t(t,1,u.zoom),u_device_pixel_ratio:p.pixelRatio,u_units_to_pixels:[1/u.pixelsToGLUnits[0],1/u.pixelsToGLUnits[1]]}},gn=(p,t,s,l,u)=>d.e(Ni(p,t,s,u),{u_image:0,u_image_height:l}),wa=(p,t,s,l,u)=>{const m=p.transform,v=ic(t,m);return{u_matrix:Uo(p,t,s,u),u_texsize:t.imageAtlasTexture.size,u_ratio:1/$t(t,1,m.zoom),u_device_pixel_ratio:p.pixelRatio,u_image:0,u_scale:[v,l.fromScale,l.toScale],u_fade:l.t,u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]]}},os=(p,t,s,l,u,m)=>{const v=p.lineAtlas,b=ic(t,p.transform),M=s.layout.get("line-cap")==="round",I=v.getDash(l.from,M),z=v.getDash(l.to,M),D=I.width*u.fromScale,O=z.width*u.toScale;return d.e(Ni(p,t,s,m),{u_patternscale_a:[b/D,-I.height/2],u_patternscale_b:[b/O,-z.height/2],u_sdfgamma:v.width/(256*Math.min(D,O)*p.pixelRatio)/2,u_image:0,u_tex_y_a:I.y,u_tex_y_b:z.y,u_mix:u.t})};function ic(p,t){return 1/$t(p,1,t.tileZoom)}function Uo(p,t,s,l){return p.translatePosMatrix(l?l.posMatrix:t.tileID.posMatrix,t,s.paint.get("line-translate"),s.paint.get("line-translate-anchor"))}const Sa=(p,t,s,l,u)=>{return{u_matrix:p,u_tl_parent:t,u_scale_parent:s,u_buffer_scale:1,u_fade_t:l.mix,u_opacity:l.opacity*u.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:u.paint.get("raster-brightness-min"),u_brightness_high:u.paint.get("raster-brightness-max"),u_saturation_factor:(v=u.paint.get("raster-saturation"),v>0?1-1/(1.001-v):-v),u_contrast_factor:(m=u.paint.get("raster-contrast"),m>0?1/(1-m):1+m),u_spin_weights:nc(u.paint.get("raster-hue-rotate"))};var m,v};function nc(p){p*=Math.PI/180;const t=Math.sin(p),s=Math.cos(p);return[(2*s+1)/3,(-Math.sqrt(3)*t-s+1)/3,(Math.sqrt(3)*t-s+1)/3]}const qo=(p,t,s,l,u,m,v,b,M,I,z,D,O,V)=>{const G=v.transform;return{u_is_size_zoom_constant:+(p==="constant"||p==="source"),u_is_size_feature_constant:+(p==="constant"||p==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:G.cameraToCenterDistance,u_pitch:G.pitch/360*2*Math.PI,u_rotate_symbol:+s,u_aspect_ratio:G.width/G.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_matrix:b,u_label_plane_matrix:M,u_coord_matrix:I,u_is_text:+D,u_pitch_with_map:+l,u_is_along_line:u,u_is_variable_anchor:m,u_texsize:O,u_texture:0,u_translation:z,u_pitched_scale:V}},eu=(p,t,s,l,u,m,v,b,M,I,z,D,O,V,G)=>{const Q=v.transform;return d.e(qo(p,t,s,l,u,m,v,b,M,I,z,D,O,G),{u_gamma_scale:l?Math.cos(Q._pitch)*Q.cameraToCenterDistance:1,u_device_pixel_ratio:v.pixelRatio,u_is_halo:+V})},tu=(p,t,s,l,u,m,v,b,M,I,z,D,O,V)=>d.e(eu(p,t,s,l,u,m,v,b,M,I,z,!0,D,!0,V),{u_texsize_icon:O,u_texture_icon:1}),Ma=(p,t,s)=>({u_matrix:p,u_opacity:t,u_color:s}),gh=(p,t,s,l,u,m)=>d.e(function(v,b,M,I){const z=M.imageManager.getPattern(v.from.toString()),D=M.imageManager.getPattern(v.to.toString()),{width:O,height:V}=M.imageManager.getPixelSize(),G=Math.pow(2,I.tileID.overscaledZ),Q=I.tileSize*Math.pow(2,M.transform.tileZoom)/G,Z=Q*(I.tileID.canonical.x+I.tileID.wrap*G),ie=Q*I.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:z.tl,u_pattern_br_a:z.br,u_pattern_tl_b:D.tl,u_pattern_br_b:D.br,u_texsize:[O,V],u_mix:b.t,u_pattern_size_a:z.displaySize,u_pattern_size_b:D.displaySize,u_scale_a:b.fromScale,u_scale_b:b.toScale,u_tile_units_to_pixels:1/$t(I,1,M.transform.tileZoom),u_pixel_coord_upper:[Z>>16,ie>>16],u_pixel_coord_lower:[65535&Z,65535&ie]}}(l,m,s,u),{u_matrix:p,u_opacity:t}),Go={fillExtrusion:(p,t)=>({u_matrix:new d.aJ(p,t.u_matrix),u_lightpos:new d.aL(p,t.u_lightpos),u_lightintensity:new d.aI(p,t.u_lightintensity),u_lightcolor:new d.aL(p,t.u_lightcolor),u_vertical_gradient:new d.aI(p,t.u_vertical_gradient),u_opacity:new d.aI(p,t.u_opacity)}),fillExtrusionPattern:(p,t)=>({u_matrix:new d.aJ(p,t.u_matrix),u_lightpos:new d.aL(p,t.u_lightpos),u_lightintensity:new d.aI(p,t.u_lightintensity),u_lightcolor:new d.aL(p,t.u_lightcolor),u_vertical_gradient:new d.aI(p,t.u_vertical_gradient),u_height_factor:new d.aI(p,t.u_height_factor),u_image:new d.aH(p,t.u_image),u_texsize:new d.aM(p,t.u_texsize),u_pixel_coord_upper:new d.aM(p,t.u_pixel_coord_upper),u_pixel_coord_lower:new d.aM(p,t.u_pixel_coord_lower),u_scale:new d.aL(p,t.u_scale),u_fade:new d.aI(p,t.u_fade),u_opacity:new d.aI(p,t.u_opacity)}),fill:(p,t)=>({u_matrix:new d.aJ(p,t.u_matrix)}),fillPattern:(p,t)=>({u_matrix:new d.aJ(p,t.u_matrix),u_image:new d.aH(p,t.u_image),u_texsize:new d.aM(p,t.u_texsize),u_pixel_coord_upper:new d.aM(p,t.u_pixel_coord_upper),u_pixel_coord_lower:new d.aM(p,t.u_pixel_coord_lower),u_scale:new d.aL(p,t.u_scale),u_fade:new d.aI(p,t.u_fade)}),fillOutline:(p,t)=>({u_matrix:new d.aJ(p,t.u_matrix),u_world:new d.aM(p,t.u_world)}),fillOutlinePattern:(p,t)=>({u_matrix:new d.aJ(p,t.u_matrix),u_world:new d.aM(p,t.u_world),u_image:new d.aH(p,t.u_image),u_texsize:new d.aM(p,t.u_texsize),u_pixel_coord_upper:new d.aM(p,t.u_pixel_coord_upper),u_pixel_coord_lower:new d.aM(p,t.u_pixel_coord_lower),u_scale:new d.aL(p,t.u_scale),u_fade:new d.aI(p,t.u_fade)}),circle:(p,t)=>({u_camera_to_center_distance:new d.aI(p,t.u_camera_to_center_distance),u_scale_with_map:new d.aH(p,t.u_scale_with_map),u_pitch_with_map:new d.aH(p,t.u_pitch_with_map),u_extrude_scale:new d.aM(p,t.u_extrude_scale),u_device_pixel_ratio:new d.aI(p,t.u_device_pixel_ratio),u_matrix:new d.aJ(p,t.u_matrix)}),collisionBox:(p,t)=>({u_matrix:new d.aJ(p,t.u_matrix),u_pixel_extrude_scale:new d.aM(p,t.u_pixel_extrude_scale)}),collisionCircle:(p,t)=>({u_matrix:new d.aJ(p,t.u_matrix),u_inv_matrix:new d.aJ(p,t.u_inv_matrix),u_camera_to_center_distance:new d.aI(p,t.u_camera_to_center_distance),u_viewport_size:new d.aM(p,t.u_viewport_size)}),debug:(p,t)=>({u_color:new d.aN(p,t.u_color),u_matrix:new d.aJ(p,t.u_matrix),u_overlay:new d.aH(p,t.u_overlay),u_overlay_scale:new d.aI(p,t.u_overlay_scale)}),clippingMask:(p,t)=>({u_matrix:new d.aJ(p,t.u_matrix)}),heatmap:(p,t)=>({u_extrude_scale:new d.aI(p,t.u_extrude_scale),u_intensity:new d.aI(p,t.u_intensity),u_matrix:new d.aJ(p,t.u_matrix)}),heatmapTexture:(p,t)=>({u_matrix:new d.aJ(p,t.u_matrix),u_world:new d.aM(p,t.u_world),u_image:new d.aH(p,t.u_image),u_color_ramp:new d.aH(p,t.u_color_ramp),u_opacity:new d.aI(p,t.u_opacity)}),hillshade:(p,t)=>({u_matrix:new d.aJ(p,t.u_matrix),u_image:new d.aH(p,t.u_image),u_latrange:new d.aM(p,t.u_latrange),u_light:new d.aM(p,t.u_light),u_shadow:new d.aN(p,t.u_shadow),u_highlight:new d.aN(p,t.u_highlight),u_accent:new d.aN(p,t.u_accent)}),hillshadePrepare:(p,t)=>({u_matrix:new d.aJ(p,t.u_matrix),u_image:new d.aH(p,t.u_image),u_dimension:new d.aM(p,t.u_dimension),u_zoom:new d.aI(p,t.u_zoom),u_unpack:new d.aK(p,t.u_unpack)}),line:(p,t)=>({u_matrix:new d.aJ(p,t.u_matrix),u_ratio:new d.aI(p,t.u_ratio),u_device_pixel_ratio:new d.aI(p,t.u_device_pixel_ratio),u_units_to_pixels:new d.aM(p,t.u_units_to_pixels)}),lineGradient:(p,t)=>({u_matrix:new d.aJ(p,t.u_matrix),u_ratio:new d.aI(p,t.u_ratio),u_device_pixel_ratio:new d.aI(p,t.u_device_pixel_ratio),u_units_to_pixels:new d.aM(p,t.u_units_to_pixels),u_image:new d.aH(p,t.u_image),u_image_height:new d.aI(p,t.u_image_height)}),linePattern:(p,t)=>({u_matrix:new d.aJ(p,t.u_matrix),u_texsize:new d.aM(p,t.u_texsize),u_ratio:new d.aI(p,t.u_ratio),u_device_pixel_ratio:new d.aI(p,t.u_device_pixel_ratio),u_image:new d.aH(p,t.u_image),u_units_to_pixels:new d.aM(p,t.u_units_to_pixels),u_scale:new d.aL(p,t.u_scale),u_fade:new d.aI(p,t.u_fade)}),lineSDF:(p,t)=>({u_matrix:new d.aJ(p,t.u_matrix),u_ratio:new d.aI(p,t.u_ratio),u_device_pixel_ratio:new d.aI(p,t.u_device_pixel_ratio),u_units_to_pixels:new d.aM(p,t.u_units_to_pixels),u_patternscale_a:new d.aM(p,t.u_patternscale_a),u_patternscale_b:new d.aM(p,t.u_patternscale_b),u_sdfgamma:new d.aI(p,t.u_sdfgamma),u_image:new d.aH(p,t.u_image),u_tex_y_a:new d.aI(p,t.u_tex_y_a),u_tex_y_b:new d.aI(p,t.u_tex_y_b),u_mix:new d.aI(p,t.u_mix)}),raster:(p,t)=>({u_matrix:new d.aJ(p,t.u_matrix),u_tl_parent:new d.aM(p,t.u_tl_parent),u_scale_parent:new d.aI(p,t.u_scale_parent),u_buffer_scale:new d.aI(p,t.u_buffer_scale),u_fade_t:new d.aI(p,t.u_fade_t),u_opacity:new d.aI(p,t.u_opacity),u_image0:new d.aH(p,t.u_image0),u_image1:new d.aH(p,t.u_image1),u_brightness_low:new d.aI(p,t.u_brightness_low),u_brightness_high:new d.aI(p,t.u_brightness_high),u_saturation_factor:new d.aI(p,t.u_saturation_factor),u_contrast_factor:new d.aI(p,t.u_contrast_factor),u_spin_weights:new d.aL(p,t.u_spin_weights)}),symbolIcon:(p,t)=>({u_is_size_zoom_constant:new d.aH(p,t.u_is_size_zoom_constant),u_is_size_feature_constant:new d.aH(p,t.u_is_size_feature_constant),u_size_t:new d.aI(p,t.u_size_t),u_size:new d.aI(p,t.u_size),u_camera_to_center_distance:new d.aI(p,t.u_camera_to_center_distance),u_pitch:new d.aI(p,t.u_pitch),u_rotate_symbol:new d.aH(p,t.u_rotate_symbol),u_aspect_ratio:new d.aI(p,t.u_aspect_ratio),u_fade_change:new d.aI(p,t.u_fade_change),u_matrix:new d.aJ(p,t.u_matrix),u_label_plane_matrix:new d.aJ(p,t.u_label_plane_matrix),u_coord_matrix:new d.aJ(p,t.u_coord_matrix),u_is_text:new d.aH(p,t.u_is_text),u_pitch_with_map:new d.aH(p,t.u_pitch_with_map),u_is_along_line:new d.aH(p,t.u_is_along_line),u_is_variable_anchor:new d.aH(p,t.u_is_variable_anchor),u_texsize:new d.aM(p,t.u_texsize),u_texture:new d.aH(p,t.u_texture),u_translation:new d.aM(p,t.u_translation),u_pitched_scale:new d.aI(p,t.u_pitched_scale)}),symbolSDF:(p,t)=>({u_is_size_zoom_constant:new d.aH(p,t.u_is_size_zoom_constant),u_is_size_feature_constant:new d.aH(p,t.u_is_size_feature_constant),u_size_t:new d.aI(p,t.u_size_t),u_size:new d.aI(p,t.u_size),u_camera_to_center_distance:new d.aI(p,t.u_camera_to_center_distance),u_pitch:new d.aI(p,t.u_pitch),u_rotate_symbol:new d.aH(p,t.u_rotate_symbol),u_aspect_ratio:new d.aI(p,t.u_aspect_ratio),u_fade_change:new d.aI(p,t.u_fade_change),u_matrix:new d.aJ(p,t.u_matrix),u_label_plane_matrix:new d.aJ(p,t.u_label_plane_matrix),u_coord_matrix:new d.aJ(p,t.u_coord_matrix),u_is_text:new d.aH(p,t.u_is_text),u_pitch_with_map:new d.aH(p,t.u_pitch_with_map),u_is_along_line:new d.aH(p,t.u_is_along_line),u_is_variable_anchor:new d.aH(p,t.u_is_variable_anchor),u_texsize:new d.aM(p,t.u_texsize),u_texture:new d.aH(p,t.u_texture),u_gamma_scale:new d.aI(p,t.u_gamma_scale),u_device_pixel_ratio:new d.aI(p,t.u_device_pixel_ratio),u_is_halo:new d.aH(p,t.u_is_halo),u_translation:new d.aM(p,t.u_translation),u_pitched_scale:new d.aI(p,t.u_pitched_scale)}),symbolTextAndIcon:(p,t)=>({u_is_size_zoom_constant:new d.aH(p,t.u_is_size_zoom_constant),u_is_size_feature_constant:new d.aH(p,t.u_is_size_feature_constant),u_size_t:new d.aI(p,t.u_size_t),u_size:new d.aI(p,t.u_size),u_camera_to_center_distance:new d.aI(p,t.u_camera_to_center_distance),u_pitch:new d.aI(p,t.u_pitch),u_rotate_symbol:new d.aH(p,t.u_rotate_symbol),u_aspect_ratio:new d.aI(p,t.u_aspect_ratio),u_fade_change:new d.aI(p,t.u_fade_change),u_matrix:new d.aJ(p,t.u_matrix),u_label_plane_matrix:new d.aJ(p,t.u_label_plane_matrix),u_coord_matrix:new d.aJ(p,t.u_coord_matrix),u_is_text:new d.aH(p,t.u_is_text),u_pitch_with_map:new d.aH(p,t.u_pitch_with_map),u_is_along_line:new d.aH(p,t.u_is_along_line),u_is_variable_anchor:new d.aH(p,t.u_is_variable_anchor),u_texsize:new d.aM(p,t.u_texsize),u_texsize_icon:new d.aM(p,t.u_texsize_icon),u_texture:new d.aH(p,t.u_texture),u_texture_icon:new d.aH(p,t.u_texture_icon),u_gamma_scale:new d.aI(p,t.u_gamma_scale),u_device_pixel_ratio:new d.aI(p,t.u_device_pixel_ratio),u_is_halo:new d.aH(p,t.u_is_halo),u_translation:new d.aM(p,t.u_translation),u_pitched_scale:new d.aI(p,t.u_pitched_scale)}),background:(p,t)=>({u_matrix:new d.aJ(p,t.u_matrix),u_opacity:new d.aI(p,t.u_opacity),u_color:new d.aN(p,t.u_color)}),backgroundPattern:(p,t)=>({u_matrix:new d.aJ(p,t.u_matrix),u_opacity:new d.aI(p,t.u_opacity),u_image:new d.aH(p,t.u_image),u_pattern_tl_a:new d.aM(p,t.u_pattern_tl_a),u_pattern_br_a:new d.aM(p,t.u_pattern_br_a),u_pattern_tl_b:new d.aM(p,t.u_pattern_tl_b),u_pattern_br_b:new d.aM(p,t.u_pattern_br_b),u_texsize:new d.aM(p,t.u_texsize),u_mix:new d.aI(p,t.u_mix),u_pattern_size_a:new d.aM(p,t.u_pattern_size_a),u_pattern_size_b:new d.aM(p,t.u_pattern_size_b),u_scale_a:new d.aI(p,t.u_scale_a),u_scale_b:new d.aI(p,t.u_scale_b),u_pixel_coord_upper:new d.aM(p,t.u_pixel_coord_upper),u_pixel_coord_lower:new d.aM(p,t.u_pixel_coord_lower),u_tile_units_to_pixels:new d.aI(p,t.u_tile_units_to_pixels)}),terrain:(p,t)=>({u_matrix:new d.aJ(p,t.u_matrix),u_texture:new d.aH(p,t.u_texture),u_ele_delta:new d.aI(p,t.u_ele_delta)}),terrainDepth:(p,t)=>({u_matrix:new d.aJ(p,t.u_matrix),u_ele_delta:new d.aI(p,t.u_ele_delta)}),terrainCoords:(p,t)=>({u_matrix:new d.aJ(p,t.u_matrix),u_texture:new d.aH(p,t.u_texture),u_terrain_coords_id:new d.aI(p,t.u_terrain_coords_id),u_ele_delta:new d.aI(p,t.u_ele_delta)})};class sc{constructor(t,s,l){this.context=t;const u=t.gl;this.buffer=u.createBuffer(),this.dynamicDraw=!!l,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),u.bufferData(u.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?u.DYNAMIC_DRAW:u.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const s=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const ka={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class oo{constructor(t,s,l,u){this.length=s.length,this.attributes=l,this.itemSize=s.bytesPerElement,this.dynamicDraw=u,this.context=t;const m=t.gl;this.buffer=m.createBuffer(),t.bindVertexBuffer.set(this.buffer),m.bufferData(m.ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const s=this.context.gl;this.bind(),s.bufferSubData(s.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,s){for(let l=0;l<this.attributes.length;l++){const u=s.attributes[this.attributes[l].name];u!==void 0&&t.enableVertexAttribArray(u)}}setVertexAttribPointers(t,s,l){for(let u=0;u<this.attributes.length;u++){const m=this.attributes[u],v=s.attributes[m.name];v!==void 0&&t.vertexAttribPointer(v,m.components,t[ka[m.type]],!1,this.itemSize,m.offset+this.itemSize*(l||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ta=new WeakMap;function _n(p){var t;if(Ta.has(p))return Ta.get(p);{const s=(t=p.getParameter(p.VERSION))===null||t===void 0?void 0:t.startsWith("WebGL 2.0");return Ta.set(p,s),s}}class wr{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ac extends wr{getDefault(){return d.aP.transparent}set(t){const s=this.current;(t.r!==s.r||t.g!==s.g||t.b!==s.b||t.a!==s.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Ca extends wr{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Ia extends wr{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class _h extends wr{getDefault(){return[!0,!0,!0,!0]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Zo extends wr{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class yh extends wr{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Ea extends wr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const s=this.current;(t.func!==s.func||t.ref!==s.ref||t.mask!==s.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class vh extends wr{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class ru extends wr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.STENCIL_TEST):s.disable(s.STENCIL_TEST),this.current=t,this.dirty=!1}}class xh extends wr{getDefault(){return[0,1]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class oc extends wr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),this.current=t,this.dirty=!1}}class lc extends wr{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class iu extends wr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.BLEND):s.disable(s.BLEND),this.current=t,this.dirty=!1}}class nu extends wr{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class su extends wr{getDefault(){return d.aP.transparent}set(t){const s=this.current;(t.r!==s.r||t.g!==s.g||t.b!==s.b||t.a!==s.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class au extends wr{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class Js extends wr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE),this.current=t,this.dirty=!1}}class ou extends wr{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class bh extends wr{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class wh extends wr{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class lu extends wr{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class Pa extends wr{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Sh extends wr{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindFramebuffer(s.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class Ho extends wr{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindRenderbuffer(s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Mh extends wr{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindTexture(s.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class kh extends wr{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindBuffer(s.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class cc extends wr{getDefault(){return null}set(t){const s=this.gl;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class cu extends wr{getDefault(){return null}set(t){var s;if(t===this.current&&!this.dirty)return;const l=this.gl;_n(l)?l.bindVertexArray(t):(s=l.getExtension("OES_vertex_array_object"))===null||s===void 0||s.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class uu extends wr{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class uc extends wr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class hu extends wr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class Aa extends wr{constructor(t,s){super(t),this.context=t,this.parent=s}getDefault(){return null}}class ls extends Aa{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Wo extends Aa{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Da extends Aa{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class lo{constructor(t,s,l,u,m){this.context=t,this.width=s,this.height=l;const v=t.gl,b=this.framebuffer=v.createFramebuffer();if(this.colorAttachment=new ls(t,b),u)this.depthAttachment=m?new Da(t,b):new Wo(t,b);else if(m)throw new Error("Stencil cannot be set without depth");if(v.checkFramebufferStatus(v.FRAMEBUFFER)!==v.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const t=this.context.gl,s=this.colorAttachment.get();if(s&&t.deleteTexture(s),this.depthAttachment){const l=this.depthAttachment.get();l&&t.deleteRenderbuffer(l)}t.deleteFramebuffer(this.framebuffer)}}class ei{constructor(t,s,l){this.blendFunction=t,this.blendColor=s,this.mask=l}}ei.Replace=[1,0],ei.disabled=new ei(ei.Replace,d.aP.transparent,[!1,!1,!1,!1]),ei.unblended=new ei(ei.Replace,d.aP.transparent,[!0,!0,!0,!0]),ei.alphaBlended=new ei([1,771],d.aP.transparent,[!0,!0,!0,!0]);class hc{constructor(t){var s,l;if(this.gl=t,this.clearColor=new ac(this),this.clearDepth=new Ca(this),this.clearStencil=new Ia(this),this.colorMask=new _h(this),this.depthMask=new Zo(this),this.stencilMask=new yh(this),this.stencilFunc=new Ea(this),this.stencilOp=new vh(this),this.stencilTest=new ru(this),this.depthRange=new xh(this),this.depthTest=new oc(this),this.depthFunc=new lc(this),this.blend=new iu(this),this.blendFunc=new nu(this),this.blendColor=new su(this),this.blendEquation=new au(this),this.cullFace=new Js(this),this.cullFaceSide=new ou(this),this.frontFace=new bh(this),this.program=new wh(this),this.activeTexture=new lu(this),this.viewport=new Pa(this),this.bindFramebuffer=new Sh(this),this.bindRenderbuffer=new Ho(this),this.bindTexture=new Mh(this),this.bindVertexBuffer=new kh(this),this.bindElementBuffer=new cc(this),this.bindVertexArray=new cu(this),this.pixelStoreUnpack=new uu(this),this.pixelStoreUnpackPremultiplyAlpha=new uc(this),this.pixelStoreUnpackFlipY=new hu(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),_n(t)){this.HALF_FLOAT=t.HALF_FLOAT;const u=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(s=t.RGBA16F)!==null&&s!==void 0?s:u==null?void 0:u.RGBA16F_EXT,this.RGB16F=(l=t.RGB16F)!==null&&l!==void 0?l:u==null?void 0:u.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const u=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=u==null?void 0:u.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,s){return new sc(this,t,s)}createVertexBuffer(t,s,l){return new oo(this,t,s,l)}createRenderbuffer(t,s,l){const u=this.gl,m=u.createRenderbuffer();return this.bindRenderbuffer.set(m),u.renderbufferStorage(u.RENDERBUFFER,t,s,l),this.bindRenderbuffer.set(null),m}createFramebuffer(t,s,l,u){return new lo(this,t,s,l,u)}clear({color:t,depth:s,stencil:l}){const u=this.gl;let m=0;t&&(m|=u.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),s!==void 0&&(m|=u.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(s),this.depthMask.set(!0)),l!==void 0&&(m|=u.STENCIL_BUFFER_BIT,this.clearStencil.set(l),this.stencilMask.set(255)),u.clear(m)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){d.aE(t.blendFunction,ei.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return _n(this.gl)?this.gl.createVertexArray():(t=this.gl.getExtension("OES_vertex_array_object"))===null||t===void 0?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var s;return _n(this.gl)?this.gl.deleteVertexArray(t):(s=this.gl.getExtension("OES_vertex_array_object"))===null||s===void 0?void 0:s.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}class Wt{constructor(t,s,l){this.func=t,this.mask=s,this.range=l}}Wt.ReadOnly=!1,Wt.ReadWrite=!0,Wt.disabled=new Wt(519,Wt.ReadOnly,[0,1]);const co=7680;class qr{constructor(t,s,l,u,m,v){this.test=t,this.ref=s,this.mask=l,this.fail=u,this.depthFail=m,this.pass=v}}qr.disabled=new qr({func:519,mask:0},0,0,co,co,co);class Gr{constructor(t,s,l){this.enable=t,this.mode=s,this.frontFace=l}}let Cs;function du(p,t,s,l,u){const m=p.context,v=m.gl,b=p.useProgram("collisionBox"),M=[];let I=0,z=0;for(let ie=0;ie<l.length;ie++){const pe=l[ie],J=t.getTile(pe).getBucket(s);if(!J)continue;const ge=u?J.textCollisionBox:J.iconCollisionBox,Se=J.collisionCircleArray;if(Se.length>0){const Te=d.F();d.aQ(Te,J.placementInvProjMatrix,p.transform.glCoordMatrix),d.aQ(Te,Te,J.placementViewportMatrix),M.push({circleArray:Se,circleOffset:z,transform:pe.posMatrix,invTransform:Te,coord:pe}),I+=Se.length/4,z=I}ge&&b.draw(m,v.LINES,Wt.disabled,qr.disabled,p.colorModeForRenderPass(),Gr.disabled,{u_matrix:pe.posMatrix,u_pixel_extrude_scale:[1/(D=p.transform).width,1/D.height]},p.style.map.terrain&&p.style.map.terrain.getTerrainData(pe),s.id,ge.layoutVertexBuffer,ge.indexBuffer,ge.segments,null,p.transform.zoom,null,null,ge.collisionVertexBuffer)}var D;if(!u||!M.length)return;const O=p.useProgram("collisionCircle"),V=new d.aR;V.resize(4*I),V._trim();let G=0;for(const ie of M)for(let pe=0;pe<ie.circleArray.length/4;pe++){const J=4*pe,ge=ie.circleArray[J+0],Se=ie.circleArray[J+1],Te=ie.circleArray[J+2],Le=ie.circleArray[J+3];V.emplace(G++,ge,Se,Te,Le,0),V.emplace(G++,ge,Se,Te,Le,1),V.emplace(G++,ge,Se,Te,Le,2),V.emplace(G++,ge,Se,Te,Le,3)}(!Cs||Cs.length<2*I)&&(Cs=function(ie){const pe=2*ie,J=new d.aT;J.resize(pe),J._trim();for(let ge=0;ge<pe;ge++){const Se=6*ge;J.uint16[Se+0]=4*ge+0,J.uint16[Se+1]=4*ge+1,J.uint16[Se+2]=4*ge+2,J.uint16[Se+3]=4*ge+2,J.uint16[Se+4]=4*ge+3,J.uint16[Se+5]=4*ge+0}return J}(I));const Q=m.createIndexBuffer(Cs,!0),Z=m.createVertexBuffer(V,d.aS.members,!0);for(const ie of M){const pe=mh(ie.transform,ie.invTransform,p.transform);O.draw(m,v.TRIANGLES,Wt.disabled,qr.disabled,p.colorModeForRenderPass(),Gr.disabled,pe,p.style.map.terrain&&p.style.map.terrain.getTerrainData(ie.coord),s.id,Z,Q,d.$.simpleSegment(0,2*ie.circleOffset,ie.circleArray.length,ie.circleArray.length/2),null,p.transform.zoom,null,null,null)}Z.destroy(),Q.destroy()}Gr.disabled=new Gr(!1,1029,2305),Gr.backCCW=new Gr(!0,1029,2305);const dc=d.an(new Float32Array(16));function Th(p,t,s,l,u,m){const{horizontalAlign:v,verticalAlign:b}=d.au(p);return new d.P((-(v-.5)*t/u+l[0])*m,(-(b-.5)*s/u+l[1])*m)}function pu(p,t,s,l,u,m){const v=t.tileAnchorPoint.add(new d.P(t.translation[0],t.translation[1]));if(t.pitchWithMap){let b=l.mult(m);return s||(b=b.rotate(-u)),Si(v.add(b),t.labelPlaneMatrix,t.getElevation).point}if(s){const b=se(t.tileAnchorPoint.x+1,t.tileAnchorPoint.y,t).point.sub(p),M=Math.atan(b.y/b.x)+(b.x<0?Math.PI:0);return p.add(l.rotate(M))}return p.add(l)}function Xo(p,t,s,l,u,m,v,b,M,I,z,D,O,V){const G=p.text.placedSymbolArray,Q=p.text.dynamicLayoutVertexArray,Z=p.icon.dynamicLayoutVertexArray,ie={};Q.clear();for(let pe=0;pe<G.length;pe++){const J=G.get(pe),ge=J.hidden||!J.crossTileID||p.allowVerticalPlacement&&!J.placedOrientation?null:l[J.crossTileID];if(ge){const Se=new d.P(J.anchorX,J.anchorY),Te={getElevation:V,width:u.width,height:u.height,labelPlaneMatrix:m,lineVertexArray:null,pitchWithMap:s,projection:z,projectionCache:null,tileAnchorPoint:Se,translation:D,unwrappedTileID:O},Le=s?Si(Se,v,V):se(Se.x,Se.y,Te),Ue=X(u.cameraToCenterDistance,Le.signedDistanceFromCamera);let st=d.ai(p.textSizeData,M,J)*Ue/d.ap;s&&(st*=p.tilePixelRatio/b);const{width:pt,height:Ke,anchor:tt,textOffset:vt,textBoxScale:jt}=ge,nt=Th(tt,pt,Ke,vt,jt,st),lt=z.getPitchedTextCorrection(u,Se.add(new d.P(D[0],D[1])),O),Bt=pu(Le.point,Te,t,nt,u.angle,lt),jr=p.allowVerticalPlacement&&J.placedOrientation===d.ah.vertical?Math.PI/2:0;for(let Gt=0;Gt<J.numGlyphs;Gt++)d.aj(Q,Bt,jr);I&&J.associatedIconIndex>=0&&(ie[J.associatedIconIndex]={shiftedAnchor:Bt,angle:jr})}else Dt(J.numGlyphs,Q)}if(I){Z.clear();const pe=p.icon.placedSymbolArray;for(let J=0;J<pe.length;J++){const ge=pe.get(J);if(ge.hidden)Dt(ge.numGlyphs,Z);else{const Se=ie[J];if(Se)for(let Te=0;Te<ge.numGlyphs;Te++)d.aj(Z,Se.shiftedAnchor,Se.angle);else Dt(ge.numGlyphs,Z)}}p.icon.dynamicLayoutVertexBuffer.updateData(Z)}p.text.dynamicLayoutVertexBuffer.updateData(Q)}function Ko(p,t,s){return s.iconsInText&&t?"symbolTextAndIcon":p?"symbolSDF":"symbolIcon"}function uo(p,t,s,l,u,m,v,b,M,I,z,D){const O=p.context,V=O.gl,G=p.transform,Q=Oi(),Z=b==="map",ie=M==="map",pe=b!=="viewport"&&s.layout.get("symbol-placement")!=="point",J=Z&&!ie&&!pe,ge=!ie&&pe,Se=!s.layout.get("symbol-sort-key").isConstant();let Te=!1;const Le=p.depthModeForSublayer(0,Wt.ReadOnly),Ue=s._unevaluatedLayout.hasValue("text-variable-anchor")||s._unevaluatedLayout.hasValue("text-variable-anchor-offset"),st=[],pt=Q.getCircleRadiusCorrection(G);for(const Ke of l){const tt=t.getTile(Ke),vt=tt.getBucket(s);if(!vt)continue;const jt=u?vt.text:vt.icon;if(!jt||!jt.segments.get().length||!jt.hasVisibleVertices)continue;const nt=jt.programConfigurations.get(s.id),lt=u||vt.sdfIcons,Bt=u?vt.textSizeData:vt.iconSizeData,jr=ie||G.pitch!==0,Gt=p.useProgram(Ko(lt,u,vt),nt),ar=d.ag(Bt,G.zoom),Vr=p.style.map.terrain&&p.style.map.terrain.getTerrainData(Ke);let ji,Bn,Ur,Ji,Yi=[0,0],Vi=null;if(u)Bn=tt.glyphAtlasTexture,Ur=V.LINEAR,ji=tt.glyphAtlasTexture.size,vt.iconsInText&&(Yi=tt.imageAtlasTexture.size,Vi=tt.imageAtlasTexture,Ji=jr||p.options.rotating||p.options.zooming||Bt.kind==="composite"||Bt.kind==="camera"?V.LINEAR:V.NEAREST);else{const Sr=s.layout.get("icon-size").constantOr(0)!==1||vt.iconsNeedLinear;Bn=tt.imageAtlasTexture,Ur=lt||p.options.rotating||p.options.zooming||Sr||jr?V.LINEAR:V.NEAREST,ji=tt.imageAtlasTexture.size}const Ui=$t(tt,1,p.transform.zoom),On=ge?Ke.posMatrix:dc,ia=ss(On,ie,Z,p.transform,Ui),_l=as(On,ie,Z,p.transform,Ui),Bs=as(Ke.posMatrix,ie,Z,p.transform,Ui),Os=Q.translatePosition(p.transform,tt,m,v),yl=Ue&&vt.hasTextData(),Ec=s.layout.get("icon-text-fit")!=="none"&&yl&&vt.hasIconData();if(pe){const Sr=p.style.map.terrain?(Pc,yi)=>p.style.map.terrain.getElevation(Ke,Pc,yi):null,Hr=s.layout.get("text-rotation-alignment")==="map";B(vt,Ke.posMatrix,p,u,ia,Bs,ie,I,Hr,Q,Ke.toUnwrapped(),G.width,G.height,Os,Sr)}const Ai=Ke.posMatrix,Pn=u&&Ue||Ec,ps=pe||Pn?dc:ia,na=_l,Di=lt&&s.paint.get(u?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let qi;qi=lt?vt.iconsInText?tu(Bt.kind,ar,J,ie,pe,Pn,p,Ai,ps,na,Os,ji,Yi,pt):eu(Bt.kind,ar,J,ie,pe,Pn,p,Ai,ps,na,Os,u,ji,!0,pt):qo(Bt.kind,ar,J,ie,pe,Pn,p,Ai,ps,na,Os,u,ji,pt);const _i={program:Gt,buffers:jt,uniformValues:qi,atlasTexture:Bn,atlasTextureIcon:Vi,atlasInterpolation:Ur,atlasInterpolationIcon:Ji,isSDF:lt,hasHalo:Di};if(Se&&vt.canOverlap){Te=!0;const Sr=jt.segments.get();for(const Hr of Sr)st.push({segments:new d.$([Hr]),sortKey:Hr.sortKey,state:_i,terrainData:Vr})}else st.push({segments:jt.segments,sortKey:0,state:_i,terrainData:Vr})}Te&&st.sort((Ke,tt)=>Ke.sortKey-tt.sortKey);for(const Ke of st){const tt=Ke.state;if(O.activeTexture.set(V.TEXTURE0),tt.atlasTexture.bind(tt.atlasInterpolation,V.CLAMP_TO_EDGE),tt.atlasTextureIcon&&(O.activeTexture.set(V.TEXTURE1),tt.atlasTextureIcon&&tt.atlasTextureIcon.bind(tt.atlasInterpolationIcon,V.CLAMP_TO_EDGE)),tt.isSDF){const vt=tt.uniformValues;tt.hasHalo&&(vt.u_is_halo=1,Jo(tt.buffers,Ke.segments,s,p,tt.program,Le,z,D,vt,Ke.terrainData)),vt.u_is_halo=0}Jo(tt.buffers,Ke.segments,s,p,tt.program,Le,z,D,tt.uniformValues,Ke.terrainData)}}function Jo(p,t,s,l,u,m,v,b,M,I){const z=l.context;u.draw(z,z.gl.TRIANGLES,m,v,b,Gr.disabled,M,I,s.id,p.layoutVertexBuffer,p.indexBuffer,t,s.paint,l.transform.zoom,p.programConfigurations.get(s.id),p.dynamicLayoutVertexBuffer,p.opacityVertexBuffer)}function Is(p,t,s,l,u){if(!s||!l||!l.imageAtlas)return;const m=l.imageAtlas.patternPositions;let v=m[s.to.toString()],b=m[s.from.toString()];if(!v&&b&&(v=b),!b&&v&&(b=v),!v||!b){const M=u.getPaintProperty(t);v=m[M],b=m[M]}v&&b&&p.setConstantPatternPositions(v,b)}function Es(p,t,s,l,u,m,v){const b=p.context.gl,M="fill-pattern",I=s.paint.get(M),z=I&&I.constantOr(1),D=s.getCrossfadeParameters();let O,V,G,Q,Z;v?(V=z&&!s.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",O=b.LINES):(V=z?"fillPattern":"fill",O=b.TRIANGLES);const ie=I.constantOr(null);for(const pe of l){const J=t.getTile(pe);if(z&&!J.patternsLoaded())continue;const ge=J.getBucket(s);if(!ge)continue;const Se=ge.programConfigurations.get(s.id),Te=p.useProgram(V,Se),Le=p.style.map.terrain&&p.style.map.terrain.getTerrainData(pe);z&&(p.context.activeTexture.set(b.TEXTURE0),J.imageAtlasTexture.bind(b.LINEAR,b.CLAMP_TO_EDGE),Se.updatePaintBuffers(D)),Is(Se,M,ie,J,s);const Ue=Le?pe:null,st=p.translatePosMatrix(Ue?Ue.posMatrix:pe.posMatrix,J,s.paint.get("fill-translate"),s.paint.get("fill-translate-anchor"));if(v){Q=ge.indexBuffer2,Z=ge.segments2;const pt=[b.drawingBufferWidth,b.drawingBufferHeight];G=V==="fillOutlinePattern"&&z?so(st,p,D,J,pt):Vo(st,pt)}else Q=ge.indexBuffer,Z=ge.segments,G=z?no(st,p,D,J):jo(st);Te.draw(p.context,O,u,p.stencilModeForClipping(pe),m,Gr.disabled,G,Le,s.id,ge.layoutVertexBuffer,Q,Z,s.paint,p.transform.zoom,Se)}}function Ki(p,t,s,l,u,m,v){const b=p.context,M=b.gl,I="fill-extrusion-pattern",z=s.paint.get(I),D=z.constantOr(1),O=s.getCrossfadeParameters(),V=s.paint.get("fill-extrusion-opacity"),G=z.constantOr(null);for(const Q of l){const Z=t.getTile(Q),ie=Z.getBucket(s);if(!ie)continue;const pe=p.style.map.terrain&&p.style.map.terrain.getTerrainData(Q),J=ie.programConfigurations.get(s.id),ge=p.useProgram(D?"fillExtrusionPattern":"fillExtrusion",J);D&&(p.context.activeTexture.set(M.TEXTURE0),Z.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),J.updatePaintBuffers(O)),Is(J,I,G,Z,s);const Se=p.translatePosMatrix(Q.posMatrix,Z,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),Te=s.paint.get("fill-extrusion-vertical-gradient"),Le=D?tc(Se,p,Te,V,Q,O,Z):io(Se,p,Te,V);ge.draw(b,b.gl.TRIANGLES,u,m,v,Gr.backCCW,Le,pe,s.id,ie.layoutVertexBuffer,ie.indexBuffer,ie.segments,s.paint,p.transform.zoom,J,p.style.map.terrain&&ie.centroidVertexBuffer)}}function fu(p,t,s,l,u,m,v){const b=p.context,M=b.gl,I=s.fbo;if(!I)return;const z=p.useProgram("hillshade"),D=p.style.map.terrain&&p.style.map.terrain.getTerrainData(t);b.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,I.colorAttachment.get()),z.draw(b,M.TRIANGLES,u,m,v,Gr.disabled,((O,V,G,Q)=>{const Z=G.paint.get("hillshade-shadow-color"),ie=G.paint.get("hillshade-highlight-color"),pe=G.paint.get("hillshade-accent-color");let J=G.paint.get("hillshade-illumination-direction")*(Math.PI/180);G.paint.get("hillshade-illumination-anchor")==="viewport"&&(J-=O.transform.angle);const ge=!O.options.moving;return{u_matrix:Q?Q.posMatrix:O.transform.calculatePosMatrix(V.tileID.toUnwrapped(),ge),u_image:0,u_latrange:ao(0,V.tileID),u_light:[G.paint.get("hillshade-exaggeration"),J],u_shadow:Z,u_highlight:ie,u_accent:pe}})(p,s,l,D?t:null),D,l.id,p.rasterBoundsBuffer,p.quadTriangleIndexBuffer,p.rasterBoundsSegments)}function mu(p,t,s,l,u,m){const v=p.context,b=v.gl,M=t.dem;if(M&&M.data){const I=M.dim,z=M.stride,D=M.getPixels();if(v.activeTexture.set(b.TEXTURE1),v.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||p.getTileTexture(z),t.demTexture){const V=t.demTexture;V.update(D,{premultiply:!1}),V.bind(b.NEAREST,b.CLAMP_TO_EDGE)}else t.demTexture=new qe(v,D,b.RGBA,{premultiply:!1}),t.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE);v.activeTexture.set(b.TEXTURE0);let O=t.fbo;if(!O){const V=new qe(v,{width:I,height:I,data:null},b.RGBA);V.bind(b.LINEAR,b.CLAMP_TO_EDGE),O=t.fbo=v.createFramebuffer(I,I,!0,!1),O.colorAttachment.set(V.texture)}v.bindFramebuffer.set(O.framebuffer),v.viewport.set([0,0,I,I]),p.useProgram("hillshadePrepare").draw(v,b.TRIANGLES,l,u,m,Gr.disabled,((V,G)=>{const Q=G.stride,Z=d.F();return d.aO(Z,0,d.W,-d.W,0,0,1),d.H(Z,Z,[0,-d.W,0]),{u_matrix:Z,u_image:1,u_dimension:[Q,Q],u_zoom:V.overscaledZ,u_unpack:G.getUnpackVector()}})(t.tileID,M),null,s.id,p.rasterBoundsBuffer,p.quadTriangleIndexBuffer,p.rasterBoundsSegments),t.needsHillshadePrepare=!1}}function pc(p,t,s,l,u,m){const v=l.paint.get("raster-fade-duration");if(!m&&v>0){const b=le.now(),M=(b-p.timeAdded)/v,I=t?(b-t.timeAdded)/v:-1,z=s.getSource(),D=u.coveringZoomLevel({tileSize:z.tileSize,roundZoom:z.roundZoom}),O=!t||Math.abs(t.tileID.overscaledZ-D)>Math.abs(p.tileID.overscaledZ-D),V=O&&p.refreshedUponExpiration?1:d.ac(O?M:1-I,0,1);return p.refreshedUponExpiration&&M>=1&&(p.refreshedUponExpiration=!1),t?{opacity:1,mix:1-V}:{opacity:V,mix:0}}return{opacity:1,mix:0}}const cs=new d.aP(1,0,0,1),ho=new d.aP(0,1,0,1),po=new d.aP(0,0,1,1),za=new d.aP(1,0,1,1),fo=new d.aP(0,1,1,1);function La(p,t,s,l){Xn(p,0,t+s/2,p.transform.width,s,l)}function Ys(p,t,s,l){Xn(p,t-s/2,0,s,p.transform.height,l)}function Xn(p,t,s,l,u,m){const v=p.context,b=v.gl;b.enable(b.SCISSOR_TEST),b.scissor(t*p.pixelRatio,s*p.pixelRatio,l*p.pixelRatio,u*p.pixelRatio),v.clear({color:m}),b.disable(b.SCISSOR_TEST)}function gu(p,t,s){const l=p.context,u=l.gl,m=s.posMatrix,v=p.useProgram("debug"),b=Wt.disabled,M=qr.disabled,I=p.colorModeForRenderPass(),z="$debug",D=p.style.map.terrain&&p.style.map.terrain.getTerrainData(s);l.activeTexture.set(u.TEXTURE0);const O=t.getTileByID(s.key).latestRawTileData,V=Math.floor((O&&O.byteLength||0)/1024),G=t.getTile(s).tileSize,Q=512/Math.min(G,512)*(s.overscaledZ/p.transform.zoom)*.5;let Z=s.canonical.toString();s.overscaledZ!==s.canonical.z&&(Z+=` => ${s.overscaledZ}`),function(ie,pe){ie.initDebugOverlayCanvas();const J=ie.debugOverlayCanvas,ge=ie.context.gl,Se=ie.debugOverlayCanvas.getContext("2d");Se.clearRect(0,0,J.width,J.height),Se.shadowColor="white",Se.shadowBlur=2,Se.lineWidth=1.5,Se.strokeStyle="white",Se.textBaseline="top",Se.font="bold 36px Open Sans, sans-serif",Se.fillText(pe,5,5),Se.strokeText(pe,5,5),ie.debugOverlayTexture.update(J),ie.debugOverlayTexture.bind(ge.LINEAR,ge.CLAMP_TO_EDGE)}(p,`${Z} ${V}kB`),v.draw(l,u.TRIANGLES,b,M,ei.alphaBlended,Gr.disabled,rc(m,d.aP.transparent,Q),null,z,p.debugBuffer,p.quadTriangleIndexBuffer,p.debugSegments),v.draw(l,u.LINE_STRIP,b,M,I,Gr.disabled,rc(m,d.aP.red),D,z,p.debugBuffer,p.tileBorderIndexBuffer,p.debugSegments)}function Yo(p,t,s){const l=p.context,u=l.gl,m=p.colorModeForRenderPass(),v=new Wt(u.LEQUAL,Wt.ReadWrite,p.depthRangeFor3D),b=p.useProgram("terrain"),M=t.getTerrainMesh();l.bindFramebuffer.set(null),l.viewport.set([0,0,p.width,p.height]);for(const I of s){const z=p.renderToTexture.getTexture(I),D=t.getTerrainData(I.tileID);l.activeTexture.set(u.TEXTURE0),u.bindTexture(u.TEXTURE_2D,z.texture);const O={u_matrix:p.transform.calculatePosMatrix(I.tileID.toUnwrapped()),u_texture:0,u_ele_delta:t.getMeshFrameDelta(p.transform.zoom)};b.draw(l,u.TRIANGLES,v,qr.disabled,m,Gr.backCCW,O,D,"terrain",M.vertexBuffer,M.indexBuffer,M.segments)}}class yr{constructor(t,s){this.context=new hc(t),this.transform=s,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:d.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Xe.maxUnderzooming+Xe.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ri}resize(t,s,l){if(this.width=Math.floor(t*l),this.height=Math.floor(s*l),this.pixelRatio=l,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const u of this.style._order)this.style._layers[u].resize()}setup(){const t=this.context,s=new d.aW;s.emplaceBack(0,0),s.emplaceBack(d.W,0),s.emplaceBack(0,d.W),s.emplaceBack(d.W,d.W),this.tileExtentBuffer=t.createVertexBuffer(s,Wn.members),this.tileExtentSegments=d.$.simpleSegment(0,0,4,2);const l=new d.aW;l.emplaceBack(0,0),l.emplaceBack(d.W,0),l.emplaceBack(0,d.W),l.emplaceBack(d.W,d.W),this.debugBuffer=t.createVertexBuffer(l,Wn.members),this.debugSegments=d.$.simpleSegment(0,0,4,5);const u=new d.Z;u.emplaceBack(0,0,0,0),u.emplaceBack(d.W,0,d.W,0),u.emplaceBack(0,d.W,0,d.W),u.emplaceBack(d.W,d.W,d.W,d.W),this.rasterBoundsBuffer=t.createVertexBuffer(u,fr.members),this.rasterBoundsSegments=d.$.simpleSegment(0,0,4,2);const m=new d.aW;m.emplaceBack(0,0),m.emplaceBack(1,0),m.emplaceBack(0,1),m.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(m,Wn.members),this.viewportSegments=d.$.simpleSegment(0,0,4,2);const v=new d.aX;v.emplaceBack(0),v.emplaceBack(1),v.emplaceBack(3),v.emplaceBack(2),v.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(v);const b=new d.aY;b.emplaceBack(0,1,2),b.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(b);const M=this.context.gl;this.stencilClearMode=new qr({func:M.ALWAYS,mask:0},0,255,M.ZERO,M.ZERO,M.ZERO)}clearStencil(){const t=this.context,s=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const l=d.F();d.aO(l,0,this.width,this.height,0,0,1),d.J(l,l,[s.drawingBufferWidth,s.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(t,s.TRIANGLES,Wt.disabled,this.stencilClearMode,ei.disabled,Gr.disabled,Qc(l),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,s){if(this.currentStencilSource===t.source||!t.isTileClipped()||!s||!s.length)return;this.currentStencilSource=t.source;const l=this.context,u=l.gl;this.nextStencilID+s.length>256&&this.clearStencil(),l.setColorMode(ei.disabled),l.setDepthMode(Wt.disabled);const m=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const v of s){const b=this._tileClippingMaskIDs[v.key]=this.nextStencilID++,M=this.style.map.terrain&&this.style.map.terrain.getTerrainData(v);m.draw(l,u.TRIANGLES,Wt.disabled,new qr({func:u.ALWAYS,mask:0},b,255,u.KEEP,u.KEEP,u.REPLACE),ei.disabled,Gr.disabled,Qc(v.posMatrix),M,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,s=this.context.gl;return new qr({func:s.NOTEQUAL,mask:255},t,255,s.KEEP,s.KEEP,s.REPLACE)}stencilModeForClipping(t){const s=this.context.gl;return new qr({func:s.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,s.KEEP,s.KEEP,s.REPLACE)}stencilConfigForOverlap(t){const s=this.context.gl,l=t.sort((v,b)=>b.overscaledZ-v.overscaledZ),u=l[l.length-1].overscaledZ,m=l[0].overscaledZ-u+1;if(m>1){this.currentStencilSource=void 0,this.nextStencilID+m>256&&this.clearStencil();const v={};for(let b=0;b<m;b++)v[b+u]=new qr({func:s.GEQUAL,mask:255},b+this.nextStencilID,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID+=m,[v,l]}return[{[u]:qr.disabled},l]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new ei([t.CONSTANT_COLOR,t.ONE],new d.aP(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?ei.unblended:ei.alphaBlended}depthModeForSublayer(t,s,l){if(!this.opaquePassEnabledForLayer())return Wt.disabled;const u=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Wt(l||this.context.gl.LEQUAL,s,[u,u])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,s){this.style=t,this.options=s,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(le.now()),this.imageManager.beginFrame();const l=this.style._order,u=this.style.sourceCaches,m={},v={},b={};for(const M in u){const I=u[M];I.used&&I.prepare(this.context),m[M]=I.getVisibleCoordinates(),v[M]=m[M].slice().reverse(),b[M]=I.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let M=0;M<l.length;M++)if(this.style._layers[l[M]].is3D()){this.opaquePassCutoff=M;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const M of l){const I=this.style._layers[M];if(!I.hasOffscreenPass()||I.isHidden(this.transform.zoom))continue;const z=v[I.source];(I.type==="custom"||z.length)&&this.renderLayer(this,u[I.source],I,z)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:s.showOverdrawInspector?d.aP.black:d.aP.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=s.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=l.length-1;this.currentLayer>=0;this.currentLayer--){const M=this.style._layers[l[this.currentLayer]],I=u[M.source],z=m[M.source];this._renderTileClippingMasks(M,z),this.renderLayer(this,I,M,z)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<l.length;this.currentLayer++){const M=this.style._layers[l[this.currentLayer]],I=u[M.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(M))continue;const z=(M.type==="symbol"?b:v)[M.source];this._renderTileClippingMasks(M,m[M.source]),this.renderLayer(this,I,M,z)}if(this.options.showTileBoundaries){const M=function(I,z){let D=null;const O=Object.values(I._layers).flatMap(Z=>Z.source&&!Z.isHidden(z)?[I.sourceCaches[Z.source]]:[]),V=O.filter(Z=>Z.getSource().type==="vector"),G=O.filter(Z=>Z.getSource().type!=="vector"),Q=Z=>{(!D||D.getSource().maxzoom<Z.getSource().maxzoom)&&(D=Z)};return V.forEach(Z=>Q(Z)),D||G.forEach(Z=>Q(Z)),D}(this.style,this.transform.zoom);M&&function(I,z,D){for(let O=0;O<D.length;O++)gu(I,z,D[O])}(this,M,M.getVisibleCoordinates())}this.options.showPadding&&function(M){const I=M.transform.padding;La(M,M.transform.height-(I.top||0),3,cs),La(M,I.bottom||0,3,ho),Ys(M,I.left||0,3,po),Ys(M,M.transform.width-(I.right||0),3,za);const z=M.transform.centerPoint;(function(D,O,V,G){Xn(D,O-1,V-10,2,20,G),Xn(D,O-10,V-1,20,2,G)})(M,z.x,M.transform.height-z.y,fo)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(t){if(!this.style||!this.style.map||!this.style.map.terrain)return;const s=this.terrainFacilitator.matrix,l=this.transform.projMatrix;let u=this.terrainFacilitator.dirty;u||(u=t?!d.aZ(s,l):!d.a_(s,l)),u||(u=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),u&&(d.a$(s,l),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(m,v){const b=m.context,M=b.gl,I=ei.unblended,z=new Wt(M.LEQUAL,Wt.ReadWrite,[0,1]),D=v.getTerrainMesh(),O=v.sourceCache.getRenderableTiles(),V=m.useProgram("terrainDepth");b.bindFramebuffer.set(v.getFramebuffer("depth").framebuffer),b.viewport.set([0,0,m.width/devicePixelRatio,m.height/devicePixelRatio]),b.clear({color:d.aP.transparent,depth:1});for(const G of O){const Q=v.getTerrainData(G.tileID),Z={u_matrix:m.transform.calculatePosMatrix(G.tileID.toUnwrapped()),u_ele_delta:v.getMeshFrameDelta(m.transform.zoom)};V.draw(b,M.TRIANGLES,z,qr.disabled,I,Gr.backCCW,Z,Q,"terrain",D.vertexBuffer,D.indexBuffer,D.segments)}b.bindFramebuffer.set(null),b.viewport.set([0,0,m.width,m.height])}(this,this.style.map.terrain),function(m,v){const b=m.context,M=b.gl,I=ei.unblended,z=new Wt(M.LEQUAL,Wt.ReadWrite,[0,1]),D=v.getTerrainMesh(),O=v.getCoordsTexture(),V=v.sourceCache.getRenderableTiles(),G=m.useProgram("terrainCoords");b.bindFramebuffer.set(v.getFramebuffer("coords").framebuffer),b.viewport.set([0,0,m.width/devicePixelRatio,m.height/devicePixelRatio]),b.clear({color:d.aP.transparent,depth:1}),v.coordsIndex=[];for(const Q of V){const Z=v.getTerrainData(Q.tileID);b.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,O.texture);const ie={u_matrix:m.transform.calculatePosMatrix(Q.tileID.toUnwrapped()),u_terrain_coords_id:(255-v.coordsIndex.length)/255,u_texture:0,u_ele_delta:v.getMeshFrameDelta(m.transform.zoom)};G.draw(b,M.TRIANGLES,z,qr.disabled,I,Gr.backCCW,ie,Z,"terrain",D.vertexBuffer,D.indexBuffer,D.segments),v.coordsIndex.push(Q.tileID.key)}b.bindFramebuffer.set(null),b.viewport.set([0,0,m.width,m.height])}(this,this.style.map.terrain))}renderLayer(t,s,l,u){if(!l.isHidden(this.transform.zoom)&&(l.type==="background"||l.type==="custom"||(u||[]).length))switch(this.id=l.id,l.type){case"symbol":(function(m,v,b,M,I){if(m.renderPass!=="translucent")return;const z=qr.disabled,D=m.colorModeForRenderPass();(b._unevaluatedLayout.hasValue("text-variable-anchor")||b._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(O,V,G,Q,Z,ie,pe,J,ge){const Se=V.transform,Te=Oi(),Le=Z==="map",Ue=ie==="map";for(const st of O){const pt=Q.getTile(st),Ke=pt.getBucket(G);if(!Ke||!Ke.text||!Ke.text.segments.get().length)continue;const tt=d.ag(Ke.textSizeData,Se.zoom),vt=$t(pt,1,V.transform.zoom),jt=ss(st.posMatrix,Ue,Le,V.transform,vt),nt=G.layout.get("icon-text-fit")!=="none"&&Ke.hasIconData();if(tt){const lt=Math.pow(2,Se.zoom-pt.tileID.overscaledZ),Bt=V.style.map.terrain?(Gt,ar)=>V.style.map.terrain.getElevation(st,Gt,ar):null,jr=Te.translatePosition(Se,pt,pe,J);Xo(Ke,Le,Ue,ge,Se,jt,st.posMatrix,lt,tt,nt,Te,jr,st.toUnwrapped(),Bt)}}}(M,m,b,v,b.layout.get("text-rotation-alignment"),b.layout.get("text-pitch-alignment"),b.paint.get("text-translate"),b.paint.get("text-translate-anchor"),I),b.paint.get("icon-opacity").constantOr(1)!==0&&uo(m,v,b,M,!1,b.paint.get("icon-translate"),b.paint.get("icon-translate-anchor"),b.layout.get("icon-rotation-alignment"),b.layout.get("icon-pitch-alignment"),b.layout.get("icon-keep-upright"),z,D),b.paint.get("text-opacity").constantOr(1)!==0&&uo(m,v,b,M,!0,b.paint.get("text-translate"),b.paint.get("text-translate-anchor"),b.layout.get("text-rotation-alignment"),b.layout.get("text-pitch-alignment"),b.layout.get("text-keep-upright"),z,D),v.map.showCollisionBoxes&&(du(m,v,b,M,!0),du(m,v,b,M,!1))})(t,s,l,u,this.style.placement.variableOffsets);break;case"circle":(function(m,v,b,M){if(m.renderPass!=="translucent")return;const I=b.paint.get("circle-opacity"),z=b.paint.get("circle-stroke-width"),D=b.paint.get("circle-stroke-opacity"),O=!b.layout.get("circle-sort-key").isConstant();if(I.constantOr(1)===0&&(z.constantOr(1)===0||D.constantOr(1)===0))return;const V=m.context,G=V.gl,Q=m.depthModeForSublayer(0,Wt.ReadOnly),Z=qr.disabled,ie=m.colorModeForRenderPass(),pe=[];for(let J=0;J<M.length;J++){const ge=M[J],Se=v.getTile(ge),Te=Se.getBucket(b);if(!Te)continue;const Le=Te.programConfigurations.get(b.id),Ue=m.useProgram("circle",Le),st=Te.layoutVertexBuffer,pt=Te.indexBuffer,Ke=m.style.map.terrain&&m.style.map.terrain.getTerrainData(ge),tt={programConfiguration:Le,program:Ue,layoutVertexBuffer:st,indexBuffer:pt,uniformValues:fh(m,ge,Se,b),terrainData:Ke};if(O){const vt=Te.segments.get();for(const jt of vt)pe.push({segments:new d.$([jt]),sortKey:jt.sortKey,state:tt})}else pe.push({segments:Te.segments,sortKey:0,state:tt})}O&&pe.sort((J,ge)=>J.sortKey-ge.sortKey);for(const J of pe){const{programConfiguration:ge,program:Se,layoutVertexBuffer:Te,indexBuffer:Le,uniformValues:Ue,terrainData:st}=J.state;Se.draw(V,G.TRIANGLES,Q,Z,ie,Gr.disabled,Ue,st,b.id,Te,Le,J.segments,b.paint,m.transform.zoom,ge)}})(t,s,l,u);break;case"heatmap":(function(m,v,b,M){if(b.paint.get("heatmap-opacity")!==0)if(m.renderPass==="offscreen"){const I=m.context,z=I.gl,D=qr.disabled,O=new ei([z.ONE,z.ONE],d.aP.transparent,[!0,!0,!0,!0]);(function(V,G,Q){const Z=V.gl;V.activeTexture.set(Z.TEXTURE1),V.viewport.set([0,0,G.width/4,G.height/4]);let ie=Q.heatmapFbo;if(ie)Z.bindTexture(Z.TEXTURE_2D,ie.colorAttachment.get()),V.bindFramebuffer.set(ie.framebuffer);else{const pe=Z.createTexture();Z.bindTexture(Z.TEXTURE_2D,pe),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_WRAP_S,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_WRAP_T,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_MIN_FILTER,Z.LINEAR),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_MAG_FILTER,Z.LINEAR),ie=Q.heatmapFbo=V.createFramebuffer(G.width/4,G.height/4,!1,!1),function(J,ge,Se,Te){var Le,Ue;const st=J.gl,pt=(Le=J.HALF_FLOAT)!==null&&Le!==void 0?Le:st.UNSIGNED_BYTE,Ke=(Ue=J.RGBA16F)!==null&&Ue!==void 0?Ue:st.RGBA;st.texImage2D(st.TEXTURE_2D,0,Ke,ge.width/4,ge.height/4,0,st.RGBA,pt,null),Te.colorAttachment.set(Se)}(V,G,pe,ie)}})(I,m,b),I.clear({color:d.aP.transparent});for(let V=0;V<M.length;V++){const G=M[V];if(v.hasRenderableParent(G))continue;const Q=v.getTile(G),Z=Q.getBucket(b);if(!Z)continue;const ie=Z.programConfigurations.get(b.id),pe=m.useProgram("heatmap",ie),{zoom:J}=m.transform;pe.draw(I,z.TRIANGLES,Wt.disabled,D,O,Gr.disabled,Ks(G.posMatrix,Q,J,b.paint.get("heatmap-intensity")),null,b.id,Z.layoutVertexBuffer,Z.indexBuffer,Z.segments,b.paint,m.transform.zoom,ie)}I.viewport.set([0,0,m.width,m.height])}else m.renderPass==="translucent"&&(m.context.setColorMode(m.colorModeForRenderPass()),function(I,z){const D=I.context,O=D.gl,V=z.heatmapFbo;if(!V)return;D.activeTexture.set(O.TEXTURE0),O.bindTexture(O.TEXTURE_2D,V.colorAttachment.get()),D.activeTexture.set(O.TEXTURE1);let G=z.colorRampTexture;G||(G=z.colorRampTexture=new qe(D,z.colorRamp,O.RGBA)),G.bind(O.LINEAR,O.CLAMP_TO_EDGE),I.useProgram("heatmapTexture").draw(D,O.TRIANGLES,Wt.disabled,qr.disabled,I.colorModeForRenderPass(),Gr.disabled,((Q,Z,ie,pe)=>{const J=d.F();d.aO(J,0,Q.width,Q.height,0,0,1);const ge=Q.context.gl;return{u_matrix:J,u_world:[ge.drawingBufferWidth,ge.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:Z.paint.get("heatmap-opacity")}})(I,z),null,z.id,I.viewportBuffer,I.quadTriangleIndexBuffer,I.viewportSegments,z.paint,I.transform.zoom)}(m,b))})(t,s,l,u);break;case"line":(function(m,v,b,M){if(m.renderPass!=="translucent")return;const I=b.paint.get("line-opacity"),z=b.paint.get("line-width");if(I.constantOr(1)===0||z.constantOr(1)===0)return;const D=m.depthModeForSublayer(0,Wt.ReadOnly),O=m.colorModeForRenderPass(),V=b.paint.get("line-dasharray"),G=b.paint.get("line-pattern"),Q=G.constantOr(1),Z=b.paint.get("line-gradient"),ie=b.getCrossfadeParameters(),pe=Q?"linePattern":V?"lineSDF":Z?"lineGradient":"line",J=m.context,ge=J.gl;let Se=!0;for(const Te of M){const Le=v.getTile(Te);if(Q&&!Le.patternsLoaded())continue;const Ue=Le.getBucket(b);if(!Ue)continue;const st=Ue.programConfigurations.get(b.id),pt=m.context.program.get(),Ke=m.useProgram(pe,st),tt=Se||Ke.program!==pt,vt=m.style.map.terrain&&m.style.map.terrain.getTerrainData(Te),jt=G.constantOr(null);if(jt&&Le.imageAtlas){const Bt=Le.imageAtlas,jr=Bt.patternPositions[jt.to.toString()],Gt=Bt.patternPositions[jt.from.toString()];jr&&Gt&&st.setConstantPatternPositions(jr,Gt)}const nt=vt?Te:null,lt=Q?wa(m,Le,b,ie,nt):V?os(m,Le,b,V,ie,nt):Z?gn(m,Le,b,Ue.lineClipsArray.length,nt):Ni(m,Le,b,nt);if(Q)J.activeTexture.set(ge.TEXTURE0),Le.imageAtlasTexture.bind(ge.LINEAR,ge.CLAMP_TO_EDGE),st.updatePaintBuffers(ie);else if(V&&(tt||m.lineAtlas.dirty))J.activeTexture.set(ge.TEXTURE0),m.lineAtlas.bind(J);else if(Z){const Bt=Ue.gradients[b.id];let jr=Bt.texture;if(b.gradientVersion!==Bt.version){let Gt=256;if(b.stepInterpolant){const ar=v.getSource().maxzoom,Vr=Te.canonical.z===ar?Math.ceil(1<<m.transform.maxZoom-Te.canonical.z):1;Gt=d.ac(d.aU(Ue.maxLineLength/d.W*1024*Vr),256,J.maxTextureSize)}Bt.gradient=d.aV({expression:b.gradientExpression(),evaluationKey:"lineProgress",resolution:Gt,image:Bt.gradient||void 0,clips:Ue.lineClipsArray}),Bt.texture?Bt.texture.update(Bt.gradient):Bt.texture=new qe(J,Bt.gradient,ge.RGBA),Bt.version=b.gradientVersion,jr=Bt.texture}J.activeTexture.set(ge.TEXTURE0),jr.bind(b.stepInterpolant?ge.NEAREST:ge.LINEAR,ge.CLAMP_TO_EDGE)}Ke.draw(J,ge.TRIANGLES,D,m.stencilModeForClipping(Te),O,Gr.disabled,lt,vt,b.id,Ue.layoutVertexBuffer,Ue.indexBuffer,Ue.segments,b.paint,m.transform.zoom,st,Ue.layoutVertexBuffer2),Se=!1}})(t,s,l,u);break;case"fill":(function(m,v,b,M){const I=b.paint.get("fill-color"),z=b.paint.get("fill-opacity");if(z.constantOr(1)===0)return;const D=m.colorModeForRenderPass(),O=b.paint.get("fill-pattern"),V=m.opaquePassEnabledForLayer()&&!O.constantOr(1)&&I.constantOr(d.aP.transparent).a===1&&z.constantOr(0)===1?"opaque":"translucent";if(m.renderPass===V){const G=m.depthModeForSublayer(1,m.renderPass==="opaque"?Wt.ReadWrite:Wt.ReadOnly);Es(m,v,b,M,G,D,!1)}if(m.renderPass==="translucent"&&b.paint.get("fill-antialias")){const G=m.depthModeForSublayer(b.getPaintProperty("fill-outline-color")?2:0,Wt.ReadOnly);Es(m,v,b,M,G,D,!0)}})(t,s,l,u);break;case"fill-extrusion":(function(m,v,b,M){const I=b.paint.get("fill-extrusion-opacity");if(I!==0&&m.renderPass==="translucent"){const z=new Wt(m.context.gl.LEQUAL,Wt.ReadWrite,m.depthRangeFor3D);if(I!==1||b.paint.get("fill-extrusion-pattern").constantOr(1))Ki(m,v,b,M,z,qr.disabled,ei.disabled),Ki(m,v,b,M,z,m.stencilModeFor3D(),m.colorModeForRenderPass());else{const D=m.colorModeForRenderPass();Ki(m,v,b,M,z,qr.disabled,D)}}})(t,s,l,u);break;case"hillshade":(function(m,v,b,M){if(m.renderPass!=="offscreen"&&m.renderPass!=="translucent")return;const I=m.context,z=m.depthModeForSublayer(0,Wt.ReadOnly),D=m.colorModeForRenderPass(),[O,V]=m.renderPass==="translucent"?m.stencilConfigForOverlap(M):[{},M];for(const G of V){const Q=v.getTile(G);Q.needsHillshadePrepare!==void 0&&Q.needsHillshadePrepare&&m.renderPass==="offscreen"?mu(m,Q,b,z,qr.disabled,D):m.renderPass==="translucent"&&fu(m,G,Q,b,z,O[G.overscaledZ],D)}I.viewport.set([0,0,m.width,m.height])})(t,s,l,u);break;case"raster":(function(m,v,b,M){if(m.renderPass!=="translucent"||b.paint.get("raster-opacity")===0||!M.length)return;const I=m.context,z=I.gl,D=v.getSource(),O=m.useProgram("raster"),V=m.colorModeForRenderPass(),[G,Q]=D instanceof Qr?[{},M]:m.stencilConfigForOverlap(M),Z=Q[Q.length-1].overscaledZ,ie=!m.options.moving;for(const pe of Q){const J=m.depthModeForSublayer(pe.overscaledZ-Z,b.paint.get("raster-opacity")===1?Wt.ReadWrite:Wt.ReadOnly,z.LESS),ge=v.getTile(pe);ge.registerFadeDuration(b.paint.get("raster-fade-duration"));const Se=v.findLoadedParent(pe,0),Te=v.findLoadedSibling(pe),Le=pc(ge,Se||Te||null,v,b,m.transform,m.style.map.terrain);let Ue,st;const pt=b.paint.get("raster-resampling")==="nearest"?z.NEAREST:z.LINEAR;I.activeTexture.set(z.TEXTURE0),ge.texture.bind(pt,z.CLAMP_TO_EDGE,z.LINEAR_MIPMAP_NEAREST),I.activeTexture.set(z.TEXTURE1),Se?(Se.texture.bind(pt,z.CLAMP_TO_EDGE,z.LINEAR_MIPMAP_NEAREST),Ue=Math.pow(2,Se.tileID.overscaledZ-ge.tileID.overscaledZ),st=[ge.tileID.canonical.x*Ue%1,ge.tileID.canonical.y*Ue%1]):ge.texture.bind(pt,z.CLAMP_TO_EDGE,z.LINEAR_MIPMAP_NEAREST);const Ke=m.style.map.terrain&&m.style.map.terrain.getTerrainData(pe),tt=Ke?pe:null,vt=tt?tt.posMatrix:m.transform.calculatePosMatrix(pe.toUnwrapped(),ie),jt=Sa(vt,st||[0,0],Ue||1,Le,b);D instanceof Qr?O.draw(I,z.TRIANGLES,J,qr.disabled,V,Gr.disabled,jt,Ke,b.id,D.boundsBuffer,m.quadTriangleIndexBuffer,D.boundsSegments):O.draw(I,z.TRIANGLES,J,G[pe.overscaledZ],V,Gr.disabled,jt,Ke,b.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments)}})(t,s,l,u);break;case"background":(function(m,v,b,M){const I=b.paint.get("background-color"),z=b.paint.get("background-opacity");if(z===0)return;const D=m.context,O=D.gl,V=m.transform,G=V.tileSize,Q=b.paint.get("background-pattern");if(m.isPatternMissing(Q))return;const Z=!Q&&I.a===1&&z===1&&m.opaquePassEnabledForLayer()?"opaque":"translucent";if(m.renderPass!==Z)return;const ie=qr.disabled,pe=m.depthModeForSublayer(0,Z==="opaque"?Wt.ReadWrite:Wt.ReadOnly),J=m.colorModeForRenderPass(),ge=m.useProgram(Q?"backgroundPattern":"background"),Se=M||V.coveringTiles({tileSize:G,terrain:m.style.map.terrain});Q&&(D.activeTexture.set(O.TEXTURE0),m.imageManager.bind(m.context));const Te=b.getCrossfadeParameters();for(const Le of Se){const Ue=M?Le.posMatrix:m.transform.calculatePosMatrix(Le.toUnwrapped()),st=Q?gh(Ue,z,m,Q,{tileID:Le,tileSize:G},Te):Ma(Ue,z,I),pt=m.style.map.terrain&&m.style.map.terrain.getTerrainData(Le);ge.draw(D,O.TRIANGLES,pe,ie,J,Gr.disabled,st,pt,b.id,m.tileExtentBuffer,m.quadTriangleIndexBuffer,m.tileExtentSegments)}})(t,0,l,u);break;case"custom":(function(m,v,b){const M=m.context,I=b.implementation;if(m.renderPass==="offscreen"){const z=I.prerender;z&&(m.setCustomLayerDefaults(),M.setColorMode(m.colorModeForRenderPass()),z.call(I,M.gl,m.transform.customLayerMatrix()),M.setDirty(),m.setBaseState())}else if(m.renderPass==="translucent"){m.setCustomLayerDefaults(),M.setColorMode(m.colorModeForRenderPass()),M.setStencilMode(qr.disabled);const z=I.renderingMode==="3d"?new Wt(m.context.gl.LEQUAL,Wt.ReadWrite,m.depthRangeFor3D):m.depthModeForSublayer(0,Wt.ReadOnly);M.setDepthMode(z),I.render(M.gl,m.transform.customLayerMatrix()),M.setDirty(),m.setBaseState(),M.bindFramebuffer.set(null)}})(t,0,l)}}translatePosMatrix(t,s,l,u,m){if(!l[0]&&!l[1])return t;const v=m?u==="map"?this.transform.angle:0:u==="viewport"?-this.transform.angle:0;if(v){const I=Math.sin(v),z=Math.cos(v);l=[l[0]*z-l[1]*I,l[0]*I+l[1]*z]}const b=[m?l[0]:$t(s,l[0],this.transform.zoom),m?l[1]:$t(s,l[1],this.transform.zoom),0],M=new Float32Array(16);return d.H(M,t,b),M}saveTileTexture(t){const s=this._tileTextures[t.size[0]];s?s.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const s=this._tileTextures[t];return s&&s.length>0?s.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const s=this.imageManager.getPattern(t.from.toString()),l=this.imageManager.getPattern(t.to.toString());return!s||!l}useProgram(t,s){this.cache=this.cache||{};const l=t+(s?s.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[l]||(this.cache[l]=new ec(this.context,ba[t],s,Go[t],this._showOverdrawInspector,this.style.map.terrain)),this.cache[l]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new qe(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:s}=this.context.gl;return this.width!==t||this.height!==s}}class Ra{constructor(t,s){this.points=t,this.planes=s}static fromInvProjectionMatrix(t,s,l){const u=Math.pow(2,l),m=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(b=>{const M=1/(b=d.af([],b,t))[3]/s*u;return d.b0(b,b,[M,M,1/b[3],M])}),v=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(b=>{const M=function(O,V){var G=V[0],Q=V[1],Z=V[2],ie=G*G+Q*Q+Z*Z;return ie>0&&(ie=1/Math.sqrt(ie)),O[0]=V[0]*ie,O[1]=V[1]*ie,O[2]=V[2]*ie,O}([],function(O,V,G){var Q=V[0],Z=V[1],ie=V[2],pe=G[0],J=G[1],ge=G[2];return O[0]=Z*ge-ie*J,O[1]=ie*pe-Q*ge,O[2]=Q*J-Z*pe,O}([],Ae([],m[b[0]],m[b[1]]),Ae([],m[b[2]],m[b[1]]))),I=-((z=M)[0]*(D=m[b[1]])[0]+z[1]*D[1]+z[2]*D[2]);var z,D;return M.concat(I)});return new Ra(m,v)}}class Qo{constructor(t,s){this.min=t,this.max=s,this.center=function(l,u,m){return l[0]=.5*u[0],l[1]=.5*u[1],l[2]=.5*u[2],l}([],function(l,u,m){return l[0]=u[0]+m[0],l[1]=u[1]+m[1],l[2]=u[2]+m[2],l}([],this.min,this.max))}quadrant(t){const s=[t%2==0,t<2],l=rt(this.min),u=rt(this.max);for(let m=0;m<s.length;m++)l[m]=s[m]?this.min[m]:this.center[m],u[m]=s[m]?this.center[m]:this.max[m];return u[2]=this.max[2],new Qo(l,u)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersects(t){const s=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let l=!0;for(let u=0;u<t.planes.length;u++){const m=t.planes[u];let v=0;for(let b=0;b<s.length;b++)d.b1(m,s[b])>=0&&v++;if(v===0)return 0;v!==s.length&&(l=!1)}if(l)return 2;for(let u=0;u<3;u++){let m=Number.MAX_VALUE,v=-Number.MAX_VALUE;for(let b=0;b<t.points.length;b++){const M=t.points[b][u]-this.min[u];m=Math.min(m,M),v=Math.max(v,M)}if(v<0||m>this.max[u]-this.min[u])return 0}return 1}}class Qs{constructor(t=0,s=0,l=0,u=0){if(isNaN(t)||t<0||isNaN(s)||s<0||isNaN(l)||l<0||isNaN(u)||u<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=s,this.left=l,this.right=u}interpolate(t,s,l){return s.top!=null&&t.top!=null&&(this.top=d.z.number(t.top,s.top,l)),s.bottom!=null&&t.bottom!=null&&(this.bottom=d.z.number(t.bottom,s.bottom,l)),s.left!=null&&t.left!=null&&(this.left=d.z.number(t.left,s.left,l)),s.right!=null&&t.right!=null&&(this.right=d.z.number(t.right,s.right,l)),this}getCenter(t,s){const l=d.ac((this.left+t-this.right)/2,0,t),u=d.ac((this.top+s-this.bottom)/2,0,s);return new d.P(l,u)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new Qs(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const us=85.051129;class mo{constructor(t,s,l,u,m){this.tileSize=512,this._renderWorldCopies=m===void 0||!!m,this._minZoom=t||0,this._maxZoom=s||22,this._minPitch=l??0,this._maxPitch=u??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new d.M(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Qs,this._posMatrixCache={},this._alignedPosMatrixCache={},this.minElevationForCurrentTile=0}clone(){const t=new mo(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.apply(this),t}apply(t){this.tileSize=t.tileSize,this.latRange=t.latRange,this.width=t.width,this.height=t.height,this._center=t._center,this._elevation=t._elevation,this.minElevationForCurrentTile=t.minElevationForCurrentTile,this.zoom=t.zoom,this.angle=t.angle,this._fov=t._fov,this._pitch=t._pitch,this._unmodified=t._unmodified,this._edgeInsets=t._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new d.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(t){const s=-d.b2(t,-180,180)*Math.PI/180;this.angle!==s&&(this._unmodified=!1,this.angle=s,this._calcMatrices(),this.rotationMatrix=function(){var l=new d.A(4);return d.A!=Float32Array&&(l[1]=0,l[2]=0),l[0]=1,l[3]=1,l}(),function(l,u,m){var v=u[0],b=u[1],M=u[2],I=u[3],z=Math.sin(m),D=Math.cos(m);l[0]=v*D+M*z,l[1]=b*D+I*z,l[2]=v*-z+M*D,l[3]=b*-z+I*D}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const s=d.ac(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==s&&(this._unmodified=!1,this._pitch=s,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(t){const s=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==s&&(this._unmodified=!1,this._zoom=s,this.tileZoom=Math.max(0,Math.floor(s)),this.scale=this.zoomScale(s),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(t){t!==this._elevation&&(this._elevation=t,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,s,l){this._unmodified=!1,this._edgeInsets.interpolate(t,s,l),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const s=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,s)}getVisibleUnwrappedCoordinates(t){const s=[new d.b3(0,t)];if(this._renderWorldCopies){const l=this.pointCoordinate(new d.P(0,0)),u=this.pointCoordinate(new d.P(this.width,0)),m=this.pointCoordinate(new d.P(this.width,this.height)),v=this.pointCoordinate(new d.P(0,this.height)),b=Math.floor(Math.min(l.x,u.x,m.x,v.x)),M=Math.floor(Math.max(l.x,u.x,m.x,v.x)),I=1;for(let z=b-I;z<=M+I;z++)z!==0&&s.push(new d.b3(z,t))}return s}coveringTiles(t){var s,l;let u=this.coveringZoomLevel(t);const m=u;if(t.minzoom!==void 0&&u<t.minzoom)return[];t.maxzoom!==void 0&&u>t.maxzoom&&(u=t.maxzoom);const v=this.pointCoordinate(this.getCameraPoint()),b=d.Y.fromLngLat(this.center),M=Math.pow(2,u),I=[M*v.x,M*v.y,0],z=[M*b.x,M*b.y,0],D=Ra.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,u);let O=t.minzoom||0;!t.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(O=u);const V=t.terrain?2/Math.min(this.tileSize,t.tileSize)*this.tileSize:3,G=J=>({aabb:new Qo([J*M,0,0],[(J+1)*M,M,0]),zoom:0,x:0,y:0,wrap:J,fullyVisible:!1}),Q=[],Z=[],ie=u,pe=t.reparseOverscaled?m:u;if(this._renderWorldCopies)for(let J=1;J<=3;J++)Q.push(G(-J)),Q.push(G(J));for(Q.push(G(0));Q.length>0;){const J=Q.pop(),ge=J.x,Se=J.y;let Te=J.fullyVisible;if(!Te){const Ke=J.aabb.intersects(D);if(Ke===0)continue;Te=Ke===2}const Le=t.terrain?I:z,Ue=J.aabb.distanceX(Le),st=J.aabb.distanceY(Le),pt=Math.max(Math.abs(Ue),Math.abs(st));if(J.zoom===ie||pt>V+(1<<ie-J.zoom)-2&&J.zoom>=O){const Ke=ie-J.zoom,tt=I[0]-.5-(ge<<Ke),vt=I[1]-.5-(Se<<Ke);Z.push({tileID:new d.Q(J.zoom===ie?pe:J.zoom,J.wrap,J.zoom,ge,Se),distanceSq:ee([z[0]-.5-ge,z[1]-.5-Se]),tileDistanceToCamera:Math.sqrt(tt*tt+vt*vt)})}else for(let Ke=0;Ke<4;Ke++){const tt=(ge<<1)+Ke%2,vt=(Se<<1)+(Ke>>1),jt=J.zoom+1;let nt=J.aabb.quadrant(Ke);if(t.terrain){const lt=new d.Q(jt,J.wrap,jt,tt,vt),Bt=t.terrain.getMinMaxElevation(lt),jr=(s=Bt.minElevation)!==null&&s!==void 0?s:this.elevation,Gt=(l=Bt.maxElevation)!==null&&l!==void 0?l:this.elevation;nt=new Qo([nt.min[0],nt.min[1],jr],[nt.max[0],nt.max[1],Gt])}Q.push({aabb:nt,zoom:jt,x:tt,y:vt,wrap:J.wrap,fullyVisible:Te})}}return Z.sort((J,ge)=>J.distanceSq-ge.distanceSq).map(J=>J.tileID)}resize(t,s){this.width=t,this.height=s,this.pixelsToGLUnits=[2/t,-2/s],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const s=d.ac(t.lat,-85.051129,us);return new d.P(d.N(t.lng)*this.worldSize,d.O(s)*this.worldSize)}unproject(t){return new d.Y(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(t){const s=this.elevation,l=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,u=this.pointLocation(this.centerPoint,t),m=t.getElevationForLngLatZoom(u,this.tileZoom);if(!(this.elevation-m))return;const v=l+s-m,b=Math.cos(this._pitch)*this.cameraToCenterDistance/v/d.b4(1,u.lat),M=this.scaleZoom(b/this.tileSize);this._elevation=m,this._center=u,this.zoom=M}setLocationAtPoint(t,s){const l=this.pointCoordinate(s),u=this.pointCoordinate(this.centerPoint),m=this.locationCoordinate(t),v=new d.Y(m.x-(l.x-u.x),m.y-(l.y-u.y));this.center=this.coordinateLocation(v),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(t,s){return s?this.coordinatePoint(this.locationCoordinate(t),s.getElevationForLngLatZoom(t,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(t))}pointLocation(t,s){return this.coordinateLocation(this.pointCoordinate(t,s))}locationCoordinate(t){return d.Y.fromLngLat(t)}coordinateLocation(t){return t&&t.toLngLat()}pointCoordinate(t,s){if(s){const O=s.pointCoordinate(t);if(O!=null)return O}const l=[t.x,t.y,0,1],u=[t.x,t.y,1,1];d.af(l,l,this.pixelMatrixInverse),d.af(u,u,this.pixelMatrixInverse);const m=l[3],v=u[3],b=l[1]/m,M=u[1]/v,I=l[2]/m,z=u[2]/v,D=I===z?0:(0-I)/(z-I);return new d.Y(d.z.number(l[0]/m,u[0]/v,D)/this.worldSize,d.z.number(b,M,D)/this.worldSize)}coordinatePoint(t,s=0,l=this.pixelMatrix){const u=[t.x*this.worldSize,t.y*this.worldSize,s,1];return d.af(u,u,l),new d.P(u[0]/u[3],u[1]/u[3])}getBounds(){const t=Math.max(0,this.height/2-this.getHorizon());return new sr().extend(this.pointLocation(new d.P(0,t))).extend(this.pointLocation(new d.P(this.width,t))).extend(this.pointLocation(new d.P(this.width,this.height))).extend(this.pointLocation(new d.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new sr([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,us])}calculatePosMatrix(t,s=!1){const l=t.key,u=s?this._alignedPosMatrixCache:this._posMatrixCache;if(u[l])return u[l];const m=t.canonical,v=this.worldSize/this.zoomScale(m.z),b=m.x+Math.pow(2,m.z)*t.wrap,M=d.an(new Float64Array(16));return d.H(M,M,[b*v,m.y*v,0]),d.J(M,M,[v/d.W,v/d.W,1]),d.K(M,s?this.alignedProjMatrix:this.projMatrix,M),u[l]=new Float32Array(M),u[l]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(t,s){s=d.ac(+s,this.minZoom,this.maxZoom);const l={center:new d.M(t.lng,t.lat),zoom:s};let u=this.lngRange;if(!this._renderWorldCopies&&u===null){const J=179.9999999999;u=[-J,J]}const m=this.tileSize*this.zoomScale(l.zoom);let v=0,b=m,M=0,I=m,z=0,D=0;const{x:O,y:V}=this.size;if(this.latRange){const J=this.latRange;v=d.O(J[1])*m,b=d.O(J[0])*m,b-v<V&&(z=V/(b-v))}u&&(M=d.b2(d.N(u[0])*m,0,m),I=d.b2(d.N(u[1])*m,0,m),I<M&&(I+=m),I-M<O&&(D=O/(I-M)));const{x:G,y:Q}=this.project.call({worldSize:m},t);let Z,ie;const pe=Math.max(D||0,z||0);if(pe){const J=new d.P(D?(I+M)/2:G,z?(b+v)/2:Q);return l.center=this.unproject.call({worldSize:m},J).wrap(),l.zoom+=this.scaleZoom(pe),l}if(this.latRange){const J=V/2;Q-J<v&&(ie=v+J),Q+J>b&&(ie=b-J)}if(u){const J=(M+I)/2;let ge=G;this._renderWorldCopies&&(ge=d.b2(G,J-m/2,J+m/2));const Se=O/2;ge-Se<M&&(Z=M+Se),ge+Se>I&&(Z=I-Se)}if(Z!==void 0||ie!==void 0){const J=new d.P(Z??G,ie??Q);l.center=this.unproject.call({worldSize:m},J).wrap()}return l}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t=this._unmodified,{center:s,zoom:l}=this.getConstrained(this.center,this.zoom);this.center=s,this.zoom=l,this._unmodified=t,this._constraining=!1}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,s=this.point.x,l=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=d.b4(1,this.center.lat)*this.worldSize;let u=d.an(new Float64Array(16));d.J(u,u,[this.width/2,-this.height/2,1]),d.H(u,u,[1,-1,0]),this.labelPlaneMatrix=u,u=d.an(new Float64Array(16)),d.J(u,u,[1,-1,1]),d.H(u,u,[-1,-1,0]),d.J(u,u,[2/this.width,2/this.height,1]),this.glCoordMatrix=u;const m=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),v=Math.min(this.elevation,this.minElevationForCurrentTile),b=m-v*this._pixelPerMeter/Math.cos(this._pitch),M=v<0?b:m,I=Math.PI/2+this._pitch,z=this._fov*(.5+t.y/this.height),D=Math.sin(z)*M/Math.sin(d.ac(Math.PI-I-z,.01,Math.PI-.01)),O=this.getHorizon(),V=2*Math.atan(O/this.cameraToCenterDistance)*(.5+t.y/(2*O)),G=Math.sin(V)*M/Math.sin(d.ac(Math.PI-I-V,.01,Math.PI-.01)),Q=Math.min(D,G),Z=1.01*(Math.cos(Math.PI/2-this._pitch)*Q+M),ie=this.height/50;u=new Float64Array(16),d.b5(u,this._fov,this.width/this.height,ie,Z),u[8]=2*-t.x/this.width,u[9]=2*t.y/this.height,d.J(u,u,[1,-1,1]),d.H(u,u,[0,0,-this.cameraToCenterDistance]),d.b6(u,u,this._pitch),d.ad(u,u,this.angle),d.H(u,u,[-s,-l,0]),this.mercatorMatrix=d.J([],u,[this.worldSize,this.worldSize,this.worldSize]),d.J(u,u,[1,1,this._pixelPerMeter]),this.pixelMatrix=d.K(new Float64Array(16),this.labelPlaneMatrix,u),d.H(u,u,[0,0,-this.elevation]),this.projMatrix=u,this.invProjMatrix=d.as([],u),this.pixelMatrix3D=d.K(new Float64Array(16),this.labelPlaneMatrix,u);const pe=this.width%2/2,J=this.height%2/2,ge=Math.cos(this.angle),Se=Math.sin(this.angle),Te=s-Math.round(s)+ge*pe+Se*J,Le=l-Math.round(l)+ge*J+Se*pe,Ue=new Float64Array(u);if(d.H(Ue,Ue,[Te>.5?Te-1:Te,Le>.5?Le-1:Le,0]),this.alignedProjMatrix=Ue,u=d.as(new Float64Array(16),this.pixelMatrix),!u)throw new Error("failed to invert matrix");this.pixelMatrixInverse=u,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const t=this.pointCoordinate(new d.P(0,0)),s=[t.x*this.worldSize,t.y*this.worldSize,0,1];return d.af(s,s,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new d.P(0,t))}getCameraQueryGeometry(t){const s=this.getCameraPoint();if(t.length===1)return[t[0],s];{let l=s.x,u=s.y,m=s.x,v=s.y;for(const b of t)l=Math.min(l,b.x),u=Math.min(u,b.y),m=Math.max(m,b.x),v=Math.max(v,b.y);return[new d.P(l,u),new d.P(m,u),new d.P(m,v),new d.P(l,v),new d.P(l,u)]}}lngLatToCameraDepth(t,s){const l=this.locationCoordinate(t),u=[l.x*this.worldSize,l.y*this.worldSize,s,1];return d.af(u,u,this.projMatrix),u[2]/u[3]}}function _u(p,t){let s,l=!1,u=null,m=null;const v=()=>{u=null,l&&(p.apply(m,s),u=setTimeout(v,t),l=!1)};return(...b)=>(l=!0,m=this,s=b,u||v(),u)}class fc{constructor(t){this._getCurrentHash=()=>{const s=window.location.hash.replace("#","");if(this._hashName){let l;return s.split("&").map(u=>u.split("=")).forEach(u=>{u[0]===this._hashName&&(l=u)}),(l&&l[1]||"").split("/")}return s.split("/")},this._onHashChange=()=>{const s=this._getCurrentHash();if(s.length>=3&&!s.some(l=>isNaN(l))){const l=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(s[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+s[2],+s[1]],zoom:+s[0],bearing:l,pitch:+(s[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const s=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,s)}catch{}},this._updateHash=_u(this._updateHashUnthrottled,300),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(t){const s=this._map.getCenter(),l=Math.round(100*this._map.getZoom())/100,u=Math.ceil((l*Math.LN2+Math.log(512/360/.5))/Math.LN10),m=Math.pow(10,u),v=Math.round(s.lng*m)/m,b=Math.round(s.lat*m)/m,M=this._map.getBearing(),I=this._map.getPitch();let z="";if(z+=t?`/${v}/${b}/${l}`:`${l}/${b}/${v}`,(M||I)&&(z+="/"+Math.round(10*M)/10),I&&(z+=`/${Math.round(I)}`),this._hashName){const D=this._hashName;let O=!1;const V=window.location.hash.slice(1).split("&").map(G=>{const Q=G.split("=")[0];return Q===D?(O=!0,`${Q}=${z}`):G}).filter(G=>G);return O||V.push(`${D}=${z}`),`#${V.join("&")}`}return`#${z}`}}const Fa={linearity:.3,easing:d.b7(0,0,.3,1)},mc=d.e({deceleration:2500,maxSpeed:1400},Fa),el=d.e({deceleration:20,maxSpeed:1400},Fa),tl=d.e({deceleration:1e3,maxSpeed:360},Fa),rl=d.e({deceleration:1e3,maxSpeed:90},Fa);class go{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:le.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,s=le.now();for(;t.length>0&&s-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const s={zoom:0,bearing:0,pitch:0,pan:new d.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:m}of this._inertiaBuffer)s.zoom+=m.zoomDelta||0,s.bearing+=m.bearingDelta||0,s.pitch+=m.pitchDelta||0,m.panDelta&&s.pan._add(m.panDelta),m.around&&(s.around=m.around),m.pinchAround&&(s.pinchAround=m.pinchAround);const l=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,u={};if(s.pan.mag()){const m=Kn(s.pan.mag(),l,d.e({},mc,t||{}));u.offset=s.pan.mult(m.amount/s.pan.mag()),u.center=this._map.transform.center,_o(u,m)}if(s.zoom){const m=Kn(s.zoom,l,el);u.zoom=this._map.transform.zoom+m.amount,_o(u,m)}if(s.bearing){const m=Kn(s.bearing,l,tl);u.bearing=this._map.transform.bearing+d.ac(m.amount,-179,179),_o(u,m)}if(s.pitch){const m=Kn(s.pitch,l,rl);u.pitch=this._map.transform.pitch+m.amount,_o(u,m)}if(u.zoom||u.bearing){const m=s.pinchAround===void 0?s.around:s.pinchAround;u.around=m?this._map.unproject(m):this._map.getCenter()}return this.clear(),d.e(u,{noMoveStart:!0})}}function _o(p,t){(!p.duration||p.duration<t.duration)&&(p.duration=t.duration,p.easing=t.easing)}function Kn(p,t,s){const{maxSpeed:l,linearity:u,deceleration:m}=s,v=d.ac(p*u/(t/1e3),-l,l),b=Math.abs(v)/(m*u);return{easing:s.easing,duration:1e3*b,amount:v*(b/2)}}class $i extends d.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,l,u={}){const m=H.mousePos(s.getCanvas(),l),v=s.unproject(m);super(t,d.e({point:m,lngLat:v,originalEvent:l},u)),this._defaultPrevented=!1,this.target=s}}class ea extends d.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,l){const u=t==="touchend"?l.changedTouches:l.touches,m=H.touchPos(s.getCanvasContainer(),u),v=m.map(M=>s.unproject(M)),b=m.reduce((M,I,z,D)=>M.add(I.div(D.length)),new d.P(0,0));super(t,{points:m,point:b,lngLats:v,lngLat:s.unproject(b),originalEvent:l}),this._defaultPrevented=!1}}class gc extends d.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,l){super(t,{originalEvent:l}),this._defaultPrevented=!1}}class yo{constructor(t,s){this._map=t,this._clickTolerance=s.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new gc(t.type,this._map,t))}mousedown(t,s){return this._mousedownPos=s,this._firePreventable(new $i(t.type,this._map,t))}mouseup(t){this._map.fire(new $i(t.type,this._map,t))}click(t,s){this._mousedownPos&&this._mousedownPos.dist(s)>=this._clickTolerance||this._map.fire(new $i(t.type,this._map,t))}dblclick(t){return this._firePreventable(new $i(t.type,this._map,t))}mouseover(t){this._map.fire(new $i(t.type,this._map,t))}mouseout(t){this._map.fire(new $i(t.type,this._map,t))}touchstart(t){return this._firePreventable(new ea(t.type,this._map,t))}touchmove(t){this._map.fire(new ea(t.type,this._map,t))}touchend(t){this._map.fire(new ea(t.type,this._map,t))}touchcancel(t){this._map.fire(new ea(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ch{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new $i(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new $i("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new $i(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ba{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.pointLocation(d.P.convert(t),this._map.terrain)}}class vo{constructor(t,s){this._map=t,this._tr=new Ba(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=s.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,s){this.isEnabled()&&t.shiftKey&&t.button===0&&(H.disableDrag(),this._startPos=this._lastPos=s,this._active=!0)}mousemoveWindow(t,s){if(!this._active)return;const l=s;if(this._lastPos.equals(l)||!this._box&&l.dist(this._startPos)<this._clickTolerance)return;const u=this._startPos;this._lastPos=l,this._box||(this._box=H.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const m=Math.min(u.x,l.x),v=Math.max(u.x,l.x),b=Math.min(u.y,l.y),M=Math.max(u.y,l.y);H.setTransform(this._box,`translate(${m}px,${b}px)`),this._box.style.width=v-m+"px",this._box.style.height=M-b+"px"}mouseupWindow(t,s){if(!this._active||t.button!==0)return;const l=this._startPos,u=s;if(this.reset(),H.suppressClick(),l.x!==u.x||l.y!==u.y)return this._map.fire(new d.k("boxzoomend",{originalEvent:t})),{cameraAnimation:m=>m.fitScreenCoordinates(l,u,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(H.remove(this._box),this._box=null),H.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,s){return this._map.fire(new d.k(t,{originalEvent:s}))}}function Oa(p,t){if(p.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${p.length}, points ${t.length}`);const s={};for(let l=0;l<p.length;l++)s[p[l].identifier]=t[l];return s}class _c{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,s,l){(this.centroid||l.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),l.length===this.numTouches&&(this.centroid=function(u){const m=new d.P(0,0);for(const v of u)m._add(v);return m.div(u.length)}(s),this.touches=Oa(l,s)))}touchmove(t,s,l){if(this.aborted||!this.centroid)return;const u=Oa(l,s);for(const m in this.touches){const v=u[m];(!v||v.dist(this.touches[m])>30)&&(this.aborted=!0)}}touchend(t,s,l){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),l.length===0){const u=!this.aborted&&this.centroid;if(this.reset(),u)return u}}}class il{constructor(t){this.singleTap=new _c(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,s,l){this.singleTap.touchstart(t,s,l)}touchmove(t,s,l){this.singleTap.touchmove(t,s,l)}touchend(t,s,l){const u=this.singleTap.touchend(t,s,l);if(u){const m=t.timeStamp-this.lastTime<500,v=!this.lastTap||this.lastTap.dist(u)<30;if(m&&v||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=u,this.count===this.numTaps)return this.reset(),u}}}class nl{constructor(t){this._tr=new Ba(t),this._zoomIn=new il({numTouches:1,numTaps:2}),this._zoomOut=new il({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,s,l){this._zoomIn.touchstart(t,s,l),this._zoomOut.touchstart(t,s,l)}touchmove(t,s,l){this._zoomIn.touchmove(t,s,l),this._zoomOut.touchmove(t,s,l)}touchend(t,s,l){const u=this._zoomIn.touchend(t,s,l),m=this._zoomOut.touchend(t,s,l),v=this._tr;return u?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:v.zoom+1,around:v.unproject(u)},{originalEvent:t})}):m?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:v.zoom-1,around:v.unproject(m)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ta{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const s=this._moveFunction(...t);if(s.bearingDelta||s.pitchDelta||s.around||s.panDelta)return this._active=!0,s}dragStart(t,s){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=s.length?s[0]:s,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,s){if(!this.isEnabled())return;const l=this._lastPoint;if(!l)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const u=s.length?s[0]:s;return!this._moved&&u.dist(l)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=u,this._move(l,u))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&H.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Ih={0:1,2:2};class sl{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const s=H.mouseButton(t);this._eventButton=s}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!function(s,l){const u=Ih[l];return s.buttons===void 0||(s.buttons&u)!==u}(t,this._eventButton)}isValidEndEvent(t){return H.mouseButton(t)===this._eventButton}}class ti{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return t.targetTouches.length===1}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}const hs=p=>{p.mousedown=p.dragStart,p.mousemoveWindow=p.dragMove,p.mouseup=p.dragEnd,p.contextmenu=t=>{t.preventDefault()}},yn=({enable:p,clickTolerance:t,bearingDegreesPerPixelMoved:s=.8})=>{const l=new sl({checkCorrectEvent:u=>H.mouseButton(u)===0&&u.ctrlKey||H.mouseButton(u)===2});return new ta({clickTolerance:t,move:(u,m)=>({bearingDelta:(m.x-u.x)*s}),moveStateManager:l,enable:p,assignEvents:hs})},al=({enable:p,clickTolerance:t,pitchDegreesPerPixelMoved:s=-.5})=>{const l=new sl({checkCorrectEvent:u=>H.mouseButton(u)===0&&u.ctrlKey||H.mouseButton(u)===2});return new ta({clickTolerance:t,move:(u,m)=>({pitchDelta:(m.y-u.y)*s}),moveStateManager:l,enable:p,assignEvents:hs})};class yc{constructor(t,s){this._clickTolerance=t.clickTolerance||1,this._map=s,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new d.P(0,0)}minTouchs(){return this._map.cooperativeGestures.isEnabled()?2:1}touchstart(t,s,l){return this._calculateTransform(t,s,l)}touchmove(t,s,l){if(this._active&&!(l.length<this.minTouchs()))return t.preventDefault(),this._calculateTransform(t,s,l)}touchend(t,s,l){this._calculateTransform(t,s,l),this._active&&l.length<this.minTouchs()&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,s,l){l.length>0&&(this._active=!0);const u=Oa(l,s),m=new d.P(0,0),v=new d.P(0,0);let b=0;for(const I in u){const z=u[I],D=this._touches[I];D&&(m._add(z),v._add(z.sub(D)),b++,u[I]=z)}if(this._touches=u,b<this.minTouchs()||!v.mag())return;const M=v.div(b);return this._sum._add(M),this._sum.mag()<this._clickTolerance?void 0:{around:m.div(b),panDelta:M}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ol{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,s,l){this._firstTwoTouches||l.length<2||(this._firstTwoTouches=[l[0].identifier,l[1].identifier],this._start([s[0],s[1]]))}touchmove(t,s,l){if(!this._firstTwoTouches)return;t.preventDefault();const[u,m]=this._firstTwoTouches,v=ds(l,s,u),b=ds(l,s,m);if(!v||!b)return;const M=this._aroundCenter?null:v.add(b).div(2);return this._move([v,b],M,t)}touchend(t,s,l){if(!this._firstTwoTouches)return;const[u,m]=this._firstTwoTouches,v=ds(l,s,u),b=ds(l,s,m);v&&b||(this._active&&H.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function ds(p,t,s){for(let l=0;l<p.length;l++)if(p[l].identifier===s)return t[l]}function Na(p,t){return Math.log(p/t)/Math.LN2}class ll extends ol{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,s){const l=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Na(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Na(this._distance,l),pinchAround:s}}}function cl(p,t){return 180*p.angleWith(t)/Math.PI}class ul extends ol{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,s,l){const u=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:cl(this._vector,u),pinchAround:s}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const s=25/(Math.PI*this._minDiameter)*360,l=cl(t,this._startVector);return Math.abs(l)<s}}function hl(p){return Math.abs(p.y)>Math.abs(p.x)}class dl extends ol{constructor(t){super(),this._currentTouchCount=0,this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,s,l){super.touchstart(t,s,l),this._currentTouchCount=l.length}_start(t){this._lastPoints=t,hl(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,s,l){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const u=t[0].sub(this._lastPoints[0]),m=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(u,m,l.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(u.y+m.y)/2*-.5}):void 0}gestureBeginsVertically(t,s,l){if(this._valid!==void 0)return this._valid;const u=t.mag()>=2,m=s.mag()>=2;if(!u&&!m)return;if(!u||!m)return this._firstMove===void 0&&(this._firstMove=l),l-this._firstMove<100&&void 0;const v=t.y>0==s.y>0;return hl(t)&&hl(s)&&v}}const yu={panStep:100,bearingStep:15,pitchStep:10};class Ps{constructor(t){this._tr=new Ba(t);const s=yu;this._panStep=s.panStep,this._bearingStep=s.bearingStep,this._pitchStep=s.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let s=0,l=0,u=0,m=0,v=0;switch(t.keyCode){case 61:case 107:case 171:case 187:s=1;break;case 189:case 109:case 173:s=-1;break;case 37:t.shiftKey?l=-1:(t.preventDefault(),m=-1);break;case 39:t.shiftKey?l=1:(t.preventDefault(),m=1);break;case 38:t.shiftKey?u=1:(t.preventDefault(),v=-1);break;case 40:t.shiftKey?u=-1:(t.preventDefault(),v=1);break;default:return}return this._rotationDisabled&&(l=0,u=0),{cameraAnimation:b=>{const M=this._tr;b.easeTo({duration:300,easeId:"keyboardHandler",easing:As,zoom:s?Math.round(M.zoom)+s*(t.shiftKey?2:1):M.zoom,bearing:M.bearing+l*this._bearingStep,pitch:M.pitch+u*this._pitchStep,offset:[-m*this._panStep,-v*this._panStep],center:M.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function As(p){return p*(2-p)}const vc=4.000244140625;class xc{constructor(t,s){this._onTimeout=l=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)},this._map=t,this._tr=new Ba(t),this._triggerRenderFrame=s,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(t){if(!this.isEnabled()||this._map.cooperativeGestures.isEnabled()&&!t[this._map.cooperativeGestures._bypassKey])return;let s=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const l=le.now(),u=l-(this._lastWheelEventTime||0);this._lastWheelEventTime=l,s!==0&&s%vc==0?this._type="wheel":s!==0&&Math.abs(s)<4?this._type="trackpad":u>400?(this._type=null,this._lastValue=s,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(u*s)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,s+=this._lastValue)),t.shiftKey&&s&&(s/=4),this._type&&(this._lastWheelEvent=t,this._delta-=s,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const s=H.mousePos(this._map.getCanvas(),t),l=this._tr;this._around=s.y>l.transform.height/2-l.transform.getHorizon()?d.M.convert(this._aroundCenter?l.center:l.unproject(s)):d.M.convert(l.center),this._aroundPoint=l.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._tr.transform;if(this._delta!==0){const b=this._type==="wheel"&&Math.abs(this._delta)>vc?this._wheelZoomRate:this._defaultZoomRate;let M=2/(1+Math.exp(-Math.abs(this._delta*b)));this._delta<0&&M!==0&&(M=1/M);const I=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):t.scale;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(I*M))),this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const s=typeof this._targetZoom=="number"?this._targetZoom:t.zoom,l=this._startZoom,u=this._easing;let m,v=!1;if(this._type==="wheel"&&l&&u){const b=Math.min((le.now()-this._lastWheelEventTime)/200,1),M=u(b);m=d.z.number(l,s,M),b<1?this._frameId||(this._frameId=!0):v=!0}else m=s,v=!0;return this._active=!0,v&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!v,zoomDelta:m-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let s=d.b8;if(this._prevEase){const l=this._prevEase,u=(le.now()-l.start)/l.duration,m=l.easing(u+.01)-l.easing(u),v=.27/Math.sqrt(m*m+1e-4)*.01,b=Math.sqrt(.0729-v*v);s=d.b7(v,b,.25,1)}return this._prevEase={start:le.now(),duration:t,easing:s},s}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Ds{constructor(t,s){this._clickZoom=t,this._tapZoom=s}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class vu{constructor(t){this._tr=new Ba(t),this.reset()}reset(){this._active=!1}dblclick(t,s){return t.preventDefault(),{cameraAnimation:l=>{l.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(s)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class xu{constructor(){this._tap=new il({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,s,l){if(!this._swipePoint)if(this._tapTime){const u=s[0],m=t.timeStamp-this._tapTime<500,v=this._tapPoint.dist(u)<30;m&&v?l.length>0&&(this._swipePoint=u,this._swipeTouch=l[0].identifier):this.reset()}else this._tap.touchstart(t,s,l)}touchmove(t,s,l){if(this._tapTime){if(this._swipePoint){if(l[0].identifier!==this._swipeTouch)return;const u=s[0],m=u.y-this._swipePoint.y;return this._swipePoint=u,t.preventDefault(),this._active=!0,{zoomDelta:m/128}}}else this._tap.touchmove(t,s,l)}touchend(t,s,l){if(this._tapTime)this._swipePoint&&l.length===0&&this.reset();else{const u=this._tap.touchend(t,s,l);u&&(this._tapTime=t.timeStamp,this._tapPoint=u)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class bc{constructor(t,s,l){this._el=t,this._mousePan=s,this._touchPan=l}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class $a{constructor(t,s,l){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=s,this._mousePitch=l}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class wc{constructor(t,s,l,u){this._el=t,this._touchZoom=s,this._touchRotate=l,this._tapDragZoom=u,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class cn{constructor(t,s){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=t,this._options=s,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const t=this._map.getCanvasContainer();t.classList.add("maplibregl-cooperative-gestures"),this._container=H.create("div","maplibregl-cooperative-gesture-screen",t);let s=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(s=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const l=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),u=document.createElement("div");u.className="maplibregl-desktop-message",u.textContent=s,this._container.appendChild(u);const m=document.createElement("div");m.className="maplibregl-mobile-message",m.textContent=l,this._container.appendChild(m),this._container.setAttribute("aria-hidden","true")}_destoryUI(){this._container&&(H.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destoryUI()}isEnabled(){return this._enabled}touchmove(t){this._onCooperativeGesture(t.touches.length===1)}wheel(t){this._map.scrollZoom.isEnabled()&&this._onCooperativeGesture(!t[this._bypassKey])}_onCooperativeGesture(t){this._enabled&&t&&(this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const Zr=p=>p.zoom||p.drag||p.pitch||p.rotate;class Sc extends d.k{}function vn(p){return p.panDelta&&p.panDelta.mag()||p.zoomDelta||p.bearingDelta||p.pitchDelta}class zs{constructor(t,s){this.handleWindowEvent=u=>{this.handleEvent(u,`${u.type}Window`)},this.handleEvent=(u,m)=>{if(u.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const v=u.type==="renderFrame"?void 0:u,b={needsRenderFrame:!1},M={},I={},z=u.touches,D=z?this._getMapTouches(z):void 0,O=D?H.touchPos(this._map.getCanvas(),D):H.mousePos(this._map.getCanvas(),u);for(const{handlerName:Q,handler:Z,allowed:ie}of this._handlers){if(!Z.isEnabled())continue;let pe;this._blockedByActive(I,ie,Q)?Z.reset():Z[m||u.type]&&(pe=Z[m||u.type](u,O,D),this.mergeHandlerResult(b,M,pe,Q,v),pe&&pe.needsRenderFrame&&this._triggerRenderFrame()),(pe||Z.isActive())&&(I[Q]=Z)}const V={};for(const Q in this._previousActiveHandlers)I[Q]||(V[Q]=v);this._previousActiveHandlers=I,(Object.keys(V).length||vn(b))&&(this._changes.push([b,M,V]),this._triggerRenderFrame()),(Object.keys(I).length||vn(b))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:G}=b;G&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],G(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new go(t),this._bearingSnap=s.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(s);const l=this._el;this._listeners=[[l,"touchstart",{passive:!0}],[l,"touchmove",{passive:!1}],[l,"touchend",void 0],[l,"touchcancel",void 0],[l,"mousedown",void 0],[l,"mousemove",void 0],[l,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[l,"mouseover",void 0],[l,"mouseout",void 0],[l,"dblclick",void 0],[l,"click",void 0],[l,"keydown",{capture:!1}],[l,"keyup",void 0],[l,"wheel",{passive:!1}],[l,"contextmenu",void 0],[window,"blur",void 0]];for(const[u,m,v]of this._listeners)H.addEventListener(u,m,u===document?this.handleWindowEvent:this.handleEvent,v)}destroy(){for(const[t,s,l]of this._listeners)H.removeEventListener(t,s,t===document?this.handleWindowEvent:this.handleEvent,l)}_addDefaultHandlers(t){const s=this._map,l=s.getCanvasContainer();this._add("mapEvent",new yo(s,t));const u=s.boxZoom=new vo(s,t);this._add("boxZoom",u),t.interactive&&t.boxZoom&&u.enable();const m=s.cooperativeGestures=new cn(s,t.cooperativeGestures);this._add("cooperativeGestures",m),t.cooperativeGestures&&m.enable();const v=new nl(s),b=new vu(s);s.doubleClickZoom=new Ds(b,v),this._add("tapZoom",v),this._add("clickZoom",b),t.interactive&&t.doubleClickZoom&&s.doubleClickZoom.enable();const M=new xu;this._add("tapDragZoom",M);const I=s.touchPitch=new dl(s);this._add("touchPitch",I),t.interactive&&t.touchPitch&&s.touchPitch.enable(t.touchPitch);const z=yn(t),D=al(t);s.dragRotate=new $a(t,z,D),this._add("mouseRotate",z,["mousePitch"]),this._add("mousePitch",D,["mouseRotate"]),t.interactive&&t.dragRotate&&s.dragRotate.enable();const O=(({enable:pe,clickTolerance:J})=>{const ge=new sl({checkCorrectEvent:Se=>H.mouseButton(Se)===0&&!Se.ctrlKey});return new ta({clickTolerance:J,move:(Se,Te)=>({around:Te,panDelta:Te.sub(Se)}),activateOnStart:!0,moveStateManager:ge,enable:pe,assignEvents:hs})})(t),V=new yc(t,s);s.dragPan=new bc(l,O,V),this._add("mousePan",O),this._add("touchPan",V,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&s.dragPan.enable(t.dragPan);const G=new ul,Q=new ll;s.touchZoomRotate=new wc(l,Q,G,M),this._add("touchRotate",G,["touchPan","touchZoom"]),this._add("touchZoom",Q,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&s.touchZoomRotate.enable(t.touchZoomRotate);const Z=s.scrollZoom=new xc(s,()=>this._triggerRenderFrame());this._add("scrollZoom",Z,["mousePan"]),t.interactive&&t.scrollZoom&&s.scrollZoom.enable(t.scrollZoom);const ie=s.keyboard=new Ps(s);this._add("keyboard",ie),t.interactive&&t.keyboard&&s.keyboard.enable(),this._add("blockableMapEvent",new Ch(s))}_add(t,s,l){this._handlers.push({handlerName:t,handler:s,allowed:l}),this._handlersById[t]=s}stop(t){if(!this._updatingCamera){for(const{handler:s}of this._handlers)s.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Zr(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,s,l){for(const u in t)if(u!==l&&(!s||s.indexOf(u)<0))return!0;return!1}_getMapTouches(t){const s=[];for(const l of t)this._el.contains(l.target)&&s.push(l);return s}mergeHandlerResult(t,s,l,u,m){if(!l)return;d.e(t,l);const v={handlerName:u,originalEvent:l.originalEvent||m};l.zoomDelta!==void 0&&(s.zoom=v),l.panDelta!==void 0&&(s.drag=v),l.pitchDelta!==void 0&&(s.pitch=v),l.bearingDelta!==void 0&&(s.rotate=v)}_applyChanges(){const t={},s={},l={};for(const[u,m,v]of this._changes)u.panDelta&&(t.panDelta=(t.panDelta||new d.P(0,0))._add(u.panDelta)),u.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+u.zoomDelta),u.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+u.bearingDelta),u.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+u.pitchDelta),u.around!==void 0&&(t.around=u.around),u.pinchAround!==void 0&&(t.pinchAround=u.pinchAround),u.noInertia&&(t.noInertia=u.noInertia),d.e(s,m),d.e(l,v);this._updateMapTransform(t,s,l),this._changes=[]}_updateMapTransform(t,s,l){const u=this._map,m=u._getTransformForUpdate(),v=u.terrain;if(!(vn(t)||v&&this._terrainMovement))return this._fireEvents(s,l,!0);let{panDelta:b,zoomDelta:M,bearingDelta:I,pitchDelta:z,around:D,pinchAround:O}=t;O!==void 0&&(D=O),u._stop(!0),D=D||u.transform.centerPoint;const V=m.pointLocation(b?D.sub(b):D);I&&(m.bearing+=I),z&&(m.pitch+=z),M&&(m.zoom+=M),v?this._terrainMovement||!s.drag&&!s.zoom?s.drag&&this._terrainMovement?m.center=m.pointLocation(m.centerPoint.sub(b)):m.setLocationAtPoint(V,D):(this._terrainMovement=!0,this._map._elevationFreeze=!0,m.setLocationAtPoint(V,D)):m.setLocationAtPoint(V,D),u._applyUpdatedTransform(m),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(s,l,!0)}_fireEvents(t,s,l){const u=Zr(this._eventsInProgress),m=Zr(t),v={};for(const D in t){const{originalEvent:O}=t[D];this._eventsInProgress[D]||(v[`${D}start`]=O),this._eventsInProgress[D]=t[D]}!u&&m&&this._fireEvent("movestart",m.originalEvent);for(const D in v)this._fireEvent(D,v[D]);m&&this._fireEvent("move",m.originalEvent);for(const D in t){const{originalEvent:O}=t[D];this._fireEvent(D,O)}const b={};let M;for(const D in this._eventsInProgress){const{handlerName:O,originalEvent:V}=this._eventsInProgress[D];this._handlersById[O].isActive()||(delete this._eventsInProgress[D],M=s[O]||V,b[`${D}end`]=M)}for(const D in b)this._fireEvent(D,b[D]);const I=Zr(this._eventsInProgress),z=(u||m)&&!I;if(z&&this._terrainMovement&&(this._map._elevationFreeze=!1,this._terrainMovement=!1,this._map.transform.recalculateZoom(this._map.terrain)),l&&z){this._updatingCamera=!0;const D=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),O=V=>V!==0&&-this._bearingSnap<V&&V<this._bearingSnap;!D||!D.essential&&le.prefersReducedMotion?(this._map.fire(new d.k("moveend",{originalEvent:M})),O(this._map.getBearing())&&this._map.resetNorth()):(O(D.bearing||this._map.getBearing())&&(D.bearing=0),D.freezeElevation=!0,this._map.easeTo(D,{originalEvent:M})),this._updatingCamera=!1}}_fireEvent(t,s){this._map.fire(new d.k(t,s?{originalEvent:s}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new Sc("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class bu extends d.E{constructor(t,s){super(),this._renderFrameCallback=()=>{const l=Math.min((le.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(l)),l<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=s.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new d.M(this.transform.center.lng,this.transform.center.lat)}setCenter(t,s){return this.jumpTo({center:t},s)}panBy(t,s,l){return t=d.P.convert(t).mult(-1),this.panTo(this.transform.center,d.e({offset:t},s),l)}panTo(t,s,l){return this.easeTo(d.e({center:t},s),l)}getZoom(){return this.transform.zoom}setZoom(t,s){return this.jumpTo({zoom:t},s),this}zoomTo(t,s,l){return this.easeTo(d.e({zoom:t},s),l)}zoomIn(t,s){return this.zoomTo(this.getZoom()+1,t,s),this}zoomOut(t,s){return this.zoomTo(this.getZoom()-1,t,s),this}getBearing(){return this.transform.bearing}setBearing(t,s){return this.jumpTo({bearing:t},s),this}getPadding(){return this.transform.padding}setPadding(t,s){return this.jumpTo({padding:t},s),this}rotateTo(t,s,l){return this.easeTo(d.e({bearing:t},s),l)}resetNorth(t,s){return this.rotateTo(0,d.e({duration:1e3},t),s),this}resetNorthPitch(t,s){return this.easeTo(d.e({bearing:0,pitch:0,duration:1e3},t),s),this}snapToNorth(t,s){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,s):this}getPitch(){return this.transform.pitch}setPitch(t,s){return this.jumpTo({pitch:t},s),this}cameraForBounds(t,s){t=sr.convert(t);const l=s&&s.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),l,s)}_cameraForBoxAndBearing(t,s,l,u){const m={top:0,bottom:0,right:0,left:0};if(typeof(u=d.e({padding:m,offset:[0,0],maxZoom:this.transform.maxZoom},u)).padding=="number"){const Ke=u.padding;u.padding={top:Ke,bottom:Ke,right:Ke,left:Ke}}u.padding=d.e(m,u.padding);const v=this.transform,b=v.padding,M=new sr(t,s),I=v.project(M.getNorthWest()),z=v.project(M.getNorthEast()),D=v.project(M.getSouthEast()),O=v.project(M.getSouthWest()),V=d.b9(-l),G=I.rotate(V),Q=z.rotate(V),Z=D.rotate(V),ie=O.rotate(V),pe=new d.P(Math.max(G.x,Q.x,ie.x,Z.x),Math.max(G.y,Q.y,ie.y,Z.y)),J=new d.P(Math.min(G.x,Q.x,ie.x,Z.x),Math.min(G.y,Q.y,ie.y,Z.y)),ge=pe.sub(J),Se=(v.width-(b.left+b.right+u.padding.left+u.padding.right))/ge.x,Te=(v.height-(b.top+b.bottom+u.padding.top+u.padding.bottom))/ge.y;if(Te<0||Se<0)return void d.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const Le=Math.min(v.scaleZoom(v.scale*Math.min(Se,Te)),u.maxZoom),Ue=d.P.convert(u.offset),st=new d.P((u.padding.left-u.padding.right)/2,(u.padding.top-u.padding.bottom)/2).rotate(d.b9(l)),pt=Ue.add(st).mult(v.scale/v.zoomScale(Le));return{center:v.unproject(I.add(D).div(2).sub(pt)),zoom:Le,bearing:l}}fitBounds(t,s,l){return this._fitInternal(this.cameraForBounds(t,s),s,l)}fitScreenCoordinates(t,s,l,u,m){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(d.P.convert(t)),this.transform.pointLocation(d.P.convert(s)),l,u),u,m)}_fitInternal(t,s,l){return t?(delete(s=d.e(t,s)).padding,s.linear?this.easeTo(s,l):this.flyTo(s,l)):this}jumpTo(t,s){this.stop();const l=this._getTransformForUpdate();let u=!1,m=!1,v=!1;return"zoom"in t&&l.zoom!==+t.zoom&&(u=!0,l.zoom=+t.zoom),t.center!==void 0&&(l.center=d.M.convert(t.center)),"bearing"in t&&l.bearing!==+t.bearing&&(m=!0,l.bearing=+t.bearing),"pitch"in t&&l.pitch!==+t.pitch&&(v=!0,l.pitch=+t.pitch),t.padding==null||l.isPaddingEqual(t.padding)||(l.padding=t.padding),this._applyUpdatedTransform(l),this.fire(new d.k("movestart",s)).fire(new d.k("move",s)),u&&this.fire(new d.k("zoomstart",s)).fire(new d.k("zoom",s)).fire(new d.k("zoomend",s)),m&&this.fire(new d.k("rotatestart",s)).fire(new d.k("rotate",s)).fire(new d.k("rotateend",s)),v&&this.fire(new d.k("pitchstart",s)).fire(new d.k("pitch",s)).fire(new d.k("pitchend",s)),this.fire(new d.k("moveend",s))}calculateCameraOptionsFromTo(t,s,l,u=0){const m=d.Y.fromLngLat(t,s),v=d.Y.fromLngLat(l,u),b=v.x-m.x,M=v.y-m.y,I=v.z-m.z,z=Math.hypot(b,M,I);if(z===0)throw new Error("Can't calculate camera options with same From and To");const D=Math.hypot(b,M),O=this.transform.scaleZoom(this.transform.cameraToCenterDistance/z/this.transform.tileSize),V=180*Math.atan2(b,-M)/Math.PI;let G=180*Math.acos(D/z)/Math.PI;return G=I<0?90-G:90+G,{center:v.toLngLat(),zoom:O,pitch:G,bearing:V}}easeTo(t,s){var l;this._stop(!1,t.easeId),((t=d.e({offset:[0,0],duration:500,easing:d.b8},t)).animate===!1||!t.essential&&le.prefersReducedMotion)&&(t.duration=0);const u=this._getTransformForUpdate(),m=this.getZoom(),v=this.getBearing(),b=this.getPitch(),M=this.getPadding(),I="bearing"in t?this._normalizeBearing(t.bearing,v):v,z="pitch"in t?+t.pitch:b,D="padding"in t?t.padding:u.padding,O=d.P.convert(t.offset);let V=u.centerPoint.add(O);const G=u.pointLocation(V),{center:Q,zoom:Z}=u.getConstrained(d.M.convert(t.center||G),(l=t.zoom)!==null&&l!==void 0?l:m);this._normalizeCenter(Q);const ie=u.project(G),pe=u.project(Q).sub(ie),J=u.zoomScale(Z-m);let ge,Se;t.around&&(ge=d.M.convert(t.around),Se=u.locationPoint(ge));const Te={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||Z!==m,this._rotating=this._rotating||v!==I,this._pitching=this._pitching||z!==b,this._padding=!u.isPaddingEqual(D),this._easeId=t.easeId,this._prepareEase(s,t.noMoveStart,Te),this.terrain&&this._prepareElevation(Q),this._ease(Le=>{if(this._zooming&&(u.zoom=d.z.number(m,Z,Le)),this._rotating&&(u.bearing=d.z.number(v,I,Le)),this._pitching&&(u.pitch=d.z.number(b,z,Le)),this._padding&&(u.interpolatePadding(M,D,Le),V=u.centerPoint.add(O)),this.terrain&&!t.freezeElevation&&this._updateElevation(Le),ge)u.setLocationAtPoint(ge,Se);else{const Ue=u.zoomScale(u.zoom-m),st=Z>m?Math.min(2,J):Math.max(.5,J),pt=Math.pow(st,1-Le),Ke=u.unproject(ie.add(pe.mult(Le*pt)).mult(Ue));u.setLocationAtPoint(u.renderWorldCopies?Ke.wrap():Ke,V)}this._applyUpdatedTransform(u),this._fireMoveEvents(s)},Le=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(s,Le)},t),this}_prepareEase(t,s,l={}){this._moving=!0,s||l.moving||this.fire(new d.k("movestart",t)),this._zooming&&!l.zooming&&this.fire(new d.k("zoomstart",t)),this._rotating&&!l.rotating&&this.fire(new d.k("rotatestart",t)),this._pitching&&!l.pitching&&this.fire(new d.k("pitchstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const s=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&s!==this._elevationTarget){const l=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(l-(s-(l*t+this._elevationStart))/(1-t)),this._elevationTarget=s}this.transform.elevation=d.z.number(this._elevationStart,this._elevationTarget,t)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(t){if(!this.transformCameraUpdate)return;const s=t.clone(),{center:l,zoom:u,pitch:m,bearing:v,elevation:b}=this.transformCameraUpdate(s);l&&(s.center=l),u!==void 0&&(s.zoom=u),m!==void 0&&(s.pitch=m),v!==void 0&&(s.bearing=v),b!==void 0&&(s.elevation=b),this.transform.apply(s)}_fireMoveEvents(t){this.fire(new d.k("move",t)),this._zooming&&this.fire(new d.k("zoom",t)),this._rotating&&this.fire(new d.k("rotate",t)),this._pitching&&this.fire(new d.k("pitch",t))}_afterEase(t,s){if(this._easeId&&s&&this._easeId===s)return;delete this._easeId;const l=this._zooming,u=this._rotating,m=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,l&&this.fire(new d.k("zoomend",t)),u&&this.fire(new d.k("rotateend",t)),m&&this.fire(new d.k("pitchend",t)),this.fire(new d.k("moveend",t))}flyTo(t,s){var l;if(!t.essential&&le.prefersReducedMotion){const lt=d.L(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(lt,s)}this.stop(),t=d.e({offset:[0,0],speed:1.2,curve:1.42,easing:d.b8},t);const u=this._getTransformForUpdate(),m=this.getZoom(),v=this.getBearing(),b=this.getPitch(),M=this.getPadding(),I="bearing"in t?this._normalizeBearing(t.bearing,v):v,z="pitch"in t?+t.pitch:b,D="padding"in t?t.padding:u.padding,O=d.P.convert(t.offset);let V=u.centerPoint.add(O);const G=u.pointLocation(V),{center:Q,zoom:Z}=u.getConstrained(d.M.convert(t.center||G),(l=t.zoom)!==null&&l!==void 0?l:m);this._normalizeCenter(Q);const ie=u.zoomScale(Z-m),pe=u.project(G),J=u.project(Q).sub(pe);let ge=t.curve;const Se=Math.max(u.width,u.height),Te=Se/ie,Le=J.mag();if("minZoom"in t){const lt=d.ac(Math.min(t.minZoom,m,Z),u.minZoom,u.maxZoom),Bt=Se/u.zoomScale(lt-m);ge=Math.sqrt(Bt/Le*2)}const Ue=ge*ge;function st(lt){const Bt=(Te*Te-Se*Se+(lt?-1:1)*Ue*Ue*Le*Le)/(2*(lt?Te:Se)*Ue*Le);return Math.log(Math.sqrt(Bt*Bt+1)-Bt)}function pt(lt){return(Math.exp(lt)-Math.exp(-lt))/2}function Ke(lt){return(Math.exp(lt)+Math.exp(-lt))/2}const tt=st(!1);let vt=function(lt){return Ke(tt)/Ke(tt+ge*lt)},jt=function(lt){return Se*((Ke(tt)*(pt(Bt=tt+ge*lt)/Ke(Bt))-pt(tt))/Ue)/Le;var Bt},nt=(st(!0)-tt)/ge;if(Math.abs(Le)<1e-6||!isFinite(nt)){if(Math.abs(Se-Te)<1e-6)return this.easeTo(t,s);const lt=Te<Se?-1:1;nt=Math.abs(Math.log(Te/Se))/ge,jt=()=>0,vt=Bt=>Math.exp(lt*ge*Bt)}return t.duration="duration"in t?+t.duration:1e3*nt/("screenSpeed"in t?+t.screenSpeed/ge:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=v!==I,this._pitching=z!==b,this._padding=!u.isPaddingEqual(D),this._prepareEase(s,!1),this.terrain&&this._prepareElevation(Q),this._ease(lt=>{const Bt=lt*nt,jr=1/vt(Bt);u.zoom=lt===1?Z:m+u.scaleZoom(jr),this._rotating&&(u.bearing=d.z.number(v,I,lt)),this._pitching&&(u.pitch=d.z.number(b,z,lt)),this._padding&&(u.interpolatePadding(M,D,lt),V=u.centerPoint.add(O)),this.terrain&&!t.freezeElevation&&this._updateElevation(lt);const Gt=lt===1?Q:u.unproject(pe.add(J.mult(jt(Bt))).mult(jr));u.setLocationAtPoint(u.renderWorldCopies?Gt.wrap():Gt,V),this._applyUpdatedTransform(u),this._fireMoveEvents(s)},()=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(s)},t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,s){var l;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const u=this._onEaseEnd;delete this._onEaseEnd,u.call(this,s)}return t||(l=this.handlers)===null||l===void 0||l.stop(!1),this}_ease(t,s,l){l.animate===!1||l.duration===0?(t(1),s()):(this._easeStart=le.now(),this._easeOptions=l,this._onEaseFrame=t,this._onEaseEnd=s,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,s){t=d.b2(t,-180,180);const l=Math.abs(t-s);return Math.abs(t-360-s)<l&&(t-=360),Math.abs(t+360-s)<l&&(t+=360),t}_normalizeCenter(t){const s=this.transform;if(!s.renderWorldCopies||s.lngRange)return;const l=t.lng-s.center.lng;t.lng+=l>180?-360:l<-180?360:0}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLatZoom(d.M.convert(t),this.transform.tileZoom)-this.transform.elevation:null}}const Mc={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class wu{constructor(t=Mc){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=s=>{!s||s.sourceDataType!=="metadata"&&s.sourceDataType!=="visibility"&&s.dataType!=="style"&&s.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options.compact,this._container=H.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=H.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=H.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){H.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,s){const l=this._map._getUIString(`AttributionControl.${s}`);t.title=l,t.setAttribute("aria-label",l)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(u=>typeof u!="string"?"":u)):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const u=this._map.style.stylesheet;this.styleOwner=u.owner,this.styleId=u.id}const s=this._map.style.sourceCaches;for(const u in s){const m=s[u];if(m.used||m.usedForTerrain){const v=m.getSource();v.attribution&&t.indexOf(v.attribution)<0&&t.push(v.attribution)}}t=t.filter(u=>String(u).trim()),t.sort((u,m)=>u.length-m.length),t=t.filter((u,m)=>{for(let v=m+1;v<t.length;v++)if(t[v].indexOf(u)>=0)return!1;return!0});const l=t.join(" | ");l!==this._attribHTML&&(this._attribHTML=l,t.length?(this._innerContainer.innerHTML=l,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class pl{constructor(t={}){this._updateCompact=()=>{const s=this._container.children;if(s.length){const l=s[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&l.classList.add("maplibregl-compact"):l.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=H.create("div","maplibregl-ctrl");const s=H.create("a","maplibregl-ctrl-logo");return s.target="_blank",s.rel="noopener nofollow",s.href="https://maplibre.org/",s.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),s.setAttribute("rel","noopener nofollow"),this._container.appendChild(s),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){H.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class ra{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const s=++this._id;return this._queue.push({callback:t,id:s,cancelled:!1}),s}remove(t){const s=this._currentlyRunning,l=s?this._queue.concat(s):this._queue;for(const u of l)if(u.id===t)return void(u.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const s=this._currentlyRunning=this._queue;this._queue=[];for(const l of s)if(!l.cancelled&&(l.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Ls=d.X([{name:"a_pos3d",type:"Int16",components:3}]);class _t extends d.E{constructor(t){super(),this.sourceCache=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,t.usedForTerrain=!0,t.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(t,s){this.sourceCache.update(t,s),this._renderableTilesKeys=[];const l={};for(const u of t.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:s}))l[u.key]=!0,this._renderableTilesKeys.push(u.key),this._tiles[u.key]||(u.posMatrix=new Float64Array(16),d.aO(u.posMatrix,0,d.W,0,d.W,0,1),this._tiles[u.key]=new Jr(u,this.tileSize));for(const u in this._tiles)l[u]||delete this._tiles[u]}freeRtt(t){for(const s in this._tiles){const l=this._tiles[s];(!t||l.tileID.equals(t)||l.tileID.isChildOf(t)||t.isChildOf(l.tileID))&&(l.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(t=>this.getTileByID(t))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t){const s={};for(const l of this._renderableTilesKeys){const u=this._tiles[l].tileID;if(u.canonical.equals(t.canonical)){const m=t.clone();m.posMatrix=new Float64Array(16),d.aO(m.posMatrix,0,d.W,0,d.W,0,1),s[l]=m}else if(u.canonical.isChildOf(t.canonical)){const m=t.clone();m.posMatrix=new Float64Array(16);const v=u.canonical.z-t.canonical.z,b=u.canonical.x-(u.canonical.x>>v<<v),M=u.canonical.y-(u.canonical.y>>v<<v),I=d.W>>v;d.aO(m.posMatrix,0,I,0,I,0,1),d.H(m.posMatrix,m.posMatrix,[-b*I,-M*I,0]),s[l]=m}else if(t.canonical.isChildOf(u.canonical)){const m=t.clone();m.posMatrix=new Float64Array(16);const v=t.canonical.z-u.canonical.z,b=t.canonical.x-(t.canonical.x>>v<<v),M=t.canonical.y-(t.canonical.y>>v<<v),I=d.W>>v;d.aO(m.posMatrix,0,d.W,0,d.W,0,1),d.H(m.posMatrix,m.posMatrix,[b*I,M*I,0]),d.J(m.posMatrix,m.posMatrix,[1/2**v,1/2**v,0]),s[l]=m}}return s}getSourceTile(t,s){const l=this.sourceCache._source;let u=t.overscaledZ-this.deltaZoom;if(u>l.maxzoom&&(u=l.maxzoom),u<l.minzoom)return null;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(u).key);let m=this.sourceCache.getTileByID(this._sourceTileCache[t.key]);if((!m||!m.dem)&&s)for(;u>=l.minzoom&&(!m||!m.dem);)m=this.sourceCache.getTileByID(t.scaledTo(u--).key);return m}tilesAfterTime(t=Date.now()){return Object.values(this._tiles).filter(s=>s.timeAdded>=t)}}class kc{constructor(t,s,l){this.painter=t,this.sourceCache=new _t(s),this.options=l,this.exaggeration=typeof l.exaggeration=="number"?l.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,s,l,u=d.W){var m;if(!(s>=0&&s<u&&l>=0&&l<u))return 0;const v=this.getTerrainData(t),b=(m=v.tile)===null||m===void 0?void 0:m.dem;if(!b)return 0;const M=function(G,Q,Z){var ie=Q[0],pe=Q[1];return G[0]=Z[0]*ie+Z[4]*pe+Z[12],G[1]=Z[1]*ie+Z[5]*pe+Z[13],G}([],[s/u*d.W,l/u*d.W],v.u_terrain_matrix),I=[M[0]*b.dim,M[1]*b.dim],z=Math.floor(I[0]),D=Math.floor(I[1]),O=I[0]-z,V=I[1]-D;return b.get(z,D)*(1-O)*(1-V)+b.get(z+1,D)*O*(1-V)+b.get(z,D+1)*(1-O)*V+b.get(z+1,D+1)*O*V}getElevationForLngLatZoom(t,s){const{tileID:l,mercatorX:u,mercatorY:m}=this._getOverscaledTileIDFromLngLatZoom(t,s);return this.getElevation(l,u%d.W,m%d.W,d.W)}getElevation(t,s,l,u=d.W){return this.getDEMElevation(t,s,l,u)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const u=this.painter.context,m=new d.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new qe(u,m,u.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new qe(u,new d.R({width:1,height:1}),u.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(u.gl.NEAREST,u.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=d.an([])}const s=this.sourceCache.getSourceTile(t,!0);if(s&&s.dem&&(!s.demTexture||s.needsTerrainPrepare)){const u=this.painter.context;s.demTexture=this.painter.getTileTexture(s.dem.stride),s.demTexture?s.demTexture.update(s.dem.getPixels(),{premultiply:!1}):s.demTexture=new qe(u,s.dem.getPixels(),u.gl.RGBA,{premultiply:!1}),s.demTexture.bind(u.gl.NEAREST,u.gl.CLAMP_TO_EDGE),s.needsTerrainPrepare=!1}const l=s&&s+s.tileID.key+t.key;if(l&&!this._demMatrixCache[l]){const u=this.sourceCache.sourceCache._source.maxzoom;let m=t.canonical.z-s.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=u?m=t.canonical.z-u:d.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const v=t.canonical.x-(t.canonical.x>>m<<m),b=t.canonical.y-(t.canonical.y>>m<<m),M=d.ba(new Float64Array(16),[1/(d.W<<m),1/(d.W<<m),0]);d.H(M,M,[v*d.W,b*d.W,0]),this._demMatrixCache[t.key]={matrix:M,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:s&&s.dem&&s.dem.dim||1,u_terrain_matrix:l?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:s&&s.dem&&s.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(s&&s.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:s}}getFramebuffer(t){const s=this.painter,l=s.width/devicePixelRatio,u=s.height/devicePixelRatio;return!this._fbo||this._fbo.width===l&&this._fbo.height===u||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new qe(s.context,{width:l,height:u,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new qe(s.context,{width:l,height:u,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=s.context.createFramebuffer(l,u,!0,!1),this._fbo.depthAttachment.set(s.context.createRenderbuffer(s.context.gl.DEPTH_COMPONENT16,l,u))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const s=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let m=0,v=0;m<this._coordsTextureSize;m++)for(let b=0;b<this._coordsTextureSize;b++,v+=4)s[v+0]=255&b,s[v+1]=255&m,s[v+2]=b>>8<<4|m>>8,s[v+3]=0;const l=new d.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(s.buffer)),u=new qe(t,l,t.gl.RGBA,{premultiply:!1});return u.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=u,u}pointCoordinate(t){this.painter.maybeDrawDepthAndCoords(!0);const s=new Uint8Array(4),l=this.painter.context,u=l.gl,m=Math.round(t.x*this.painter.pixelRatio/devicePixelRatio),v=Math.round(t.y*this.painter.pixelRatio/devicePixelRatio),b=Math.round(this.painter.height/devicePixelRatio);l.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),u.readPixels(m,b-v-1,1,1,u.RGBA,u.UNSIGNED_BYTE,s),l.bindFramebuffer.set(null);const M=s[0]+(s[2]>>4<<8),I=s[1]+((15&s[2])<<8),z=this.coordsIndex[255-s[3]],D=z&&this.sourceCache.getTileByID(z);if(!D)return null;const O=this._coordsTextureSize,V=(1<<D.tileID.canonical.z)*O;return new d.Y((D.tileID.canonical.x*O+M)/V+D.tileID.wrap,(D.tileID.canonical.y*O+I)/V,this.getElevation(D.tileID,M,I,O))}depthAtPoint(t){const s=new Uint8Array(4),l=this.painter.context,u=l.gl;return l.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),u.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,u.RGBA,u.UNSIGNED_BYTE,s),l.bindFramebuffer.set(null),(s[0]/16777216+s[1]/65536+s[2]/256+s[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const t=this.painter.context,s=new d.bb,l=new d.aY,u=this.meshSize,m=d.W/u,v=u*u;for(let D=0;D<=u;D++)for(let O=0;O<=u;O++)s.emplaceBack(O*m,D*m,0);for(let D=0;D<v;D+=u+1)for(let O=0;O<u;O++)l.emplaceBack(O+D,u+O+D+1,u+O+D+2),l.emplaceBack(O+D,u+O+D+2,O+D+1);const b=s.length,M=b+2*(u+1);for(const D of[0,1])for(let O=0;O<=u;O++)for(const V of[0,1])s.emplaceBack(O*m,D*d.W,V);for(let D=0;D<2*u;D+=2)l.emplaceBack(M+D,M+D+1,M+D+3),l.emplaceBack(M+D,M+D+3,M+D+2),l.emplaceBack(b+D,b+D+3,b+D+1),l.emplaceBack(b+D,b+D+2,b+D+3);const I=s.length,z=I+2*(u+1);for(const D of[0,1])for(let O=0;O<=u;O++)for(const V of[0,1])s.emplaceBack(D*d.W,O*m,V);for(let D=0;D<2*u;D+=2)l.emplaceBack(I+D,I+D+1,I+D+3),l.emplaceBack(I+D,I+D+3,I+D+2),l.emplaceBack(z+D,z+D+3,z+D+1),l.emplaceBack(z+D,z+D+2,z+D+3);return this._mesh={indexBuffer:t.createIndexBuffer(l),vertexBuffer:t.createVertexBuffer(s,Ls.members),segments:d.$.simpleSegment(0,0,s.length,l.length)},this._mesh}getMeshFrameDelta(t){return 2*Math.PI*d.bc/Math.pow(2,t)/5}getMinTileElevationForLngLatZoom(t,s){var l;const{tileID:u}=this._getOverscaledTileIDFromLngLatZoom(t,s);return(l=this.getMinMaxElevation(u).minElevation)!==null&&l!==void 0?l:0}getMinMaxElevation(t){const s=this.getTerrainData(t).tile,l={minElevation:null,maxElevation:null};return s&&s.dem&&(l.minElevation=s.dem.min*this.exaggeration,l.maxElevation=s.dem.max*this.exaggeration),l}_getOverscaledTileIDFromLngLatZoom(t,s){const l=d.Y.fromLngLat(t.wrap()),u=(1<<s)*d.W,m=l.x*u,v=l.y*u,b=Math.floor(m/d.W),M=Math.floor(v/d.W);return{tileID:new d.Q(s,0,s,b,M),mercatorX:m,mercatorY:v}}}class xo{constructor(t,s,l){this._context=t,this._size=s,this._tileSize=l,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const s=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),l=new qe(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return l.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),s.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),s.colorAttachment.set(l.texture),{id:t,fbo:s,texture:l,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(s=>t.id!==s),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const s of this._recentlyUsed)if(!this._objects[s].inUse)return this._objects[s];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(t=>!t.inUse)===!1}}const Jn={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Su{constructor(t,s){this.painter=t,this.terrain=s,this.pool=new xo(t.context,30,s.sourceCache.tileSize*s.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,s){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=t._order.filter(l=>!t._layers[l].isHidden(s)),this._coordsDescendingInv={};for(const l in t.sourceCaches){this._coordsDescendingInv[l]={};const u=t.sourceCaches[l].getVisibleCoordinates();for(const m of u){const v=this.terrain.sourceCache.getTerrainCoords(m);for(const b in v)this._coordsDescendingInv[l][b]||(this._coordsDescendingInv[l][b]=[]),this._coordsDescendingInv[l][b].push(v[b])}}this._coordsDescendingInvStr={};for(const l of t._order){const u=t._layers[l],m=u.source;if(Jn[u.type]&&!this._coordsDescendingInvStr[m]){this._coordsDescendingInvStr[m]={};for(const v in this._coordsDescendingInv[m])this._coordsDescendingInvStr[m][v]=this._coordsDescendingInv[m][v].map(b=>b.key).sort().join()}}for(const l of this._renderableTiles)for(const u in this._coordsDescendingInvStr){const m=this._coordsDescendingInvStr[u][l.tileID.key];m&&m!==l.rttCoords[u]&&(l.rtt=[])}}renderLayer(t){if(t.isHidden(this.painter.transform.zoom))return!1;const s=t.type,l=this.painter,u=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(Jn[s]&&(this._prevType&&Jn[this._prevType]||this._stacks.push([]),this._prevType=s,this._stacks[this._stacks.length-1].push(t.id),!u))return!0;if(Jn[this._prevType]||Jn[s]&&u){this._prevType=s;const m=this._stacks.length-1,v=this._stacks[m]||[];for(const b of this._renderableTiles){if(this.pool.isFull()&&(Yo(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(b),b.rtt[m]){const I=this.pool.getObjectForId(b.rtt[m].id);if(I.stamp===b.rtt[m].stamp){this.pool.useObject(I);continue}}const M=this.pool.getOrCreateFreeObject();this.pool.useObject(M),this.pool.stampObject(M),b.rtt[m]={id:M.id,stamp:M.stamp},l.context.bindFramebuffer.set(M.fbo.framebuffer),l.context.clear({color:d.aP.transparent,stencil:0}),l.currentStencilSource=void 0;for(let I=0;I<v.length;I++){const z=l.style._layers[v[I]],D=z.source?this._coordsDescendingInv[z.source][b.tileID.key]:[b.tileID];l.context.viewport.set([0,0,M.fbo.width,M.fbo.height]),l._renderTileClippingMasks(z,D),l.renderLayer(l,l.style.sourceCaches[z.source],z,D),z.source&&(b.rttCoords[z.source]=this._coordsDescendingInvStr[z.source][b.tileID.key])}}return Yo(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),Jn[s]}return!1}}const ot={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Rs=q,Eh={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:Mc,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:d.a.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0},Mu=p=>{p.touchstart=p.dragStart,p.touchmoveWindow=p.dragMove,p.touchend=p.dragEnd},Tc={showCompass:!0,showZoom:!0,visualizePitch:!1};class Cc{constructor(t,s,l=!1){this.mousedown=v=>{this.startMouse(d.e({},v,{ctrlKey:!0,preventDefault:()=>v.preventDefault()}),H.mousePos(this.element,v)),H.addEventListener(window,"mousemove",this.mousemove),H.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=v=>{this.moveMouse(v,H.mousePos(this.element,v))},this.mouseup=v=>{this.mouseRotate.dragEnd(v),this.mousePitch&&this.mousePitch.dragEnd(v),this.offTemp()},this.touchstart=v=>{v.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=H.touchPos(this.element,v.targetTouches)[0],this.startTouch(v,this._startPos),H.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),H.addEventListener(window,"touchend",this.touchend))},this.touchmove=v=>{v.targetTouches.length!==1?this.reset():(this._lastPos=H.touchPos(this.element,v.targetTouches)[0],this.moveTouch(v,this._lastPos))},this.touchend=v=>{v.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const u=t.dragRotate._mouseRotate.getClickTolerance(),m=t.dragRotate._mousePitch.getClickTolerance();this.element=s,this.mouseRotate=yn({clickTolerance:u,enable:!0}),this.touchRotate=(({enable:v,clickTolerance:b,bearingDegreesPerPixelMoved:M=.8})=>{const I=new ti;return new ta({clickTolerance:b,move:(z,D)=>({bearingDelta:(D.x-z.x)*M}),moveStateManager:I,enable:v,assignEvents:Mu})})({clickTolerance:u,enable:!0}),this.map=t,l&&(this.mousePitch=al({clickTolerance:m,enable:!0}),this.touchPitch=(({enable:v,clickTolerance:b,pitchDegreesPerPixelMoved:M=-.5})=>{const I=new ti;return new ta({clickTolerance:b,move:(z,D)=>({pitchDelta:(D.y-z.y)*M}),moveStateManager:I,enable:v,assignEvents:Mu})})({clickTolerance:m,enable:!0})),H.addEventListener(s,"mousedown",this.mousedown),H.addEventListener(s,"touchstart",this.touchstart,{passive:!1}),H.addEventListener(s,"touchcancel",this.reset)}startMouse(t,s){this.mouseRotate.dragStart(t,s),this.mousePitch&&this.mousePitch.dragStart(t,s),H.disableDrag()}startTouch(t,s){this.touchRotate.dragStart(t,s),this.touchPitch&&this.touchPitch.dragStart(t,s),H.disableDrag()}moveMouse(t,s){const l=this.map,{bearingDelta:u}=this.mouseRotate.dragMove(t,s)||{};if(u&&l.setBearing(l.getBearing()+u),this.mousePitch){const{pitchDelta:m}=this.mousePitch.dragMove(t,s)||{};m&&l.setPitch(l.getPitch()+m)}}moveTouch(t,s){const l=this.map,{bearingDelta:u}=this.touchRotate.dragMove(t,s)||{};if(u&&l.setBearing(l.getBearing()+u),this.touchPitch){const{pitchDelta:m}=this.touchPitch.dragMove(t,s)||{};m&&l.setPitch(l.getPitch()+m)}}off(){const t=this.element;H.removeEventListener(t,"mousedown",this.mousedown),H.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),H.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),H.removeEventListener(window,"touchend",this.touchend),H.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){H.enableDrag(),H.removeEventListener(window,"mousemove",this.mousemove),H.removeEventListener(window,"mouseup",this.mouseup),H.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),H.removeEventListener(window,"touchend",this.touchend)}}let xn;function ku(p,t,s){const l=new d.M(p.lng,p.lat);if(p=new d.M(p.lng,p.lat),t){const u=new d.M(p.lng-360,p.lat),m=new d.M(p.lng+360,p.lat),v=s.locationPoint(p).distSqr(t);s.locationPoint(u).distSqr(t)<v?p=u:s.locationPoint(m).distSqr(t)<v&&(p=m)}for(;Math.abs(p.lng-s.center.lng)>180;){const u=s.locationPoint(p);if(u.x>=0&&u.y>=0&&u.x<=s.width&&u.y<=s.height)break;p.lng>s.center.lng?p.lng-=360:p.lng+=360}return p.lng!==l.lng&&s.locationPoint(p).y>s.height/2-s.getHorizon()?p:l}const fl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Fs(p,t,s){const l=p.classList;for(const u in fl)l.remove(`maplibregl-${s}-anchor-${u}`);l.add(`maplibregl-${s}-anchor-${t}`)}class Fr extends d.E{constructor(t){if(super(),this._onKeyPress=s=>{const l=s.code,u=s.charCode||s.keyCode;l!=="Space"&&l!=="Enter"&&u!==32&&u!==13||this.togglePopup()},this._onMapClick=s=>{const l=s.originalEvent.target,u=this._element;this._popup&&(l===u||u.contains(l))&&this.togglePopup()},this._update=s=>{var l;if(!this._map)return;const u=this._map.loaded()&&!this._map.isMoving();((s==null?void 0:s.type)==="terrain"||(s==null?void 0:s.type)==="render"&&!u)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?ku(this._lngLat,this._flatPos,this._map.transform):(l=this._lngLat)===null||l===void 0?void 0:l.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let m="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?m=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(m=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let v="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?v="rotateX(0deg)":this._pitchAlignment==="map"&&(v=`rotateX(${this._map.getPitch()}deg)`),s&&s.type!=="moveend"||(this._pos=this._pos.round()),H.setTransform(this._element,`${fl[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${v} ${m}`),le.frameAsync(new AbortController).then(()=>{this._updateOpacity(s&&s.type==="moveend")}).catch(()=>{})},this._onMove=s=>{if(!this._isDragging){const l=this._clickTolerance||this._map._clickTolerance;this._isDragging=s.point.dist(this._pointerdownPos)>=l}this._isDragging&&(this._pos=s.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new d.k("dragstart"))),this.fire(new d.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new d.k("dragend")),this._state="inactive"},this._addDragHandler=s=>{this._element.contains(s.originalEvent.target)&&(s.preventDefault(),this._positionDelta=s.point.sub(this._pos).add(this._offset),this._pointerdownPos=s.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(t==null?void 0:t.opacity,t==null?void 0:t.opacityWhenCovered),t&&t.element)this._element=t.element,this._offset=d.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=H.create("div"),this._element.setAttribute("aria-label","Map marker");const s=H.createNS("http://www.w3.org/2000/svg","svg"),l=41,u=27;s.setAttributeNS(null,"display","block"),s.setAttributeNS(null,"height",`${l}px`),s.setAttributeNS(null,"width",`${u}px`),s.setAttributeNS(null,"viewBox",`0 0 ${u} ${l}`);const m=H.createNS("http://www.w3.org/2000/svg","g");m.setAttributeNS(null,"stroke","none"),m.setAttributeNS(null,"stroke-width","1"),m.setAttributeNS(null,"fill","none"),m.setAttributeNS(null,"fill-rule","evenodd");const v=H.createNS("http://www.w3.org/2000/svg","g");v.setAttributeNS(null,"fill-rule","nonzero");const b=H.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"transform","translate(3.0, 29.0)"),b.setAttributeNS(null,"fill","#000000");const M=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ie of M){const pe=H.createNS("http://www.w3.org/2000/svg","ellipse");pe.setAttributeNS(null,"opacity","0.04"),pe.setAttributeNS(null,"cx","10.5"),pe.setAttributeNS(null,"cy","5.80029008"),pe.setAttributeNS(null,"rx",ie.rx),pe.setAttributeNS(null,"ry",ie.ry),b.appendChild(pe)}const I=H.createNS("http://www.w3.org/2000/svg","g");I.setAttributeNS(null,"fill",this._color);const z=H.createNS("http://www.w3.org/2000/svg","path");z.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),I.appendChild(z);const D=H.createNS("http://www.w3.org/2000/svg","g");D.setAttributeNS(null,"opacity","0.25"),D.setAttributeNS(null,"fill","#000000");const O=H.createNS("http://www.w3.org/2000/svg","path");O.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),D.appendChild(O);const V=H.createNS("http://www.w3.org/2000/svg","g");V.setAttributeNS(null,"transform","translate(6.0, 7.0)"),V.setAttributeNS(null,"fill","#FFFFFF");const G=H.createNS("http://www.w3.org/2000/svg","g");G.setAttributeNS(null,"transform","translate(8.0, 8.0)");const Q=H.createNS("http://www.w3.org/2000/svg","circle");Q.setAttributeNS(null,"fill","#000000"),Q.setAttributeNS(null,"opacity","0.25"),Q.setAttributeNS(null,"cx","5.5"),Q.setAttributeNS(null,"cy","5.5"),Q.setAttributeNS(null,"r","5.4999962");const Z=H.createNS("http://www.w3.org/2000/svg","circle");Z.setAttributeNS(null,"fill","#FFFFFF"),Z.setAttributeNS(null,"cx","5.5"),Z.setAttributeNS(null,"cy","5.5"),Z.setAttributeNS(null,"r","5.4999962"),G.appendChild(Q),G.appendChild(Z),v.appendChild(b),v.appendChild(I),v.appendChild(D),v.appendChild(V),v.appendChild(G),s.appendChild(v),s.setAttributeNS(null,"height",l*this._scale+"px"),s.setAttributeNS(null,"width",u*this._scale+"px"),this._element.appendChild(s),this._offset=d.P.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",s=>{s.preventDefault()}),this._element.addEventListener("mousedown",s=>{s.preventDefault()}),Fs(this._element,this._anchor,"marker"),t&&t.className)for(const s of t.className.split(" "))this._element.classList.add(s);this._popup=null}addTo(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),H.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=d.M.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const u=Math.abs(13.5)/Math.SQRT2;t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[u,-1*(38.1-13.5+u)],"bottom-right":[-u,-1*(38.1-13.5+u)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:t?(t.isOpen()?t.remove():(t.setLngLat(this._lngLat),t.addTo(this._map)),this):this}_updateOpacity(t=!1){var s,l;if(!(!((s=this._map)===null||s===void 0)&&s.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(t)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const u=this._map,m=u.terrain.depthAtPoint(this._pos),v=u.terrain.getElevationForLngLatZoom(this._lngLat,u.transform.tileZoom);if(u.transform.lngLatToCameraDepth(this._lngLat,v)-m<.006)return void(this._element.style.opacity=this._opacity);const b=-this._offset.y/u.transform._pixelPerMeter,M=Math.sin(u.getPitch()*Math.PI/180)*b,I=u.terrain.depthAtPoint(new d.P(this._pos.x,this._pos.y-this._offset.y)),z=u.transform.lngLatToCameraDepth(this._lngLat,v+M)-I>.006;!((l=this._popup)===null||l===void 0)&&l.isOpen()&&z&&this._popup.remove(),this._element.style.opacity=z?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(t){return this._offset=d.P.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(t,s){return t===void 0&&s===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),t!==void 0&&(this._opacity=t),s!==void 0&&(this._opacityWhenCovered=s),this._map&&this._updateOpacity(!0),this}}const ml={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let ja=0,Va=!1;const Tu={maxWidth:100,unit:"metric"};function Ic(p,t,s){const l=s&&s.maxWidth||100,u=p._container.clientHeight/2,m=p.unproject([0,u]),v=p.unproject([l,u]),b=m.distanceTo(v);if(s&&s.unit==="imperial"){const M=3.2808*b;M>5280?bo(t,l,M/5280,p._getUIString("ScaleControl.Miles")):bo(t,l,M,p._getUIString("ScaleControl.Feet"))}else s&&s.unit==="nautical"?bo(t,l,b/1852,p._getUIString("ScaleControl.NauticalMiles")):b>=1e3?bo(t,l,b/1e3,p._getUIString("ScaleControl.Kilometers")):bo(t,l,b,p._getUIString("ScaleControl.Meters"))}function bo(p,t,s,l){const u=function(m){const v=Math.pow(10,`${Math.floor(m)}`.length-1);let b=m/v;return b=b>=10?10:b>=5?5:b>=3?3:b>=2?2:b>=1?1:function(M){const I=Math.pow(10,Math.ceil(-Math.log(M)/Math.LN10));return Math.round(M*I)/I}(b),v*b}(s);p.style.width=t*(u/s)+"px",p.innerHTML=`${u}&nbsp;${l}`}const Yn={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},gl=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Tt(p){if(p){if(typeof p=="number"){const t=Math.round(Math.abs(p)/Math.SQRT2);return{center:new d.P(0,0),top:new d.P(0,p),"top-left":new d.P(t,t),"top-right":new d.P(-t,t),bottom:new d.P(0,-p),"bottom-left":new d.P(t,-t),"bottom-right":new d.P(-t,-t),left:new d.P(p,0),right:new d.P(-p,0)}}if(p instanceof d.P||Array.isArray(p)){const t=d.P.convert(p);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:d.P.convert(p.center||[0,0]),top:d.P.convert(p.top||[0,0]),"top-left":d.P.convert(p["top-left"]||[0,0]),"top-right":d.P.convert(p["top-right"]||[0,0]),bottom:d.P.convert(p.bottom||[0,0]),"bottom-left":d.P.convert(p["bottom-left"]||[0,0]),"bottom-right":d.P.convert(p["bottom-right"]||[0,0]),left:d.P.convert(p.left||[0,0]),right:d.P.convert(p.right||[0,0])}}return Tt(new d.P(0,0))}const Ft=q;S.AJAXError=d.bf,S.Evented=d.E,S.LngLat=d.M,S.MercatorCoordinate=d.Y,S.Point=d.P,S.addProtocol=d.bg,S.config=d.a,S.removeProtocol=d.bh,S.AttributionControl=wu,S.BoxZoomHandler=vo,S.CanvasSource=Rr,S.CooperativeGesturesHandler=cn,S.DoubleClickZoomHandler=Ds,S.DragPanHandler=bc,S.DragRotateHandler=$a,S.EdgeInsets=Qs,S.FullscreenControl=class extends d.E{constructor(p={}){super(),this._onFullscreenChange=()=>{var t;let s=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((t=s==null?void 0:s.shadowRoot)===null||t===void 0)&&t.fullscreenElement;)s=s.shadowRoot.fullscreenElement;s===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,p&&p.container&&(p.container instanceof HTMLElement?this._container=p.container:d.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(p){return this._map=p,this._container||(this._container=this._map.getContainer()),this._controlContainer=H.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){H.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const p=this._fullscreenButton=H.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);H.create("span","maplibregl-ctrl-icon",p).setAttribute("aria-hidden","true"),p.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const p=this._getTitle();this._fullscreenButton.setAttribute("aria-label",p),this._fullscreenButton.title=p}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new d.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new d.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},S.GeoJSONSource=er,S.GeolocateControl=class extends d.E{constructor(p){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new d.k("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new d.k("geolocate",t)),this._finish()}},this._updateCamera=t=>{const s=new d.M(t.coords.longitude,t.coords.latitude),l=t.coords.accuracy,u=this._map.getBearing(),m=d.e({bearing:u},this.options.fitBoundsOptions),v=sr.fromLngLat(s,l);this._map.fitBounds(v,m,{geolocateSource:!0})},this._updateMarker=t=>{if(t){const s=new d.M(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(s).addTo(this._map),this._userLocationDotMarker.setLngLat(s).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=t=>{if(this._map){if(this.options.trackUserLocation)if(t.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&Va)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new d.k("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=t=>{if(this._map){if(this._container.addEventListener("contextmenu",s=>s.preventDefault()),this._geolocateButton=H.create("button","maplibregl-ctrl-geolocate",this._container),H.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",t===!1){d.w("Geolocation support is not available so the GeolocateControl will be disabled.");const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}else{const s=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=H.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Fr({element:this._dotElement}),this._circleElement=H.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Fr({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",s=>{s.geolocateSource||this._watchState!=="ACTIVE_LOCK"||s.originalEvent&&s.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new d.k("trackuserlocationend")))})}},this.options=d.e({},ml,p)}onAdd(p){return this._map=p,this._container=H.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(){return d._(this,arguments,void 0,function*(t=!1){if(xn!==void 0&&!t)return xn;if(window.navigator.permissions===void 0)return xn=!!window.navigator.geolocation,xn;try{xn=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{xn=!!window.navigator.geolocation}return xn})}().then(t=>this._setupUI(t)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),H.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,ja=0,Va=!1}_isOutOfMapMaxBounds(p){const t=this._map.getMaxBounds(),s=p.coords;return t&&(s.longitude<t.getWest()||s.longitude>t.getEast()||s.latitude<t.getSouth()||s.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const p=this._map.getBounds(),t=p.getSouthEast(),s=p.getNorthEast(),l=t.distanceTo(s),u=Math.ceil(this._accuracy/(l/this._map._container.clientHeight)*2);this._circleElement.style.width=`${u}px`,this._circleElement.style.height=`${u}px`}trigger(){if(!this._setup)return d.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new d.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":ja--,Va=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new d.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new d.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let p;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),ja++,ja>1?(p={maximumAge:6e5,timeout:0},Va=!0):(p=this.options.positionOptions,Va=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,p)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},S.Hash=fc,S.ImageSource=Qr,S.KeyboardHandler=Ps,S.LngLatBounds=sr,S.LogoControl=pl,S.Map=class extends bu{constructor(p){if(d.bd.mark(d.be.create),(p=d.e({},Eh,p)).minZoom!=null&&p.maxZoom!=null&&p.minZoom>p.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(p.minPitch!=null&&p.maxPitch!=null&&p.minPitch>p.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(p.minPitch!=null&&p.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(p.maxPitch!=null&&p.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new mo(p.minZoom,p.maxZoom,p.minPitch,p.maxPitch,p.renderWorldCopies),{bearingSnap:p.bearingSnap}),this._contextLost=t=>{t.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new d.k("webglcontextlost",{originalEvent:t}))},this._contextRestored=t=>{this._setupPainter(),this.resize(),this._update(),this.fire(new d.k("webglcontextrestored",{originalEvent:t}))},this._onMapScroll=t=>{if(t.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=p.interactive,this._maxTileCacheSize=p.maxTileCacheSize,this._maxTileCacheZoomLevels=p.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=p.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=p.preserveDrawingBuffer,this._antialias=p.antialias,this._trackResize=p.trackResize,this._bearingSnap=p.bearingSnap,this._refreshExpiredTiles=p.refreshExpiredTiles,this._fadeDuration=p.fadeDuration,this._crossSourceCollisions=p.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=p.collectResourceTiming,this._renderTaskQueue=new ra,this._controls=[],this._mapId=d.a3(),this._locale=d.e({},ot,p.locale),this._clickTolerance=p.clickTolerance,this._overridePixelRatio=p.pixelRatio,this._maxCanvasSize=p.maxCanvasSize,this.transformCameraUpdate=p.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=p.cancelPendingTileRequestsWhileZooming,this._imageQueueHandle=_e.addThrottleControl(()=>this.isMoving()),this._requestManager=new je(p.transformRequest),typeof p.container=="string"){if(this._container=document.getElementById(p.container),!this._container)throw new Error(`Container '${p.container}' not found.`)}else{if(!(p.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=p.container}if(p.maxBounds&&this.setMaxBounds(p.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let t=!1;const s=_u(l=>{this._trackResize&&!this._removed&&this.resize(l)._update()},50);this._resizeObserver=new ResizeObserver(l=>{t?s(l):t=!0}),this._resizeObserver.observe(this._container)}this.handlers=new zs(this,p),this._hash=p.hash&&new fc(typeof p.hash=="string"&&p.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch}),p.bounds&&(this.resize(),this.fitBounds(p.bounds,d.e({},p.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=p.localIdeographFontFamily,this._validateStyle=p.validateStyle,p.style&&this.setStyle(p.style,{localIdeographFontFamily:p.localIdeographFontFamily}),p.attributionControl&&this.addControl(new wu(typeof p.attributionControl=="boolean"?void 0:p.attributionControl)),p.maplibreLogo&&this.addControl(new pl,p.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",t=>{this._update(t.dataType==="style"),this.fire(new d.k(`${t.dataType}data`,t))}),this.on("dataloading",t=>{this.fire(new d.k(`${t.dataType}dataloading`,t))}),this.on("dataabort",t=>{this.fire(new d.k("sourcedataabort",t))})}_getMapId(){return this._mapId}addControl(p,t){if(t===void 0&&(t=p.getDefaultPosition?p.getDefaultPosition():"top-right"),!p||!p.onAdd)return this.fire(new d.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const s=p.onAdd(this);this._controls.push(p);const l=this._controlPositions[t];return t.indexOf("bottom")!==-1?l.insertBefore(s,l.firstChild):l.appendChild(s),this}removeControl(p){if(!p||!p.onRemove)return this.fire(new d.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(p);return t>-1&&this._controls.splice(t,1),p.onRemove(this),this}hasControl(p){return this._controls.indexOf(p)>-1}calculateCameraOptionsFromTo(p,t,s,l){return l==null&&this.terrain&&(l=this.terrain.getElevationForLngLatZoom(s,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(p,t,s,l)}resize(p){var t;const s=this._containerDimensions(),l=s[0],u=s[1],m=this._getClampedPixelRatio(l,u);if(this._resizeCanvas(l,u,m),this.painter.resize(l,u,m),this.painter.overLimit()){const b=this.painter.context.gl;this._maxCanvasSize=[b.drawingBufferWidth,b.drawingBufferHeight];const M=this._getClampedPixelRatio(l,u);this._resizeCanvas(l,u,M),this.painter.resize(l,u,M)}this.transform.resize(l,u),(t=this._requestedCameraState)===null||t===void 0||t.resize(l,u);const v=!this._moving;return v&&(this.stop(),this.fire(new d.k("movestart",p)).fire(new d.k("move",p))),this.fire(new d.k("resize",p)),v&&this.fire(new d.k("moveend",p)),this}_getClampedPixelRatio(p,t){const{0:s,1:l}=this._maxCanvasSize,u=this.getPixelRatio(),m=p*u,v=t*u;return Math.min(m>s?s/m:1,v>l?l/v:1)*u}getPixelRatio(){var p;return(p=this._overridePixelRatio)!==null&&p!==void 0?p:devicePixelRatio}setPixelRatio(p){this._overridePixelRatio=p,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(p){return this.transform.setMaxBounds(sr.convert(p)),this._update()}setMinZoom(p){if((p=p??-2)>=-2&&p<=this.transform.maxZoom)return this.transform.minZoom=p,this._update(),this.getZoom()<p&&this.setZoom(p),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(p){if((p=p??22)>=this.transform.minZoom)return this.transform.maxZoom=p,this._update(),this.getZoom()>p&&this.setZoom(p),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(p){if((p=p??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(p>=0&&p<=this.transform.maxPitch)return this.transform.minPitch=p,this._update(),this.getPitch()<p&&this.setPitch(p),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(p){if((p=p??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(p>=this.transform.minPitch)return this.transform.maxPitch=p,this._update(),this.getPitch()>p&&this.setPitch(p),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(p){return this.transform.renderWorldCopies=p,this._update()}project(p){return this.transform.locationPoint(d.M.convert(p),this.style&&this.terrain)}unproject(p){return this.transform.pointLocation(d.P.convert(p),this.terrain)}isMoving(){var p;return this._moving||((p=this.handlers)===null||p===void 0?void 0:p.isMoving())}isZooming(){var p;return this._zooming||((p=this.handlers)===null||p===void 0?void 0:p.isZooming())}isRotating(){var p;return this._rotating||((p=this.handlers)===null||p===void 0?void 0:p.isRotating())}_createDelegatedListener(p,t,s){if(p==="mouseenter"||p==="mouseover"){let l=!1;return{layer:t,listener:s,delegates:{mousemove:m=>{const v=this.getLayer(t)?this.queryRenderedFeatures(m.point,{layers:[t]}):[];v.length?l||(l=!0,s.call(this,new $i(p,this,m.originalEvent,{features:v}))):l=!1},mouseout:()=>{l=!1}}}}if(p==="mouseleave"||p==="mouseout"){let l=!1;return{layer:t,listener:s,delegates:{mousemove:v=>{(this.getLayer(t)?this.queryRenderedFeatures(v.point,{layers:[t]}):[]).length?l=!0:l&&(l=!1,s.call(this,new $i(p,this,v.originalEvent)))},mouseout:v=>{l&&(l=!1,s.call(this,new $i(p,this,v.originalEvent)))}}}}{const l=u=>{const m=this.getLayer(t)?this.queryRenderedFeatures(u.point,{layers:[t]}):[];m.length&&(u.features=m,s.call(this,u),delete u.features)};return{layer:t,listener:s,delegates:{[p]:l}}}}on(p,t,s){if(s===void 0)return super.on(p,t);const l=this._createDelegatedListener(p,t,s);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[p]=this._delegatedListeners[p]||[],this._delegatedListeners[p].push(l);for(const u in l.delegates)this.on(u,l.delegates[u]);return this}once(p,t,s){if(s===void 0)return super.once(p,t);const l=this._createDelegatedListener(p,t,s);for(const u in l.delegates)this.once(u,l.delegates[u]);return this}off(p,t,s){return s===void 0?super.off(p,t):(this._delegatedListeners&&this._delegatedListeners[p]&&(l=>{const u=this._delegatedListeners[p];for(let m=0;m<u.length;m++){const v=u[m];if(v.layer===t&&v.listener===s){for(const b in v.delegates)this.off(b,v.delegates[b]);return u.splice(m,1),this}}})(),this)}queryRenderedFeatures(p,t){if(!this.style)return[];let s;const l=p instanceof d.P||Array.isArray(p),u=l?p:[[0,0],[this.transform.width,this.transform.height]];if(t=t||(l?{}:p)||{},u instanceof d.P||typeof u[0]=="number")s=[d.P.convert(u)];else{const m=d.P.convert(u[0]),v=d.P.convert(u[1]);s=[m,new d.P(v.x,m.y),v,new d.P(m.x,v.y),m]}return this.style.queryRenderedFeatures(s,t,this.transform)}querySourceFeatures(p,t){return this.style.querySourceFeatures(p,t)}setStyle(p,t){return(t=d.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&p?(this._diffStyle(p,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(p,t))}setTransformRequest(p){return this._requestManager.setTransformRequest(p),this}_getUIString(p){const t=this._locale[p];if(t==null)throw new Error(`Missing UI string '${p}'`);return t}_updateStyle(p,t){if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(p,t));const s=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!p)),p?(this.style=new to(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof p=="string"?this.style.loadURL(p,t,s):this.style.loadJSON(p,t,s),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new to(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(p,t){if(typeof p=="string"){const s=this._requestManager.transformRequest(p,"Style");d.h(s,new AbortController).then(l=>{this._updateDiff(l.data,t)}).catch(l=>{l&&this.fire(new d.j(l))})}else typeof p=="object"&&this._updateDiff(p,t)}_updateDiff(p,t){try{this.style.setState(p,t)&&this._update(!0)}catch(s){d.w(`Unable to perform style diff: ${s.message||s.error||s}.  Rebuilding the style from scratch.`),this._updateStyle(p,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():d.w("There is no style added to the map.")}addSource(p,t){return this._lazyInitEmptyStyle(),this.style.addSource(p,t),this._update(!0)}isSourceLoaded(p){const t=this.style&&this.style.sourceCaches[p];if(t!==void 0)return t.loaded();this.fire(new d.j(new Error(`There is no source with ID '${p}'`)))}setTerrain(p){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),p){const t=this.style.sourceCaches[p.source];if(!t)throw new Error(`cannot load terrain, because there exists no source with ID: ${p.source}`);this.terrain===null&&t.reload();for(const s in this.style._layers){const l=this.style._layers[s];l.type==="hillshade"&&l.source===p.source&&d.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new kc(this.painter,t,p),this.painter.renderToTexture=new Su(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=s=>{s.dataType==="style"?this.terrain.sourceCache.freeRtt():s.dataType==="source"&&s.tile&&(s.sourceId!==p.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(s.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new d.k("terrain",{terrain:p})),this}getTerrain(){var p,t;return(t=(p=this.terrain)===null||p===void 0?void 0:p.options)!==null&&t!==void 0?t:null}areTilesLoaded(){const p=this.style&&this.style.sourceCaches;for(const t in p){const s=p[t]._tiles;for(const l in s){const u=s[l];if(u.state!=="loaded"&&u.state!=="errored")return!1}}return!0}removeSource(p){return this.style.removeSource(p),this._update(!0)}getSource(p){return this.style.getSource(p)}addImage(p,t,s={}){const{pixelRatio:l=1,sdf:u=!1,stretchX:m,stretchY:v,content:b,textFitWidth:M,textFitHeight:I}=s;if(this._lazyInitEmptyStyle(),!(t instanceof HTMLImageElement||d.b(t))){if(t.width===void 0||t.height===void 0)return this.fire(new d.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:z,height:D,data:O}=t,V=t;return this.style.addImage(p,{data:new d.R({width:z,height:D},new Uint8Array(O)),pixelRatio:l,stretchX:m,stretchY:v,content:b,textFitWidth:M,textFitHeight:I,sdf:u,version:0,userImage:V}),V.onAdd&&V.onAdd(this,p),this}}{const{width:z,height:D,data:O}=le.getImageData(t);this.style.addImage(p,{data:new d.R({width:z,height:D},O),pixelRatio:l,stretchX:m,stretchY:v,content:b,textFitWidth:M,textFitHeight:I,sdf:u,version:0})}}updateImage(p,t){const s=this.style.getImage(p);if(!s)return this.fire(new d.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const l=t instanceof HTMLImageElement||d.b(t)?le.getImageData(t):t,{width:u,height:m,data:v}=l;if(u===void 0||m===void 0)return this.fire(new d.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(u!==s.data.width||m!==s.data.height)return this.fire(new d.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const b=!(t instanceof HTMLImageElement||d.b(t));return s.data.replace(v,b),this.style.updateImage(p,s),this}getImage(p){return this.style.getImage(p)}hasImage(p){return p?!!this.style.getImage(p):(this.fire(new d.j(new Error("Missing required image id"))),!1)}removeImage(p){this.style.removeImage(p)}loadImage(p){return _e.getImage(this._requestManager.transformRequest(p,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(p,t){return this._lazyInitEmptyStyle(),this.style.addLayer(p,t),this._update(!0)}moveLayer(p,t){return this.style.moveLayer(p,t),this._update(!0)}removeLayer(p){return this.style.removeLayer(p),this._update(!0)}getLayer(p){return this.style.getLayer(p)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(p,t,s){return this.style.setLayerZoomRange(p,t,s),this._update(!0)}setFilter(p,t,s={}){return this.style.setFilter(p,t,s),this._update(!0)}getFilter(p){return this.style.getFilter(p)}setPaintProperty(p,t,s,l={}){return this.style.setPaintProperty(p,t,s,l),this._update(!0)}getPaintProperty(p,t){return this.style.getPaintProperty(p,t)}setLayoutProperty(p,t,s,l={}){return this.style.setLayoutProperty(p,t,s,l),this._update(!0)}getLayoutProperty(p,t){return this.style.getLayoutProperty(p,t)}setGlyphs(p,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(p,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(p,t,s={}){return this._lazyInitEmptyStyle(),this.style.addSprite(p,t,s,l=>{l||this._update(!0)}),this}removeSprite(p){return this._lazyInitEmptyStyle(),this.style.removeSprite(p),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(p,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(p,t,s=>{s||this._update(!0)}),this}setLight(p,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(p,t),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(p,t){return this.style.setFeatureState(p,t),this._update()}removeFeatureState(p,t){return this.style.removeFeatureState(p,t),this._update()}getFeatureState(p){return this.style.getFeatureState(p)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let p=0,t=0;return this._container&&(p=this._container.clientWidth||400,t=this._container.clientHeight||300),[p,t]}_setupContainer(){const p=this._container;p.classList.add("maplibregl-map");const t=this._canvasContainer=H.create("div","maplibregl-canvas-container",p);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=H.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const s=this._containerDimensions(),l=this._getClampedPixelRatio(s[0],s[1]);this._resizeCanvas(s[0],s[1],l);const u=this._controlContainer=H.create("div","maplibregl-control-container",p),m=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(v=>{m[v]=H.create("div",`maplibregl-ctrl-${v} `,u)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(p,t,s){this._canvas.width=Math.floor(s*p),this._canvas.height=Math.floor(s*t),this._canvas.style.width=`${p}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const p={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let t=null;this._canvas.addEventListener("webglcontextcreationerror",l=>{t={requestedAttributes:p},l&&(t.statusMessage=l.statusMessage,t.type=l.type)},{once:!0});const s=this._canvas.getContext("webgl2",p)||this._canvas.getContext("webgl",p);if(!s){const l="Failed to initialize WebGL";throw t?(t.message=l,new Error(JSON.stringify(t))):new Error(l)}this.painter=new yr(s,this.transform),Ge.testSupport(s)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(p){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||p,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(p){return this._update(),this._renderTaskQueue.add(p)}_cancelRenderFrame(p){this._renderTaskQueue.remove(p)}_render(p){const t=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(p),this._removed)return;let s=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const u=this.transform.zoom,m=le.now();this.style.zoomHistory.update(u,m);const v=new d.a8(u,{now:m,fadeDuration:t,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),b=v.crossFadingFactor();b===1&&b===this._crossFadingFactor||(s=!0,this._crossFadingFactor=b),this.style.update(v)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,t,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:t,showPadding:this.showPadding}),this.fire(new d.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,d.bd.mark(d.be.load),this.fire(new d.k("load"))),this.style&&(this.style.hasTransitions()||s)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const l=this._sourcesDirty||this._styleDirty||this._placementDirty;return l||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new d.k("idle")),!this._loaded||this._fullyLoaded||l||(this._fullyLoaded=!0,d.bd.mark(d.be.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var p;this._hash&&this._hash.remove();for(const s of this._controls)s.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),_e.removeThrottleControl(this._imageQueueHandle),(p=this._resizeObserver)===null||p===void 0||p.disconnect();const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t&&t.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),H.remove(this._canvasContainer),H.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),d.bd.clearMetrics(),this._removed=!0,this.fire(new d.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,le.frameAsync(this._frameRequest).then(p=>{d.bd.frame(p),this._frameRequest=null,this._render(p)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(p){this._showTileBoundaries!==p&&(this._showTileBoundaries=p,this._update())}get showPadding(){return!!this._showPadding}set showPadding(p){this._showPadding!==p&&(this._showPadding=p,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(p){this._showCollisionBoxes!==p&&(this._showCollisionBoxes=p,p?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(p){this._showOverdrawInspector!==p&&(this._showOverdrawInspector=p,this._update())}get repaint(){return!!this._repaint}set repaint(p){this._repaint!==p&&(this._repaint=p,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(p){this._vertices=p,this._update()}get version(){return Rs}getCameraTargetElevation(){return this.transform.elevation}},S.MapMouseEvent=$i,S.MapTouchEvent=ea,S.MapWheelEvent=gc,S.Marker=Fr,S.NavigationControl=class{constructor(p){this._updateZoomButtons=()=>{const t=this._map.getZoom(),s=t===this._map.getMaxZoom(),l=t===this._map.getMinZoom();this._zoomInButton.disabled=s,this._zoomOutButton.disabled=l,this._zoomInButton.setAttribute("aria-disabled",s.toString()),this._zoomOutButton.setAttribute("aria-disabled",l.toString())},this._rotateCompassArrow=()=>{const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=t},this._setButtonTitle=(t,s)=>{const l=this._map._getUIString(`NavigationControl.${s}`);t.title=l,t.setAttribute("aria-label",l)},this.options=d.e({},Tc,p),this._container=H.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",t=>this._map.zoomIn({},{originalEvent:t})),H.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",t=>this._map.zoomOut({},{originalEvent:t})),H.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}),this._compassIcon=H.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(p){return this._map=p,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Cc(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){H.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(p,t){const s=H.create("button",p,this._container);return s.type="button",s.addEventListener("click",t),s}},S.Popup=class extends d.E{constructor(p){super(),this.remove=()=>(this._content&&H.remove(this._content),this._container&&(H.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new d.k("close"))),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{var s;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=H.create("div","maplibregl-popup",this._map.getContainer()),this._tip=H.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const b of this.options.className.split(" "))this._container.classList.add(b);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?ku(this._lngLat,this._flatPos,this._map.transform):(s=this._lngLat)===null||s===void 0?void 0:s.wrap(),this._trackPointer&&!t)return;const l=this._flatPos=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&t?t:this._map.transform.locationPoint(this._lngLat));let u=this.options.anchor;const m=Tt(this.options.offset);if(!u){const b=this._container.offsetWidth,M=this._container.offsetHeight;let I;I=l.y+m.bottom.y<M?["top"]:l.y>this._map.transform.height-M?["bottom"]:[],l.x<b/2?I.push("left"):l.x>this._map.transform.width-b/2&&I.push("right"),u=I.length===0?"bottom":I.join("-")}let v=l.add(m[u]);this.options.subpixelPositioning||(v=v.round()),H.setTransform(this._container,`${fl[u]} translate(${v.x}px,${v.y}px)`),Fs(this._container,u,"popup")},this._onClose=()=>{this.remove()},this.options=d.e(Object.create(Yn),p)}addTo(p){return this._map&&this.remove(),this._map=p,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new d.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(p){return this._lngLat=d.M.convert(p),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(p){return this.setDOMContent(document.createTextNode(p))}setHTML(p){const t=document.createDocumentFragment(),s=document.createElement("body");let l;for(s.innerHTML=p;l=s.firstChild,l;)t.appendChild(l);return this.setDOMContent(t)}getMaxWidth(){var p;return(p=this._container)===null||p===void 0?void 0:p.style.maxWidth}setMaxWidth(p){return this.options.maxWidth=p,this._update(),this}setDOMContent(p){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=H.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(p),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(p){return this._container&&this._container.classList.add(p),this}removeClassName(p){return this._container&&this._container.classList.remove(p),this}setOffset(p){return this.options.offset=p,this._update(),this}toggleClassName(p){if(this._container)return this._container.classList.toggle(p)}setSubpixelPositioning(p){this.options.subpixelPositioning=p}_createCloseButton(){this.options.closeButton&&(this._closeButton=H.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const p=this._container.querySelector(gl);p&&p.focus()}},S.RasterDEMTileSource=oi,S.RasterTileSource=ai,S.ScaleControl=class{constructor(p){this._onMove=()=>{Ic(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,Ic(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Tu),p)}getDefaultPosition(){return"bottom-left"}onAdd(p){return this._map=p,this._container=H.create("div","maplibregl-ctrl maplibregl-ctrl-scale",p.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){H.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},S.ScrollZoomHandler=xc,S.Style=to,S.TerrainControl=class{constructor(p){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=p}onAdd(p){return this._map=p,this._container=H.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=H.create("button","maplibregl-ctrl-terrain",this._container),H.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){H.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},S.TwoFingersTouchPitchHandler=dl,S.TwoFingersTouchRotateHandler=ul,S.TwoFingersTouchZoomHandler=ll,S.TwoFingersTouchZoomRotateHandler=wc,S.VectorTileSource=Ce,S.VideoSource=Tr,S.addSourceType=(p,t)=>d._(void 0,void 0,void 0,function*(){if(cr(p))throw new Error(`A source type called "${p}" already exists.`);((s,l)=>{Hi[s]=l})(p,t)}),S.clearPrewarmedResources=function(){const p=Ht;p&&(p.isPreloaded()&&p.numActive()===1?(p.release(Ze),Ht=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},S.getMaxParallelImageRequests=function(){return d.a.MAX_PARALLEL_IMAGE_REQUESTS},S.getRTLTextPluginStatus=function(){return Kr().getRTLTextPluginStatus()},S.getVersion=function(){return Ft},S.getWorkerCount=function(){return Ot.workerCount},S.getWorkerUrl=function(){return d.a.WORKER_URL},S.importScriptInWorkers=function(p){return Lt().broadcast("IS",p)},S.prewarm=function(){Qt().acquire(Ze)},S.setMaxParallelImageRequests=function(p){d.a.MAX_PARALLEL_IMAGE_REQUESTS=p},S.setRTLTextPlugin=function(p,t){return Kr().setRTLTextPlugin(p,t)},S.setWorkerCount=function(p){Ot.workerCount=p},S.setWorkerUrl=function(p){d.a.WORKER_URL=p}});var T=h;return T})})(ox);var DS=ox.exports;const G0=xg(DS);var cx={exports:{}};/* @license
Papa Parse
v5.4.1
https://github.com/mholt/PapaParse
License: MIT
*/(function(i,a){(function(h,_){i.exports=_()})(vg,function h(){var _=typeof self<"u"?self:typeof window<"u"?window:_!==void 0?_:{},w=!_.document&&!!_.postMessage,T=_.IS_PAPA_WORKER||!1,S={},d=0,q={parse:function(ee,de){var De=(de=de||{}).dynamicTyping||!1;if(Ae(De)&&(de.dynamicTypingFunction=De,De={}),de.dynamicTyping=De,de.transform=!!Ae(de.transform)&&de.transform,de.worker&&q.WORKERS_SUPPORTED){var qe=function(){if(!q.WORKERS_SUPPORTED)return!1;var bt=(or=_.URL||_.webkitURL||null,hr=h.toString(),q.BLOB_URL||(q.BLOB_URL=or.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",hr,")();"],{type:"text/javascript"})))),Et=new _.Worker(bt),or,hr;return Et.onmessage=ne,Et.id=d++,S[Et.id]=Et}();return qe.userStep=de.step,qe.userChunk=de.chunk,qe.userComplete=de.complete,qe.userError=de.error,de.step=Ae(de.step),de.chunk=Ae(de.chunk),de.complete=Ae(de.complete),de.error=Ae(de.error),delete de.worker,void qe.postMessage({input:ee,config:de,workerId:qe.id})}var yt=null;return q.NODE_STREAM_INPUT,typeof ee=="string"?(ee=function(bt){return bt.charCodeAt(0)===65279?bt.slice(1):bt}(ee),yt=de.download?new le(de):new Ge(de)):ee.readable===!0&&Ae(ee.read)&&Ae(ee.on)?yt=new We(de):(_.File&&ee instanceof File||ee instanceof Object)&&(yt=new H(de)),yt.stream(ee)},unparse:function(ee,de){var De=!1,qe=!0,yt=",",bt=`\r
`,Et='"',or=Et+Et,hr=!1,ht=null,Ye=!1;(function(){if(typeof de=="object"){if(typeof de.delimiter!="string"||q.BAD_DELIMITERS.filter(function(Ze){return de.delimiter.indexOf(Ze)!==-1}).length||(yt=de.delimiter),(typeof de.quotes=="boolean"||typeof de.quotes=="function"||Array.isArray(de.quotes))&&(De=de.quotes),typeof de.skipEmptyLines!="boolean"&&typeof de.skipEmptyLines!="string"||(hr=de.skipEmptyLines),typeof de.newline=="string"&&(bt=de.newline),typeof de.quoteChar=="string"&&(Et=de.quoteChar),typeof de.header=="boolean"&&(qe=de.header),Array.isArray(de.columns)){if(de.columns.length===0)throw new Error("Option columns is empty");ht=de.columns}de.escapeChar!==void 0&&(or=de.escapeChar+Et),(typeof de.escapeFormulae=="boolean"||de.escapeFormulae instanceof RegExp)&&(Ye=de.escapeFormulae instanceof RegExp?de.escapeFormulae:/^[=+\-@\t\r].*$/)}})();var Fe=new RegExp(gt(Et),"g");if(typeof ee=="string"&&(ee=JSON.parse(ee)),Array.isArray(ee)){if(!ee.length||Array.isArray(ee[0]))return dt(null,ee,hr);if(typeof ee[0]=="object")return dt(ht||Object.keys(ee[0]),ee,hr)}else if(typeof ee=="object")return typeof ee.data=="string"&&(ee.data=JSON.parse(ee.data)),Array.isArray(ee.data)&&(ee.fields||(ee.fields=ee.meta&&ee.meta.fields||ht),ee.fields||(ee.fields=Array.isArray(ee.data[0])?ee.fields:typeof ee.data[0]=="object"?Object.keys(ee.data[0]):[]),Array.isArray(ee.data[0])||typeof ee.data[0]=="object"||(ee.data=[ee.data])),dt(ee.fields||[],ee.data||[],hr);throw new Error("Unable to serialize unrecognized input");function dt(Ze,Ot,Yt){var Ht="";typeof Ze=="string"&&(Ze=JSON.parse(Ze)),typeof Ot=="string"&&(Ot=JSON.parse(Ot));var nr=Array.isArray(Ze)&&0<Ze.length,Qt=!Array.isArray(Ot[0]);if(nr&&qe){for(var Ir=0;Ir<Ze.length;Ir++)0<Ir&&(Ht+=yt),Ht+=St(Ze[Ir],Ir);0<Ot.length&&(Ht+=bt)}for(var Lt=0;Lt<Ot.length;Lt++){var lr=nr?Ze.length:Ot[Lt].length,Er=!1,_r=nr?Object.keys(Ot[Lt]).length===0:Ot[Lt].length===0;if(Yt&&!nr&&(Er=Yt==="greedy"?Ot[Lt].join("").trim()==="":Ot[Lt].length===1&&Ot[Lt][0].length===0),Yt==="greedy"&&nr){for(var dr=[],sr=0;sr<lr;sr++){var zr=Qt?Ze[sr]:sr;dr.push(Ot[Lt][zr])}Er=dr.join("").trim()===""}if(!Er){for(var Ce=0;Ce<lr;Ce++){0<Ce&&!_r&&(Ht+=yt);var ai=nr&&Qt?Ze[Ce]:Ce;Ht+=St(Ot[Lt][ai],Ce)}Lt<Ot.length-1&&(!Yt||0<lr&&!_r)&&(Ht+=bt)}}return Ht}function St(Ze,Ot){if(Ze==null)return"";if(Ze.constructor===Date)return JSON.stringify(Ze).slice(1,25);var Yt=!1;Ye&&typeof Ze=="string"&&Ye.test(Ze)&&(Ze="'"+Ze,Yt=!0);var Ht=Ze.toString().replace(Fe,or);return(Yt=Yt||De===!0||typeof De=="function"&&De(Ze,Ot)||Array.isArray(De)&&De[Ot]||function(nr,Qt){for(var Ir=0;Ir<Qt.length;Ir++)if(-1<nr.indexOf(Qt[Ir]))return!0;return!1}(Ht,q.BAD_DELIMITERS)||-1<Ht.indexOf(yt)||Ht.charAt(0)===" "||Ht.charAt(Ht.length-1)===" ")?Et+Ht+Et:Ht}}};if(q.RECORD_SEP="",q.UNIT_SEP="",q.BYTE_ORDER_MARK="\uFEFF",q.BAD_DELIMITERS=["\r",`
`,'"',q.BYTE_ORDER_MARK],q.WORKERS_SUPPORTED=!w&&!!_.Worker,q.NODE_STREAM_INPUT=1,q.LocalChunkSize=10485760,q.RemoteChunkSize=5242880,q.DefaultDelimiter=",",q.Parser=he,q.ParserHandle=ke,q.NetworkStreamer=le,q.FileStreamer=H,q.StringStreamer=Ge,q.ReadableStreamStreamer=We,_.jQuery){var me=_.jQuery;me.fn.parse=function(ee){var de=ee.config||{},De=[];return this.each(function(bt){if(!(me(this).prop("tagName").toUpperCase()==="INPUT"&&me(this).attr("type").toLowerCase()==="file"&&_.FileReader)||!this.files||this.files.length===0)return!0;for(var Et=0;Et<this.files.length;Et++)De.push({file:this.files[Et],inputElem:this,instanceConfig:me.extend({},de)})}),qe(),this;function qe(){if(De.length!==0){var bt,Et,or,hr,ht=De[0];if(Ae(ee.before)){var Ye=ee.before(ht.file,ht.inputElem);if(typeof Ye=="object"){if(Ye.action==="abort")return bt="AbortError",Et=ht.file,or=ht.inputElem,hr=Ye.reason,void(Ae(ee.error)&&ee.error({name:bt},Et,or,hr));if(Ye.action==="skip")return void yt();typeof Ye.config=="object"&&(ht.instanceConfig=me.extend(ht.instanceConfig,Ye.config))}else if(Ye==="skip")return void yt()}var Fe=ht.instanceConfig.complete;ht.instanceConfig.complete=function(dt){Ae(Fe)&&Fe(dt,ht.file,ht.inputElem),yt()},q.parse(ht.file,ht.instanceConfig)}else Ae(ee.complete)&&ee.complete()}function yt(){De.splice(0,1),qe()}}}function Pe(ee){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},(function(de){var De=rt(de);De.chunkSize=parseInt(De.chunkSize),de.step||de.chunk||(De.chunkSize=null),this._handle=new ke(De),(this._handle.streamer=this)._config=De}).call(this,ee),this.parseChunk=function(de,De){if(this.isFirstChunk&&Ae(this._config.beforeFirstChunk)){var qe=this._config.beforeFirstChunk(de);qe!==void 0&&(de=qe)}this.isFirstChunk=!1,this._halted=!1;var yt=this._partialLine+de;this._partialLine="";var bt=this._handle.parse(yt,this._baseIndex,!this._finished);if(!this._handle.paused()&&!this._handle.aborted()){var Et=bt.meta.cursor;this._finished||(this._partialLine=yt.substring(Et-this._baseIndex),this._baseIndex=Et),bt&&bt.data&&(this._rowCount+=bt.data.length);var or=this._finished||this._config.preview&&this._rowCount>=this._config.preview;if(T)_.postMessage({results:bt,workerId:q.WORKER_ID,finished:or});else if(Ae(this._config.chunk)&&!De){if(this._config.chunk(bt,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);bt=void 0,this._completeResults=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(bt.data),this._completeResults.errors=this._completeResults.errors.concat(bt.errors),this._completeResults.meta=bt.meta),this._completed||!or||!Ae(this._config.complete)||bt&&bt.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),or||bt&&bt.meta.paused||this._nextChunk(),bt}this._halted=!0},this._sendError=function(de){Ae(this._config.error)?this._config.error(de):T&&this._config.error&&_.postMessage({workerId:q.WORKER_ID,error:de,finished:!1})}}function le(ee){var de;(ee=ee||{}).chunkSize||(ee.chunkSize=q.RemoteChunkSize),Pe.call(this,ee),this._nextChunk=w?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(De){this._input=De,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(de=new XMLHttpRequest,this._config.withCredentials&&(de.withCredentials=this._config.withCredentials),w||(de.onload=te(this._chunkLoaded,this),de.onerror=te(this._chunkError,this)),de.open(this._config.downloadRequestBody?"POST":"GET",this._input,!w),this._config.downloadRequestHeaders){var De=this._config.downloadRequestHeaders;for(var qe in De)de.setRequestHeader(qe,De[qe])}if(this._config.chunkSize){var yt=this._start+this._config.chunkSize-1;de.setRequestHeader("Range","bytes="+this._start+"-"+yt)}try{de.send(this._config.downloadRequestBody)}catch(bt){this._chunkError(bt.message)}w&&de.status===0&&this._chunkError()}},this._chunkLoaded=function(){de.readyState===4&&(de.status<200||400<=de.status?this._chunkError():(this._start+=this._config.chunkSize?this._config.chunkSize:de.responseText.length,this._finished=!this._config.chunkSize||this._start>=function(De){var qe=De.getResponseHeader("Content-Range");return qe===null?-1:parseInt(qe.substring(qe.lastIndexOf("/")+1))}(de),this.parseChunk(de.responseText)))},this._chunkError=function(De){var qe=de.statusText||De;this._sendError(new Error(qe))}}function H(ee){var de,De;(ee=ee||{}).chunkSize||(ee.chunkSize=q.LocalChunkSize),Pe.call(this,ee);var qe=typeof FileReader<"u";this.stream=function(yt){this._input=yt,De=yt.slice||yt.webkitSlice||yt.mozSlice,qe?((de=new FileReader).onload=te(this._chunkLoaded,this),de.onerror=te(this._chunkError,this)):de=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var yt=this._input;if(this._config.chunkSize){var bt=Math.min(this._start+this._config.chunkSize,this._input.size);yt=De.call(yt,this._start,bt)}var Et=de.readAsText(yt,this._config.encoding);qe||this._chunkLoaded({target:{result:Et}})},this._chunkLoaded=function(yt){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(yt.target.result)},this._chunkError=function(){this._sendError(de.error)}}function Ge(ee){var de;Pe.call(this,ee=ee||{}),this.stream=function(De){return de=De,this._nextChunk()},this._nextChunk=function(){if(!this._finished){var De,qe=this._config.chunkSize;return qe?(De=de.substring(0,qe),de=de.substring(qe)):(De=de,de=""),this._finished=!de,this.parseChunk(De)}}}function We(ee){Pe.call(this,ee=ee||{});var de=[],De=!0,qe=!1;this.pause=function(){Pe.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){Pe.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(yt){this._input=yt,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){qe&&de.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),de.length?this.parseChunk(de.shift()):De=!0},this._streamData=te(function(yt){try{de.push(typeof yt=="string"?yt:yt.toString(this._config.encoding)),De&&(De=!1,this._checkIsFinished(),this.parseChunk(de.shift()))}catch(bt){this._streamError(bt)}},this),this._streamError=te(function(yt){this._streamCleanUp(),this._sendError(yt)},this),this._streamEnd=te(function(){this._streamCleanUp(),qe=!0,this._streamData("")},this),this._streamCleanUp=te(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function ke(ee){var de,De,qe,yt=Math.pow(2,53),bt=-yt,Et=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,or=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,hr=this,ht=0,Ye=0,Fe=!1,dt=!1,St=[],Ze={data:[],errors:[],meta:{}};if(Ae(ee.step)){var Ot=ee.step;ee.step=function(Lt){if(Ze=Lt,nr())Ht();else{if(Ht(),Ze.data.length===0)return;ht+=Lt.data.length,ee.preview&&ht>ee.preview?De.abort():(Ze.data=Ze.data[0],Ot(Ze,hr))}}}function Yt(Lt){return ee.skipEmptyLines==="greedy"?Lt.join("").trim()==="":Lt.length===1&&Lt[0].length===0}function Ht(){return Ze&&qe&&(Ir("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+q.DefaultDelimiter+"'"),qe=!1),ee.skipEmptyLines&&(Ze.data=Ze.data.filter(function(Lt){return!Yt(Lt)})),nr()&&function(){if(!Ze)return;function Lt(Er,_r){Ae(ee.transformHeader)&&(Er=ee.transformHeader(Er,_r)),St.push(Er)}if(Array.isArray(Ze.data[0])){for(var lr=0;nr()&&lr<Ze.data.length;lr++)Ze.data[lr].forEach(Lt);Ze.data.splice(0,1)}else Ze.data.forEach(Lt)}(),function(){if(!Ze||!ee.header&&!ee.dynamicTyping&&!ee.transform)return Ze;function Lt(Er,_r){var dr,sr=ee.header?{}:[];for(dr=0;dr<Er.length;dr++){var zr=dr,Ce=Er[dr];ee.header&&(zr=dr>=St.length?"__parsed_extra":St[dr]),ee.transform&&(Ce=ee.transform(Ce,zr)),Ce=Qt(zr,Ce),zr==="__parsed_extra"?(sr[zr]=sr[zr]||[],sr[zr].push(Ce)):sr[zr]=Ce}return ee.header&&(dr>St.length?Ir("FieldMismatch","TooManyFields","Too many fields: expected "+St.length+" fields but parsed "+dr,Ye+_r):dr<St.length&&Ir("FieldMismatch","TooFewFields","Too few fields: expected "+St.length+" fields but parsed "+dr,Ye+_r)),sr}var lr=1;return!Ze.data.length||Array.isArray(Ze.data[0])?(Ze.data=Ze.data.map(Lt),lr=Ze.data.length):Ze.data=Lt(Ze.data,0),ee.header&&Ze.meta&&(Ze.meta.fields=St),Ye+=lr,Ze}()}function nr(){return ee.header&&St.length===0}function Qt(Lt,lr){return Er=Lt,ee.dynamicTypingFunction&&ee.dynamicTyping[Er]===void 0&&(ee.dynamicTyping[Er]=ee.dynamicTypingFunction(Er)),(ee.dynamicTyping[Er]||ee.dynamicTyping)===!0?lr==="true"||lr==="TRUE"||lr!=="false"&&lr!=="FALSE"&&(function(_r){if(Et.test(_r)){var dr=parseFloat(_r);if(bt<dr&&dr<yt)return!0}return!1}(lr)?parseFloat(lr):or.test(lr)?new Date(lr):lr===""?null:lr):lr;var Er}function Ir(Lt,lr,Er,_r){var dr={type:Lt,code:lr,message:Er};_r!==void 0&&(dr.row=_r),Ze.errors.push(dr)}this.parse=function(Lt,lr,Er){var _r=ee.quoteChar||'"';if(ee.newline||(ee.newline=function(zr,Ce){zr=zr.substring(0,1048576);var ai=new RegExp(gt(Ce)+"([^]*?)"+gt(Ce),"gm"),oi=(zr=zr.replace(ai,"")).split("\r"),er=zr.split(`
`),fr=1<er.length&&er[0].length<oi[0].length;if(oi.length===1||fr)return`
`;for(var Qr=0,Tr=0;Tr<oi.length;Tr++)oi[Tr][0]===`
`&&Qr++;return Qr>=oi.length/2?`\r
`:"\r"}(Lt,_r)),qe=!1,ee.delimiter)Ae(ee.delimiter)&&(ee.delimiter=ee.delimiter(Lt),Ze.meta.delimiter=ee.delimiter);else{var dr=function(zr,Ce,ai,oi,er){var fr,Qr,Tr,Rr;er=er||[",","	","|",";",q.RECORD_SEP,q.UNIT_SEP];for(var Hi=0;Hi<er.length;Hi++){var cr=er[Hi],nn=0,Wi=0,Je=0;Tr=void 0;for(var Kr=new he({comments:oi,delimiter:cr,newline:Ce,preview:10}).parse(zr),Jr=0;Jr<Kr.data.length;Jr++)if(ai&&Yt(Kr.data[Jr]))Je++;else{var Xi=Kr.data[Jr].length;Wi+=Xi,Tr!==void 0?0<Xi&&(nn+=Math.abs(Xi-Tr),Tr=Xi):Tr=Xi}0<Kr.data.length&&(Wi/=Kr.data.length-Je),(Qr===void 0||nn<=Qr)&&(Rr===void 0||Rr<Wi)&&1.99<Wi&&(Qr=nn,fr=cr,Rr=Wi)}return{successful:!!(ee.delimiter=fr),bestDelimiter:fr}}(Lt,ee.newline,ee.skipEmptyLines,ee.comments,ee.delimitersToGuess);dr.successful?ee.delimiter=dr.bestDelimiter:(qe=!0,ee.delimiter=q.DefaultDelimiter),Ze.meta.delimiter=ee.delimiter}var sr=rt(ee);return ee.preview&&ee.header&&sr.preview++,de=Lt,De=new he(sr),Ze=De.parse(de,lr,Er),Ht(),Fe?{meta:{paused:!0}}:Ze||{meta:{paused:!1}}},this.paused=function(){return Fe},this.pause=function(){Fe=!0,De.abort(),de=Ae(ee.chunk)?"":de.substring(De.getCharIndex())},this.resume=function(){hr.streamer._halted?(Fe=!1,hr.streamer.parseChunk(de,!0)):setTimeout(hr.resume,3)},this.aborted=function(){return dt},this.abort=function(){dt=!0,De.abort(),Ze.meta.aborted=!0,Ae(ee.complete)&&ee.complete(Ze),de=""}}function gt(ee){return ee.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function he(ee){var de,De=(ee=ee||{}).delimiter,qe=ee.newline,yt=ee.comments,bt=ee.step,Et=ee.preview,or=ee.fastMode,hr=de=ee.quoteChar===void 0||ee.quoteChar===null?'"':ee.quoteChar;if(ee.escapeChar!==void 0&&(hr=ee.escapeChar),(typeof De!="string"||-1<q.BAD_DELIMITERS.indexOf(De))&&(De=","),yt===De)throw new Error("Comment character same as delimiter");yt===!0?yt="#":(typeof yt!="string"||-1<q.BAD_DELIMITERS.indexOf(yt))&&(yt=!1),qe!==`
`&&qe!=="\r"&&qe!==`\r
`&&(qe=`
`);var ht=0,Ye=!1;this.parse=function(Fe,dt,St){if(typeof Fe!="string")throw new Error("Input must be a string");var Ze=Fe.length,Ot=De.length,Yt=qe.length,Ht=yt.length,nr=Ae(bt),Qt=[],Ir=[],Lt=[],lr=ht=0;if(!Fe)return li();if(ee.header&&!dt){var Er=Fe.split(qe)[0].split(De),_r=[],dr={},sr=!1;for(var zr in Er){var Ce=Er[zr];Ae(ee.transformHeader)&&(Ce=ee.transformHeader(Ce,zr));var ai=Ce,oi=dr[Ce]||0;for(0<oi&&(sr=!0,ai=Ce+"_"+oi),dr[Ce]=oi+1;_r.includes(ai);)ai=ai+"_"+oi;_r.push(ai)}if(sr){var er=Fe.split(qe);er[0]=_r.join(De),Fe=er.join(qe)}}if(or||or!==!1&&Fe.indexOf(de)===-1){for(var fr=Fe.split(qe),Qr=0;Qr<fr.length;Qr++){if(Lt=fr[Qr],ht+=Lt.length,Qr!==fr.length-1)ht+=qe.length;else if(St)return li();if(!yt||Lt.substring(0,Ht)!==yt){if(nr){if(Qt=[],Je(Lt.split(De)),Xe(),Ye)return li()}else Je(Lt.split(De));if(Et&&Et<=Qr)return Qt=Qt.slice(0,Et),li(!0)}}return li()}for(var Tr=Fe.indexOf(De,ht),Rr=Fe.indexOf(qe,ht),Hi=new RegExp(gt(hr)+gt(de),"g"),cr=Fe.indexOf(de,ht);;)if(Fe[ht]!==de)if(yt&&Lt.length===0&&Fe.substring(ht,ht+Ht)===yt){if(Rr===-1)return li();ht=Rr+Yt,Rr=Fe.indexOf(qe,ht),Tr=Fe.indexOf(De,ht)}else if(Tr!==-1&&(Tr<Rr||Rr===-1))Lt.push(Fe.substring(ht,Tr)),ht=Tr+Ot,Tr=Fe.indexOf(De,ht);else{if(Rr===-1)break;if(Lt.push(Fe.substring(ht,Rr)),Xi(Rr+Yt),nr&&(Xe(),Ye))return li();if(Et&&Qt.length>=Et)return li(!0)}else for(cr=ht,ht++;;){if((cr=Fe.indexOf(de,cr+1))===-1)return St||Ir.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:Qt.length,index:ht}),Jr();if(cr===Ze-1)return Jr(Fe.substring(ht,cr).replace(Hi,de));if(de!==hr||Fe[cr+1]!==hr){if(de===hr||cr===0||Fe[cr-1]!==hr){Tr!==-1&&Tr<cr+1&&(Tr=Fe.indexOf(De,cr+1)),Rr!==-1&&Rr<cr+1&&(Rr=Fe.indexOf(qe,cr+1));var nn=Kr(Rr===-1?Tr:Math.min(Tr,Rr));if(Fe.substr(cr+1+nn,Ot)===De){Lt.push(Fe.substring(ht,cr).replace(Hi,de)),Fe[ht=cr+1+nn+Ot]!==de&&(cr=Fe.indexOf(de,ht)),Tr=Fe.indexOf(De,ht),Rr=Fe.indexOf(qe,ht);break}var Wi=Kr(Rr);if(Fe.substring(cr+1+Wi,cr+1+Wi+Yt)===qe){if(Lt.push(Fe.substring(ht,cr).replace(Hi,de)),Xi(cr+1+Wi+Yt),Tr=Fe.indexOf(De,ht),cr=Fe.indexOf(de,ht),nr&&(Xe(),Ye))return li();if(Et&&Qt.length>=Et)return li(!0);break}Ir.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:Qt.length,index:ht}),cr++}}else cr++}return Jr();function Je(Rt){Qt.push(Rt),lr=ht}function Kr(Rt){var Nt=0;if(Rt!==-1){var mi=Fe.substring(cr+1,Rt);mi&&mi.trim()===""&&(Nt=mi.length)}return Nt}function Jr(Rt){return St||(Rt===void 0&&(Rt=Fe.substring(ht)),Lt.push(Rt),ht=Ze,Je(Lt),nr&&Xe()),li()}function Xi(Rt){ht=Rt,Je(Lt),Lt=[],Rr=Fe.indexOf(qe,ht)}function li(Rt){return{data:Qt,errors:Ir,meta:{delimiter:De,linebreak:qe,aborted:Ye,truncated:!!Rt,cursor:lr+(dt||0)}}}function Xe(){bt(li()),Qt=[],Ir=[]}},this.abort=function(){Ye=!0},this.getCharIndex=function(){return ht}}function ne(ee){var de=ee.data,De=S[de.workerId],qe=!1;if(de.error)De.userError(de.error,de.file);else if(de.results&&de.results.data){var yt={abort:function(){qe=!0,_e(de.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:je,resume:je};if(Ae(De.userStep)){for(var bt=0;bt<de.results.data.length&&(De.userStep({data:de.results.data[bt],errors:de.results.errors,meta:de.results.meta},yt),!qe);bt++);delete de.results}else Ae(De.userChunk)&&(De.userChunk(de.results,yt,de.file),delete de.results)}de.finished&&!qe&&_e(de.workerId,de.results)}function _e(ee,de){var De=S[ee];Ae(De.userComplete)&&De.userComplete(de),De.terminate(),delete S[ee]}function je(){throw new Error("Not implemented.")}function rt(ee){if(typeof ee!="object"||ee===null)return ee;var de=Array.isArray(ee)?[]:{};for(var De in ee)de[De]=rt(ee[De]);return de}function te(ee,de){return function(){ee.apply(de,arguments)}}function Ae(ee){return typeof ee=="function"}return T&&(_.onmessage=function(ee){var de=ee.data;if(q.WORKER_ID===void 0&&de&&(q.WORKER_ID=de.workerId),typeof de.input=="string")_.postMessage({workerId:q.WORKER_ID,results:q.parse(de.input,de.config),finished:!0});else if(_.File&&de.input instanceof File||de.input instanceof Object){var De=q.parse(de.input,de.config);De&&_.postMessage({workerId:q.WORKER_ID,results:De,finished:!0})}}),(le.prototype=Object.create(Pe.prototype)).constructor=le,(H.prototype=Object.create(Pe.prototype)).constructor=H,(Ge.prototype=Object.create(Ge.prototype)).constructor=Ge,(We.prototype=Object.create(Pe.prototype)).constructor=We,q})})(cx);var zS=cx.exports;const ux=xg(zS),_g=(i,a,h)=>{const _=Math.round(i.r+(a.r-i.r)*h),w=Math.round(i.g+(a.g-i.g)*h),T=Math.round(i.b+(a.b-i.b)*h);return`rgb(${_},${w},${T})`},LS="data:image/svg+xml,%3csvg%20width='32'%20height='32'%20viewBox='0%200%2032%2032'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M3.60625%2012.0625L4.19375%2013.0875C4.7125%2013.9937%205.5625%2014.6625%206.56875%2014.95L10.1875%2015.9812C11.2625%2016.2875%2012%2017.2688%2012%2018.3875V20.8813C12%2021.5688%2012.3875%2022.1937%2013%2022.5C13.6125%2022.8063%2014%2023.4312%2014%2024.1187V26.5562C14%2027.5312%2014.9312%2028.2375%2015.8687%2027.9688C16.875%2027.6813%2017.6563%2026.875%2017.9125%2025.8563L18.0875%2025.1562C18.35%2024.1%2019.0375%2023.1938%2019.9813%2022.6562L20.4875%2022.3687C21.425%2021.8375%2022%2020.8375%2022%2019.7625V19.2437C22%2018.45%2021.6812%2017.6875%2021.1187%2017.125L20.875%2016.8813C20.3125%2016.3188%2019.55%2016%2018.7563%2016H16.0625C15.3687%2016%2014.6812%2015.8188%2014.075%2015.475L11.9187%2014.2437C11.65%2014.0875%2011.4438%2013.8375%2011.3438%2013.5437C11.1437%2012.9437%2011.4125%2012.2937%2011.9812%2012.0125L12.35%2011.825C12.7625%2011.6187%2013.2437%2011.5812%2013.6812%2011.7312L15.1313%2012.2125C15.6438%2012.3812%2016.2063%2012.1875%2016.5%2011.7437C16.7937%2011.3062%2016.7625%2010.725%2016.425%2010.3188L15.575%209.3C14.95%208.55%2014.9563%207.45625%2015.5938%206.71875L16.575%205.575C17.125%204.93125%2017.2125%204.0125%2016.7938%203.28125L16.6437%203.01875C16.425%203.00625%2016.2125%203%2015.9937%203C10.1937%203%205.275%206.80625%203.60625%2012.0625ZM29%2016C29%2013.7%2028.4%2011.5375%2027.35%209.65625L25.75%2010.3C24.7688%2010.6938%2024.2625%2011.7875%2024.5938%2012.7875L25.65%2015.9563C25.8687%2016.6063%2026.4%2017.1%2027.0625%2017.2625L28.8813%2017.7188C28.9563%2017.1562%2028.9937%2016.5813%2028.9937%2016H29ZM0%2016C0%2011.7565%201.68571%207.68687%204.68629%204.68629C7.68687%201.68571%2011.7565%200%2016%200C20.2435%200%2024.3131%201.68571%2027.3137%204.68629C30.3143%207.68687%2032%2011.7565%2032%2016C32%2020.2435%2030.3143%2024.3131%2027.3137%2027.3137C24.3131%2030.3143%2020.2435%2032%2016%2032C11.7565%2032%207.68687%2030.3143%204.68629%2027.3137C1.68571%2024.3131%200%2020.2435%200%2016Z'%20fill='black'/%3e%3c/svg%3e",hx="data:image/svg+xml,%3csvg%20width='19'%20height='19'%20viewBox='0%200%2019%2019'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M15.4383%207.71762C15.4383%209.42069%2014.8853%2010.9939%2013.9538%2012.2703L18.6521%2016.9713C19.116%2017.4351%2019.116%2018.1884%2018.6521%2018.6522C18.1882%2019.1159%2017.4348%2019.1159%2016.9709%2018.6522L12.2727%2013.9511C10.996%2014.8861%209.42253%2015.4352%207.71913%2015.4352C3.45505%2015.4352%200%2011.9809%200%207.71762C0%203.45438%203.45505%200%207.71913%200C11.9832%200%2015.4383%203.45438%2015.4383%207.71762ZM7.71913%2013.0606C8.42091%2013.0606%209.11583%2012.9224%209.76419%2012.6539C10.4126%2012.3854%2011.0017%2011.9918%2011.4979%2011.4957C11.9941%2010.9995%2012.3878%2010.4105%2012.6563%209.76228C12.9249%209.11405%2013.0631%208.41927%2013.0631%207.71762C13.0631%207.01597%2012.9249%206.32119%2012.6563%205.67295C12.3878%205.02472%2011.9941%204.43571%2011.4979%203.93957C11.0017%203.44343%2010.4126%203.04987%209.76419%202.78136C9.11583%202.51285%208.42091%202.37465%207.71913%202.37465C7.01734%202.37465%206.32243%202.51285%205.67406%202.78136C5.0257%203.04987%204.43658%203.44343%203.94034%203.93957C3.4441%204.43571%203.05047%205.02472%202.7819%205.67295C2.51334%206.32119%202.37512%207.01597%202.37512%207.71762C2.37512%208.41927%202.51334%209.11405%202.7819%209.76228C3.05047%2010.4105%203.4441%2010.9995%203.94034%2011.4957C4.43658%2011.9918%205.0257%2012.3854%205.67406%2012.6539C6.32243%2012.9224%207.01734%2013.0606%207.71913%2013.0606Z'%20fill='%23595959'/%3e%3c/svg%3e",RS="data:image/svg+xml,%3csvg%20width='11'%20height='11'%20viewBox='0%200%2011%2011'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M5.5%201V10'%20stroke='black'%20stroke-linecap='round'/%3e%3cpath%20d='M10%205.5L1%205.5'%20stroke='black'%20stroke-linecap='round'/%3e%3c/svg%3e",FS="data:image/svg+xml,%3csvg%20width='11'%20height='2'%20viewBox='0%200%2011%202'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M10%201L1%201'%20stroke='black'%20stroke-linecap='round'/%3e%3c/svg%3e",BS=({label:i,startColor:a,endColor:h})=>{const _=Array.from({length:10},(w,T)=>_g(a,h,(10-T)/10));return Ee.jsxs("div",{className:"absolute bottom-10 right-1 z-20 flex w-[7rem] flex-col rounded-lg bg-white px-1 py-4 shadow-lg",children:[Ee.jsx("h2",{className:"mb-2 text-center text-base font-bold leading-5",children:i}),Ee.jsx("div",{className:"flex columns-2 flex-row justify-center align-middle",children:Ee.jsxs("div",{className:"relative flex flex-col justify-between",children:[_.map((w,T)=>Ee.jsx("div",{className:"min-h-7 w-7",style:{backgroundColor:w}},T)),Ee.jsxs("div",{className:"absolute left-7 ml-1 flex h-full w-full flex-col justify-between",children:[Ee.jsx("span",{className:"mt-[-0.3rem] text-xs",children:"100"}),Ee.jsx("span",{className:"mb-[0rem] text-xs",children:"50"}),Ee.jsx("span",{className:"mb-[-0.3rem] text-xs",children:"0"})]})]})})]})},OS={version:8,sources:{osm:{type:"raster",tiles:["https://tile.openstreetmap.org/{z}/{x}/{y}.png"],tileSize:256,attribution:"Map data  OpenStreetMap contributors"},tilesource:{type:"vector",tiles:["https://major-sculpin.nceas.ucsb.edu/censustracts/data/tiles/{z}/{x}/{y}.pbf"],minzoom:0,maxzoom:14}},layers:[{id:"simple-tiles",type:"raster",source:"osm"},{id:"tiles",type:"fill",source:"tilesource","source-layer":"cb_2023_us_tract_5m_with_geoid",paint:{"fill-color":["coalesce",["feature-state","color"],"#D3D3D3"]}}]},NS=async i=>{const h=await(await fetch(`https://major-sculpin.nceas.ucsb.edu/api/${i.domainId}/${i.metricId}`)).text(),_=ux.parse(h,{header:!0}),w={};return _.data.forEach(T=>{T.geoid&&T[i.metricId]&&(w[T.geoid]=parseFloat(T[i.metricId]))}),w},$S=async()=>{const a=await(await fetch("https://major-sculpin.nceas.ucsb.edu/api/locations")).text(),h=ux.parse(a,{header:!0}),_={};return h.data.forEach(w=>{w.geoid&&(_[w.geoid]={county_name:w.county_name,state_name:w.state_name})}),_},jS=({selectedCensusTract:i,selectedMetricIdObject:a,setSelectedCountyName:h,setSelectedStateName:_,setSelectedMetricValue:w,setSelectedCensusTract:T})=>{const S=Jt.useRef(null),[d,q]=Jt.useState({}),[me,Pe]=Jt.useState({}),le=Jt.useRef({}),H=Jt.useRef({}),[Ge,We]=Jt.useState(!1),[ke,gt]=Jt.useState(!1),he=Jt.useRef(null),ne=Jt.useRef(null),[_e,je]=Jt.useState([]),[rt,te]=Jt.useState(""),[Ae,ee]=Jt.useState(!1),de=Jt.useRef(a.colorGradient.startColor),De=Jt.useRef(a.colorGradient.endColor);Jt.useEffect(()=>{de.current=a.colorGradient.startColor,De.current=a.colorGradient.endColor},[a]),Jt.useEffect(()=>{(async()=>{const dt=NS(a),St=$S(),Ze=await dt,Ot=await St;q(Ze),Pe(Ot),le.current=Ze,H.current=Ot,We(!0)})()},[a]),Jt.useEffect(()=>{if(S.current&&!he.current){const Fe=new G0.Map({container:S.current,style:OS,center:[-103.9375,38.7888894],zoom:3.3});he.current=Fe,Fe.getCanvas().style.cursor="pointer",Fe.on("load",()=>{gt(!0)}),Fe.on("click","tiles",St=>{const Ze=St.features;if(Ze&&Ze.length>0){const Ot=Ze[0],{GEOID:Yt}=Ot.properties,Ht=le.current[Yt];typeof Ht=="number"&&w&&(h(H.current[Yt].county_name),_(H.current[Yt].state_name),T(Yt),w(Ht),console.log("Selected metric value:",Ht))}}),Fe.on("mouseleave","tiles",()=>{ne.current&&(ne.current.remove(),ne.current=null)});const dt=()=>{console.log("moveend event"),qe(Fe)};return Fe.on("moveend",dt),()=>{var St;Fe.off("moveend",dt),(St=he.current)==null||St.remove()}}},[]),Jt.useEffect(()=>{console.log("Reloading the colors A"),Ge&&ke&&he.current&&(console.log("Reloading the colors B"),qe(he.current))},[d,Ge,ke]),Jt.useEffect(()=>{if(he.current){const Fe=he.current,dt=St=>{var Ot;const Ze=St.features;if(Ze&&Ze.length>0){const Yt=Ze[0],{GEOID:Ht}=Yt.properties,nr=le.current[Ht],Qt=H.current[Ht];ne.current||(ne.current=new G0.Popup({closeButton:!1,closeOnClick:!1}));const Ir=ax[Qt==null?void 0:Qt.state_name],Lt=_g(de.current,De.current,nr),lr=`
            <div id="map-tooltip" class="rounded">
              <h1 class="font-bold text-[0.8rem] text-selectedIndicatorTextColor">
                ${((Ot=Qt==null?void 0:Qt.county_name)==null?void 0:Ot.toUpperCase())||"N/A"}, ${Ir}
              </h1>
              <h2 class="text-xs tracking-widest">TRACT ${Ht}</h2>
              <div class="mt-1 flex items-center">
                <div class="blackc mr-1 inline-block min-h-4 min-w-4 rounded-sm border-[1px] border-solid border-black" style="background-color: ${Lt}"></div>
                <span class="font-bold text-black">
                  ${nr!==void 0?`${(nr*100).toFixed(1)}%`:"N/A"}
                </span>
                <span class="ml-1 text-xs"> ${a.label}</span>
              </div>
            </div>
          `,Er=St.lngLat,_r=Fe.project(Er);_r.y-=5;const dr=Fe.unproject(_r);ne.current.setLngLat(dr).setHTML(lr).addTo(Fe)}};return Fe.off("mousemove","tiles",dt),Fe.on("mousemove","tiles",dt),()=>{Fe.off("mousemove","tiles",dt)}}},[d,Ge,ke,a]);const qe=Fe=>{Fe.queryRenderedFeatures({layers:["tiles"]}).forEach(St=>{const Ze=St.properties.GEOID,Ot=le.current[Ze];if(Ot!==void 0){const Yt=_g(de.current,De.current,Ot);Fe.setFeatureState({source:"tilesource",sourceLayer:"cb_2023_us_tract_5m_with_geoid",id:St.id},{color:Yt})}})},yt=Fe=>{const dt=Fe.target.value;te(dt),dt.length>2?Et(dt):je([])},bt=(Fe,dt,St)=>{he.current&&he.current.flyTo({center:[dt,Fe],zoom:8.5,essential:!0}),te(St),je([])},Et=async Fe=>{const Ze=await(await fetch(`https://api.opencagedata.com/geocode/v1/json?q=${encodeURIComponent(Fe)}&key=7daab0c61bc84b5d80eb72315d130135&countrycode=us,ca&limit=5`)).json();je(Ze.results)},or=()=>{te(""),je([]),ee(!1)},hr=()=>{he.current&&he.current.zoomIn()},ht=()=>{he.current&&he.current.zoomOut()},Ye=()=>{he.current&&he.current.flyTo({center:[-103.9375,38.7888894],zoom:3.3,essential:!0})};return Ee.jsxs("div",{id:"map-area",className:"relative h-full w-full",children:[Ee.jsxs("div",{id:"search-icon-searchbox-container",className:`transition-width absolute right-1 top-1 z-10 rounded-md bg-white shadow-sm duration-200 ${Ae?"w-80":"w-10"}`,children:[!Ae&&Ee.jsx("button",{className:"flex h-10 w-10 items-center justify-center rounded-md border border-gray-400",onClick:()=>ee(!0),children:Ee.jsx("img",{src:hx,alt:"search icon",className:"h-6 w-6",style:{filter:"grayscale(100%) invert(70%)"}})}),Ae&&Ee.jsxs(Ee.Fragment,{children:[Ee.jsxs("div",{id:"location-search-box",className:"relative w-full",children:[Ee.jsx("input",{type:"text",className:"search-input h-10 w-full rounded border border-gray-400 py-1 pl-2 pr-8 text-sm focus:border-gray-400 focus:outline-none",placeholder:"Search for a location",value:rt,onChange:yt,onBlur:()=>{setTimeout(()=>{je([])},100)}}),Ee.jsx("button",{className:"absolute right-0 top-0 flex h-10 w-10 items-center justify-center text-gray-400",onClick:or,children:Ee.jsx("img",{src:sx,alt:"close search",className:"h-4 w-4",style:{filter:"grayscale(80%) invert(70%)"}})})]}),_e.length>0&&Ee.jsx("div",{id:"location-autocomplete-suggestions",className:"autocomplete-suggestions absolute z-30 w-[calc(100%-2.8rem)] rounded bg-white shadow-md",children:_e.map((Fe,dt)=>Ee.jsxs("div",{className:"autocomplete-suggestion cursor-pointer p-2 hover:bg-gray-200",onClick:()=>bt(Fe.geometry.lat,Fe.geometry.lng,Fe.formatted),children:[Ee.jsx("strong",{className:"text-sm",children:Fe.formatted.split(",")[0]}),Ee.jsx("span",{className:"text-sm text-gray-500",children:`,${Fe.formatted.split(",").slice(1).join(",")}`})]},dt))})]})]}),Ee.jsxs("div",{id:"map-area-controls",className:"absolute right-1 top-12 z-10 flex flex-col space-y-1",children:[Ee.jsx("button",{id:"zoom-in-button",className:"flex h-10 w-10 items-center justify-center rounded-md border border-gray-400 bg-white align-middle text-4xl text-mapIconColor",onClick:hr,children:Ee.jsx("img",{src:RS,alt:"zoom in",className:"h-6 w-6",style:{filter:"grayscale(50%) invert(50%)"}})}),Ee.jsx("button",{id:"zoom-out-button",className:"flex h-10 w-10 items-center justify-center rounded-md border border-gray-400 bg-white align-middle text-4xl text-mapIconColor",onClick:ht,children:Ee.jsx("img",{src:FS,alt:"zoom out",className:"h-6 w-6 fill-mapIconColor stroke-mapIconColor",style:{filter:"grayscale(50%) invert(50%)"}})}),Ee.jsx("button",{id:"reset-view-button",className:"flex h-10 w-10 items-center justify-center rounded-md border border-gray-400 bg-white",onClick:Ye,children:Ee.jsx("img",{src:LS,alt:"reset view",className:"h-6 w-6 fill-current stroke-mapIconColor",style:{filter:"grayscale(50%) invert(50%)"}})})]}),Ee.jsx(BS,{startColor:de.current,endColor:De.current,label:a.label}),Ee.jsx("div",{ref:S,className:"absolute left-0 top-0 flex h-full w-full"})]})};var dx={exports:{}};/**
 * chroma.js - JavaScript library for color conversions
 *
 * Copyright (c) 2011-2019, Gregor Aisch
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice, this
 * list of conditions and the following disclaimer.
 *
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 * this list of conditions and the following disclaimer in the documentation
 * and/or other materials provided with the distribution.
 *
 * 3. The name Gregor Aisch may not be used to endorse or promote products
 * derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL GREGOR AISCH OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,
 * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
 * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE,
 * EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * -------------------------------------------------------
 *
 * chroma.js includes colors from colorbrewer2.org, which are released under
 * the following license:
 *
 * Copyright (c) 2002 Cynthia Brewer, Mark Harrower,
 * and The Pennsylvania State University.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,
 * either express or implied. See the License for the specific
 * language governing permissions and limitations under the License.
 *
 * ------------------------------------------------------
 *
 * Named colors are taken from X11 Color Names.
 * http://www.w3.org/TR/css3-color/#svg-color
 *
 * @preserve
 */(function(i,a){(function(h,_){i.exports=_()})(vg,function(){for(var h=function(C,A,N){return A===void 0&&(A=0),N===void 0&&(N=1),C<A?A:C>N?N:C},_=h,w=function(C){C._clipped=!1,C._unclipped=C.slice(0);for(var A=0;A<=3;A++)A<3?((C[A]<0||C[A]>255)&&(C._clipped=!0),C[A]=_(C[A],0,255)):A===3&&(C[A]=_(C[A],0,1));return C},T={},S=0,d=["Boolean","Number","String","Function","Array","Date","RegExp","Undefined","Null"];S<d.length;S+=1){var q=d[S];T["[object "+q+"]"]=q.toLowerCase()}var me=function(C){return T[Object.prototype.toString.call(C)]||"object"},Pe=me,le=function(C,A){return A===void 0&&(A=null),C.length>=3?Array.prototype.slice.call(C):Pe(C[0])=="object"&&A?A.split("").filter(function(N){return C[0][N]!==void 0}).map(function(N){return C[0][N]}):C[0]},H=me,Ge=function(C){if(C.length<2)return null;var A=C.length-1;return H(C[A])=="string"?C[A].toLowerCase():null},We=Math.PI,ke={clip_rgb:w,limit:h,type:me,unpack:le,last:Ge,PI:We,TWOPI:We*2,PITHIRD:We/3,DEG2RAD:We/180,RAD2DEG:180/We},gt={format:{},autodetect:[]},he=ke.last,ne=ke.clip_rgb,_e=ke.type,je=gt,rt=function(){for(var A=[],N=arguments.length;N--;)A[N]=arguments[N];var K=this;if(_e(A[0])==="object"&&A[0].constructor&&A[0].constructor===this.constructor)return A[0];var ue=he(A),ye=!1;if(!ue){ye=!0,je.sorted||(je.autodetect=je.autodetect.sort(function(He,mt){return mt.p-He.p}),je.sorted=!0);for(var ae=0,be=je.autodetect;ae<be.length;ae+=1){var Ie=be[ae];if(ue=Ie.test.apply(Ie,A),ue)break}}if(je.format[ue]){var Ve=je.format[ue].apply(null,ye?A:A.slice(0,-1));K._rgb=ne(Ve)}else throw new Error("unknown format: "+A);K._rgb.length===3&&K._rgb.push(1)};rt.prototype.toString=function(){return _e(this.hex)=="function"?this.hex():"["+this._rgb.join(",")+"]"};var te=rt,Ae=function(){for(var C=[],A=arguments.length;A--;)C[A]=arguments[A];return new(Function.prototype.bind.apply(Ae.Color,[null].concat(C)))};Ae.Color=te,Ae.version="2.4.2";var ee=Ae,de=ke.unpack,De=Math.max,qe=function(){for(var C=[],A=arguments.length;A--;)C[A]=arguments[A];var N=de(C,"rgb"),K=N[0],ue=N[1],ye=N[2];K=K/255,ue=ue/255,ye=ye/255;var ae=1-De(K,De(ue,ye)),be=ae<1?1/(1-ae):0,Ie=(1-K-ae)*be,Ve=(1-ue-ae)*be,He=(1-ye-ae)*be;return[Ie,Ve,He,ae]},yt=qe,bt=ke.unpack,Et=function(){for(var C=[],A=arguments.length;A--;)C[A]=arguments[A];C=bt(C,"cmyk");var N=C[0],K=C[1],ue=C[2],ye=C[3],ae=C.length>4?C[4]:1;return ye===1?[0,0,0,ae]:[N>=1?0:255*(1-N)*(1-ye),K>=1?0:255*(1-K)*(1-ye),ue>=1?0:255*(1-ue)*(1-ye),ae]},or=Et,hr=ee,ht=te,Ye=gt,Fe=ke.unpack,dt=ke.type,St=yt;ht.prototype.cmyk=function(){return St(this._rgb)},hr.cmyk=function(){for(var C=[],A=arguments.length;A--;)C[A]=arguments[A];return new(Function.prototype.bind.apply(ht,[null].concat(C,["cmyk"])))},Ye.format.cmyk=or,Ye.autodetect.push({p:2,test:function(){for(var C=[],A=arguments.length;A--;)C[A]=arguments[A];if(C=Fe(C,"cmyk"),dt(C)==="array"&&C.length===4)return"cmyk"}});var Ze=ke.unpack,Ot=ke.last,Yt=function(C){return Math.round(C*100)/100},Ht=function(){for(var C=[],A=arguments.length;A--;)C[A]=arguments[A];var N=Ze(C,"hsla"),K=Ot(C)||"lsa";return N[0]=Yt(N[0]||0),N[1]=Yt(N[1]*100)+"%",N[2]=Yt(N[2]*100)+"%",K==="hsla"||N.length>3&&N[3]<1?(N[3]=N.length>3?N[3]:1,K="hsla"):N.length=3,K+"("+N.join(",")+")"},nr=Ht,Qt=ke.unpack,Ir=function(){for(var C=[],A=arguments.length;A--;)C[A]=arguments[A];C=Qt(C,"rgba");var N=C[0],K=C[1],ue=C[2];N/=255,K/=255,ue/=255;var ye=Math.min(N,K,ue),ae=Math.max(N,K,ue),be=(ae+ye)/2,Ie,Ve;return ae===ye?(Ie=0,Ve=Number.NaN):Ie=be<.5?(ae-ye)/(ae+ye):(ae-ye)/(2-ae-ye),N==ae?Ve=(K-ue)/(ae-ye):K==ae?Ve=2+(ue-N)/(ae-ye):ue==ae&&(Ve=4+(N-K)/(ae-ye)),Ve*=60,Ve<0&&(Ve+=360),C.length>3&&C[3]!==void 0?[Ve,Ie,be,C[3]]:[Ve,Ie,be]},Lt=Ir,lr=ke.unpack,Er=ke.last,_r=nr,dr=Lt,sr=Math.round,zr=function(){for(var C=[],A=arguments.length;A--;)C[A]=arguments[A];var N=lr(C,"rgba"),K=Er(C)||"rgb";return K.substr(0,3)=="hsl"?_r(dr(N),K):(N[0]=sr(N[0]),N[1]=sr(N[1]),N[2]=sr(N[2]),(K==="rgba"||N.length>3&&N[3]<1)&&(N[3]=N.length>3?N[3]:1,K="rgba"),K+"("+N.slice(0,K==="rgb"?3:4).join(",")+")")},Ce=zr,ai=ke.unpack,oi=Math.round,er=function(){for(var C,A=[],N=arguments.length;N--;)A[N]=arguments[N];A=ai(A,"hsl");var K=A[0],ue=A[1],ye=A[2],ae,be,Ie;if(ue===0)ae=be=Ie=ye*255;else{var Ve=[0,0,0],He=[0,0,0],mt=ye<.5?ye*(1+ue):ye+ue-ye*ue,et=2*ye-mt,Ct=K/360;Ve[0]=Ct+1/3,Ve[1]=Ct,Ve[2]=Ct-1/3;for(var It=0;It<3;It++)Ve[It]<0&&(Ve[It]+=1),Ve[It]>1&&(Ve[It]-=1),6*Ve[It]<1?He[It]=et+(mt-et)*6*Ve[It]:2*Ve[It]<1?He[It]=mt:3*Ve[It]<2?He[It]=et+(mt-et)*(2/3-Ve[It])*6:He[It]=et;C=[oi(He[0]*255),oi(He[1]*255),oi(He[2]*255)],ae=C[0],be=C[1],Ie=C[2]}return A.length>3?[ae,be,Ie,A[3]]:[ae,be,Ie,1]},fr=er,Qr=fr,Tr=gt,Rr=/^rgb\(\s*(-?\d+),\s*(-?\d+)\s*,\s*(-?\d+)\s*\)$/,Hi=/^rgba\(\s*(-?\d+),\s*(-?\d+)\s*,\s*(-?\d+)\s*,\s*([01]|[01]?\.\d+)\)$/,cr=/^rgb\(\s*(-?\d+(?:\.\d+)?)%,\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*\)$/,nn=/^rgba\(\s*(-?\d+(?:\.\d+)?)%,\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)$/,Wi=/^hsl\(\s*(-?\d+(?:\.\d+)?),\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*\)$/,Je=/^hsla\(\s*(-?\d+(?:\.\d+)?),\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)$/,Kr=Math.round,Jr=function(C){C=C.toLowerCase().trim();var A;if(Tr.format.named)try{return Tr.format.named(C)}catch{}if(A=C.match(Rr)){for(var N=A.slice(1,4),K=0;K<3;K++)N[K]=+N[K];return N[3]=1,N}if(A=C.match(Hi)){for(var ue=A.slice(1,5),ye=0;ye<4;ye++)ue[ye]=+ue[ye];return ue}if(A=C.match(cr)){for(var ae=A.slice(1,4),be=0;be<3;be++)ae[be]=Kr(ae[be]*2.55);return ae[3]=1,ae}if(A=C.match(nn)){for(var Ie=A.slice(1,5),Ve=0;Ve<3;Ve++)Ie[Ve]=Kr(Ie[Ve]*2.55);return Ie[3]=+Ie[3],Ie}if(A=C.match(Wi)){var He=A.slice(1,4);He[1]*=.01,He[2]*=.01;var mt=Qr(He);return mt[3]=1,mt}if(A=C.match(Je)){var et=A.slice(1,4);et[1]*=.01,et[2]*=.01;var Ct=Qr(et);return Ct[3]=+A[4],Ct}};Jr.test=function(C){return Rr.test(C)||Hi.test(C)||cr.test(C)||nn.test(C)||Wi.test(C)||Je.test(C)};var Xi=Jr,li=ee,Xe=te,Rt=gt,Nt=ke.type,mi=Ce,Bi=Xi;Xe.prototype.css=function(C){return mi(this._rgb,C)},li.css=function(){for(var C=[],A=arguments.length;A--;)C[A]=arguments[A];return new(Function.prototype.bind.apply(Xe,[null].concat(C,["css"])))},Rt.format.css=Bi,Rt.autodetect.push({p:5,test:function(C){for(var A=[],N=arguments.length-1;N-- >0;)A[N]=arguments[N+1];if(!A.length&&Nt(C)==="string"&&Bi.test(C))return"css"}});var Ut=te,ss=ee,as=gt,Si=ke.unpack;as.format.gl=function(){for(var C=[],A=arguments.length;A--;)C[A]=arguments[A];var N=Si(C,"rgba");return N[0]*=255,N[1]*=255,N[2]*=255,N},ss.gl=function(){for(var C=[],A=arguments.length;A--;)C[A]=arguments[A];return new(Function.prototype.bind.apply(Ut,[null].concat(C,["gl"])))},Ut.prototype.gl=function(){var C=this._rgb;return[C[0]/255,C[1]/255,C[2]/255,C[3]]};var X=ke.unpack,R=function(){for(var C=[],A=arguments.length;A--;)C[A]=arguments[A];var N=X(C,"rgb"),K=N[0],ue=N[1],ye=N[2],ae=Math.min(K,ue,ye),be=Math.max(K,ue,ye),Ie=be-ae,Ve=Ie*100/255,He=ae/(255-Ie)*100,mt;return Ie===0?mt=Number.NaN:(K===be&&(mt=(ue-ye)/Ie),ue===be&&(mt=2+(ye-K)/Ie),ye===be&&(mt=4+(K-ue)/Ie),mt*=60,mt<0&&(mt+=360)),[mt,Ve,He]},B=R,j=ke.unpack,Y=Math.floor,ce=function(){for(var C,A,N,K,ue,ye,ae=[],be=arguments.length;be--;)ae[be]=arguments[be];ae=j(ae,"hcg");var Ie=ae[0],Ve=ae[1],He=ae[2],mt,et,Ct;He=He*255;var It=Ve*255;if(Ve===0)mt=et=Ct=He;else{Ie===360&&(Ie=0),Ie>360&&(Ie-=360),Ie<0&&(Ie+=360),Ie/=60;var pr=Y(Ie),mr=Ie-pr,Mr=He*(1-Ve),Cr=Mr+It*(1-mr),Qi=Mr+It*mr,Mi=Mr+It;switch(pr){case 0:C=[Mi,Qi,Mr],mt=C[0],et=C[1],Ct=C[2];break;case 1:A=[Cr,Mi,Mr],mt=A[0],et=A[1],Ct=A[2];break;case 2:N=[Mr,Mi,Qi],mt=N[0],et=N[1],Ct=N[2];break;case 3:K=[Mr,Cr,Mi],mt=K[0],et=K[1],Ct=K[2];break;case 4:ue=[Qi,Mr,Mi],mt=ue[0],et=ue[1],Ct=ue[2];break;case 5:ye=[Mi,Mr,Cr],mt=ye[0],et=ye[1],Ct=ye[2];break}}return[mt,et,Ct,ae.length>3?ae[3]:1]},fe=ce,xe=ke.unpack,se=ke.type,Me=ee,Ne=te,Re=gt,ze=B;Ne.prototype.hcg=function(){return ze(this._rgb)},Me.hcg=function(){for(var C=[],A=arguments.length;A--;)C[A]=arguments[A];return new(Function.prototype.bind.apply(Ne,[null].concat(C,["hcg"])))},Re.format.hcg=fe,Re.autodetect.push({p:1,test:function(){for(var C=[],A=arguments.length;A--;)C[A]=arguments[A];if(C=xe(C,"hcg"),se(C)==="array"&&C.length===3)return"hcg"}});var Dt=ke.unpack,Pt=ke.last,Xt=Math.round,$t=function(){for(var C=[],A=arguments.length;A--;)C[A]=arguments[A];var N=Dt(C,"rgba"),K=N[0],ue=N[1],ye=N[2],ae=N[3],be=Pt(C)||"auto";ae===void 0&&(ae=1),be==="auto"&&(be=ae<1?"rgba":"rgb"),K=Xt(K),ue=Xt(ue),ye=Xt(ye);var Ie=K<<16|ue<<8|ye,Ve="000000"+Ie.toString(16);Ve=Ve.substr(Ve.length-6);var He="0"+Xt(ae*255).toString(16);switch(He=He.substr(He.length-2),be.toLowerCase()){case"rgba":return"#"+Ve+He;case"argb":return"#"+He+Ve;default:return"#"+Ve}},ur=$t,Ar=/^#?([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/,$r=/^#?([A-Fa-f0-9]{8}|[A-Fa-f0-9]{4})$/,ci=function(C){if(C.match(Ar)){(C.length===4||C.length===7)&&(C=C.substr(1)),C.length===3&&(C=C.split(""),C=C[0]+C[0]+C[1]+C[1]+C[2]+C[2]);var A=parseInt(C,16),N=A>>16,K=A>>8&255,ue=A&255;return[N,K,ue,1]}if(C.match($r)){(C.length===5||C.length===9)&&(C=C.substr(1)),C.length===4&&(C=C.split(""),C=C[0]+C[0]+C[1]+C[1]+C[2]+C[2]+C[3]+C[3]);var ye=parseInt(C,16),ae=ye>>24&255,be=ye>>16&255,Ie=ye>>8&255,Ve=Math.round((ye&255)/255*100)/100;return[ae,be,Ie,Ve]}throw new Error("unknown hex color: "+C)},qt=ci,Yr=ee,ui=te,sn=ke.type,an=gt,gi=ur;ui.prototype.hex=function(C){return gi(this._rgb,C)},Yr.hex=function(){for(var C=[],A=arguments.length;A--;)C[A]=arguments[A];return new(Function.prototype.bind.apply(ui,[null].concat(C,["hex"])))},an.format.hex=qt,an.autodetect.push({p:4,test:function(C){for(var A=[],N=arguments.length-1;N-- >0;)A[N]=arguments[N+1];if(!A.length&&sn(C)==="string"&&[3,4,5,6,7,8,9].indexOf(C.length)>=0)return"hex"}});var xa=ke.unpack,Yc=ke.TWOPI,Pr=Math.min,Jl=Math.sqrt,Yl=Math.acos,mn=function(){for(var C=[],A=arguments.length;A--;)C[A]=arguments[A];var N=xa(C,"rgb"),K=N[0],ue=N[1],ye=N[2];K/=255,ue/=255,ye/=255;var ae,be=Pr(K,ue,ye),Ie=(K+ue+ye)/3,Ve=Ie>0?1-be/Ie:0;return Ve===0?ae=NaN:(ae=(K-ue+(K-ye))/2,ae/=Jl((K-ue)*(K-ue)+(K-ye)*(ue-ye)),ae=Yl(ae),ye>ue&&(ae=Yc-ae),ae/=Yc),[ae*360,Ve,Ie]},on=mn,Qa=ke.unpack,Oi=ke.limit,Pi=ke.TWOPI,No=ke.PITHIRD,ln=Math.cos,hi=function(){for(var C=[],A=arguments.length;A--;)C[A]=arguments[A];C=Qa(C,"hsi");var N=C[0],K=C[1],ue=C[2],ye,ae,be;return isNaN(N)&&(N=0),isNaN(K)&&(K=0),N>360&&(N-=360),N<0&&(N+=360),N/=360,N<1/3?(be=(1-K)/3,ye=(1+K*ln(Pi*N)/ln(No-Pi*N))/3,ae=1-(be+ye)):N<2/3?(N-=1/3,ye=(1-K)/3,ae=(1+K*ln(Pi*N)/ln(No-Pi*N))/3,be=1-(ye+ae)):(N-=2/3,ae=(1-K)/3,be=(1+K*ln(Pi*N)/ln(No-Pi*N))/3,ye=1-(ae+be)),ye=Oi(ue*ye*3),ae=Oi(ue*ae*3),be=Oi(ue*be*3),[ye*255,ae*255,be*255,C.length>3?C[3]:1]},eo=hi,Hs=ke.unpack,ri=ke.type,Ws=ee,En=te,to=gt,Wn=on;En.prototype.hsi=function(){return Wn(this._rgb)},Ws.hsi=function(){for(var C=[],A=arguments.length;A--;)C[A]=arguments[A];return new(Function.prototype.bind.apply(En,[null].concat(C,["hsi"])))},to.format.hsi=eo,to.autodetect.push({p:2,test:function(){for(var C=[],A=arguments.length;A--;)C[A]=arguments[A];if(C=Hs(C,"hsi"),ri(C)==="array"&&C.length===3)return"hsi"}});var Ql=ke.unpack,ba=ke.type,br=ee,ro=te,Xs=gt,ec=Lt;ro.prototype.hsl=function(){return ec(this._rgb)},br.hsl=function(){for(var C=[],A=arguments.length;A--;)C[A]=arguments[A];return new(Function.prototype.bind.apply(ro,[null].concat(C,["hsl"])))},Xs.format.hsl=fr,Xs.autodetect.push({p:2,test:function(){for(var C=[],A=arguments.length;A--;)C[A]=arguments[A];if(C=Ql(C,"hsl"),ba(C)==="array"&&C.length===3)return"hsl"}});var $o=ke.unpack,io=Math.min,tc=Math.max,jo=function(){for(var C=[],A=arguments.length;A--;)C[A]=arguments[A];C=$o(C,"rgb");var N=C[0],K=C[1],ue=C[2],ye=io(N,K,ue),ae=tc(N,K,ue),be=ae-ye,Ie,Ve,He;return He=ae/255,ae===0?(Ie=Number.NaN,Ve=0):(Ve=be/ae,N===ae&&(Ie=(K-ue)/be),K===ae&&(Ie=2+(ue-N)/be),ue===ae&&(Ie=4+(N-K)/be),Ie*=60,Ie<0&&(Ie+=360)),[Ie,Ve,He]},no=jo,Vo=ke.unpack,so=Math.floor,fh=function(){for(var C,A,N,K,ue,ye,ae=[],be=arguments.length;be--;)ae[be]=arguments[be];ae=Vo(ae,"hsv");var Ie=ae[0],Ve=ae[1],He=ae[2],mt,et,Ct;if(He*=255,Ve===0)mt=et=Ct=He;else{Ie===360&&(Ie=0),Ie>360&&(Ie-=360),Ie<0&&(Ie+=360),Ie/=60;var It=so(Ie),pr=Ie-It,mr=He*(1-Ve),Mr=He*(1-Ve*pr),Cr=He*(1-Ve*(1-pr));switch(It){case 0:C=[He,Cr,mr],mt=C[0],et=C[1],Ct=C[2];break;case 1:A=[Mr,He,mr],mt=A[0],et=A[1],Ct=A[2];break;case 2:N=[mr,He,Cr],mt=N[0],et=N[1],Ct=N[2];break;case 3:K=[mr,Mr,He],mt=K[0],et=K[1],Ct=K[2];break;case 4:ue=[Cr,mr,He],mt=ue[0],et=ue[1],Ct=ue[2];break;case 5:ye=[He,mr,Mr],mt=ye[0],et=ye[1],Ct=ye[2];break}}return[mt,et,Ct,ae.length>3?ae[3]:1]},mh=fh,rc=ke.unpack,Qc=ke.type,Ks=ee,ao=te,Ni=gt,gn=no;ao.prototype.hsv=function(){return gn(this._rgb)},Ks.hsv=function(){for(var C=[],A=arguments.length;A--;)C[A]=arguments[A];return new(Function.prototype.bind.apply(ao,[null].concat(C,["hsv"])))},Ni.format.hsv=mh,Ni.autodetect.push({p:2,test:function(){for(var C=[],A=arguments.length;A--;)C[A]=arguments[A];if(C=rc(C,"hsv"),Qc(C)==="array"&&C.length===3)return"hsv"}});var wa={Kn:18,Xn:.95047,Yn:1,Zn:1.08883,t0:.137931034,t1:.206896552,t2:.12841855,t3:.008856452},os=wa,ic=ke.unpack,Uo=Math.pow,Sa=function(){for(var C=[],A=arguments.length;A--;)C[A]=arguments[A];var N=ic(C,"rgb"),K=N[0],ue=N[1],ye=N[2],ae=eu(K,ue,ye),be=ae[0],Ie=ae[1],Ve=ae[2],He=116*Ie-16;return[He<0?0:He,500*(be-Ie),200*(Ie-Ve)]},nc=function(C){return(C/=255)<=.04045?C/12.92:Uo((C+.055)/1.055,2.4)},qo=function(C){return C>os.t3?Uo(C,1/3):C/os.t2+os.t0},eu=function(C,A,N){C=nc(C),A=nc(A),N=nc(N);var K=qo((.4124564*C+.3575761*A+.1804375*N)/os.Xn),ue=qo((.2126729*C+.7151522*A+.072175*N)/os.Yn),ye=qo((.0193339*C+.119192*A+.9503041*N)/os.Zn);return[K,ue,ye]},tu=Sa,Ma=wa,gh=ke.unpack,Go=Math.pow,sc=function(){for(var C=[],A=arguments.length;A--;)C[A]=arguments[A];C=gh(C,"lab");var N=C[0],K=C[1],ue=C[2],ye,ae,be,Ie,Ve,He;return ae=(N+16)/116,ye=isNaN(K)?ae:ae+K/500,be=isNaN(ue)?ae:ae-ue/200,ae=Ma.Yn*oo(ae),ye=Ma.Xn*oo(ye),be=Ma.Zn*oo(be),Ie=ka(3.2404542*ye-1.5371385*ae-.4985314*be),Ve=ka(-.969266*ye+1.8760108*ae+.041556*be),He=ka(.0556434*ye-.2040259*ae+1.0572252*be),[Ie,Ve,He,C.length>3?C[3]:1]},ka=function(C){return 255*(C<=.00304?12.92*C:1.055*Go(C,1/2.4)-.055)},oo=function(C){return C>Ma.t1?C*C*C:Ma.t2*(C-Ma.t0)},Ta=sc,_n=ke.unpack,wr=ke.type,ac=ee,Ca=te,Ia=gt,_h=tu;Ca.prototype.lab=function(){return _h(this._rgb)},ac.lab=function(){for(var C=[],A=arguments.length;A--;)C[A]=arguments[A];return new(Function.prototype.bind.apply(Ca,[null].concat(C,["lab"])))},Ia.format.lab=Ta,Ia.autodetect.push({p:2,test:function(){for(var C=[],A=arguments.length;A--;)C[A]=arguments[A];if(C=_n(C,"lab"),wr(C)==="array"&&C.length===3)return"lab"}});var Zo=ke.unpack,yh=ke.RAD2DEG,Ea=Math.sqrt,vh=Math.atan2,ru=Math.round,xh=function(){for(var C=[],A=arguments.length;A--;)C[A]=arguments[A];var N=Zo(C,"lab"),K=N[0],ue=N[1],ye=N[2],ae=Ea(ue*ue+ye*ye),be=(vh(ye,ue)*yh+360)%360;return ru(ae*1e4)===0&&(be=Number.NaN),[K,ae,be]},oc=xh,lc=ke.unpack,iu=tu,nu=oc,su=function(){for(var C=[],A=arguments.length;A--;)C[A]=arguments[A];var N=lc(C,"rgb"),K=N[0],ue=N[1],ye=N[2],ae=iu(K,ue,ye),be=ae[0],Ie=ae[1],Ve=ae[2];return nu(be,Ie,Ve)},au=su,Js=ke.unpack,ou=ke.DEG2RAD,bh=Math.sin,wh=Math.cos,lu=function(){for(var C=[],A=arguments.length;A--;)C[A]=arguments[A];var N=Js(C,"lch"),K=N[0],ue=N[1],ye=N[2];return isNaN(ye)&&(ye=0),ye=ye*ou,[K,wh(ye)*ue,bh(ye)*ue]},Pa=lu,Sh=ke.unpack,Ho=Pa,Mh=Ta,kh=function(){for(var C=[],A=arguments.length;A--;)C[A]=arguments[A];C=Sh(C,"lch");var N=C[0],K=C[1],ue=C[2],ye=Ho(N,K,ue),ae=ye[0],be=ye[1],Ie=ye[2],Ve=Mh(ae,be,Ie),He=Ve[0],mt=Ve[1],et=Ve[2];return[He,mt,et,C.length>3?C[3]:1]},cc=kh,cu=ke.unpack,uu=cc,uc=function(){for(var C=[],A=arguments.length;A--;)C[A]=arguments[A];var N=cu(C,"hcl").reverse();return uu.apply(void 0,N)},hu=uc,Aa=ke.unpack,ls=ke.type,Wo=ee,Da=te,lo=gt,ei=au;Da.prototype.lch=function(){return ei(this._rgb)},Da.prototype.hcl=function(){return ei(this._rgb).reverse()},Wo.lch=function(){for(var C=[],A=arguments.length;A--;)C[A]=arguments[A];return new(Function.prototype.bind.apply(Da,[null].concat(C,["lch"])))},Wo.hcl=function(){for(var C=[],A=arguments.length;A--;)C[A]=arguments[A];return new(Function.prototype.bind.apply(Da,[null].concat(C,["hcl"])))},lo.format.lch=cc,lo.format.hcl=hu,["lch","hcl"].forEach(function(C){return lo.autodetect.push({p:2,test:function(){for(var A=[],N=arguments.length;N--;)A[N]=arguments[N];if(A=Aa(A,C),ls(A)==="array"&&A.length===3)return C}})});var hc={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflower:"#6495ed",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",laserlemon:"#ffff54",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrod:"#fafad2",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",maroon2:"#7f0000",maroon3:"#b03060",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",purple2:"#7f007f",purple3:"#a020f0",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},Wt=hc,co=te,qr=gt,Gr=ke.type,Cs=Wt,du=qt,dc=ur;co.prototype.name=function(){for(var C=dc(this._rgb,"rgb"),A=0,N=Object.keys(Cs);A<N.length;A+=1){var K=N[A];if(Cs[K]===C)return K.toLowerCase()}return C},qr.format.named=function(C){if(C=C.toLowerCase(),Cs[C])return du(Cs[C]);throw new Error("unknown color name: "+C)},qr.autodetect.push({p:5,test:function(C){for(var A=[],N=arguments.length-1;N-- >0;)A[N]=arguments[N+1];if(!A.length&&Gr(C)==="string"&&Cs[C.toLowerCase()])return"named"}});var Th=ke.unpack,pu=function(){for(var C=[],A=arguments.length;A--;)C[A]=arguments[A];var N=Th(C,"rgb"),K=N[0],ue=N[1],ye=N[2];return(K<<16)+(ue<<8)+ye},Xo=pu,Ko=ke.type,uo=function(C){if(Ko(C)=="number"&&C>=0&&C<=16777215){var A=C>>16,N=C>>8&255,K=C&255;return[A,N,K,1]}throw new Error("unknown num color: "+C)},Jo=uo,Is=ee,Es=te,Ki=gt,fu=ke.type,mu=Xo;Es.prototype.num=function(){return mu(this._rgb)},Is.num=function(){for(var C=[],A=arguments.length;A--;)C[A]=arguments[A];return new(Function.prototype.bind.apply(Es,[null].concat(C,["num"])))},Ki.format.num=Jo,Ki.autodetect.push({p:5,test:function(){for(var C=[],A=arguments.length;A--;)C[A]=arguments[A];if(C.length===1&&fu(C[0])==="number"&&C[0]>=0&&C[0]<=16777215)return"num"}});var pc=ee,cs=te,ho=gt,po=ke.unpack,za=ke.type,fo=Math.round;cs.prototype.rgb=function(C){return C===void 0&&(C=!0),C===!1?this._rgb.slice(0,3):this._rgb.slice(0,3).map(fo)},cs.prototype.rgba=function(C){return C===void 0&&(C=!0),this._rgb.slice(0,4).map(function(A,N){return N<3?C===!1?A:fo(A):A})},pc.rgb=function(){for(var C=[],A=arguments.length;A--;)C[A]=arguments[A];return new(Function.prototype.bind.apply(cs,[null].concat(C,["rgb"])))},ho.format.rgb=function(){for(var C=[],A=arguments.length;A--;)C[A]=arguments[A];var N=po(C,"rgba");return N[3]===void 0&&(N[3]=1),N},ho.autodetect.push({p:3,test:function(){for(var C=[],A=arguments.length;A--;)C[A]=arguments[A];if(C=po(C,"rgba"),za(C)==="array"&&(C.length===3||C.length===4&&za(C[3])=="number"&&C[3]>=0&&C[3]<=1))return"rgb"}});var La=Math.log,Ys=function(C){var A=C/100,N,K,ue;return A<66?(N=255,K=A<6?0:-155.25485562709179-.44596950469579133*(K=A-2)+104.49216199393888*La(K),ue=A<20?0:-254.76935184120902+.8274096064007395*(ue=A-10)+115.67994401066147*La(ue)):(N=351.97690566805693+.114206453784165*(N=A-55)-40.25366309332127*La(N),K=325.4494125711974+.07943456536662342*(K=A-50)-28.0852963507957*La(K),ue=255),[N,K,ue,1]},Xn=Ys,gu=Xn,Yo=ke.unpack,yr=Math.round,Ra=function(){for(var C=[],A=arguments.length;A--;)C[A]=arguments[A];for(var N=Yo(C,"rgb"),K=N[0],ue=N[2],ye=1e3,ae=4e4,be=.4,Ie;ae-ye>be;){Ie=(ae+ye)*.5;var Ve=gu(Ie);Ve[2]/Ve[0]>=ue/K?ae=Ie:ye=Ie}return yr(Ie)},Qo=Ra,Qs=ee,us=te,mo=gt,_u=Qo;us.prototype.temp=us.prototype.kelvin=us.prototype.temperature=function(){return _u(this._rgb)},Qs.temp=Qs.kelvin=Qs.temperature=function(){for(var C=[],A=arguments.length;A--;)C[A]=arguments[A];return new(Function.prototype.bind.apply(us,[null].concat(C,["temp"])))},mo.format.temp=mo.format.kelvin=mo.format.temperature=Xn;var fc=ke.unpack,Fa=Math.cbrt,mc=Math.pow,el=Math.sign,tl=function(){for(var C=[],A=arguments.length;A--;)C[A]=arguments[A];var N=fc(C,"rgb"),K=N[0],ue=N[1],ye=N[2],ae=[go(K/255),go(ue/255),go(ye/255)],be=ae[0],Ie=ae[1],Ve=ae[2],He=Fa(.4122214708*be+.5363325363*Ie+.0514459929*Ve),mt=Fa(.2119034982*be+.6806995451*Ie+.1073969566*Ve),et=Fa(.0883024619*be+.2817188376*Ie+.6299787005*Ve);return[.2104542553*He+.793617785*mt-.0040720468*et,1.9779984951*He-2.428592205*mt+.4505937099*et,.0259040371*He+.7827717662*mt-.808675766*et]},rl=tl;function go(C){var A=Math.abs(C);return A<.04045?C/12.92:(el(C)||1)*mc((A+.055)/1.055,2.4)}var _o=ke.unpack,Kn=Math.pow,$i=Math.sign,ea=function(){for(var C=[],A=arguments.length;A--;)C[A]=arguments[A];C=_o(C,"lab");var N=C[0],K=C[1],ue=C[2],ye=Kn(N+.3963377774*K+.2158037573*ue,3),ae=Kn(N-.1055613458*K-.0638541728*ue,3),be=Kn(N-.0894841775*K-1.291485548*ue,3);return[255*yo(4.0767416621*ye-3.3077115913*ae+.2309699292*be),255*yo(-1.2684380046*ye+2.6097574011*ae-.3413193965*be),255*yo(-.0041960863*ye-.7034186147*ae+1.707614701*be),C.length>3?C[3]:1]},gc=ea;function yo(C){var A=Math.abs(C);return A>.0031308?($i(C)||1)*(1.055*Kn(A,1/2.4)-.055):C*12.92}var Ch=ke.unpack,Ba=ke.type,vo=ee,Oa=te,_c=gt,il=rl;Oa.prototype.oklab=function(){return il(this._rgb)},vo.oklab=function(){for(var C=[],A=arguments.length;A--;)C[A]=arguments[A];return new(Function.prototype.bind.apply(Oa,[null].concat(C,["oklab"])))},_c.format.oklab=gc,_c.autodetect.push({p:3,test:function(){for(var C=[],A=arguments.length;A--;)C[A]=arguments[A];if(C=Ch(C,"oklab"),Ba(C)==="array"&&C.length===3)return"oklab"}});var nl=ke.unpack,ta=rl,Ih=oc,sl=function(){for(var C=[],A=arguments.length;A--;)C[A]=arguments[A];var N=nl(C,"rgb"),K=N[0],ue=N[1],ye=N[2],ae=ta(K,ue,ye),be=ae[0],Ie=ae[1],Ve=ae[2];return Ih(be,Ie,Ve)},ti=sl,hs=ke.unpack,yn=Pa,al=gc,yc=function(){for(var C=[],A=arguments.length;A--;)C[A]=arguments[A];C=hs(C,"lch");var N=C[0],K=C[1],ue=C[2],ye=yn(N,K,ue),ae=ye[0],be=ye[1],Ie=ye[2],Ve=al(ae,be,Ie),He=Ve[0],mt=Ve[1],et=Ve[2];return[He,mt,et,C.length>3?C[3]:1]},ol=yc,ds=ke.unpack,Na=ke.type,ll=ee,cl=te,ul=gt,hl=ti;cl.prototype.oklch=function(){return hl(this._rgb)},ll.oklch=function(){for(var C=[],A=arguments.length;A--;)C[A]=arguments[A];return new(Function.prototype.bind.apply(cl,[null].concat(C,["oklch"])))},ul.format.oklch=ol,ul.autodetect.push({p:3,test:function(){for(var C=[],A=arguments.length;A--;)C[A]=arguments[A];if(C=ds(C,"oklch"),Na(C)==="array"&&C.length===3)return"oklch"}});var dl=te,yu=ke.type;dl.prototype.alpha=function(C,A){return A===void 0&&(A=!1),C!==void 0&&yu(C)==="number"?A?(this._rgb[3]=C,this):new dl([this._rgb[0],this._rgb[1],this._rgb[2],C],"rgb"):this._rgb[3]};var Ps=te;Ps.prototype.clipped=function(){return this._rgb._clipped||!1};var As=te,vc=wa;As.prototype.darken=function(C){C===void 0&&(C=1);var A=this,N=A.lab();return N[0]-=vc.Kn*C,new As(N,"lab").alpha(A.alpha(),!0)},As.prototype.brighten=function(C){return C===void 0&&(C=1),this.darken(-C)},As.prototype.darker=As.prototype.darken,As.prototype.brighter=As.prototype.brighten;var xc=te;xc.prototype.get=function(C){var A=C.split("."),N=A[0],K=A[1],ue=this[N]();if(K){var ye=N.indexOf(K)-(N.substr(0,2)==="ok"?2:0);if(ye>-1)return ue[ye];throw new Error("unknown channel "+K+" in mode "+N)}else return ue};var Ds=te,vu=ke.type,xu=Math.pow,bc=1e-7,$a=20;Ds.prototype.luminance=function(C){if(C!==void 0&&vu(C)==="number"){if(C===0)return new Ds([0,0,0,this._rgb[3]],"rgb");if(C===1)return new Ds([255,255,255,this._rgb[3]],"rgb");var A=this.luminance(),N="rgb",K=$a,ue=function(ae,be){var Ie=ae.interpolate(be,.5,N),Ve=Ie.luminance();return Math.abs(C-Ve)<bc||!K--?Ie:Ve>C?ue(ae,Ie):ue(Ie,be)},ye=(A>C?ue(new Ds([0,0,0]),this):ue(this,new Ds([255,255,255]))).rgb();return new Ds(ye.concat([this._rgb[3]]))}return wc.apply(void 0,this._rgb.slice(0,3))};var wc=function(C,A,N){return C=cn(C),A=cn(A),N=cn(N),.2126*C+.7152*A+.0722*N},cn=function(C){return C/=255,C<=.03928?C/12.92:xu((C+.055)/1.055,2.4)},Zr={},Sc=te,vn=ke.type,zs=Zr,bu=function(C,A,N){N===void 0&&(N=.5);for(var K=[],ue=arguments.length-3;ue-- >0;)K[ue]=arguments[ue+3];var ye=K[0]||"lrgb";if(!zs[ye]&&!K.length&&(ye=Object.keys(zs)[0]),!zs[ye])throw new Error("interpolation mode "+ye+" is not defined");return vn(C)!=="object"&&(C=new Sc(C)),vn(A)!=="object"&&(A=new Sc(A)),zs[ye](C,A,N).alpha(C.alpha()+N*(A.alpha()-C.alpha()))},Mc=te,wu=bu;Mc.prototype.mix=Mc.prototype.interpolate=function(C,A){A===void 0&&(A=.5);for(var N=[],K=arguments.length-2;K-- >0;)N[K]=arguments[K+2];return wu.apply(void 0,[this,C,A].concat(N))};var pl=te;pl.prototype.premultiply=function(C){C===void 0&&(C=!1);var A=this._rgb,N=A[3];return C?(this._rgb=[A[0]*N,A[1]*N,A[2]*N,N],this):new pl([A[0]*N,A[1]*N,A[2]*N,N],"rgb")};var ra=te,Ls=wa;ra.prototype.saturate=function(C){C===void 0&&(C=1);var A=this,N=A.lch();return N[1]+=Ls.Kn*C,N[1]<0&&(N[1]=0),new ra(N,"lch").alpha(A.alpha(),!0)},ra.prototype.desaturate=function(C){return C===void 0&&(C=1),this.saturate(-C)};var _t=te,kc=ke.type;_t.prototype.set=function(C,A,N){N===void 0&&(N=!1);var K=C.split("."),ue=K[0],ye=K[1],ae=this[ue]();if(ye){var be=ue.indexOf(ye)-(ue.substr(0,2)==="ok"?2:0);if(be>-1){if(kc(A)=="string")switch(A.charAt(0)){case"+":ae[be]+=+A;break;case"-":ae[be]+=+A;break;case"*":ae[be]*=+A.substr(1);break;case"/":ae[be]/=+A.substr(1);break;default:ae[be]=+A}else if(kc(A)==="number")ae[be]=A;else throw new Error("unsupported value for Color.set");var Ie=new _t(ae,ue);return N?(this._rgb=Ie._rgb,this):Ie}throw new Error("unknown channel "+ye+" in mode "+ue)}else return ae};var xo=te,Jn=function(C,A,N){var K=C._rgb,ue=A._rgb;return new xo(K[0]+N*(ue[0]-K[0]),K[1]+N*(ue[1]-K[1]),K[2]+N*(ue[2]-K[2]),"rgb")};Zr.rgb=Jn;var Su=te,ot=Math.sqrt,Rs=Math.pow,Eh=function(C,A,N){var K=C._rgb,ue=K[0],ye=K[1],ae=K[2],be=A._rgb,Ie=be[0],Ve=be[1],He=be[2];return new Su(ot(Rs(ue,2)*(1-N)+Rs(Ie,2)*N),ot(Rs(ye,2)*(1-N)+Rs(Ve,2)*N),ot(Rs(ae,2)*(1-N)+Rs(He,2)*N),"rgb")};Zr.lrgb=Eh;var Mu=te,Tc=function(C,A,N){var K=C.lab(),ue=A.lab();return new Mu(K[0]+N*(ue[0]-K[0]),K[1]+N*(ue[1]-K[1]),K[2]+N*(ue[2]-K[2]),"lab")};Zr.lab=Tc;var Cc=te,xn=function(C,A,N,K){var ue,ye,ae,be;K==="hsl"?(ae=C.hsl(),be=A.hsl()):K==="hsv"?(ae=C.hsv(),be=A.hsv()):K==="hcg"?(ae=C.hcg(),be=A.hcg()):K==="hsi"?(ae=C.hsi(),be=A.hsi()):K==="lch"||K==="hcl"?(K="hcl",ae=C.hcl(),be=A.hcl()):K==="oklch"&&(ae=C.oklch().reverse(),be=A.oklch().reverse());var Ie,Ve,He,mt,et,Ct;(K.substr(0,1)==="h"||K==="oklch")&&(ue=ae,Ie=ue[0],He=ue[1],et=ue[2],ye=be,Ve=ye[0],mt=ye[1],Ct=ye[2]);var It,pr,mr,Mr;return!isNaN(Ie)&&!isNaN(Ve)?(Ve>Ie&&Ve-Ie>180?Mr=Ve-(Ie+360):Ve<Ie&&Ie-Ve>180?Mr=Ve+360-Ie:Mr=Ve-Ie,pr=Ie+N*Mr):isNaN(Ie)?isNaN(Ve)?pr=Number.NaN:(pr=Ve,(et==1||et==0)&&K!="hsv"&&(It=mt)):(pr=Ie,(Ct==1||Ct==0)&&K!="hsv"&&(It=He)),It===void 0&&(It=He+N*(mt-He)),mr=et+N*(Ct-et),K==="oklch"?new Cc([mr,It,pr],K):new Cc([pr,It,mr],K)},ku=xn,fl=function(C,A,N){return ku(C,A,N,"lch")};Zr.lch=fl,Zr.hcl=fl;var Fs=te,Fr=function(C,A,N){var K=C.num(),ue=A.num();return new Fs(K+N*(ue-K),"num")};Zr.num=Fr;var ml=xn,ja=function(C,A,N){return ml(C,A,N,"hcg")};Zr.hcg=ja;var Va=xn,Tu=function(C,A,N){return Va(C,A,N,"hsi")};Zr.hsi=Tu;var Ic=xn,bo=function(C,A,N){return Ic(C,A,N,"hsl")};Zr.hsl=bo;var Yn=xn,gl=function(C,A,N){return Yn(C,A,N,"hsv")};Zr.hsv=gl;var Tt=te,Ft=function(C,A,N){var K=C.oklab(),ue=A.oklab();return new Tt(K[0]+N*(ue[0]-K[0]),K[1]+N*(ue[1]-K[1]),K[2]+N*(ue[2]-K[2]),"oklab")};Zr.oklab=Ft;var p=xn,t=function(C,A,N){return p(C,A,N,"oklch")};Zr.oklch=t;var s=te,l=ke.clip_rgb,u=Math.pow,m=Math.sqrt,v=Math.PI,b=Math.cos,M=Math.sin,I=Math.atan2,z=function(C,A,N){A===void 0&&(A="lrgb"),N===void 0&&(N=null);var K=C.length;N||(N=Array.from(new Array(K)).map(function(){return 1}));var ue=K/N.reduce(function(pr,mr){return pr+mr});if(N.forEach(function(pr,mr){N[mr]*=ue}),C=C.map(function(pr){return new s(pr)}),A==="lrgb")return D(C,N);for(var ye=C.shift(),ae=ye.get(A),be=[],Ie=0,Ve=0,He=0;He<ae.length;He++)if(ae[He]=(ae[He]||0)*N[0],be.push(isNaN(ae[He])?0:N[0]),A.charAt(He)==="h"&&!isNaN(ae[He])){var mt=ae[He]/180*v;Ie+=b(mt)*N[0],Ve+=M(mt)*N[0]}var et=ye.alpha()*N[0];C.forEach(function(pr,mr){var Mr=pr.get(A);et+=pr.alpha()*N[mr+1];for(var Cr=0;Cr<ae.length;Cr++)if(!isNaN(Mr[Cr]))if(be[Cr]+=N[mr+1],A.charAt(Cr)==="h"){var Qi=Mr[Cr]/180*v;Ie+=b(Qi)*N[mr+1],Ve+=M(Qi)*N[mr+1]}else ae[Cr]+=Mr[Cr]*N[mr+1]});for(var Ct=0;Ct<ae.length;Ct++)if(A.charAt(Ct)==="h"){for(var It=I(Ve/be[Ct],Ie/be[Ct])/v*180;It<0;)It+=360;for(;It>=360;)It-=360;ae[Ct]=It}else ae[Ct]=ae[Ct]/be[Ct];return et/=K,new s(ae,A).alpha(et>.99999?1:et,!0)},D=function(C,A){for(var N=C.length,K=[0,0,0,0],ue=0;ue<C.length;ue++){var ye=C[ue],ae=A[ue]/N,be=ye._rgb;K[0]+=u(be[0],2)*ae,K[1]+=u(be[1],2)*ae,K[2]+=u(be[2],2)*ae,K[3]+=be[3]*ae}return K[0]=m(K[0]),K[1]=m(K[1]),K[2]=m(K[2]),K[3]>.9999999&&(K[3]=1),new s(l(K))},O=ee,V=ke.type,G=Math.pow,Q=function(C){var A="rgb",N=O("#ccc"),K=0,ue=[0,1],ye=[],ae=[0,0],be=!1,Ie=[],Ve=!1,He=0,mt=1,et=!1,Ct={},It=!0,pr=1,mr=function(Qe){if(Qe=Qe||["#fff","#000"],Qe&&V(Qe)==="string"&&O.brewer&&O.brewer[Qe.toLowerCase()]&&(Qe=O.brewer[Qe.toLowerCase()]),V(Qe)==="array"){Qe.length===1&&(Qe=[Qe[0],Qe[0]]),Qe=Qe.slice(0);for(var Vt=0;Vt<Qe.length;Vt++)Qe[Vt]=O(Qe[Vt]);ye.length=0;for(var tr=0;tr<Qe.length;tr++)ye.push(tr/(Qe.length-1))}return bn(),Ie=Qe},Mr=function(Qe){if(be!=null){for(var Vt=be.length-1,tr=0;tr<Vt&&Qe>=be[tr];)tr++;return tr-1}return 0},Cr=function(Qe){return Qe},Qi=function(Qe){return Qe},Mi=function(Qe,Vt){var tr,rr;if(Vt==null&&(Vt=!1),isNaN(Qe)||Qe===null)return N;if(Vt)rr=Qe;else if(be&&be.length>2){var ki=Mr(Qe);rr=ki/(be.length-2)}else mt!==He?rr=(Qe-He)/(mt-He):rr=1;rr=Qi(rr),Vt||(rr=Cr(rr)),pr!==1&&(rr=G(rr,pr)),rr=ae[0]+rr*(1-ae[0]-ae[1]),rr=Math.min(1,Math.max(0,rr));var Wr=Math.floor(rr*1e4);if(It&&Ct[Wr])tr=Ct[Wr];else{if(V(Ie)==="array")for(var vr=0;vr<ye.length;vr++){var Lr=ye[vr];if(rr<=Lr){tr=Ie[vr];break}if(rr>=Lr&&vr===ye.length-1){tr=Ie[vr];break}if(rr>Lr&&rr<ye[vr+1]){rr=(rr-Lr)/(ye[vr+1]-Lr),tr=O.interpolate(Ie[vr],Ie[vr+1],rr,A);break}}else V(Ie)==="function"&&(tr=Ie(rr));It&&(Ct[Wr]=tr)}return tr},bn=function(){return Ct={}};mr(C);var gr=function(Qe){var Vt=O(Mi(Qe));return Ve&&Vt[Ve]?Vt[Ve]():Vt};return gr.classes=function(Qe){if(Qe!=null){if(V(Qe)==="array")be=Qe,ue=[Qe[0],Qe[Qe.length-1]];else{var Vt=O.analyze(ue);Qe===0?be=[Vt.min,Vt.max]:be=O.limits(Vt,"e",Qe)}return gr}return be},gr.domain=function(Qe){if(!arguments.length)return ue;He=Qe[0],mt=Qe[Qe.length-1],ye=[];var Vt=Ie.length;if(Qe.length===Vt&&He!==mt)for(var tr=0,rr=Array.from(Qe);tr<rr.length;tr+=1){var ki=rr[tr];ye.push((ki-He)/(mt-He))}else{for(var Wr=0;Wr<Vt;Wr++)ye.push(Wr/(Vt-1));if(Qe.length>2){var vr=Qe.map(function(Kt,kr){return kr/(Qe.length-1)}),Lr=Qe.map(function(Kt){return(Kt-He)/(mt-He)});Lr.every(function(Kt,kr){return vr[kr]===Kt})||(Qi=function(Kt){if(Kt<=0||Kt>=1)return Kt;for(var kr=0;Kt>=Lr[kr+1];)kr++;var Nn=(Kt-Lr[kr])/(Lr[kr+1]-Lr[kr]),aa=vr[kr]+Nn*(vr[kr+1]-vr[kr]);return aa})}}return ue=[He,mt],gr},gr.mode=function(Qe){return arguments.length?(A=Qe,bn(),gr):A},gr.range=function(Qe,Vt){return mr(Qe),gr},gr.out=function(Qe){return Ve=Qe,gr},gr.spread=function(Qe){return arguments.length?(K=Qe,gr):K},gr.correctLightness=function(Qe){return Qe==null&&(Qe=!0),et=Qe,bn(),et?Cr=function(Vt){for(var tr=Mi(0,!0).lab()[0],rr=Mi(1,!0).lab()[0],ki=tr>rr,Wr=Mi(Vt,!0).lab()[0],vr=tr+(rr-tr)*Vt,Lr=Wr-vr,Kt=0,kr=1,Nn=20;Math.abs(Lr)>.01&&Nn-- >0;)(function(){return ki&&(Lr*=-1),Lr<0?(Kt=Vt,Vt+=(kr-Vt)*.5):(kr=Vt,Vt+=(Kt-Vt)*.5),Wr=Mi(Vt,!0).lab()[0],Lr=Wr-vr})();return Vt}:Cr=function(Vt){return Vt},gr},gr.padding=function(Qe){return Qe!=null?(V(Qe)==="number"&&(Qe=[Qe,Qe]),ae=Qe,gr):ae},gr.colors=function(Qe,Vt){arguments.length<2&&(Vt="hex");var tr=[];if(arguments.length===0)tr=Ie.slice(0);else if(Qe===1)tr=[gr(.5)];else if(Qe>1){var rr=ue[0],ki=ue[1]-rr;tr=Z(0,Qe).map(function(kr){return gr(rr+kr/(Qe-1)*ki)})}else{C=[];var Wr=[];if(be&&be.length>2)for(var vr=1,Lr=be.length,Kt=1<=Lr;Kt?vr<Lr:vr>Lr;Kt?vr++:vr--)Wr.push((be[vr-1]+be[vr])*.5);else Wr=ue;tr=Wr.map(function(kr){return gr(kr)})}return O[Vt]&&(tr=tr.map(function(kr){return kr[Vt]()})),tr},gr.cache=function(Qe){return Qe!=null?(It=Qe,gr):It},gr.gamma=function(Qe){return Qe!=null?(pr=Qe,gr):pr},gr.nodata=function(Qe){return Qe!=null?(N=O(Qe),gr):N},gr};function Z(C,A,N){for(var K=[],ue=C<A,ye=A,ae=C;ue?ae<ye:ae>ye;ue?ae++:ae--)K.push(ae);return K}var ie=te,pe=Q,J=function(C){for(var A=[1,1],N=1;N<C;N++){for(var K=[1],ue=1;ue<=A.length;ue++)K[ue]=(A[ue]||0)+A[ue-1];A=K}return A},ge=function(C){var A,N,K,ue,ye,ae,be;if(C=C.map(function(et){return new ie(et)}),C.length===2)A=C.map(function(et){return et.lab()}),ye=A[0],ae=A[1],ue=function(et){var Ct=[0,1,2].map(function(It){return ye[It]+et*(ae[It]-ye[It])});return new ie(Ct,"lab")};else if(C.length===3)N=C.map(function(et){return et.lab()}),ye=N[0],ae=N[1],be=N[2],ue=function(et){var Ct=[0,1,2].map(function(It){return(1-et)*(1-et)*ye[It]+2*(1-et)*et*ae[It]+et*et*be[It]});return new ie(Ct,"lab")};else if(C.length===4){var Ie;K=C.map(function(et){return et.lab()}),ye=K[0],ae=K[1],be=K[2],Ie=K[3],ue=function(et){var Ct=[0,1,2].map(function(It){return(1-et)*(1-et)*(1-et)*ye[It]+3*(1-et)*(1-et)*et*ae[It]+3*(1-et)*et*et*be[It]+et*et*et*Ie[It]});return new ie(Ct,"lab")}}else if(C.length>=5){var Ve,He,mt;Ve=C.map(function(et){return et.lab()}),mt=C.length-1,He=J(mt),ue=function(et){var Ct=1-et,It=[0,1,2].map(function(pr){return Ve.reduce(function(mr,Mr,Cr){return mr+He[Cr]*Math.pow(Ct,mt-Cr)*Math.pow(et,Cr)*Mr[pr]},0)});return new ie(It,"lab")}}else throw new RangeError("No point in running bezier with only one color.");return ue},Se=function(C){var A=ge(C);return A.scale=function(){return pe(A)},A},Te=ee,Le=function(C,A,N){if(!Le[N])throw new Error("unknown blend mode "+N);return Le[N](C,A)},Ue=function(C){return function(A,N){var K=Te(N).rgb(),ue=Te(A).rgb();return Te.rgb(C(K,ue))}},st=function(C){return function(A,N){var K=[];return K[0]=C(A[0],N[0]),K[1]=C(A[1],N[1]),K[2]=C(A[2],N[2]),K}},pt=function(C){return C},Ke=function(C,A){return C*A/255},tt=function(C,A){return C>A?A:C},vt=function(C,A){return C>A?C:A},jt=function(C,A){return 255*(1-(1-C/255)*(1-A/255))},nt=function(C,A){return A<128?2*C*A/255:255*(1-2*(1-C/255)*(1-A/255))},lt=function(C,A){return 255*(1-(1-A/255)/(C/255))},Bt=function(C,A){return C===255?255:(C=255*(A/255)/(1-C/255),C>255?255:C)};Le.normal=Ue(st(pt)),Le.multiply=Ue(st(Ke)),Le.screen=Ue(st(jt)),Le.overlay=Ue(st(nt)),Le.darken=Ue(st(tt)),Le.lighten=Ue(st(vt)),Le.dodge=Ue(st(Bt)),Le.burn=Ue(st(lt));for(var jr=Le,Gt=ke.type,ar=ke.clip_rgb,Vr=ke.TWOPI,ji=Math.pow,Bn=Math.sin,Ur=Math.cos,Ji=ee,Yi=function(C,A,N,K,ue){C===void 0&&(C=300),A===void 0&&(A=-1.5),N===void 0&&(N=1),K===void 0&&(K=1),ue===void 0&&(ue=[0,1]);var ye=0,ae;Gt(ue)==="array"?ae=ue[1]-ue[0]:(ae=0,ue=[ue,ue]);var be=function(Ie){var Ve=Vr*((C+120)/360+A*Ie),He=ji(ue[0]+ae*Ie,K),mt=ye!==0?N[0]+Ie*ye:N,et=mt*He*(1-He)/2,Ct=Ur(Ve),It=Bn(Ve),pr=He+et*(-.14861*Ct+1.78277*It),mr=He+et*(-.29227*Ct-.90649*It),Mr=He+et*(1.97294*Ct);return Ji(ar([pr*255,mr*255,Mr*255,1]))};return be.start=function(Ie){return Ie==null?C:(C=Ie,be)},be.rotations=function(Ie){return Ie==null?A:(A=Ie,be)},be.gamma=function(Ie){return Ie==null?K:(K=Ie,be)},be.hue=function(Ie){return Ie==null?N:(N=Ie,Gt(N)==="array"?(ye=N[1]-N[0],ye===0&&(N=N[1])):ye=0,be)},be.lightness=function(Ie){return Ie==null?ue:(Gt(Ie)==="array"?(ue=Ie,ae=Ie[1]-Ie[0]):(ue=[Ie,Ie],ae=0),be)},be.scale=function(){return Ji.scale(be)},be.hue(N),be},Vi=te,Ui="0123456789abcdef",On=Math.floor,ia=Math.random,_l=function(){for(var C="#",A=0;A<6;A++)C+=Ui.charAt(On(ia()*16));return new Vi(C,"hex")},Bs=me,Os=Math.log,yl=Math.pow,Ec=Math.floor,Ai=Math.abs,Pn=function(C,A){A===void 0&&(A=null);var N={min:Number.MAX_VALUE,max:Number.MAX_VALUE*-1,sum:0,values:[],count:0};return Bs(C)==="object"&&(C=Object.values(C)),C.forEach(function(K){A&&Bs(K)==="object"&&(K=K[A]),K!=null&&!isNaN(K)&&(N.values.push(K),N.sum+=K,K<N.min&&(N.min=K),K>N.max&&(N.max=K),N.count+=1)}),N.domain=[N.min,N.max],N.limits=function(K,ue){return ps(N,K,ue)},N},ps=function(C,A,N){A===void 0&&(A="equal"),N===void 0&&(N=7),Bs(C)=="array"&&(C=Pn(C));var K=C.min,ue=C.max,ye=C.values.sort(function(Dh,Lc){return Dh-Lc});if(N===1)return[K,ue];var ae=[];if(A.substr(0,1)==="c"&&(ae.push(K),ae.push(ue)),A.substr(0,1)==="e"){ae.push(K);for(var be=1;be<N;be++)ae.push(K+be/N*(ue-K));ae.push(ue)}else if(A.substr(0,1)==="l"){if(K<=0)throw new Error("Logarithmic scales are only possible for values > 0");var Ie=Math.LOG10E*Os(K),Ve=Math.LOG10E*Os(ue);ae.push(K);for(var He=1;He<N;He++)ae.push(yl(10,Ie+He/N*(Ve-Ie)));ae.push(ue)}else if(A.substr(0,1)==="q"){ae.push(K);for(var mt=1;mt<N;mt++){var et=(ye.length-1)*mt/N,Ct=Ec(et);if(Ct===et)ae.push(ye[Ct]);else{var It=et-Ct;ae.push(ye[Ct]*(1-It)+ye[Ct+1]*It)}}ae.push(ue)}else if(A.substr(0,1)==="k"){var pr,mr=ye.length,Mr=new Array(mr),Cr=new Array(N),Qi=!0,Mi=0,bn=null;bn=[],bn.push(K);for(var gr=1;gr<N;gr++)bn.push(K+gr/N*(ue-K));for(bn.push(ue);Qi;){for(var Qe=0;Qe<N;Qe++)Cr[Qe]=0;for(var Vt=0;Vt<mr;Vt++)for(var tr=ye[Vt],rr=Number.MAX_VALUE,ki=void 0,Wr=0;Wr<N;Wr++){var vr=Ai(bn[Wr]-tr);vr<rr&&(rr=vr,ki=Wr),Cr[ki]++,Mr[Vt]=ki}for(var Lr=new Array(N),Kt=0;Kt<N;Kt++)Lr[Kt]=null;for(var kr=0;kr<mr;kr++)pr=Mr[kr],Lr[pr]===null?Lr[pr]=ye[kr]:Lr[pr]+=ye[kr];for(var Nn=0;Nn<N;Nn++)Lr[Nn]*=1/Cr[Nn];Qi=!1;for(var aa=0;aa<N;aa++)if(Lr[aa]!==bn[aa]){Qi=!0;break}bn=Lr,Mi++,Mi>200&&(Qi=!1)}for(var Qn={},Sl=0;Sl<N;Sl++)Qn[Sl]=[];for(var oa=0;oa<mr;oa++)pr=Mr[oa],Qn[pr].push(ye[oa]);for(var la=[],qa=0;qa<N;qa++)la.push(Qn[qa][0]),la.push(Qn[qa][Qn[qa].length-1]);la=la.sort(function(Dh,Lc){return Dh-Lc}),ae.push(la[0]);for(var Ml=1;Ml<la.length;Ml+=2){var Ga=la[Ml];!isNaN(Ga)&&ae.indexOf(Ga)===-1&&ae.push(Ga)}}return ae},na={analyze:Pn,limits:ps},Di=te,qi=function(C,A){C=new Di(C),A=new Di(A);var N=C.luminance(),K=A.luminance();return N>K?(N+.05)/(K+.05):(K+.05)/(N+.05)},_i=te,Sr=Math.sqrt,Hr=Math.pow,Pc=Math.min,yi=Math.max,Ac=Math.atan2,wo=Math.abs,sa=Math.cos,fs=Math.sin,Cu=Math.exp,vl=Math.PI,Dc=function(C,A,N,K,ue){N===void 0&&(N=1),K===void 0&&(K=1),ue===void 0&&(ue=1);var ye=function(Ga){return 360*Ga/(2*vl)},ae=function(Ga){return 2*vl*Ga/360};C=new _i(C),A=new _i(A);var be=Array.from(C.lab()),Ie=be[0],Ve=be[1],He=be[2],mt=Array.from(A.lab()),et=mt[0],Ct=mt[1],It=mt[2],pr=(Ie+et)/2,mr=Sr(Hr(Ve,2)+Hr(He,2)),Mr=Sr(Hr(Ct,2)+Hr(It,2)),Cr=(mr+Mr)/2,Qi=.5*(1-Sr(Hr(Cr,7)/(Hr(Cr,7)+Hr(25,7)))),Mi=Ve*(1+Qi),bn=Ct*(1+Qi),gr=Sr(Hr(Mi,2)+Hr(He,2)),Qe=Sr(Hr(bn,2)+Hr(It,2)),Vt=(gr+Qe)/2,tr=ye(Ac(He,Mi)),rr=ye(Ac(It,bn)),ki=tr>=0?tr:tr+360,Wr=rr>=0?rr:rr+360,vr=wo(ki-Wr)>180?(ki+Wr+360)/2:(ki+Wr)/2,Lr=1-.17*sa(ae(vr-30))+.24*sa(ae(2*vr))+.32*sa(ae(3*vr+6))-.2*sa(ae(4*vr-63)),Kt=Wr-ki;Kt=wo(Kt)<=180?Kt:Wr<=ki?Kt+360:Kt-360,Kt=2*Sr(gr*Qe)*fs(ae(Kt)/2);var kr=et-Ie,Nn=Qe-gr,aa=1+.015*Hr(pr-50,2)/Sr(20+Hr(pr-50,2)),Qn=1+.045*Vt,Sl=1+.015*Vt*Lr,oa=30*Cu(-Hr((vr-275)/25,2)),la=2*Sr(Hr(Vt,7)/(Hr(Vt,7)+Hr(25,7))),qa=-la*fs(2*ae(oa)),Ml=Sr(Hr(kr/(N*aa),2)+Hr(Nn/(K*Qn),2)+Hr(Kt/(ue*Sl),2)+qa*(Nn/(K*Qn))*(Kt/(ue*Sl)));return yi(0,Pc(100,Ml))},xl=te,bl=function(C,A,N){N===void 0&&(N="lab"),C=new xl(C),A=new xl(A);var K=C.get(N),ue=A.get(N),ye=0;for(var ae in K){var be=(K[ae]||0)-(ue[ae]||0);ye+=be*be}return Math.sqrt(ye)},Ua=te,Fd=function(){for(var C=[],A=arguments.length;A--;)C[A]=arguments[A];try{return new(Function.prototype.bind.apply(Ua,[null].concat(C))),!0}catch{return!1}},Iu=ee,zc=Q,So={cool:function(){return zc([Iu.hsl(180,1,.9),Iu.hsl(250,.7,.4)])},hot:function(){return zc(["#000","#f00","#ff0","#fff"]).mode("rgb")}},Mo={OrRd:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"],PuBu:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"],BuPu:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"],Oranges:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"],BuGn:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"],YlOrBr:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"],YlGn:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"],Reds:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"],RdPu:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"],Greens:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"],YlGnBu:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"],Purples:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"],GnBu:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"],Greys:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"],YlOrRd:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"],PuRd:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"],Blues:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"],PuBuGn:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"],Viridis:["#440154","#482777","#3f4a8a","#31678e","#26838f","#1f9d8a","#6cce5a","#b6de2b","#fee825"],Spectral:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],RdYlGn:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],RdBu:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],PiYG:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],PRGn:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],RdYlBu:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],BrBG:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],RdGy:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],PuOr:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],Set2:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"],Accent:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"],Set1:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"],Set3:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"],Dark2:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"],Paired:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"],Pastel2:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"],Pastel1:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]},Eu=0,Ph=Object.keys(Mo);Eu<Ph.length;Eu+=1){var Bd=Ph[Eu];Mo[Bd.toLowerCase()]=Mo[Bd]}var Ah=Mo,di=ee;di.average=z,di.bezier=Se,di.blend=jr,di.cubehelix=Yi,di.mix=di.interpolate=bu,di.random=_l,di.scale=Q,di.analyze=na.analyze,di.contrast=qi,di.deltaE=Dc,di.distance=bl,di.limits=na.limits,di.valid=Fd,di.scales=So,di.colors=Wt,di.brewer=Ah;var wl=di;return wl})})(dx);var VS=dx.exports;const US=xg(VS),yg=[{id:"water",label:"Domain 1",description:"The overall score for Domain 1.",colorGradient:{startColor:{r:255,g:255,b:255},endColor:{r:78,g:160,b:220}},status:{id:"status_summary",label:"Subdomain 1",description:"The subdomain 1 score of Domain 1.",metrics:[{id:"status_metric_1",label:"Subdomain 1 Metric 1",description:"Description text for Status Metric 1"},{id:"status_metric_2",label:"Subdomain 1 Metric 2",description:"Description text for Status Metric 2"},{id:"status_metric_3",label:"Subdomain 1 Metric 3",description:"Description text for Status Metric 3"},{id:"status_metric_4",label:"Subdomain 1 Metric 4",description:"Description text for Status Metric 4"},{id:"status_metric_5",label:"Subdomain 1 Metric 5",description:"Description text for Status Metric 5"},{id:"status_metric_6",label:"Subdomain 1 Metric 6",description:"Description text for Status Metric 6"}]},resilience:{id:"resilience_summary",label:"Subdomain 2",description:"The subdomain 2 score for Domain 1.",resistance:{id:"resistance_summary",label:"Section 1",description:"The subsubdomain 1 score of Domain 1.",metrics:[{id:"resilience_resistance_metric_1",label:"Section 1 Metric 1",description:"Description text for Section 1 Metric 1"},{id:"resilience_resistance_metric_2",label:"Section 1 Metric 2",description:"Description text for Section 1 Metric 2"},{id:"resilience_resistance_metric_3",label:"Section 1 Metric 3",description:"Description text for Section 1 Metric 3"},{id:"resilience_resistance_metric_4",label:"Section 1 Metric 4",description:"Description text for Section 1 Metric 4"},{id:"resilience_resistance_metric_5",label:"Section 1 Metric 5",description:"Description text for Section 1 Metric 5"},{id:"resilience_resistance_metric_6",label:"Section 1 Metric 6",description:"Description text for Section 1 Metric 6"},{id:"resilience_resistance_metric_7",label:"Section 1 Metric 7",description:"Description text for Section 1 Metric 7"},{id:"resilience_resistance_metric_8",label:"Section 1 Metric 8",description:"Description text for Section 1 Metric 8"}]},recovery:{id:"recovery_summary",label:"Section 2",description:"The subsubdomain 2 score for domain 1.",metrics:[{id:"resilience_recovery_metric_1",label:"Section 2 Metric 1",description:"Description text for Recovery Metric 1"},{id:"resilience_recovery_metric_2",label:"Section 2 Metric 2",description:"Description text for Recovery Metric 2"},{id:"resilience_recovery_metric_3",label:"Section 2 Metric 3",description:"Description text for Recovery Metric 3"},{id:"resilience_recovery_metric_4",label:"Section 2 Metric 4",description:"Description text for Recovery Metric 4"},{id:"resilience_recovery_metric_5",label:"Section 2 Metric 5",description:"Description text for Recovery Metric 5"},{id:"resilience_recovery_metric_6",label:"Section 2 Metric 6",description:"Description text for Recovery Metric 6"},{id:"resilience_recovery_metric_7",label:"Section 2 Metric 7",description:"Description text for Recovery Metric 7"},{id:"resilience_recovery_metric_8",label:"Section 2 Metric 8",description:"Description text for Recovery Metric 8"},{id:"resilience_recovery_metric_9",label:"Section 2 Metric 9",description:"Description text for Recovery Metric 9"}]}}},{id:"air",label:"Domain 2",description:"The overall score for Domain 2",colorGradient:{startColor:{r:255,g:255,b:255},endColor:{r:73,g:0,b:106}},status:{id:"status_summary",label:"Subdomain 1",description:"The subdomain 1 score of domain 2.",metrics:[{id:"status_metric_1",label:"Subdomain 1 Metric 1",description:"Description text for Status Metric 1"},{id:"status_metric_2",label:"Subdomain 1 Metric 2",description:"Description text for Status Metric 2"},{id:"status_metric_3",label:"Subdomain 1 Metric 3",description:"Description text for Status Metric 3"},{id:"status_metric_4",label:"Subdomain 1 Metric 4",description:"Description text for Status Metric 4"},{id:"status_metric_5",label:"Subdomain 1 Metric 5",description:"Description text for Status Metric 5"},{id:"status_metric_6",label:"Subdomain 1 Metric 6",description:"Description text for Status Metric 6"}]},resilience:{id:"resilience_summary",label:"Subdomain 2",description:"The subdomain 2 score for Domain 2.",resistance:{id:"resistance_summary",label:"Section 1",description:"The subsubdomain 1 score of Domain 2.",metrics:[{id:"resilience_resistance_metric_1",label:"Section 1 Metric 1",description:"Description text for Section 1 Metric 1"},{id:"resilience_resistance_metric_2",label:"Section 1 Metric 2",description:"Description text for Section 1 Metric 2"},{id:"resilience_resistance_metric_3",label:"Section 1 Metric 3",description:"Description text for Section 1 Metric 3"},{id:"resilience_resistance_metric_4",label:"Section 1 Metric 4",description:"Description text for Section 1 Metric 4"},{id:"resilience_resistance_metric_5",label:"Section 1 Metric 5",description:"Description text for Section 1 Metric 5"},{id:"resilience_resistance_metric_6",label:"Section 1 Metric 6",description:"Description text for Section 1 Metric 6"},{id:"resilience_resistance_metric_7",label:"Section 1 Metric 7",description:"Description text for Section 1 Metric 7"},{id:"resilience_resistance_metric_8",label:"Section 1 Metric 8",description:"Description text for Section 1 Metric 8"}]},recovery:{id:"recovery_summary",label:"Section 2",description:"The subsubdomain 2 score for Domain 2.",metrics:[{id:"resilience_recovery_metric_1",label:"Section 2 Metric 1",description:"Description text for Recovery Metric 1"},{id:"resilience_recovery_metric_2",label:"Section 2 Metric 2",description:"Description text for Recovery Metric 2"},{id:"resilience_recovery_metric_3",label:"Section 2 Metric 3",description:"Description text for Recovery Metric 3"},{id:"resilience_recovery_metric_4",label:"Section 2 Metric 4",description:"Description text for Recovery Metric 4"},{id:"resilience_recovery_metric_5",label:"Section 2 Metric 5",description:"Description text for Recovery Metric 5"},{id:"resilience_recovery_metric_6",label:"Section 2 Metric 6",description:"Description text for Recovery Metric 6"},{id:"resilience_recovery_metric_7",label:"Section 2 Metric 7",description:"Description text for Recovery Metric 7"},{id:"resilience_recovery_metric_8",label:"Section 2 Metric 8",description:"Description text for Recovery Metric 8"},{id:"resilience_recovery_metric_9",label:"Section 2 Metric 9",description:"Description text for Recovery Metric 9"}]}}},{id:"ecosystems",label:"Domain 3",description:"The overall score for Domain 3.",colorGradient:{startColor:{r:255,g:255,b:255},endColor:{r:255,g:145,b:178}},status:{id:"status_summary",label:"Subdomain 1",description:"The subdomain 1 score of Domain 3.",metrics:[{id:"status_metric_1",label:"Subdomain 1 Metric 1",description:"Description text for Status Metric 1"},{id:"status_metric_2",label:"Subdomain 1 Metric 2",description:"Description text for Status Metric 2"},{id:"status_metric_3",label:"Subdomain 1 Metric 3",description:"Description text for Status Metric 3"},{id:"status_metric_4",label:"Subdomain 1 Metric 4",description:"Description text for Status Metric 4"},{id:"status_metric_5",label:"Subdomain 1 Metric 5",description:"Description text for Status Metric 5"},{id:"status_metric_6",label:"Subdomain 1 Metric 6",description:"Description text for Status Metric 6"}]},resilience:{id:"resilience_summary",label:"Subdomain 2",description:"The subdomain 2 score for Domain 3.",resistance:{id:"resistance_summary",label:"Section 1",description:"The subsubdomain 1 score of Domain 3.",metrics:[{id:"resilience_resistance_metric_1",label:"Section 1 Metric 1",description:"Description text for Section 1 Metric 1"},{id:"resilience_resistance_metric_2",label:"Section 1 Metric 2",description:"Description text for Section 1 Metric 2"},{id:"resilience_resistance_metric_3",label:"Section 1 Metric 3",description:"Description text for Section 1 Metric 3"},{id:"resilience_resistance_metric_4",label:"Section 1 Metric 4",description:"Description text for Section 1 Metric 4"},{id:"resilience_resistance_metric_5",label:"Section 1 Metric 5",description:"Description text for Section 1 Metric 5"},{id:"resilience_resistance_metric_6",label:"Section 1 Metric 6",description:"Description text for Section 1 Metric 6"},{id:"resilience_resistance_metric_7",label:"Section 1 Metric 7",description:"Description text for Section 1 Metric 7"},{id:"resilience_resistance_metric_8",label:"Section 1 Metric 8",description:"Description text for Section 1 Metric 8"}]},recovery:{id:"recovery_summary",label:"Section 2",description:"The subsubdomain 2 score for Domain 3.",metrics:[{id:"resilience_recovery_metric_1",label:"Section 2 Metric 1",description:"Description text for Recovery Metric 1"},{id:"resilience_recovery_metric_2",label:"Section 2 Metric 2",description:"Description text for Recovery Metric 2"},{id:"resilience_recovery_metric_3",label:"Section 2 Metric 3",description:"Description text for Recovery Metric 3"},{id:"resilience_recovery_metric_4",label:"Section 2 Metric 4",description:"Description text for Recovery Metric 4"},{id:"resilience_recovery_metric_5",label:"Section 2 Metric 5",description:"Description text for Recovery Metric 5"},{id:"resilience_recovery_metric_6",label:"Section 2 Metric 6",description:"Description text for Recovery Metric 6"},{id:"resilience_recovery_metric_7",label:"Section 2 Metric 7",description:"Description text for Recovery Metric 7"},{id:"resilience_recovery_metric_8",label:"Section 2 Metric 8",description:"Description text for Recovery Metric 8"},{id:"resilience_recovery_metric_9",label:"Section 2 Metric 9",description:"Description text for Recovery Metric 9"}]}}},{id:"biodiversity",label:"Domain 4",description:"The overall score for Domain 4",colorGradient:{startColor:{r:255,g:255,b:255},endColor:{r:103,g:14,b:10}},status:{id:"status_summary",label:"Subdomain 1",description:"The subdomain 1 score of Domain 4.",metrics:[{id:"status_metric_1",label:"Subdomain 1 Metric 1",description:"Description text for Status Metric 1"},{id:"status_metric_2",label:"Subdomain 1 Metric 2",description:"Description text for Status Metric 2"},{id:"status_metric_3",label:"Subdomain 1 Metric 3",description:"Description text for Status Metric 3"},{id:"status_metric_4",label:"Subdomain 1 Metric 4",description:"Description text for Status Metric 4"},{id:"status_metric_5",label:"Subdomain 1 Metric 5",description:"Description text for Status Metric 5"},{id:"status_metric_6",label:"Subdomain 1 Metric 6",description:"Description text for Status Metric 6"}]},resilience:{id:"resilience_summary",label:"Subdomain 2",description:"The subdomain 2 score for Domain 4.",resistance:{id:"resistance_summary",label:"Section 1",description:"The subsubdomain 1 score of Domain 4.",metrics:[{id:"resilience_resistance_metric_1",label:"Section 1 Metric 1",description:"Description text for Section 1 Metric 1"},{id:"resilience_resistance_metric_2",label:"Section 1 Metric 2",description:"Description text for Section 1 Metric 2"},{id:"resilience_resistance_metric_3",label:"Section 1 Metric 3",description:"Description text for Section 1 Metric 3"},{id:"resilience_resistance_metric_4",label:"Section 1 Metric 4",description:"Description text for Section 1 Metric 4"},{id:"resilience_resistance_metric_5",label:"Section 1 Metric 5",description:"Description text for Section 1 Metric 5"},{id:"resilience_resistance_metric_6",label:"Section 1 Metric 6",description:"Description text for Section 1 Metric 6"},{id:"resilience_resistance_metric_7",label:"Section 1 Metric 7",description:"Description text for Section 1 Metric 7"},{id:"resilience_resistance_metric_8",label:"Section 1 Metric 8",description:"Description text for Section 1 Metric 8"}]},recovery:{id:"recovery_summary",label:"Section 2",description:"The subsubdomain 2 score for Domain 4.",metrics:[{id:"resilience_recovery_metric_1",label:"Section 2 Metric 1",description:"Description text for Recovery Metric 1"},{id:"resilience_recovery_metric_2",label:"Section 2 Metric 2",description:"Description text for Recovery Metric 2"},{id:"resilience_recovery_metric_3",label:"Section 2 Metric 3",description:"Description text for Recovery Metric 3"},{id:"resilience_recovery_metric_4",label:"Section 2 Metric 4",description:"Description text for Recovery Metric 4"},{id:"resilience_recovery_metric_5",label:"Section 2 Metric 5",description:"Description text for Recovery Metric 5"},{id:"resilience_recovery_metric_6",label:"Section 2 Metric 6",description:"Description text for Recovery Metric 6"},{id:"resilience_recovery_metric_7",label:"Section 2 Metric 7",description:"Description text for Recovery Metric 7"},{id:"resilience_recovery_metric_8",label:"Section 2 Metric 8",description:"Description text for Recovery Metric 8"},{id:"resilience_recovery_metric_9",label:"Section 2 Metric 9",description:"Description text for Recovery Metric 9"}]}}},{id:"infrastructure",label:"Domain 5",description:"The overall score for Domain 5.",colorGradient:{startColor:{r:255,g:255,b:255},endColor:{r:78,g:160,b:220}},status:{id:"status_summary",label:"Subdomain 1",description:"The subdomain 1 score of Domain 5.",metrics:[{id:"status_metric_1",label:"Subdomain 1 Metric 1",description:"Description text for Status Metric 1"},{id:"status_metric_2",label:"Subdomain 1 Metric 2",description:"Description text for Status Metric 2"},{id:"status_metric_3",label:"Subdomain 1 Metric 3",description:"Description text for Status Metric 3"},{id:"status_metric_4",label:"Subdomain 1 Metric 4",description:"Description text for Status Metric 4"},{id:"status_metric_5",label:"Subdomain 1 Metric 5",description:"Description text for Status Metric 5"},{id:"status_metric_6",label:"Subdomain 1 Metric 6",description:"Description text for Status Metric 6"}]},resilience:{id:"resilience_summary",label:"Subdomain 2",description:"The subdomain 2 score for Domain 5.",resistance:{id:"resistance_summary",label:"Section 1",description:"The subsubdomain 1 score of the Domain 5.",metrics:[{id:"resilience_resistance_metric_1",label:"Section 1 Metric 1",description:"Description text for Section 1 Metric 1"},{id:"resilience_resistance_metric_2",label:"Section 1 Metric 2",description:"Description text for Section 1 Metric 2"},{id:"resilience_resistance_metric_3",label:"Section 1 Metric 3",description:"Description text for Section 1 Metric 3"},{id:"resilience_resistance_metric_4",label:"Section 1 Metric 4",description:"Description text for Section 1 Metric 4"},{id:"resilience_resistance_metric_5",label:"Section 1 Metric 5",description:"Description text for Section 1 Metric 5"},{id:"resilience_resistance_metric_6",label:"Section 1 Metric 6",description:"Description text for Section 1 Metric 6"},{id:"resilience_resistance_metric_7",label:"Section 1 Metric 7",description:"Description text for Section 1 Metric 7"},{id:"resilience_resistance_metric_8",label:"Section 1 Metric 8",description:"Description text for Section 1 Metric 8"}]},recovery:{id:"recovery_summary",label:"Section 2",description:"The subsubdomain 2 score for Domain 5.",metrics:[{id:"resilience_recovery_metric_1",label:"Section 2 Metric 1",description:"Description text for Recovery Metric 1"},{id:"resilience_recovery_metric_2",label:"Section 2 Metric 2",description:"Description text for Recovery Metric 2"},{id:"resilience_recovery_metric_3",label:"Section 2 Metric 3",description:"Description text for Recovery Metric 3"},{id:"resilience_recovery_metric_4",label:"Section 2 Metric 4",description:"Description text for Recovery Metric 4"},{id:"resilience_recovery_metric_5",label:"Section 2 Metric 5",description:"Description text for Recovery Metric 5"},{id:"resilience_recovery_metric_6",label:"Section 2 Metric 6",description:"Description text for Recovery Metric 6"},{id:"resilience_recovery_metric_7",label:"Section 2 Metric 7",description:"Description text for Recovery Metric 7"},{id:"resilience_recovery_metric_8",label:"Section 2 Metric 8",description:"Description text for Recovery Metric 8"},{id:"resilience_recovery_metric_9",label:"Section 2 Metric 9",description:"Description text for Recovery Metric 9"}]}}},{id:"social",label:"Domain 6",description:"The overall score for Domain 6.",colorGradient:{startColor:{r:255,g:255,b:255},endColor:{r:23,g:46,b:106}},status:{id:"status_summary",label:"Subdomain 1",description:"The subdomain 1 score of Domain 6.",metrics:[{id:"status_metric_1",label:"Subdomain 1 Metric 1",description:"Description text for Status Metric 1"},{id:"status_metric_2",label:"Subdomain 1 Metric 2",description:"Description text for Status Metric 2"},{id:"status_metric_3",label:"Subdomain 1 Metric 3",description:"Description text for Status Metric 3"},{id:"status_metric_4",label:"Subdomain 1 Metric 4",description:"Description text for Status Metric 4"},{id:"status_metric_5",label:"Subdomain 1 Metric 5",description:"Description text for Status Metric 5"},{id:"status_metric_6",label:"Subdomain 1 Metric 6",description:"Description text for Status Metric 6"}]},resilience:{id:"resilience_summary",label:"Subdomain 2",description:"The subdomain 2 score for Domain 6.",resistance:{id:"resistance_summary",label:"Section 1",description:"The subsubdomain 1 score of Domain 6.",metrics:[{id:"resilience_resistance_metric_1",label:"Section 1 Metric 1",description:"Description text for Section 1 Metric 1"},{id:"resilience_resistance_metric_2",label:"Section 1 Metric 2",description:"Description text for Section 1 Metric 2"},{id:"resilience_resistance_metric_3",label:"Section 1 Metric 3",description:"Description text for Section 1 Metric 3"},{id:"resilience_resistance_metric_4",label:"Section 1 Metric 4",description:"Description text for Section 1 Metric 4"},{id:"resilience_resistance_metric_5",label:"Section 1 Metric 5",description:"Description text for Section 1 Metric 5"},{id:"resilience_resistance_metric_6",label:"Section 1 Metric 6",description:"Description text for Section 1 Metric 6"},{id:"resilience_resistance_metric_7",label:"Section 1 Metric 7",description:"Description text for Section 1 Metric 7"},{id:"resilience_resistance_metric_8",label:"Section 1 Metric 8",description:"Description text for Section 1 Metric 8"}]},recovery:{id:"recovery_summary",label:"Section 2",description:"The subsubdomain 2 score for Domain 6.",metrics:[{id:"resilience_recovery_metric_1",label:"Section 2 Metric 1",description:"Description text for Recovery Metric 1"},{id:"resilience_recovery_metric_2",label:"Section 2 Metric 2",description:"Description text for Recovery Metric 2"},{id:"resilience_recovery_metric_3",label:"Section 2 Metric 3",description:"Description text for Recovery Metric 3"},{id:"resilience_recovery_metric_4",label:"Section 2 Metric 4",description:"Description text for Recovery Metric 4"},{id:"resilience_recovery_metric_5",label:"Section 2 Metric 5",description:"Description text for Recovery Metric 5"},{id:"resilience_recovery_metric_6",label:"Section 2 Metric 6",description:"Description text for Recovery Metric 6"},{id:"resilience_recovery_metric_7",label:"Section 2 Metric 7",description:"Description text for Recovery Metric 7"},{id:"resilience_recovery_metric_8",label:"Section 2 Metric 8",description:"Description text for Recovery Metric 8"},{id:"resilience_recovery_metric_9",label:"Section 2 Metric 9",description:"Description text for Recovery Metric 9"}]}}},{id:"economy",label:"Domain 7",description:"The overall score for Domain 7.",colorGradient:{startColor:{r:255,g:255,b:255},endColor:{r:90,g:56,b:15}},status:{id:"status_summary",label:"Subdomain 1",description:"The subdomain 1 score of Domain 7.",metrics:[{id:"status_metric_1",label:"Subdomain 1 Metric 1",description:"Description text for Status Metric 1"},{id:"status_metric_2",label:"Subdomain 1 Metric 2",description:"Description text for Status Metric 2"},{id:"status_metric_3",label:"Subdomain 1 Metric 3",description:"Description text for Status Metric 3"},{id:"status_metric_4",label:"Subdomain 1 Metric 4",description:"Description text for Status Metric 4"},{id:"status_metric_5",label:"Subdomain 1 Metric 5",description:"Description text for Status Metric 5"},{id:"status_metric_6",label:"Subdomain 1 Metric 6",description:"Description text for Status Metric 6"}]},resilience:{id:"resilience_summary",label:"Subdomain 2",description:"The subdomain 2 score for Domain 7.",resistance:{id:"resistance_summary",label:"Section 1",description:"The subsubdomain 1 score of Domain 7.",metrics:[{id:"resilience_resistance_metric_1",label:"Section 1 Metric 1",description:"Description text for Section 1 Metric 1"},{id:"resilience_resistance_metric_2",label:"Section 1 Metric 2",description:"Description text for Section 1 Metric 2"},{id:"resilience_resistance_metric_3",label:"Section 1 Metric 3",description:"Description text for Section 1 Metric 3"},{id:"resilience_resistance_metric_4",label:"Section 1 Metric 4",description:"Description text for Section 1 Metric 4"},{id:"resilience_resistance_metric_5",label:"Section 1 Metric 5",description:"Description text for Section 1 Metric 5"},{id:"resilience_resistance_metric_6",label:"Section 1 Metric 6",description:"Description text for Section 1 Metric 6"},{id:"resilience_resistance_metric_7",label:"Section 1 Metric 7",description:"Description text for Section 1 Metric 7"},{id:"resilience_resistance_metric_8",label:"Section 1 Metric 8",description:"Description text for Section 1 Metric 8"}]},recovery:{id:"recovery_summary",label:"Section 2",description:"The subsubdomain 2 score for Domain 7.",metrics:[{id:"resilience_recovery_metric_1",label:"Section 2 Metric 1",description:"Description text for Recovery Metric 1"},{id:"resilience_recovery_metric_2",label:"Section 2 Metric 2",description:"Description text for Recovery Metric 2"},{id:"resilience_recovery_metric_3",label:"Section 2 Metric 3",description:"Description text for Recovery Metric 3"},{id:"resilience_recovery_metric_4",label:"Section 2 Metric 4",description:"Description text for Recovery Metric 4"},{id:"resilience_recovery_metric_5",label:"Section 2 Metric 5",description:"Description text for Recovery Metric 5"},{id:"resilience_recovery_metric_6",label:"Section 2 Metric 6",description:"Description text for Recovery Metric 6"},{id:"resilience_recovery_metric_7",label:"Section 2 Metric 7",description:"Description text for Recovery Metric 7"},{id:"resilience_recovery_metric_8",label:"Section 2 Metric 8",description:"Description text for Recovery Metric 8"},{id:"resilience_recovery_metric_9",label:"Section 2 Metric 9",description:"Description text for Recovery Metric 9"}]}}},{id:"culture",label:"Domain 8",description:"The overall score for Domain 8.",colorGradient:{startColor:{r:255,g:255,b:255},endColor:{r:20,g:13,b:70}},status:{id:"status_summary",label:"Subdomain 1",description:"The subdomain 1 score for Domain 8.",metrics:[{id:"status_metric_1",label:"Subdomain 1 Metric 1",description:"Description text for Status Metric 1"},{id:"status_metric_2",label:"Subdomain 1 Metric 2",description:"Description text for Status Metric 2"},{id:"status_metric_3",label:"Subdomain 1 Metric 3",description:"Description text for Status Metric 3"},{id:"status_metric_4",label:"Subdomain 1 Metric 4",description:"Description text for Status Metric 4"},{id:"status_metric_5",label:"Subdomain 1 Metric 5",description:"Description text for Status Metric 5"},{id:"status_metric_6",label:"Subdomain 1 Metric 6",description:"Description text for Status Metric 6"}]},resilience:{id:"resilience_summary",label:"Subdomain 2",description:"The subdomain 2 score for Domain 8.",resistance:{id:"resistance_summary",label:"Section 1",description:"The subsubdomain 1 score of Domain 8.",metrics:[{id:"resilience_resistance_metric_1",label:"Section 1 Metric 1",description:"Description text for Section 1 Metric 1"},{id:"resilience_resistance_metric_2",label:"Section 1 Metric 2",description:"Description text for Section 1 Metric 2"},{id:"resilience_resistance_metric_3",label:"Section 1 Metric 3",description:"Description text for Section 1 Metric 3"},{id:"resilience_resistance_metric_4",label:"Section 1 Metric 4",description:"Description text for Section 1 Metric 4"},{id:"resilience_resistance_metric_5",label:"Section 1 Metric 5",description:"Description text for Section 1 Metric 5"},{id:"resilience_resistance_metric_6",label:"Section 1 Metric 6",description:"Description text for Section 1 Metric 6"},{id:"resilience_resistance_metric_7",label:"Section 1 Metric 7",description:"Description text for Section 1 Metric 7"},{id:"resilience_resistance_metric_8",label:"Section 1 Metric 8",description:"Description text for Section 1 Metric 8"}]},recovery:{id:"recovery_summary",label:"Section 2",description:"The subsubdomain 2 score for Domain 8.",metrics:[{id:"resilience_recovery_metric_1",label:"Section 2 Metric 1",description:"Description text for Recovery Metric 1"},{id:"resilience_recovery_metric_2",label:"Section 2 Metric 2",description:"Description text for Recovery Metric 2"},{id:"resilience_recovery_metric_3",label:"Section 2 Metric 3",description:"Description text for Recovery Metric 3"},{id:"resilience_recovery_metric_4",label:"Section 2 Metric 4",description:"Description text for Recovery Metric 4"},{id:"resilience_recovery_metric_5",label:"Section 2 Metric 5",description:"Description text for Recovery Metric 5"},{id:"resilience_recovery_metric_6",label:"Section 2 Metric 6",description:"Description text for Recovery Metric 6"},{id:"resilience_recovery_metric_7",label:"Section 2 Metric 7",description:"Description text for Recovery Metric 7"},{id:"resilience_recovery_metric_8",label:"Section 2 Metric 8",description:"Description text for Recovery Metric 8"},{id:"resilience_recovery_metric_9",label:"Section 2 Metric 9",description:"Description text for Recovery Metric 9"}]}}},{id:"carbon",label:"Domain 9",description:"The overall score for Domain 9.",colorGradient:{startColor:{r:255,g:255,b:255},endColor:{r:15,g:15,b:15}},status:{id:"status_summary",label:"Subdomain 1",description:"The subdomain 1 score of Domain 9.",metrics:[{id:"status_metric_1",label:"Subdomain 1 Metric 1",description:"Description text for Status Metric 1"},{id:"status_metric_2",label:"Subdomain 1 Metric 2",description:"Description text for Status Metric 2"},{id:"status_metric_3",label:"Subdomain 1 Metric 3",description:"Description text for Status Metric 3"},{id:"status_metric_4",label:"Subdomain 1 Metric 4",description:"Description text for Status Metric 4"},{id:"status_metric_5",label:"Subdomain 1 Metric 5",description:"Description text for Status Metric 5"},{id:"status_metric_6",label:"Subdomain 1 Metric 6",description:"Description text for Status Metric 6"}]},resilience:{id:"resilience_summary",label:"Subdomain 2",description:"The subdomain 2 score for Domain 9.",resistance:{id:"resistance_summary",label:"Section 1",description:"The subsubdomain 1 score of Domain 9.",metrics:[{id:"resilience_resistance_metric_1",label:"Section 1 Metric 1",description:"Description text for Section 1 Metric 1"},{id:"resilience_resistance_metric_2",label:"Section 1 Metric 2",description:"Description text for Section 1 Metric 2"},{id:"resilience_resistance_metric_3",label:"Section 1 Metric 3",description:"Description text for Section 1 Metric 3"},{id:"resilience_resistance_metric_4",label:"Section 1 Metric 4",description:"Description text for Section 1 Metric 4"},{id:"resilience_resistance_metric_5",label:"Section 1 Metric 5",description:"Description text for Section 1 Metric 5"},{id:"resilience_resistance_metric_6",label:"Section 1 Metric 6",description:"Description text for Section 1 Metric 6"},{id:"resilience_resistance_metric_7",label:"Section 1 Metric 7",description:"Description text for Section 1 Metric 7"},{id:"resilience_resistance_metric_8",label:"Section 1 Metric 8",description:"Description text for Section 1 Metric 8"}]},recovery:{id:"recovery_summary",label:"Section 2",description:"The subsubdomain 2 score for Domain 9.",metrics:[{id:"resilience_recovery_metric_1",label:"Section 2 Metric 1",description:"Description text for Recovery Metric 1"},{id:"resilience_recovery_metric_2",label:"Section 2 Metric 2",description:"Description text for Recovery Metric 2"},{id:"resilience_recovery_metric_3",label:"Section 2 Metric 3",description:"Description text for Recovery Metric 3"},{id:"resilience_recovery_metric_4",label:"Section 2 Metric 4",description:"Description text for Recovery Metric 4"},{id:"resilience_recovery_metric_5",label:"Section 2 Metric 5",description:"Description text for Recovery Metric 5"},{id:"resilience_recovery_metric_6",label:"Section 2 Metric 6",description:"Description text for Recovery Metric 6"},{id:"resilience_recovery_metric_7",label:"Section 2 Metric 7",description:"Description text for Recovery Metric 7"},{id:"resilience_recovery_metric_8",label:"Section 2 Metric 8",description:"Description text for Recovery Metric 8"},{id:"resilience_recovery_metric_9",label:"Section 2 Metric 9",description:"Description text for Recovery Metric 9"}]}}}],qS="data:image/svg+xml,%3csvg%20width='9'%20height='7'%20viewBox='0%200%209%207'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M0.560059%201.41797L4.3045%205.5027L8.04895%201.41797'%20stroke='%23C5C5C5'%20stroke-width='1.04847'%20stroke-linecap='round'/%3e%3c/svg%3e",GS="data:image/svg+xml,%3csvg%20width='228'%20height='21'%20viewBox='0%200%20228%2021'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M3%2021L5.89009%2015.9942H0.109908L3%2021ZM3%201V0.499421H2.49942V1H3ZM225%201H225.501V0.499421H225V1ZM225%2021L227.89%2015.9942H222.11L225%2021ZM3.50058%2016.4948V1H2.49942V16.4948H3.50058ZM3%201.50058H225V0.499421H3V1.50058ZM224.499%201V16.4948H225.501V1H224.499Z'%20fill='%23C5C5C5'/%3e%3c/svg%3e",ZS="data:image/svg+xml,%3csvg%20width='7'%20height='9'%20viewBox='0%200%207%209'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M1.42676%208.3125L5.50552%204.56155L1.41485%200.823597'%20stroke='%23C5C5C5'%20stroke-width='1.04847'%20stroke-linecap='round'/%3e%3c/svg%3e",HS="data:image/svg+xml,%3csvg%20width='138'%20height='21'%20viewBox='0%200%20138%2021'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M3%2021L5.89009%2015.9942H0.109908L3%2021ZM3%201V0.499421H2.49942V1H3ZM135%201H135.501V0.499421H135V1ZM135%2021L137.89%2015.9942H132.11L135%2021ZM3.50058%2016.4948V1H2.49942V16.4948H3.50058ZM3%201.50058H135V0.499421H3V1.50058ZM134.499%201V16.4948H135.501V1H134.499Z'%20fill='%23C5C5C5'/%3e%3c/svg%3e",px=i=>{const a=[],h=(_,w)=>{const T=`${_.label}`;_.status.metrics.forEach(S=>{a.push({domainId:_.id,metricId:S.id,traversedPathForSearchSuggestions:`${T} > ${_.status.label} > ${S.label}`,label:S.label,description:S.description,colorGradient:_.colorGradient})}),_.resilience.resistance.metrics.forEach(S=>{a.push({domainId:_.id,metricId:S.id,traversedPathForSearchSuggestions:`${T} > ${_.resilience.label} > ${_.resilience.resistance.label} > ${S.label}`,label:S.label,description:S.description,colorGradient:_.colorGradient})}),_.resilience.recovery.metrics.forEach(S=>{a.push({domainId:_.id,metricId:S.id,traversedPathForSearchSuggestions:`${T} > ${_.resilience.label} > ${_.resilience.recovery.label} > ${S.label}`,label:S.label,description:S.description,colorGradient:_.colorGradient})})};return i.forEach(_=>h(_)),a};px(yg);const WS=[["AK","","","","","","","","","","ME"],["","","","","","","","","NY","VT","NH"],["WA","","MT","ND","MN","WI","MI","","NJ","CT","NH"],["OR","ID","WY","SD","IL","IN","OH","PA","MD","RI",""],["CA","NV","UT","NE","IA","KY","WV","VA","DC","",""],["","AZ","CO","KS","MO","TN","NC","SC","DE","",""],["","","NM","OK","AR","MS","AL","GA","","",""],["HI","","","TX","LA","","","","FL","",""]],XS=["bg-[#DFE3D5]","bg-[#DFE2D2]","bg-[#7D9FA7]","bg-[#445D7A]","bg-[#5E7B8B]","bg-[#162836]"],KS=i=>i.slice(4,-1),JS=i=>{const a=KS(i);return US(a).luminance()<.5},YS=(i,a)=>{const h=i%a.length;return a[h]},QS=(i,a)=>i.split(new RegExp(`(${a})`,"gi")).map((_,w)=>_.toLowerCase()===a.toLowerCase()?Ee.jsx("strong",{children:_},w):_),eM=({selectedMetricIdObject:i,setSelectedMetricIdObject:a})=>{const[h,_]=Jt.useState(!1),[w,T]=Jt.useState(null),[S,d]=Jt.useState(null),[q,me]=Jt.useState(null),[Pe,le]=Jt.useState(null),[H,Ge]=Jt.useState("Water Pollutants Resistance"),[We,ke]=Jt.useState({water:!0,air:!1,ecosystems:!1,biodiversity:!1,infrastructure:!1,social:!1,economy:!1,culture:!1,carbon:!1}),[gt,he]=Jt.useState(""),[ne,_e]=Jt.useState([]),je=px(yg);Jt.useEffect(()=>{if(gt){const te=gt.toLowerCase(),Ae=je.filter(ee=>ee.traversedPathForSearchSuggestions.toLowerCase().includes(te));_e(Ae)}else _e([])},[gt]);const rt=te=>{ke(Ae=>{const ee={};for(const de in Ae)de===te?ee[de]=!Ae[de]:ee[de]=!1;return ee})};return Ee.jsxs("div",{id:"right-sidebar",className:"h-[calc(100vh-60px)] min-w-[470px] max-w-[470px] overflow-scroll border-l-[1px] border-t-[1px] border-solid border-rightSidebarBorder px-4 pb-2 pt-[0.8rem]",children:[Ee.jsx("h1",{id:"indicator-navigation-header",className:"mb-1 font-BeVietnamPro text-xl font-medium",children:"Indicator Navigation"}),Ee.jsxs("div",{id:"indicator-search-box",className:`relative mb-2 flex w-full flex-row border-[1px] border-rightSidebarSearchBoxGray px-2 py-1 ${h?"rounded-t-lg":"rounded-lg rounded-b-lg"}`,children:[Ee.jsx("img",{src:hx,alt:""}),Ee.jsx("input",{type:"text",placeholder:"Search or select a topic to update the map...",className:"ml-2 w-full border-none bg-transparent text-rightSidebarSearchBoxGray outline-none",value:gt,onChange:te=>he(te.target.value),onInput:te=>_(te.target.value!==""),onFocus:te=>{te.target.value&&_(!0)},onBlur:()=>_(!1)}),h&&Ee.jsx("div",{id:"indicator-search-suggestions",className:"absolute left-[-1px] top-[2rem] z-20 max-h-48 min-h-[10rem] w-[calc(100%+2px)] overflow-y-auto rounded-b-lg border-b border-l border-r border-t border-rightSidebarSearchBoxGray border-t-gray-200 bg-white",children:ne.map((te,Ae)=>Ee.jsx("div",{className:"cursor-pointer py-1 pl-9 hover:bg-gray-200",onMouseDown:()=>{T(`${te.domainId}-${te.metricId}`),rt(te.domainId),Ge(te.label),a({domainId:te.domainId,metricId:te.metricId,label:te.label,description:te.description,colorGradient:te.colorGradient}),he(""),_(!1)},children:Ee.jsx("span",{className:"font-be-vietnam-pro text-base text-rightSidebarSearchBoxGray",children:QS(te.traversedPathForSearchSuggestions,gt)})},Ae))})]}),Ee.jsxs("div",{id:"overall-resilience",className:"relative mb-1 ml-[0.35rem]",children:[Ee.jsxs("div",{className:"flex items-center",children:[Ee.jsx("button",{id:"overall_resilience",onClick:()=>{T("overall_resilience"),Ge("Overall Resilience"),a({domainId:"overall_resilience",metricId:"overall_resilience",label:"Overall Resilience",description:"The overall resilience score to wildfires. This score is calculated from the resilience scores of each domain (e.g. Water, Air, etc.).",colorGradient:{startColor:{r:250,g:250,b:244},endColor:{r:26,g:41,b:60}}})},className:`mr-2 h-6 w-6 rounded-[0.2rem] border-[1px] ${w==="overall_resilience"?"border-metricSelectorBoxesBorderDefault bg-selectedMetricBGColorDefault":"border-metricSelectorBoxesBorderDefault bg-metricSelectorBoxesDefault"}`}),Ee.jsx("span",{className:"font-bold",children:"Overall Resilience"})]}),yg.map(te=>Ee.jsxs("div",{id:te.id,className:"ml-[calc(2.05rem-0.35rem)] mt-1",children:[Ee.jsxs("div",{className:"flex w-[39%] items-center justify-between",children:[Ee.jsxs("div",{className:"flex items-center",children:[Ee.jsx("button",{id:te.id,onClick:()=>{T(te.id),Ge(te.label),a({domainId:te.id,metricId:te.id,label:te.label,description:te.description,colorGradient:te.colorGradient})},className:`mr-2 h-[20px] w-[20px] justify-self-start rounded-[0.2rem] border-[1px] ${w===te.id?"border-metricSelectorBoxesBorderDefault bg-selectedMetricBGColorDefault":"border-metricSelectorBoxesBorderDefault bg-metricSelectorBoxesDefault"}`}),Ee.jsx("span",{className:"font-bold",children:te.label})]}),Ee.jsx("button",{onClick:()=>rt(te.id),className:"ml-2 text-[lightgray]",children:We[te.id]?Ee.jsx("img",{src:qS,alt:"down-arrow",className:"min-h-3 min-w-3"}):Ee.jsx("img",{src:ZS,alt:"right-side-arrow",className:"min-h-3 min-w-3"})})]}),We[te.id]&&Ee.jsxs("div",{id:"subdomain-container",className:"ml-[0.95rem] mt-1 h-[9.5rem]",children:[Ee.jsx("div",{id:"arrows-first-two-sub-domains-container",className:"ml-2 h-5 flex-shrink-0",children:Ee.jsx("img",{src:GS,alt:"arrows-first-two-sub-domains",className:"ml-3 h-full w-auto"})}),Ee.jsxs("div",{className:"flex max-w-[390px] flex-1 justify-between",children:[Ee.jsxs("div",{id:"status",className:"ml-[0.9rem] mr-3 flex flex-shrink-0 flex-col items-start",children:[Ee.jsxs("div",{className:"flex items-center",children:[Ee.jsx("button",{id:te.status.id,onClick:()=>{T(`${te.id}-${te.status.id}`),Ge(`${te.label} ${te.status.label}`),a({domainId:te.id,metricId:te.status.id,label:`${te.status.label}`,description:te.status.description,colorGradient:te.colorGradient})},className:`mr-1 h-4 w-4 rounded-[0.2rem] border-[1px] ${w===`${te.id}-${te.status.id}`?"border-metricSelectorBoxesBorderDefault bg-selectedMetricBGColorDefault":"border-metricSelectorBoxesBorderDefault bg-metricSelectorBoxesDefault"}`}),Ee.jsx("span",{children:te.status.label})]}),Ee.jsx("div",{className:"ml-[1.14rem] grid grid-cols-5 gap-x-1 gap-y-1",children:te.status.metrics.map((Ae,ee)=>Ee.jsx("button",{id:`${te.id}-${Ae.id}`,onMouseEnter:()=>d(Ae.label),onMouseLeave:()=>d(null),onClick:()=>{T(`${te.id}-${Ae.id}`),a({domainId:te.id,metricId:Ae.id,label:`${te.label} ${Ae.label}`,description:Ae.description,colorGradient:te.colorGradient}),Ge(`${te.label} ${Ae.label}`)},className:`h-3.5 w-3.5 rounded-sm border-[1px] ${w===`${te.id}-${Ae.id}`?"border-metricSelectorBoxesBorderDefault bg-selectedMetricBGColorDefault":"border-metricSelectorBoxesBorderDefault bg-metricSelectorBoxesDefault"}`},`${te.id}-${Ae.id}`))}),S&&Ee.jsx("span",{className:"ml-[1.125rem] mt-1 block max-w-[6rem] font-BeVietnamPro text-xs text-selectedMetricTextLabel",children:S})]}),Ee.jsxs("div",{id:"resilience",className:"ml-2 flex w-[60%] flex-shrink-0 flex-col items-center",children:[Ee.jsxs("div",{className:"ml-[4.4rem] flex items-center self-start",children:[Ee.jsx("button",{id:`${te.id}-${te.resilience.id}`,onClick:()=>{T(`${te.id}-${te.resilience.id}`),Ge(`${te.label} ${te.resilience.label}`),a({domainId:te.id,metricId:te.resilience.id,label:`${te.resilience.label}`,description:te.resilience.description,colorGradient:te.colorGradient})},className:`mr-1 h-4 w-4 rounded-[0.2rem] border-[1px] ${w===`${te.id}-${te.resilience.id}`?"border-metricSelectorBoxesBorderDefault bg-selectedMetricBGColorDefault":"border-metricSelectorBoxesBorderDefault bg-metricSelectorBoxesDefault"}`}),Ee.jsx("span",{children:te.resilience.label})]}),Ee.jsx("div",{id:"arrows-for-resilience",className:"ml-[0.6rem] h-5 flex-shrink-0 self-start",children:Ee.jsx("img",{src:HS,alt:"arrows-first-two-sub-domains",className:"h-full w-auto"})}),Ee.jsxs("div",{id:"resilience-content",className:"flex w-full flex-row justify-between",children:[Ee.jsxs("div",{id:"resistance",className:"ml-1 flex w-[45%] flex-shrink-0 flex-col items-start",children:[Ee.jsxs("div",{className:"flex items-center",children:[Ee.jsx("button",{id:`${te.id}-${te.resilience.resistance.id}`,onClick:()=>{T(`${te.id}-${te.resilience.resistance.id}`),Ge(`${te.label} ${te.resilience.resistance.label}`),a({domainId:te.id,metricId:te.resilience.resistance.id,label:`${te.resilience.resistance.label}`,description:te.resilience.resistance.description,colorGradient:te.colorGradient})},className:`mr-1 h-4 w-4 rounded-[0.2rem] border-[1px] ${w===`${te.id}-${te.resilience.resistance.id}`?"border-metricSelectorBoxesBorderDefault bg-selectedMetricBGColorDefault":"border-metricSelectorBoxesBorderDefault bg-metricSelectorBoxesDefault"}`}),Ee.jsx("span",{children:te.resilience.resistance.label})]}),Ee.jsx("div",{className:"ml-[1.14rem] grid grid-cols-5 gap-x-1 gap-y-1",children:te.resilience.resistance.metrics.map((Ae,ee)=>Ee.jsx("button",{id:`${te.id}-${Ae.id}`,onMouseEnter:()=>{me(Ae.label)},onMouseLeave:()=>{me(null)},onClick:()=>{T(`${te.id}-${Ae.id}`),a({domainId:te.id,metricId:Ae.id,label:`${te.label} ${Ae.label}`,description:Ae.description,colorGradient:te.colorGradient}),Ge(`${te.label} ${Ae.label}`)},className:`h-3.5 w-3.5 rounded-sm border-[1px] ${w===`${te.id}-${Ae.id}`?"border-metricSelectorBoxesBorderDefault bg-selectedMetricBGColorDefault":"border-metricSelectorBoxesBorderDefault bg-metricSelectorBoxesDefault"}`},`${te.id}-${Ae.id}`))}),q&&Ee.jsx("span",{className:"ml-[1.125rem] mt-1 block font-BeVietnamPro text-xs text-selectedMetricTextLabel",children:q})]}),Ee.jsxs("div",{id:"recovery",className:"ml-5 flex min-w-[50%] flex-col items-start",children:[Ee.jsxs("div",{className:"flex items-center",children:[Ee.jsx("button",{id:`${te.id}-${te.resilience.recovery.id}`,onClick:()=>{T(`${te.id}-${te.resilience.recovery.id}`),Ge(`${te.label} ${te.resilience.recovery.label}`),a({domainId:te.id,metricId:te.resilience.recovery.id,label:`${te.resilience.recovery.label}`,description:te.resilience.recovery.description,colorGradient:te.colorGradient})},className:`mr-1 h-4 w-4 rounded-[0.2rem] border-[1px] ${w===`${te.id}-${te.resilience.recovery.id}`?"border-metricSelectorBoxesBorderDefault bg-selectedMetricBGColorDefault":"border-metricSelectorBoxesBorderDefault bg-metricSelectorBoxesDefault"}`}),Ee.jsx("span",{children:te.resilience.recovery.label})]}),Ee.jsx("div",{className:"ml-[1.14rem] grid grid-cols-5 gap-x-1 gap-y-1",children:te.resilience.recovery.metrics.map((Ae,ee)=>Ee.jsx("button",{id:`${te.id}-${Ae.id}`,onClick:()=>{T(`${te.id}-${Ae.id}`),a({domainId:te.id,metricId:Ae.id,label:`${te.label} ${Ae.label}`,description:Ae.description,colorGradient:te.colorGradient}),Ge(`${te.label} ${Ae.label}`)},onMouseEnter:()=>{le(Ae.label)},onMouseLeave:()=>{le(null)},className:`h-3.5 w-3.5 rounded-sm border-[1px] ${w===`${te.id}-${Ae.id}`?"border-metricSelectorBoxesBorderDefault bg-selectedMetricBGColorDefault":"border-metricSelectorBoxesBorderDefault bg-metricSelectorBoxesDefault"}`},`${te.id}-${Ae.id}`))}),Pe&&Ee.jsx("span",{className:"ml-[1.125rem] mt-1 block font-BeVietnamPro text-xs text-selectedMetricTextLabel",children:Pe})]})]})]})]})]})]},te.id))]}),Ee.jsxs("div",{id:"selected-indicator-right-sidebar",className:"relative -ml-4 -mr-4 mt-3 flex w-[calc(100%+2rem)] flex-col bg-subheaderBackground p-2",children:[Ee.jsx("h1",{className:"ml-2 text-sm font-bold text-selectedIndicatorTextColor",children:"SELECTED INDICATOR"}),Ee.jsxs("div",{id:"box-holder",className:"ml-2 flex flex-row items-center",children:[Ee.jsx("button",{id:"selected-indicator-box",className:"flex h-5 w-5 items-center justify-center rounded-[0.2rem] border-[1px] border-black bg-[#2693C4]",children:Ee.jsx("div",{className:"h-full w-full rounded-sm"})}),Ee.jsx("span",{className:"ml-2 font-BeVietnamPro font-semibold",children:i?i.label:"Water Pollutants Resistance"})]})]}),Ee.jsx("h1",{className:"font-BeVietnamePro mt-1 text-lg font-medium text-geopgrahicContextLabelTextColor",children:"Geographic Context"}),Ee.jsx("h3",{className:"text-sm text-geopgrahicContextDescriptionTextColor",children:"Select an area to focus the map."}),Ee.jsx("div",{id:"state-navigation-bottom-bar",className:"ml-8 mt-4 max-w-[280px]",children:Ee.jsx("div",{className:"grid grid-cols-11 grid-rows-7 gap-1",children:WS.flat().map((te,Ae)=>{const ee=YS(Ae,XS),de=te&&JS(ee)?"text-white":"text-black";return Ee.jsx("button",{className:`flex h-[20px] w-[20px] items-center justify-center text-[10px] font-semibold ${de} ${te?ee:""}`,children:te},Ae)})})})]})},tM=({selectedMetricObject:i})=>Ee.jsx("div",{id:"sub-header",className:"flex min-h-[80px] w-full items-center border-b-[1px] border-t-[1px] border-solid border-subheaderBorder bg-subheaderBackground pl-[20px]",children:Ee.jsxs("div",{className:"flex w-full flex-col",children:[Ee.jsx("h1",{className:"font-BeVietnamPro text-2xl font-bold",children:i.label||"Overall Resilience"}),Ee.jsx("h3",{className:"overflow-hidden overflow-ellipsis whitespace-nowrap font-BeVietnamPro text-base",children:i.description||"The overall resilience score to wildfires. This score is calculated from the resilience scores of each domain (e.g. Water, Air, etc.)."})]})});function rM(){const[i,a]=Jt.useState({domainId:"air",metricId:"status_metric_1",label:"Overall Domain Score",description:"The overall domain score for each area. This score is calculated from the subdomain scores of each domain.",colorGradient:{startColor:{r:250,g:250,b:244},endColor:{r:26,g:41,b:60}}}),[h,_]=Jt.useState(null),[w,T]=Jt.useState(""),[S,d]=Jt.useState(""),[q,me]=Jt.useState("");return Ee.jsxs("div",{className:"h-full w-full",children:[Ee.jsx(SS,{}),Ee.jsxs("div",{id:"body",className:"flex flex-1",children:[Ee.jsxs("div",{id:"body-minus-right-sidebar",className:"flex min-w-[580px] flex-1 flex-col",children:[Ee.jsx(tM,{selectedMetricObject:i}),Ee.jsx(AS,{selectedCountyName:w,selectedStateName:S,selectedCensusTract:q,selectedMetricValue:h}),Ee.jsx(jS,{selectedMetricIdObject:i,selectedCensusTract:q,setSelectedCountyName:T,setSelectedStateName:d,setSelectedCensusTract:me,setSelectedMetricValue:_})]}),Ee.jsx(eM,{selectedMetricIdObject:i,setSelectedMetricIdObject:a})]})]})}const iM=document.getElementById("root"),nM=nx(iM);nM.render(Ee.jsx(rM,{}));
